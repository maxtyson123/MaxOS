<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Max OS: /home/runner/work/MaxOS/MaxOS/kernel/src/drivers/clock/clock.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Max OS<span id="projectnumber">&#160;0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('clock_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">clock.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="clock_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;<a class="code" href="clock_8h.html">drivers/clock/clock.h</a>&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &lt;<a class="code" href="logger_8h.html">common/logger.h</a>&gt;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="keyword">using namespace </span>MaxOS;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="keyword">using namespace </span>MaxOS::common;</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="keyword">using namespace </span>MaxOS::hardwarecommunication;</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="keyword">using namespace </span>MaxOS::drivers;</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="keyword">using namespace </span>MaxOS::drivers::clock;</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="foldopen" id="foldopen00024" data-start="{" data-end="}">
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#af60d01870c81940dcdce350326e81dd7">   24</a></span><a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#af60d01870c81940dcdce350326e81dd7">Clock::Clock</a>(<a class="code hl_class" href="classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController.html">AdvancedProgrammableInterruptController</a>* apic, <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint16_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time_between_events</a>)</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>: <a class="code hl_class" href="classMaxOS_1_1hardwarecommunication_1_1InterruptHandler.html">InterruptHandler</a>(0x20),</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>  m_apic(apic),</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>  m_ticks_between_events(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time_between_events</a>)</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>{</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>    <a class="code hl_function" href="classLogger.html#a6fa276d92dbf0dd22dcab146f5c99da6">Logger::INFO</a>() &lt;&lt; <span class="stringliteral">&quot;Setting up Clock \n&quot;</span>;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>}</div>
</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>Clock::~Clock() = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="keywordtype">void</span> Clock::handle_interrupt() {</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="comment">// Clock has ticked</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    m_ticks++;</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    m_ticks_until_next_event--;</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    <span class="comment">// Dont raise events until needed</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <span class="keywordflow">if</span> (m_ticks_until_next_event != 0)</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <span class="comment">// Raise the time event</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">//    Time time = get_time();</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">//    raise_event(new TimeEvent(&amp;time));</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    <span class="comment">// Reset</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    m_ticks_until_next_event = m_ticks_between_events;</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>}</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span> </div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a> Clock::read_hardware_clock(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a> address) {</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span> </div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    m_command_port.<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1Port8Bit.html#a6ede8fba6ba7e26c5982a91a3d5ffa72">write</a>(address);</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <span class="keywordflow">return</span> m_data_port.<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1Port8Bit.html#a425297307d64cb5d9889b32767f8fdc3">read</a>();</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>}</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a> Clock::binary_representation(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">number</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="comment">// Check if the conversion needed</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="keywordflow">if</span> (m_binary)</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        <span class="keywordflow">return</span> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">number</a>;</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="comment">// Convert to the binary representation</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="keywordflow">return</span> ((<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">number</a> / 16) * 10) + (<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">number</a> &amp; 0x0f);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>}</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span> </div>
<div class="foldopen" id="foldopen00088" data-start="{" data-end="}">
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#a7d105f260a9197c78e77e0ba437f0168">   88</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#a7d105f260a9197c78e77e0ba437f0168">Clock::activate</a>() {</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    s_active_clock = <span class="keyword">this</span>;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <span class="comment">// Get the stats from the clock</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a> status = read_hardware_clock(0xB);</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <span class="comment">// Store the clock status</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    m_24_hour_clock = status &amp; 0x02;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    m_binary = status &amp; 0x04;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>}</div>
</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="foldopen" id="foldopen00110" data-start="{" data-end="}">
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aed23e6f62c03a9f35056a62e97daad69">  110</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aed23e6f62c03a9f35056a62e97daad69">Clock::delay</a>(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint32_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">milliseconds</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    <span class="comment">// Round the number of milliseconds UP to the nearest clock accuracy</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint64_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">rounded_milliseconds</a> = (<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">milliseconds</a> + <a class="code hl_variable" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aecea13aad11f6fd54bc99bea83a076ee">clock_accuracy</a> - 1) / <a class="code hl_variable" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aecea13aad11f6fd54bc99bea83a076ee">clock_accuracy</a>;</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <span class="comment">// Wait until the time has passed</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint64_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">ticks_until_delay_is_over</a> = m_ticks + <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">rounded_milliseconds</a>;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <span class="keywordflow">while</span> (m_ticks &lt; <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">ticks_until_delay_is_over</a>)</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>        <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;nop&quot;</span>);</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>}</div>
</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="foldopen" id="foldopen00126" data-start="{" data-end="}">
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#af6d0a67fe521cefba6d58d31eaeeaae1">  126</a></span><span class="keywordtype">string</span> <a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#af6d0a67fe521cefba6d58d31eaeeaae1">Clock::vendor_name</a>() {</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Generic&quot;</span>;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>}</div>
</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="foldopen" id="foldopen00135" data-start="{" data-end="}">
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aa090fa2a1970772e55c0064ed975a26a">  135</a></span><span class="keywordtype">string</span> <a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aa090fa2a1970772e55c0064ed975a26a">Clock::device_name</a>() {</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Clock&quot;</span>;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>}</div>
</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="foldopen" id="foldopen00144" data-start="{" data-end="}">
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#afab69ba284bca41ae58a19b1821ad6c1">  144</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#afab69ba284bca41ae58a19b1821ad6c1">Clock::calibrate</a>(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint64_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">ms_per_tick</a>) {</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span> </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <a class="code hl_function" href="classLogger.html#a6fa276d92dbf0dd22dcab146f5c99da6">Logger::INFO</a>() &lt;&lt; <span class="stringliteral">&quot;Calibrating Clock \n&quot;</span>;</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <a class="code hl_variable" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aecea13aad11f6fd54bc99bea83a076ee">clock_accuracy</a> = <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">ms_per_tick</a>;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="comment">// Get the ticks per ms</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <a class="code hl_class" href="classMaxOS_1_1drivers_1_1clock_1_1PIT.html">PIT</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">pit</a>(m_apic);</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    m_pit_ticks_per_ms = <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">pit</a>.ticks_per_ms();</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="comment">// Calibrate the BSP apic to the desired time</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#ab780e51fe8d4680eaa20d7ce53936e90">setup_apic_clock</a>(m_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController.html#af632f7fe1f4a8d9716ec845628946eef">local_apic</a>());</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <a class="code hl_function" href="classLogger.html#a1df434c9cd82457b6830c0500731a601">Logger::DEBUG</a>() &lt;&lt; <span class="stringliteral">&quot;Clock: Calibrated to &quot;</span> &lt;&lt; <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">ms_per_tick</a> &lt;&lt; <span class="stringliteral">&quot;ms per kernel tick\n&quot;</span>;</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>}</div>
</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="foldopen" id="foldopen00163" data-start="{" data-end="}">
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#ab780e51fe8d4680eaa20d7ce53936e90">  163</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#ab780e51fe8d4680eaa20d7ce53936e90">Clock::setup_apic_clock</a>(<a class="code hl_class" href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html">hardwarecommunication::LocalAPIC</a>* local_apic)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="comment">// Configure the clock to periodic mode</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint32_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">lvt</a> = 0x20 | (1 &lt;&lt; 17);</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    local_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#a58100a1d7ff3dac52a6abfb1d5686561">write</a>(0x320, <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">lvt</a>);</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="comment">// Set the initial count</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    local_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#a58100a1d7ff3dac52a6abfb1d5686561">write</a>(0x380, m_pit_ticks_per_ms * <a class="code hl_variable" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aecea13aad11f6fd54bc99bea83a076ee">clock_accuracy</a>);</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    <span class="comment">// Clear the interrupt mask for the clock</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">lvt</a> &amp;= ~(1 &lt;&lt; 16);</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    local_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#a58100a1d7ff3dac52a6abfb1d5686561">write</a>(0x320, <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">lvt</a>);</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>}</div>
</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="foldopen" id="foldopen00182" data-start="{" data-end="}">
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#a138de5b2eb0367cd755e9e32cac3628f">  182</a></span><a class="code hl_struct" href="structMaxOS_1_1common_1_1Time.html">common::Time</a> <a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#a138de5b2eb0367cd755e9e32cac3628f">Clock::get_time</a>() {</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="comment">// Wait for the clock to be ready</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="keywordflow">while</span> (read_hardware_clock(0xA) &amp; 0x80)</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;nop&quot;</span>);</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    <span class="comment">// Read the time from the clock</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <a class="code hl_struct" href="structMaxOS_1_1common_1_1Time.html">Time</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>{};</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>.year = binary_representation(read_hardware_clock(0x9)) + 2000;</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>.month = binary_representation(read_hardware_clock(0x8));</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>.day = binary_representation(read_hardware_clock(0x7));</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>.hour = binary_representation(read_hardware_clock(0x4));</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>.minute = binary_representation(read_hardware_clock(0x2));</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>.second = binary_representation(read_hardware_clock(0x0));</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="comment">// If the clock is using 12hr format and PM is set then add 12 to the hour</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="keywordflow">if</span> (!m_24_hour_clock &amp;&amp; (<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>.hour &amp; 0x80) != 0)</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>.hour = ((<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>.hour &amp; 0x7F) + 12) % 24;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="keywordflow">return</span> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">time</a>;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>}</div>
</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span> </div>
<div class="foldopen" id="foldopen00208" data-start="{" data-end="}">
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#af6e633c389f02276b3c76ee4ff2c65bb">  208</a></span><a class="code hl_class" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html">Clock</a> *<a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#af6e633c389f02276b3c76ee4ff2c65bb">Clock::active_clock</a>() {</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="keywordflow">return</span> s_active_clock;</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>}</div>
</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span> </div>
<div class="foldopen" id="foldopen00216" data-start="{" data-end="}">
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno"><a class="line" href="classMaxOS_1_1drivers_1_1clock_1_1PIT.html#a3862549baa91f68a23e9f76534a917c3">  216</a></span><a class="code hl_function" href="classMaxOS_1_1drivers_1_1clock_1_1PIT.html#a3862549baa91f68a23e9f76534a917c3">PIT::PIT</a>(<a class="code hl_class" href="classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController.html">AdvancedProgrammableInterruptController</a> *apic)</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>: <a class="code hl_class" href="classMaxOS_1_1hardwarecommunication_1_1InterruptHandler.html">InterruptHandler</a>(0x22),</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>  m_data_port(0x40),</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>  m_command_port(0x43),</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>  m_local_apic(apic-&gt;local_apic()),</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>  m_io_apic(apic-&gt;io_apic())</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>{</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span> </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>}</div>
</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span> </div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>PIT::~PIT() = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span><span class="keywordtype">void</span> PIT::handle_interrupt() {</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    m_ticks++;</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>}</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span><a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint32_t</a> PIT::ticks_per_ms() {</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span> </div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="comment">// Set the redirect for the timer interrupt</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <a class="code hl_struct" href="structMaxOS_1_1hardwarecommunication_1_1InterruptRedirect.html">interrupt_redirect_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">redirect</a> = {</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>            .type = 0x2,</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>            .index = 0x14,</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>            .interrupt = 0x22,</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>            .destination = 0x00,</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>            .flags = 0x00,</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>            .mask = <span class="keyword">true</span>,</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    };</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    m_io_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1IOAPIC.html#a4b794a1a0c15a6262dbd6075961b37c2">set_redirect</a>(&amp;<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">redirect</a>);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>    <span class="comment">// Configure the PIT clock</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <a class="code hl_struct" href="structMaxOS_1_1drivers_1_1clock_1_1PITCommand.html">pit_command_t</a> <a class="code hl_variable" href="arp_8h.html#a4635796d5c7e7a2639b11dfe83718acc">command</a> = {</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>            .bcd_mode       = (<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a>) BCDMode::BINARY,</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>            .operating_mode = (<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a>) OperatingMode::RATE_GENERATOR,</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>            .access_mode    = (<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a>) AccessMode::LOW_HIGH_BYTE,</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>            .channel        = (<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a>) Channel::INTERRUPT</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    };</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    m_command_port.<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1Port8Bit.html#a6ede8fba6ba7e26c5982a91a3d5ffa72">write</a>(*(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint8_t</a> *) &amp;<a class="code hl_variable" href="arp_8h.html#a4635796d5c7e7a2639b11dfe83718acc">command</a>);</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="comment">// Set the clock rate to 1 ms;</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint16_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">rate</a> = 1193182 / 1000;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    m_data_port.<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1Port8Bit.html#a6ede8fba6ba7e26c5982a91a3d5ffa72">write</a>(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">rate</a> &amp; 0xFF);</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    m_data_port.<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1Port8Bit.html#a6ede8fba6ba7e26c5982a91a3d5ffa72">write</a>(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">rate</a> &gt;&gt; 8);</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="comment">// Stop the clock</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    m_local_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#a58100a1d7ff3dac52a6abfb1d5686561">write</a>(0x380, 0x00);</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    <span class="comment">// Set the divisor to 2</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    m_local_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#a58100a1d7ff3dac52a6abfb1d5686561">write</a>(0x3E0, 0x0);</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <span class="comment">// Unmask the PIT interrupt</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    m_io_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1IOAPIC.html#ad082ec1b5e7905789976e043b67902ac">set_redirect_mask</a>(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">redirect</a>.index, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    <span class="comment">// Calculate the number of ticks in 1 ms</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <span class="keyword">auto</span> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">max</a> = (<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint32_t</a>) -1;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    m_local_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#a58100a1d7ff3dac52a6abfb1d5686561">write</a>(0x380, <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">max</a>);</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    <span class="keywordflow">while</span> (m_ticks &lt; TICK_CALIBRATE_LENGTH)</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>        <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;nop&quot;</span>);</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint32_t</a> <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">elapsed</a> = <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">max</a> - (m_local_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#ad1a2879252218ed8d96e385b3cc34a7e">read</a>(0x390));</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">uint32_t</a> ticks_per_ms = <a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">elapsed</a> / <a class="code hl_variable" href="clock_8h.html#a25cda667ba25c7e95b6d8f2a96efb9a6">TICK_CALIBRATE_LENGTH</a>;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    <a class="code hl_function" href="classLogger.html#a1df434c9cd82457b6830c0500731a601">Logger::DEBUG</a>() &lt;&lt; <span class="stringliteral">&quot;Ticks per ms: &quot;</span> &lt;&lt; (<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">int</a>) ticks_per_ms &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    <span class="comment">// Disable the PIT interrupt again</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    m_local_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#a58100a1d7ff3dac52a6abfb1d5686561">write</a>(0x380, 0x00);</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    m_io_apic-&gt;<a class="code hl_function" href="classMaxOS_1_1hardwarecommunication_1_1IOAPIC.html#ad082ec1b5e7905789976e043b67902ac">set_redirect_mask</a>(<a class="code hl_class" href="classMaxOS_1_1common_1_1Rectangle.html">redirect</a>.index, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    <span class="keywordflow">return</span> ticks_per_ms;</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>}</div>
<div class="ttc" id="aarp_8h_html_a4635796d5c7e7a2639b11dfe83718acc"><div class="ttname"><a href="arp_8h.html#a4635796d5c7e7a2639b11dfe83718acc">command</a></div><div class="ttdeci">uint16_t command</div><div class="ttdoc">The ARP command (1 = request, 2 = reply)</div><div class="ttdef"><b>Definition</b> <a href="arp_8h_source.html#l00006">arp.h:6</a></div></div>
<div class="ttc" id="aclassLogger_html_a1df434c9cd82457b6830c0500731a601"><div class="ttname"><a href="classLogger.html#a1df434c9cd82457b6830c0500731a601">Logger::DEBUG</a></div><div class="ttdeci">static Logger DEBUG()</div><div class="ttdoc">Gets active logger set to DEBUG level.</div><div class="ttdef"><b>Definition</b> <a href="logger_8cpp_source.html#l00178">logger.cpp:178</a></div></div>
<div class="ttc" id="aclassLogger_html_a6fa276d92dbf0dd22dcab146f5c99da6"><div class="ttname"><a href="classLogger.html#a6fa276d92dbf0dd22dcab146f5c99da6">Logger::INFO</a></div><div class="ttdeci">static Logger INFO()</div><div class="ttdoc">Gets active logger set to info level.</div><div class="ttdef"><b>Definition</b> <a href="logger_8cpp_source.html#l00167">logger.cpp:167</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1common_1_1Rectangle_html"><div class="ttname"><a href="classMaxOS_1_1common_1_1Rectangle.html">MaxOS::common::Rectangle</a></div><div class="ttdoc">Stores the left, top, width and height of a rectangle.</div><div class="ttdef"><b>Definition</b> <a href="rectangle_8h_source.html#l00024">rectangle.h:24</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html">MaxOS::drivers::clock::Clock</a></div><div class="ttdoc">Driver for the APIC clock.</div><div class="ttdef"><b>Definition</b> <a href="clock_8h_source.html#l00121">clock.h:121</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_a138de5b2eb0367cd755e9e32cac3628f"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#a138de5b2eb0367cd755e9e32cac3628f">MaxOS::drivers::clock::Clock::get_time</a></div><div class="ttdeci">common::Time get_time()</div><div class="ttdoc">Reads the current time from the APIC clock (in 24hr time)</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00182">clock.cpp:182</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_a7d105f260a9197c78e77e0ba437f0168"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#a7d105f260a9197c78e77e0ba437f0168">MaxOS::drivers::clock::Clock::activate</a></div><div class="ttdeci">void activate() override</div><div class="ttdoc">Activates the clock, setting the binary coded decimal representation flag.</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00088">clock.cpp:88</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_aa090fa2a1970772e55c0064ed975a26a"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aa090fa2a1970772e55c0064ed975a26a">MaxOS::drivers::clock::Clock::device_name</a></div><div class="ttdeci">string device_name() final</div><div class="ttdoc">Gets the name of the device.</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00135">clock.cpp:135</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_ab780e51fe8d4680eaa20d7ce53936e90"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#ab780e51fe8d4680eaa20d7ce53936e90">MaxOS::drivers::clock::Clock::setup_apic_clock</a></div><div class="ttdeci">void setup_apic_clock(hardwarecommunication::LocalAPIC *local_apic) const</div><div class="ttdoc">Sets up the APIC clock to fire interrupts at the desired rate.</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00163">clock.cpp:163</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_aecea13aad11f6fd54bc99bea83a076ee"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aecea13aad11f6fd54bc99bea83a076ee">MaxOS::drivers::clock::Clock::clock_accuracy</a></div><div class="ttdeci">uint64_t clock_accuracy</div><div class="ttdoc">How accurate the clock is in microseconds (how often should an interrupt be raised)</div><div class="ttdef"><b>Definition</b> <a href="clock_8h_source.html#l00153">clock.h:153</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_aed23e6f62c03a9f35056a62e97daad69"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#aed23e6f62c03a9f35056a62e97daad69">MaxOS::drivers::clock::Clock::delay</a></div><div class="ttdeci">void delay(uint32_t milliseconds) const</div><div class="ttdoc">Delays the program for a specified number of milliseconds (rounded up to the nearest degree of accura...</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00110">clock.cpp:110</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_af60d01870c81940dcdce350326e81dd7"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#af60d01870c81940dcdce350326e81dd7">MaxOS::drivers::clock::Clock::Clock</a></div><div class="ttdeci">Clock(hardwarecommunication::AdvancedProgrammableInterruptController *apic, uint16_t time_between_events=10)</div><div class="ttdoc">Constructor for the Clock class.</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00024">clock.cpp:24</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_af6d0a67fe521cefba6d58d31eaeeaae1"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#af6d0a67fe521cefba6d58d31eaeeaae1">MaxOS::drivers::clock::Clock::vendor_name</a></div><div class="ttdeci">string vendor_name() final</div><div class="ttdoc">Gets the vendor who created the device.</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00126">clock.cpp:126</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_af6e633c389f02276b3c76ee4ff2c65bb"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#af6e633c389f02276b3c76ee4ff2c65bb">MaxOS::drivers::clock::Clock::active_clock</a></div><div class="ttdeci">static Clock * active_clock()</div><div class="ttdoc">Gets the currently active clock.</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00208">clock.cpp:208</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1Clock_html_afab69ba284bca41ae58a19b1821ad6c1"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1Clock.html#afab69ba284bca41ae58a19b1821ad6c1">MaxOS::drivers::clock::Clock::calibrate</a></div><div class="ttdeci">void calibrate(uint64_t ms_per_tick=1)</div><div class="ttdoc">Configures the APIC clock to fire an interrupt at a specified interval in milliseconds.</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00144">clock.cpp:144</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1PIT_html"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1PIT.html">MaxOS::drivers::clock::PIT</a></div><div class="ttdoc">Driver for the Programmable Interval Timer.</div><div class="ttdef"><b>Definition</b> <a href="clock_8h_source.html#l00093">clock.h:93</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1drivers_1_1clock_1_1PIT_html_a3862549baa91f68a23e9f76534a917c3"><div class="ttname"><a href="classMaxOS_1_1drivers_1_1clock_1_1PIT.html#a3862549baa91f68a23e9f76534a917c3">MaxOS::drivers::clock::PIT::PIT</a></div><div class="ttdeci">PIT(hardwarecommunication::AdvancedProgrammableInterruptController *apic)</div><div class="ttdoc">Constructor for the PIT class. Registers a handler for interrupt 0x22 and initializes ports.</div><div class="ttdef"><b>Definition</b> <a href="clock_8cpp_source.html#l00216">clock.cpp:216</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController_html"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController.html">MaxOS::hardwarecommunication::AdvancedProgrammableInterruptController</a></div><div class="ttdoc">Handles both the Local APIC (boot core) and IO APIC.</div><div class="ttdef"><b>Definition</b> <a href="apic_8h_source.html#l00203">apic.h:203</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController_html_af632f7fe1f4a8d9716ec845628946eef"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController.html#af632f7fe1f4a8d9716ec845628946eef">MaxOS::hardwarecommunication::AdvancedProgrammableInterruptController::local_apic</a></div><div class="ttdeci">LocalAPIC * local_apic() const</div><div class="ttdoc">Get the local apic.</div><div class="ttdef"><b>Definition</b> <a href="apic_8cpp_source.html#l00474">apic.cpp:474</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1IOAPIC_html_a4b794a1a0c15a6262dbd6075961b37c2"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1IOAPIC.html#a4b794a1a0c15a6262dbd6075961b37c2">MaxOS::hardwarecommunication::IOAPIC::set_redirect</a></div><div class="ttdeci">void set_redirect(interrupt_redirect_t *redirect)</div><div class="ttdoc">Redirect a system interrupt to a different IRQ.</div><div class="ttdef"><b>Definition</b> <a href="apic_8cpp_source.html#l00362">apic.cpp:362</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1IOAPIC_html_ad082ec1b5e7905789976e043b67902ac"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1IOAPIC.html#ad082ec1b5e7905789976e043b67902ac">MaxOS::hardwarecommunication::IOAPIC::set_redirect_mask</a></div><div class="ttdeci">void set_redirect_mask(uint8_t index, bool mask)</div><div class="ttdoc">Enables/Disables an interrupt redirect by masking it.</div><div class="ttdef"><b>Definition</b> <a href="apic_8cpp_source.html#l00396">apic.cpp:396</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1InterruptHandler_html"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1InterruptHandler.html">MaxOS::hardwarecommunication::InterruptHandler</a></div><div class="ttdoc">Handles a certain interrupt number.</div><div class="ttdef"><b>Definition</b> <a href="interrupts_8h_source.html#l00032">interrupts.h:32</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1LocalAPIC_html"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html">MaxOS::hardwarecommunication::LocalAPIC</a></div><div class="ttdoc">Handles the local APIC for the current core.</div><div class="ttdef"><b>Definition</b> <a href="apic_8h_source.html#l00023">apic.h:23</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1LocalAPIC_html_a58100a1d7ff3dac52a6abfb1d5686561"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#a58100a1d7ff3dac52a6abfb1d5686561">MaxOS::hardwarecommunication::LocalAPIC::write</a></div><div class="ttdeci">void write(uint32_t reg, uint32_t value) const</div><div class="ttdoc">Write a value to the apic register using the MSR or memory I/O depending on the local apic version.</div><div class="ttdef"><b>Definition</b> <a href="apic_8cpp_source.html#l00088">apic.cpp:88</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1LocalAPIC_html_ad1a2879252218ed8d96e385b3cc34a7e"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1LocalAPIC.html#ad1a2879252218ed8d96e385b3cc34a7e">MaxOS::hardwarecommunication::LocalAPIC::read</a></div><div class="ttdeci">uint32_t read(uint32_t reg) const</div><div class="ttdoc">Read a value from the apic register using the MSR or memory I/O depending on the local apic version.</div><div class="ttdef"><b>Definition</b> <a href="apic_8cpp_source.html#l00073">apic.cpp:73</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1Port8Bit_html_a425297307d64cb5d9889b32767f8fdc3"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1Port8Bit.html#a425297307d64cb5d9889b32767f8fdc3">MaxOS::hardwarecommunication::Port8Bit::read</a></div><div class="ttdeci">virtual uint8_t read()</div><div class="ttdoc">read a byte from the port</div><div class="ttdef"><b>Definition</b> <a href="port_8cpp_source.html#l00051">port.cpp:51</a></div></div>
<div class="ttc" id="aclassMaxOS_1_1hardwarecommunication_1_1Port8Bit_html_a6ede8fba6ba7e26c5982a91a3d5ffa72"><div class="ttname"><a href="classMaxOS_1_1hardwarecommunication_1_1Port8Bit.html#a6ede8fba6ba7e26c5982a91a3d5ffa72">MaxOS::hardwarecommunication::Port8Bit::write</a></div><div class="ttdeci">virtual void write(uint8_t data)</div><div class="ttdoc">write a byte to the port</div><div class="ttdef"><b>Definition</b> <a href="port_8cpp_source.html#l00041">port.cpp:41</a></div></div>
<div class="ttc" id="aclock_8h_html"><div class="ttname"><a href="clock_8h.html">clock.h</a></div><div class="ttdoc">Defines drivers for the Programmable Interval Timer (PIT) and APIC Clock.</div></div>
<div class="ttc" id="aclock_8h_html_a25cda667ba25c7e95b6d8f2a96efb9a6"><div class="ttname"><a href="clock_8h.html#a25cda667ba25c7e95b6d8f2a96efb9a6">MaxOS::drivers::clock::TICK_CALIBRATE_LENGTH</a></div><div class="ttdeci">constexpr uint16_t TICK_CALIBRATE_LENGTH</div><div class="ttdoc">How many loops to spin for calibration.</div><div class="ttdef"><b>Definition</b> <a href="clock_8h_source.html#l00087">clock.h:87</a></div></div>
<div class="ttc" id="alogger_8h_html"><div class="ttname"><a href="logger_8h.html">logger.h</a></div><div class="ttdoc">Defines a Logger class for logging messages with different severity levels to multiple output streams...</div></div>
<div class="ttc" id="astructMaxOS_1_1common_1_1Time_html"><div class="ttname"><a href="structMaxOS_1_1common_1_1Time.html">MaxOS::common::Time</a></div><div class="ttdoc">Stores the year, month, day, hour, minute and second of a time.</div><div class="ttdef"><b>Definition</b> <a href="time_8h_source.html#l00022">time.h:22</a></div></div>
<div class="ttc" id="astructMaxOS_1_1drivers_1_1clock_1_1PITCommand_html"><div class="ttname"><a href="structMaxOS_1_1drivers_1_1clock_1_1PITCommand.html">MaxOS::drivers::clock::PITCommand</a></div><div class="ttdoc">The command byte to send to the PIT, specifies the channel, access mode, operating mode and BCD mode.</div><div class="ttdef"><b>Definition</b> <a href="clock_8h_source.html#l00075">clock.h:75</a></div></div>
<div class="ttc" id="astructMaxOS_1_1hardwarecommunication_1_1InterruptRedirect_html"><div class="ttname"><a href="structMaxOS_1_1hardwarecommunication_1_1InterruptRedirect.html">MaxOS::hardwarecommunication::InterruptRedirect</a></div><div class="ttdoc">Defines how an interrupt input is redirected to a specific processor via the I/O APIC.</div><div class="ttdef"><b>Definition</b> <a href="apic_8h_source.html#l00143">apic.h:143</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_3dd30a497388ee684638f120a124721c.html">src</a></li><li class="navelem"><a class="el" href="dir_79cdf04718782f286da113044bf76c98.html">drivers</a></li><li class="navelem"><a class="el" href="dir_6103eb5d66ca6001ea97a378fcd67b9f.html">clock</a></li><li class="navelem"><a class="el" href="clock_8cpp.html">clock.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
