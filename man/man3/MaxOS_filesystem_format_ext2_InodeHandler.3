.TH "MaxOS::filesystem::format::ext2::InodeHandler" 3 "Version 0.1" "Max OS" \" -*- nroff -*-
.ad l
.nh
.SH NAME
MaxOS::filesystem::format::ext2::InodeHandler \- Simplfies the management of an inode & its blocks\&.  

.SH SYNOPSIS
.br
.PP
.PP
\fC#include <ext2\&.h>\fP
.SS "Public Member Functions"

.in +1c
.ti -1c
.RI "\fBInodeHandler\fP (\fBExt2Volume\fP *\fBvolume\fP, \fBuint32_t\fP \fBinode\fP)"
.br
.RI "Construct a new \fBInode\fP Handler object\&. Reads the inode and caches the block pointers\&. "
.ti -1c
.RI "\fBsize_t\fP \fBsize\fP () \fBconst\fP"
.br
.RI "Read the size upper and lower into a single size_t\&. "
.ti -1c
.RI "\fBvoid\fP \fBset_size\fP (\fBsize_t\fP \fBsize\fP)"
.br
.RI "Store the size of the inode data\&. (does not write to disk) "
.ti -1c
.RI "\fBsize_t\fP \fBgrow\fP (\fBsize_t\fP \fBamount\fP, \fBbool\fP flush=\fBtrue\fP)"
.br
.RI "Increase the size of the inode's storage capacity by allocating new blocks\&. "
.ti -1c
.RI "\fBvoid\fP \fBsave\fP ()"
.br
.RI "Writes the inode meta data to disk\&. "
.ti -1c
.RI "\fBvoid\fP \fBfree\fP ()"
.br
.RI "Marks this inode's blocks as free and then the inode as free\&. "
.in -1c
.SS "Public Attributes"

.in +1c
.ti -1c
.RI "uint32_t \fBinode_number\fP"
.br
.RI "The index of the inode\&. "
.ti -1c
.RI "inode_t \fBinode\fP"
.br
.RI "The inode metadata for this file/directory\&. "
.ti -1c
.RI "\fBcommon::Vector\fP< uint32_t > \fBblock_cache\fP"
.br
.RI "All the blocks used by this inode\&. "
.in -1c
.SH "Detailed Description"
.PP 
Simplfies the management of an inode & its blocks\&. 
.PP
Definition at line \fB358\fP of file \fBext2\&.h\fP\&.
.SH "Constructor & Destructor Documentation"
.PP 
.SS "InodeHandler::InodeHandler (\fBExt2Volume\fP * volume, \fBuint32_t\fP inode_index)"

.PP
Construct a new \fBInode\fP Handler object\&. Reads the inode and caches the block pointers\&. 
.PP
\fBParameters\fP
.RS 4
\fIvolume\fP The volume the inode belongs to 
.br
\fIinode_index\fP The inode index 
.RE
.PP

.PP
Definition at line \fB506\fP of file \fBext2\&.cpp\fP\&..PP
.nf
507 : m_volume(volume),
508   inode_number(inode_index),
509   inode(m_volume\->read_inode(inode_number))
510 {
511 
512     // Read the block pointers
513     for (uint32_t direct_pointer = 0; direct_pointer < 12; ++direct_pointer)
514         if (inode\&.block_pointers[direct_pointer])
515             block_cache\&.push_back(inode\&.block_pointers[direct_pointer]);
516 
517     buffer_t buffer(m_volume\->block_size);
518     parse_indirect(1, inode\&.l1_indirect, &buffer);
519     parse_indirect(2, inode\&.l2_indirect, &buffer);
520     parse_indirect(3, inode\&.l3_indirect, &buffer);
521 }
.fi

.PP
References \fBblock_cache\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::block_size\fP, \fBinode\fP, and \fBMaxOS::common::Vector< Type >::push_back()\fP\&.
.SH "Member Function Documentation"
.PP 
.SS "\fBvoid\fP InodeHandler::free ()"

.PP
Marks this inode's blocks as free and then the inode as free\&. 
.PP
Definition at line \fB703\fP of file \fBext2\&.cpp\fP\&..PP
.nf
703                         {
704 
705     m_volume\->ext2_lock\&.lock();
706 
707     // Free the inode
708     m_volume\->free_blocks(block_cache);
709     m_volume\->free_inode(inode_number);
710 
711     m_volume\->ext2_lock\&.unlock();
712 }
.fi

.PP
References \fBblock_cache\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::ext2_lock\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::free_blocks()\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::free_inode()\fP, \fBinode_number\fP, \fBMaxOS::common::Spinlock::lock()\fP, and \fBMaxOS::common::Spinlock::unlock()\fP\&.
.SS "\fBsize_t\fP InodeHandler::grow (\fBsize_t\fP amount, \fBbool\fP flush = \fC\fBtrue\fP\fP)"

.PP
Increase the size of the inode's storage capacity by allocating new blocks\&. 
.PP
\fBParameters\fP
.RS 4
\fIamount\fP The amount to grow to in bytes 
.br
\fIflush\fP Save the newly allocated chunks to disk, defaults to true 
.RE
.PP
\fBReturns\fP
.RS 4
The new toatal size of the file (\fBsize()\fP + amount)
.RE
.PP
\fBTodo\fP
.RS 4
Should this return \fBsize()\fP instead? 
.RE
.PP

.PP
Definition at line \fB673\fP of file \fBext2\&.cpp\fP\&..PP
.nf
673                                                    {
674 
675     // Nothing to grow
676     if (amount <= 0)
677         return size();
678 
679     // Allocate new blocks
680     auto blocks = m_volume\->allocate_blocks(m_volume\->bytes_to_blocks(amount));
681     ASSERT(blocks[0] != 0, "Failed to allocate new blocks for file");
682 
683     // Save the changes
684     store_blocks(blocks);
685     set_size(size() + amount);
686     if (flush)
687         save();
688 
689     return size() + amount;
690 }
.fi

.PP
References \fBMaxOS::filesystem::format::ext2::Ext2Volume::allocate_blocks()\fP, \fBASSERT\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::bytes_to_blocks()\fP, \fBsave()\fP, \fBset_size()\fP, and \fBsize()\fP\&.
.PP
Referenced by \fBMaxOS::filesystem::format::ext2::Ext2File::write()\fP\&.
.SS "\fBvoid\fP InodeHandler::save ()"

.PP
Writes the inode meta data to disk\&. 
.PP
Definition at line \fB695\fP of file \fBext2\&.cpp\fP\&..PP
.nf
695                         {
696 
697     m_volume\->write_inode(inode_number, &inode);
698 }
.fi

.PP
References \fBinode\fP, \fBinode_number\fP, and \fBMaxOS::filesystem::format::ext2::Ext2Volume::write_inode()\fP\&.
.PP
Referenced by \fBgrow()\fP, and \fBMaxOS::filesystem::format::ext2::Ext2File::write()\fP\&.
.SS "\fBvoid\fP InodeHandler::set_size (\fBsize_t\fP size)"

.PP
Store the size of the inode data\&. (does not write to disk) 
.PP
\fBParameters\fP
.RS 4
\fIsize\fP The new size 
.RE
.PP

.PP
Definition at line \fB535\fP of file \fBext2\&.cpp\fP\&..PP
.nf
535                                        {
536 
537     inode\&.size_lower = (uint32_t) (size & 0xFFFFFFFFULL);
538     inode\&.size_upper = (uint32_t) (size >> 32);
539 
540 }
.fi

.PP
References \fBinode\fP, and \fBsize()\fP\&.
.PP
Referenced by \fBgrow()\fP\&.
.SS "\fBsize_t\fP InodeHandler::size () const"

.PP
Read the size upper and lower into a single size_t\&. 
.PP
\fBReturns\fP
.RS 4
The size of the inode data (not the inode itself) 
.RE
.PP

.PP
Definition at line \fB527\fP of file \fBext2\&.cpp\fP\&..PP
.nf
527                                 {
528     return ((size_t) inode\&.size_upper << 32) | (size_t) inode\&.size_lower;
529 }
.fi

.PP
References \fBinode\fP\&.
.PP
Referenced by \fBMaxOS::filesystem::format::ext2::Ext2File::Ext2File()\fP, \fBgrow()\fP, and \fBset_size()\fP\&.
.SH "Member Data Documentation"
.PP 
.SS "\fBcommon::Vector\fP<uint32_t> MaxOS::filesystem::format::ext2::InodeHandler::block_cache"

.PP
All the blocks used by this inode\&. 
.PP
Definition at line \fB373\fP of file \fBext2\&.h\fP\&.
.PP
Referenced by \fBfree()\fP, \fBInodeHandler()\fP, \fBMaxOS::filesystem::format::ext2::Ext2File::read()\fP, \fBMaxOS::filesystem::format::ext2::Ext2Directory::read_from_disk()\fP, and \fBMaxOS::filesystem::format::ext2::Ext2File::write()\fP\&.
.SS "inode_t MaxOS::filesystem::format::ext2::InodeHandler::inode"

.PP
The inode metadata for this file/directory\&. 
.PP
Definition at line \fB372\fP of file \fBext2\&.h\fP\&.
.PP
Referenced by \fBInodeHandler()\fP, \fBsave()\fP, \fBset_size()\fP, \fBsize()\fP, and \fBMaxOS::filesystem::format::ext2::Ext2File::write()\fP\&.
.SS "uint32_t MaxOS::filesystem::format::ext2::InodeHandler::inode_number"

.PP
The index of the inode\&. 
.PP
Definition at line \fB371\fP of file \fBext2\&.h\fP\&.
.PP
Referenced by \fBMaxOS::filesystem::format::ext2::Ext2Directory::create_subdirectory()\fP, \fBfree()\fP, and \fBsave()\fP\&.

.SH "Author"
.PP 
Generated automatically by Doxygen for Max OS from the source code\&.
