.TH "MaxOS::filesystem::format::ext2::InodeHandler" 3 "Version 0.3" "Max OS" \" -*- nroff -*-
.ad l
.nh
.SH NAME
MaxOS::filesystem::format::ext2::InodeHandler \- Simplfies the management of an inode & its blocks\&.  

.SH SYNOPSIS
.br
.PP
.PP
\fC#include <ext2\&.h>\fP
.SS "Public Member Functions"

.in +1c
.ti -1c
.RI "\fBInodeHandler\fP (\fBExt2Volume\fP *\fBvolume\fP, \fBuint32_t\fP \fBinode\fP)"
.br
.RI "Construct a new \fBInode\fP Handler object\&. Reads the inode and caches the block pointers\&. "
.ti -1c
.RI "\fBsize_t\fP \fBsize\fP () \fBconst\fP"
.br
.RI "read the size upper and lower into a single size_t "
.ti -1c
.RI "\fBvoid\fP \fBset_size\fP (\fBsize_t\fP \fBsize\fP)"
.br
.RI "store the size of the inode data\&. (does not write to disk) "
.ti -1c
.RI "\fBsize_t\fP \fBgrow\fP (\fBsize_t\fP \fBamount\fP, \fBbool\fP flush=\fBtrue\fP)"
.br
.RI "Increase the size of the inode's storage capacity by allocating new blocks\&. "
.ti -1c
.RI "\fBvoid\fP \fBsave\fP ()"
.br
.RI "Writes the inode meta data to disk\&. "
.ti -1c
.RI "\fBvoid\fP \fBfree\fP ()"
.br
.RI "Marks this inode's blocks as free and then the inode as free\&. "
.in -1c
.SS "Public Attributes"

.in +1c
.ti -1c
.RI "uint32_t \fBinode_number\fP"
.br
.RI "The index of the inode\&. "
.ti -1c
.RI "\fBinode_t\fP \fBinode\fP"
.br
.RI "The inode metadata for this file/directory\&. "
.ti -1c
.RI "\fBcommon::Vector\fP< uint32_t > \fBblock_cache\fP"
.br
.RI "All the blocks used by this inode\&. "
.in -1c
.SH "Detailed Description"
.PP 
Simplfies the management of an inode & its blocks\&. 
.PP
Definition at line \fB372\fP of file \fBext2\&.h\fP\&.
.SH "Constructor & Destructor Documentation"
.PP 
.SS "InodeHandler::InodeHandler (\fBExt2Volume\fP * volume, \fBuint32_t\fP inode_index)"

.PP
Construct a new \fBInode\fP Handler object\&. Reads the inode and caches the block pointers\&. 
.PP
\fBParameters\fP
.RS 4
\fIvolume\fP The volume the inode belongs to 
.br
\fIinode_index\fP The inode index 
.RE
.PP

.PP
Definition at line \fB509\fP of file \fBext2\&.cpp\fP\&..PP
.nf
510         : m_volume(volume),
511         inode_number(inode_index),
512         inode(m_volume\->read_inode(inode_number)) {
513 
514     // Read the block pointers
515     for(uint32_t direct_pointer = 0; direct_pointer < 12; ++direct_pointer)
516         if(inode\&.block_pointers[direct_pointer])
517             block_cache\&.push_back(inode\&.block_pointers[direct_pointer]);
518 
519     buffer_t buffer(m_volume\->block_size);
520     parse_indirect(1, inode\&.l1_indirect, &buffer);
521     parse_indirect(2, inode\&.l2_indirect, &buffer);
522     parse_indirect(3, inode\&.l3_indirect, &buffer);
523 }
.fi

.PP
References \fBblock_cache\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::block_size\fP, \fBinode\fP, and \fBMaxOS::common::Vector< Type >::push_back()\fP\&.
.SH "Member Function Documentation"
.PP 
.SS "\fBvoid\fP InodeHandler::free ()"

.PP
Marks this inode's blocks as free and then the inode as free\&. 
.PP
Definition at line \fB705\fP of file \fBext2\&.cpp\fP\&..PP
.nf
705                         {
706 
707     m_volume\->ext2_lock\&.lock();
708 
709     // Free the inode
710     m_volume\->free_blocks(block_cache);
711     m_volume\->free_inode(inode_number);
712 
713     m_volume\->ext2_lock\&.unlock();
714 }
.fi

.PP
References \fBblock_cache\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::ext2_lock\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::free_blocks()\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::free_inode()\fP, \fBinode_number\fP, \fBMaxOS::common::Spinlock::lock()\fP, and \fBMaxOS::common::Spinlock::unlock()\fP\&.
.SS "\fBsize_t\fP InodeHandler::grow (\fBsize_t\fP amount, \fBbool\fP flush = \fC\fBtrue\fP\fP)"

.PP
Increase the size of the inode's storage capacity by allocating new blocks\&. 
.PP
\fBParameters\fP
.RS 4
\fIamount\fP The amount to grow to in bytes 
.br
\fIflush\fP Save the newly allocated chunks to disk, defaults to true 
.RE
.PP
\fBReturns\fP
.RS 4
The new toatal size of the file (\fBsize()\fP + amount)
.RE
.PP
\fBTodo\fP
.RS 4
Should this return \fBsize()\fP instead? 
.RE
.PP

.PP
Definition at line \fB675\fP of file \fBext2\&.cpp\fP\&..PP
.nf
675                                                    {
676 
677     // Nothing to grow
678     if(amount <= 0)
679         return size();
680 
681     // Allocate new blocks
682     auto blocks = m_volume\->allocate_blocks(m_volume\->bytes_to_blocks(amount));
683     ASSERT(blocks[0] != 0, "Failed to allocate new blocks for file");
684 
685     // Save the changes
686     store_blocks(blocks);
687     set_size(size() + amount);
688     if(flush)
689         save();
690 
691     return size() + amount;
692 }
.fi

.PP
References \fBMaxOS::filesystem::format::ext2::Ext2Volume::allocate_blocks()\fP, \fBASSERT\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::bytes_to_blocks()\fP, \fBsave()\fP, \fBset_size()\fP, and \fBsize()\fP\&.
.PP
Referenced by \fBMaxOS::filesystem::format::ext2::Ext2File::write()\fP\&.
.SS "\fBvoid\fP InodeHandler::save ()"

.PP
Writes the inode meta data to disk\&. 
.PP
Definition at line \fB697\fP of file \fBext2\&.cpp\fP\&..PP
.nf
697                         {
698 
699     m_volume\->write_inode(inode_number, &inode);
700 }
.fi

.PP
References \fBinode\fP, \fBinode_number\fP, and \fBMaxOS::filesystem::format::ext2::Ext2Volume::write_inode()\fP\&.
.PP
Referenced by \fBgrow()\fP, and \fBMaxOS::filesystem::format::ext2::Ext2File::write()\fP\&.
.SS "\fBvoid\fP InodeHandler::set_size (\fBsize_t\fP size)"

.PP
store the size of the inode data\&. (does not write to disk) 
.PP
\fBParameters\fP
.RS 4
\fIsize\fP The new size 
.RE
.PP

.PP
Definition at line \fB537\fP of file \fBext2\&.cpp\fP\&..PP
.nf
537                                        {
538 
539     inode\&.size_lower = (uint32_t) (size & 0xFFFFFFFFULL);
540     inode\&.size_upper = (uint32_t) (size >> 32);
541 
542 }
.fi

.PP
References \fBinode\fP, and \fBsize()\fP\&.
.PP
Referenced by \fBgrow()\fP\&.
.SS "\fBsize_t\fP InodeHandler::size () const"

.PP
read the size upper and lower into a single size_t 
.PP
\fBReturns\fP
.RS 4
The size of the inode data (not the inode itself) 
.RE
.PP

.PP
Definition at line \fB529\fP of file \fBext2\&.cpp\fP\&..PP
.nf
529                                 {
530     return ((size_t) inode\&.size_upper << 32) | (size_t) inode\&.size_lower;
531 }
.fi

.PP
References \fBinode\fP\&.
.PP
Referenced by \fBMaxOS::filesystem::format::ext2::Ext2File::Ext2File()\fP, \fBgrow()\fP, and \fBset_size()\fP\&.
.SH "Member Data Documentation"
.PP 
.SS "\fBcommon::Vector\fP<uint32_t> MaxOS::filesystem::format::ext2::InodeHandler::block_cache"

.PP
All the blocks used by this inode\&. 
.PP
Definition at line \fB387\fP of file \fBext2\&.h\fP\&.
.PP
Referenced by \fBfree()\fP, \fBInodeHandler()\fP, \fBMaxOS::filesystem::format::ext2::Ext2File::read()\fP, \fBMaxOS::filesystem::format::ext2::Ext2Directory::read_from_disk()\fP, and \fBMaxOS::filesystem::format::ext2::Ext2File::write()\fP\&.
.SS "\fBinode_t\fP MaxOS::filesystem::format::ext2::InodeHandler::inode"

.PP
The inode metadata for this file/directory\&. 
.PP
Definition at line \fB386\fP of file \fBext2\&.h\fP\&.
.PP
Referenced by \fBInodeHandler()\fP, \fBsave()\fP, \fBset_size()\fP, \fBsize()\fP, and \fBMaxOS::filesystem::format::ext2::Ext2File::write()\fP\&.
.SS "uint32_t MaxOS::filesystem::format::ext2::InodeHandler::inode_number"

.PP
The index of the inode\&. 
.PP
Definition at line \fB385\fP of file \fBext2\&.h\fP\&.
.PP
Referenced by \fBMaxOS::filesystem::format::ext2::Ext2Directory::create_subdirectory()\fP, \fBfree()\fP, and \fBsave()\fP\&.

.SH "Author"
.PP 
Generated automatically by Doxygen for Max OS from the source code\&.
