.TH "/home/runner/work/MaxOS/MaxOS/kernel/src/kernel.cpp" 3 "Version 0.1" "Max OS" \" -*- nroff -*-
.ad l
.nh
.SH NAME
/home/runner/work/MaxOS/MaxOS/kernel/src/kernel.cpp \- The main kernel entry point for the bsp and other cores\&. Handles initialisation of all core systems\&.  

.SH SYNOPSIS
.br
.PP
\fC#include <stdint\&.h>\fP
.br
\fC#include <common/logger\&.h>\fP
.br
\fC#include <hardwarecommunication/interrupts\&.h>\fP
.br
\fC#include <drivers/console/serial\&.h>\fP
.br
\fC#include <drivers/console/vesaboot\&.h>\fP
.br
\fC#include <drivers/driver\&.h>\fP
.br
\fC#include <drivers/video/vesa\&.h>\fP
.br
\fC#include <gui/desktop\&.h>\fP
.br
\fC#include <processes/scheduler\&.h>\fP
.br
\fC#include <system/cpu\&.h>\fP
.br
\fC#include <system/syscalls\&.h>\fP
.br
\fC#include <memory/memorymanagement\&.h>\fP
.br
\fC#include <memory/physical\&.h>\fP
.br
\fC#include <memory/virtual\&.h>\fP
.br
\fC#include <filesystem/vfs\&.h>\fP
.br
\fC#include <filesystem/vfsresource\&.h>\fP
.br

.SS "Functions"

.in +1c
.ti -1c
.RI "void \fBcall_constructors\fP ()"
.br
.RI "Calls the C++ static constructors\&. "
.ti -1c
.RI "\fBvoid\fP \fBcore_main\fP ()"
.br
.RI "The main entry point for secondary cores\&. Sets up the core and waits to be scheduled\&. "
.ti -1c
.RI "\fBvoid\fP \fBkernel_main\fP (\fBunsigned\fP \fBlong\fP addr, \fBunsigned\fP \fBlong\fP \fBmagic\fP)"
.br
.RI "The main kernel entry point\&. Initialises all core systems and starts the scheduler\&. "
.in -1c
.SS "Variables"

.in +1c
.ti -1c
.RI "\fBuint8_t\fP \fBcore_boot_info\fP []"
.br
.RI "The boot info structure for the core being started\&. "
.in -1c
.SH "Detailed Description"
.PP 
The main kernel entry point for the bsp and other cores\&. Handles initialisation of all core systems\&. 


.PP
\fBDate\fP
.RS 4
2022 
.RE
.PP
\fBAuthor\fP
.RS 4
Max Tyson 
.RE
.PP

.PP
Definition in file \fBkernel\&.cpp\fP\&.
.SH "Function Documentation"
.PP 
.SS "void call_constructors ()"

.PP
Calls the C++ static constructors\&. 
.PP
Definition at line \fB29\fP of file \fBcplusplus\&.cpp\fP\&..PP
.nf
29                                     {
30     // Loop through and initialise all the global constructors
31     for (constructor* i = &start_ctors; i != &end_ctors; i++)
32         (*i)();
33 }
.fi

.PP
Referenced by \fBkernel_main()\fP\&.
.SS "\fBvoid\fP core_main ()"

.PP
The main entry point for secondary cores\&. Sets up the core and waits to be scheduled\&. 
.PP
Definition at line \fB46\fP of file \fBkernel\&.cpp\fP\&..PP
.nf
46                                         {
47 
48     auto info = (core_boot_info_t*)(core_boot_info);
49     info \-> activated = true;
50     auto core = CPU::executing_core();
51 
52     // Make sure the correct core is being setup
53     ASSERT(info\->id == core\->id, "Current setup core isn't the core expected");
54     Logger::DEBUG() << "Core " << core\->id << " now in higher half \\n";
55 
56     // Set up the core
57     core \-> init();
58     asm("sti");
59 
60     // Wait to be scheduled
61     while (true)
62         asm("nop");
63 }
.fi

.PP
References \fBactivated\fP, \fBASSERT\fP, \fBcore_boot_info\fP, \fBLogger::DEBUG()\fP, and \fBMaxOS::system::CPU::executing_core()\fP\&.
.SS "\fBvoid\fP kernel_main (\fBunsigned\fP \fBlong\fP addr, \fBunsigned\fP \fBlong\fP magic)"

.PP
The main kernel entry point\&. Initialises all core systems and starts the scheduler\&. 
.PP
\fBParameters\fP
.RS 4
\fIaddr\fP The address of the multiboot info struct 
.br
\fImagic\fP The multiboot magic number 
.RE
.PP

.PP
Definition at line \fB71\fP of file \fBkernel\&.cpp\fP\&..PP
.nf
71                                                                                   {
72 
73     call_constructors();
74 
75     // Initialise the logger
76     Logger logger;
77     SerialConsole serial_console(&logger);
78     Logger::INFO() << "MaxOS Booted Successfully 0x\\n";
79 
80     Logger::HEADER() << "Stage {1}: System Initialisation\\n";
81     Multiboot multiboot(addr, magic);
82     GlobalDescriptorTable gdt;
83     InterruptManager interrupts;
84 
85     Logger::HEADER() << "Stage {1\&.1}: Memory Initialisation\\n";
86     PhysicalMemoryManager pmm(&multiboot);
87     VirtualMemoryManager vmm;
88     MemoryManager memoryManager(&vmm);
89 
90     Logger::HEADER() << "Stage {1\&.2}: Console Initialisation\\n";
91     VideoElectronicsStandardsAssociation vesa(multiboot\&.framebuffer());
92     VESABootConsole console(&vesa);
93 
94     Logger::HEADER() << "Stage {2}: Hardware Initialisation\\n";
95     VirtualFileSystem vfs;
96     CPU cpu(&gdt, &multiboot);
97     Clock kernel_clock(&cpu\&.apic, 1);
98     DriverManager driver_manager;
99     driver_manager\&.add_driver(&kernel_clock);
100     driver_manager\&.find_drivers();
101     uint32_t reset_wait_time = driver_manager\&.reset_devices();
102 
103     Logger::HEADER() << "Stage {3}: Device Finalisation\\n";
104     interrupts\&.activate();
105     kernel_clock\&.calibrate();
106     kernel_clock\&.delay(reset_wait_time);
107     driver_manager\&.initialise_drivers();
108     driver_manager\&.activate_drivers();
109     cpu\&.init_cores();
110 
111     Logger::HEADER() << "Stage {4}: System Finalisation\\n";
112     GlobalScheduler scheduler(multiboot);
113     VFSResourceRegistry vfs_registry(&vfs);
114     SyscallManager syscalls;
115     console\&.finish();
116     GlobalScheduler::activate();
117 
118     // Idle loop  (read Idle\&.md)
119     while (true)
120         asm("hlt");
121 
122 }
.fi

.PP
References \fBMaxOS::processes::GlobalScheduler::activate()\fP, \fBcall_constructors()\fP, \fBMaxOS::drivers::console::VESABootConsole::finish()\fP, \fBLogger::HEADER()\fP, \fBLogger::INFO()\fP, and \fBmagic\fP\&.
.SH "Variable Documentation"
.PP 
.SS "\fBuint8_t\fP core_boot_info[]"

.PP
The boot info structure for the core being started\&. 
.PP
Definition at line \fB41\fP of file \fBkernel\&.cpp\fP\&.
.PP
Referenced by \fBcore_main()\fP, \fBMaxOS::system::CPU::init_cores()\fP, and \fBMaxOS::system::Core::wake_up()\fP\&.
.SH "Author"
.PP 
Generated automatically by Doxygen for Max OS from the source code\&.
