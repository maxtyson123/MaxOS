.TH "MaxOS::drivers::peripherals::KeyboardDriver" 3 "Version 0.3" "Max OS" \" -*- nroff -*-
.ad l
.nh
.SH NAME
MaxOS::drivers::peripherals::KeyboardDriver \- \fBDriver\fP for the Keyboard Controller, manages the events and the keyboard state\&.  

.SH SYNOPSIS
.br
.PP
.PP
\fC#include <keyboard\&.h>\fP
.PP
Inherits \fBMaxOS::hardwarecommunication::InterruptHandler\fP, \fBMaxOS::drivers::Driver\fP, and \fBMaxOS::common::GenericInputStream< uint8_t >\fP\&.
.SS "Public Member Functions"

.in +1c
.ti -1c
.RI "\fBKeyboardDriver\fP ()"
.br
.RI "Construct a new Keyboard \fBDriver\fP object, registering it as an interrupt handler for interrupt 0x21\&. "
.ti -1c
.RI "\fBvoid\fP \fBhandle_interrupt\fP () \fBfinal\fP"
.br
.RI "deactivate the keyboard driver "
.ti -1c
.RI "\fBvoid\fP \fBactivate\fP () \fBfinal\fP"
.br
.RI "activate the keyboard driver "
.ti -1c
.RI "\fBstring\fP \fBdevice_name\fP () \fBfinal\fP"
.br
.RI "Get the device name\&. "
.in -1c

Public Member Functions inherited from \fBMaxOS::hardwarecommunication::InterruptHandler\fP
.in +1c
.ti -1c
.RI "\fBvirtual\fP \fBsystem::cpu_status_t\fP * \fBhandle_interrupt\fP (\fBsystem::cpu_status_t\fP *status)"
.br
.RI "Handles an interrupt and returns the status\&. "
.in -1c

Public Member Functions inherited from \fBMaxOS::drivers::Driver\fP
.in +1c
.ti -1c
.RI "\fBvirtual\fP \fBvoid\fP \fBdeactivate\fP ()"
.br
.RI "Deactivate the driver\&. "
.ti -1c
.RI "\fBvirtual\fP \fBvoid\fP \fBinitialise\fP ()"
.br
.RI "Initialise the driver\&. "
.ti -1c
.RI "\fBvirtual\fP \fBuint32_t\fP \fBreset\fP ()"
.br
.RI "Reset the driver\&. "
.ti -1c
.RI "\fBvirtual\fP \fBstring\fP \fBvendor_name\fP ()"
.br
.RI "Get who created the device\&. "
.in -1c

Public Member Functions inherited from \fBMaxOS::common::GenericInputStream< uint8_t >\fP
.in +1c
.ti -1c
.RI "\fBGenericInputStream\fP ()"
.br
.RI "Creates a new \fBGenericInputStream\fP\&. "
.ti -1c
.RI "\fBGenericInputStream\fP (\fBInputStreamEventHandler\fP< \fBuint8_t\fP > *)"
.br
.RI "Creates a new \fBGenericInputStream\fP and connects it to the handler\&. "
.ti -1c
.RI "\fB~GenericInputStream\fP ()"
.br
.RI "Destroys the \fBGenericInputStream\fP and disconnects all handlers\&. "
.ti -1c
.RI "\fBvoid\fP \fBconnect_input_stream_event_handler\fP (\fBInputStreamEventHandler\fP< \fBuint8_t\fP > *)"
.br
.RI "Adds a inputStreamEventHandler to the list of internetProtocolHandlers\&. "
.ti -1c
.RI "\fBvoid\fP \fBdisconnect_input_stream_event_handler\fP (\fBInputStreamEventHandler\fP< \fBuint8_t\fP > *)"
.br
.RI "Removes a handler from the list of handlers\&. "
.in -1c
.SS "Additional Inherited Members"


Protected Member Functions inherited from \fBMaxOS::hardwarecommunication::InterruptHandler\fP
.in +1c
.ti -1c
.RI "\fBInterruptHandler\fP (\fBuint8_t\fP interrupt_number, \fBint64_t\fP \fBredirect\fP=\-1, \fBuint64_t\fP \fBredirect_index\fP=0)"
.br
.RI "Creates a new interrupt handler and registers it with the interrupt manager\&. "
.ti -1c
.RI "\fB~InterruptHandler\fP ()"
.br
.RI "Destroys the interrupt handler and unregisters it from the interrupt manager\&. "
.in -1c

Protected Attributes inherited from \fBMaxOS::hardwarecommunication::InterruptHandler\fP
.in +1c
.ti -1c
.RI "uint8_t \fBm_interrupt_number\fP"
.br
.RI "The interrupt number this handler handles\&. "
.in -1c

Protected Attributes inherited from \fBMaxOS::common::GenericInputStream< uint8_t >\fP
.in +1c
.ti -1c
.RI "\fBcommon::Vector\fP< \fBInputStreamEventHandler\fP< \fBuint8_t\fP > * > \fBm_input_stream_event_handlers\fP"
.br
.RI "List of streams being observed by this handler\&. "
.in -1c
.SH "Detailed Description"
.PP 
\fBDriver\fP for the Keyboard Controller, manages the events and the keyboard state\&. 
.PP
Definition at line \fB446\fP of file \fBkeyboard\&.h\fP\&.
.SH "Constructor & Destructor Documentation"
.PP 
.SS "KeyboardDriver::KeyboardDriver ()"

.PP
Construct a new Keyboard \fBDriver\fP object, registering it as an interrupt handler for interrupt 0x21\&. 
.PP
Definition at line \fB67\fP of file \fBkeyboard\&.cpp\fP\&..PP
.nf
68 : InterruptHandler(0x21, 0x1, 0x12),
69   m_data_port(0x60),
70   m_command_port(0x64)
71 {
72 
73 
74 }
.fi

.SH "Member Function Documentation"
.PP 
.SS "\fBvoid\fP KeyboardDriver::activate ()\fC [final]\fP, \fC [virtual]\fP"

.PP
activate the keyboard driver 
.PP
Reimplemented from \fBMaxOS::drivers::Driver\fP\&.
.PP
Definition at line \fB81\fP of file \fBkeyboard\&.cpp\fP\&..PP
.nf
81                               {
82 
83     // Wait for user to stop pressing key (this is for the start\-up key e\&.g\&. hold 'F12' for boot menu or hold 'del' for bios )
84     while (m_command_port\&.read() & 0x1)
85         m_data_port\&.read();
86 
87     // Enable keyboard interrupts
88     m_command_port\&.write(0xAE);
89 
90     // Get the current state of the keyboard
91     m_command_port\&.write(0x20);
92     uint8_t status = (m_data_port\&.read() | 1) & ~0x10;
93 
94     // Reset the keyboard
95     m_command_port\&.write(0x60);
96     m_data_port\&.write(status);
97 
98     // Activate the keyboard
99     m_data_port\&.write(0xF4);
100 }
.fi

.PP
References \fBMaxOS::hardwarecommunication::Port8Bit::read()\fP, and \fBMaxOS::hardwarecommunication::Port8Bit::write()\fP\&.
.SS "\fBstring\fP KeyboardDriver::device_name ()\fC [final]\fP, \fC [virtual]\fP"

.PP
Get the device name\&. 
.PP
\fBReturns\fP
.RS 4
The device name 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::drivers::Driver\fP\&.
.PP
Definition at line \fB117\fP of file \fBkeyboard\&.cpp\fP\&..PP
.nf
117                                    {
118     return "Keyboard";
119 }
.fi

.SS "\fBvoid\fP KeyboardDriver::handle_interrupt ()\fC [final]\fP, \fC [virtual]\fP"

.PP
deactivate the keyboard driver 
.PP
Reimplemented from \fBMaxOS::hardwarecommunication::InterruptHandler\fP\&.
.PP
Definition at line \fB105\fP of file \fBkeyboard\&.cpp\fP\&..PP
.nf
105                                       {
106 
107     // Pass the scan code to the m_handlers
108     uint8_t key = m_data_port\&.read();
109     for (auto &handler: m_input_stream_event_handlers)
110         handler\->on_stream_read(key);
111 }
.fi

.PP
References \fBMaxOS::common::GenericInputStream< uint8_t >::m_input_stream_event_handlers\fP, and \fBMaxOS::hardwarecommunication::Port8Bit::read()\fP\&.

.SH "Author"
.PP 
Generated automatically by Doxygen for Max OS from the source code\&.
