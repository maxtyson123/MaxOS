.TH "MaxOS::filesystem::format::ext2::Ext2Directory" 3 "Version 0.1" "Max OS" \" -*- nroff -*-
.ad l
.nh
.SH NAME
MaxOS::filesystem::format::ext2::Ext2Directory \- Handles the directory operations on the \fBext2\fP filesystem\&.  

.SH SYNOPSIS
.br
.PP
.PP
\fC#include <ext2\&.h>\fP
.PP
Inherits \fBMaxOS::filesystem::Directory\fP\&.
.SS "Public Member Functions"

.in +1c
.ti -1c
.RI "\fBExt2Directory\fP (\fBExt2Volume\fP *\fBvolume\fP, \fBuint32_t\fP \fBinode\fP, \fBconst\fP \fBstring\fP &\fBname\fP)"
.br
.ti -1c
.RI "\fB~Ext2Directory\fP () final"
.br
.ti -1c
.RI "\fBvoid\fP \fBread_from_disk\fP () \fBfinal\fP"
.br
.RI "Read the directory from the inode on the disk\&. "
.ti -1c
.RI "\fBFile\fP * \fBcreate_file\fP (\fBconst\fP \fBstring\fP &\fBname\fP) \fBfinal\fP"
.br
.RI "Create a new file in the directory\&. "
.ti -1c
.RI "\fBvoid\fP \fBremove_file\fP (\fBconst\fP \fBstring\fP &\fBname\fP) \fBfinal\fP"
.br
.RI "Delete a file from this directory\&. "
.ti -1c
.RI "\fBvoid\fP \fBrename_file\fP (\fBconst\fP \fBstring\fP &\fBold_name\fP, \fBconst\fP \fBstring\fP &\fBnew_name\fP) \fBfinal\fP"
.br
.RI "Renames the file from the old name to the new name if it exists\&. "
.ti -1c
.RI "\fBDirectory\fP * \fBcreate_subdirectory\fP (\fBconst\fP \fBstring\fP &\fBname\fP) \fBfinal\fP"
.br
.RI "Create a new directory in the directory\&. "
.ti -1c
.RI "\fBvoid\fP \fBremove_subdirectory\fP (\fBconst\fP \fBstring\fP &\fBname\fP) \fBfinal\fP"
.br
.RI "Remove a directory entry from the directory\&. "
.ti -1c
.RI "\fBvoid\fP \fBrename_subdirectory\fP (\fBconst\fP \fBstring\fP &\fBold_name\fP, \fBconst\fP \fBstring\fP &\fBnew_name\fP) \fBfinal\fP"
.br
.RI "Renames the directory from the old name to the new name if it exists\&. "
.in -1c

Public Member Functions inherited from \fBMaxOS::filesystem::Directory\fP
.in +1c
.ti -1c
.RI "\fBDirectory\fP ()"
.br
.ti -1c
.RI "\fBvirtual\fP \fB~Directory\fP ()"
.br
.ti -1c
.RI "\fBcommon::Vector\fP< \fBFile\fP * > \fBfiles\fP ()"
.br
.RI "Get the files in the directory\&. "
.ti -1c
.RI "\fBcommon::Vector\fP< \fBDirectory\fP * > \fBsubdirectories\fP ()"
.br
.RI "Get the subdirectories in the directory\&. "
.ti -1c
.RI "\fBFile\fP * \fBopen_file\fP (\fBconst\fP \fBstring\fP &\fBname\fP)"
.br
.RI "Open a file in the directory\&. "
.ti -1c
.RI "\fBDirectory\fP * \fBopen_subdirectory\fP (\fBconst\fP \fBstring\fP &\fBname\fP)"
.br
.RI "Open a directory in the directory\&. "
.ti -1c
.RI "\fBvoid\fP \fBrename_file\fP (\fBFile\fP *file, \fBconst\fP \fBstring\fP &\fBnew_name\fP)"
.br
.RI "Rename a file in the directory\&. "
.ti -1c
.RI "\fBvoid\fP \fBrename_subdirectory\fP (\fBDirectory\fP *directory, \fBconst\fP \fBstring\fP &\fBnew_name\fP)"
.br
.RI "Rename a subdirectory in the directory\&. "
.ti -1c
.RI "\fBstring\fP \fBname\fP ()"
.br
.RI "Get the name of the directory\&. "
.ti -1c
.RI "\fBsize_t\fP \fBsize\fP ()"
.br
.RI "Get the size of the directory\&. "
.in -1c
.SS "Additional Inherited Members"


Protected Attributes inherited from \fBMaxOS::filesystem::Directory\fP
.in +1c
.ti -1c
.RI "\fBcommon::Vector\fP< \fBFile\fP * > \fBm_files\fP"
.br
.ti -1c
.RI "\fBcommon::Vector\fP< \fBDirectory\fP * > \fBm_subdirectories\fP"
.br
.ti -1c
.RI "\fBstring\fP \fBm_name\fP"
.br
.in -1c
.SH "Detailed Description"
.PP 
Handles the directory operations on the \fBext2\fP filesystem\&. 
.PP
Definition at line \fB332\fP of file \fBext2\&.h\fP\&.
.SH "Constructor & Destructor Documentation"
.PP 
.SS "Ext2Directory::Ext2Directory (\fBExt2Volume\fP * volume, \fBuint32_t\fP inode, \fBconst\fP \fBstring\fP & name)"

.PP
Definition at line \fB821\fP of file \fBext2\&.cpp\fP\&..PP
.nf
822 : m_volume(volume),
823   m_inode(m_volume, inode)
824 {
825     m_name = name;
826 }
.fi

.PP
References \fBMaxOS::filesystem::Directory::m_name\fP, and \fBMaxOS::filesystem::Directory::name()\fP\&.
.SS "Ext2Directory::~Ext2Directory ()\fC [final]\fP, \fC [default]\fP"

.SH "Member Function Documentation"
.PP 
.SS "\fBFile\fP * Ext2Directory::create_file (\fBconst\fP \fBstring\fP & name)\fC [final]\fP, \fC [virtual]\fP"

.PP
Create a new file in the directory\&. 
.PP
\fBParameters\fP
.RS 4
\fIname\fP The name of the file to create 
.RE
.PP
\fBReturns\fP
.RS 4
The new file object or null if it could not be created 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::filesystem::Directory\fP\&.
.PP
Definition at line \fB1048\fP of file \fBext2\&.cpp\fP\&..PP
.nf
1048                                                    {
1049 
1050     // Check if the file already exists
1051     for (auto &file: m_files)
1052         if (file\->name() == name)
1053             return nullptr;
1054 
1055     // Create the file
1056     auto file = new Ext2File(m_volume, create_entry(name, 0, false)\&.inode, name);
1057     m_files\&.push_back(file);
1058     return file;
1059 }
.fi

.PP
References \fBinode\fP, \fBMaxOS::filesystem::Directory::m_files\fP, and \fBMaxOS::filesystem::Directory::name()\fP\&.
.SS "\fBDirectory\fP * Ext2Directory::create_subdirectory (\fBconst\fP \fBstring\fP & name)\fC [final]\fP, \fC [virtual]\fP"

.PP
Create a new directory in the directory\&. 
.PP
\fBParameters\fP
.RS 4
\fIname\fP The name of the directory to create 
.RE
.PP
\fBReturns\fP
.RS 4
The new directory object or null if it could not be created 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::filesystem::Directory\fP\&.
.PP
Definition at line \fB1086\fP of file \fBext2\&.cpp\fP\&..PP
.nf
1086                                                                 {
1087 
1088     // Check if the directory already exists
1089     for (auto &subdirectory: m_subdirectories)
1090         if (subdirectory\->name() == name)
1091             return nullptr;
1092 
1093     // Store the directory
1094     auto directory = new Ext2Directory(m_volume, create_entry(name, 0, true)\&.inode, name);
1095     m_subdirectories\&.push_back(directory);
1096 
1097     // Create self & parent references
1098     directory\->create_entry("\&.", directory\->m_inode\&.inode_number, true);
1099     directory\->create_entry("\&.\&.", m_inode\&.inode_number, true);
1100 
1101     return directory;
1102 }
.fi

.PP
References \fBinode\fP, \fBMaxOS::filesystem::format::ext2::InodeHandler::inode_number\fP, \fBMaxOS::filesystem::Directory::m_subdirectories\fP, and \fBMaxOS::filesystem::Directory::name()\fP\&.
.SS "\fBvoid\fP Ext2Directory::read_from_disk ()\fC [final]\fP, \fC [virtual]\fP"

.PP
Read the directory from the inode on the disk\&. 
.PP
Reimplemented from \fBMaxOS::filesystem::Directory\fP\&.
.PP
Definition at line \fB927\fP of file \fBext2\&.cpp\fP\&..PP
.nf
927                                    {
928 
929     m_volume\->ext2_lock\&.lock();
930     m_entries\&.clear();
931     m_entry_names\&.clear();
932 
933     // Clear the old files & Directories
934     for (auto &file: m_files)
935         delete file;
936     m_files\&.clear();
937 
938     for (auto &directory: m_subdirectories)
939         delete directory;
940     m_subdirectories\&.clear();
941 
942     // Read the direct blocks (cant use for( : ))
943     buffer_t buffer(m_volume\->block_size);
944     for (int i = 0; i < m_inode\&.block_cache\&.size(); ++i) {
945         uint32_t block_pointer = m_inode\&.block_cache[i];
946 
947         // Invalid block
948         if (block_pointer == 0)
949             break;
950 
951         // Parse the block
952         m_volume\->read_block(block_pointer, &buffer);
953         parse_block(&buffer);
954     }
955 
956     m_volume\->ext2_lock\&.unlock();
957 }
.fi

.PP
References \fBMaxOS::filesystem::format::ext2::InodeHandler::block_cache\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::block_size\fP, \fBMaxOS::common::Vector< Type >::clear()\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::ext2_lock\fP, \fBMaxOS::common::Spinlock::lock()\fP, \fBMaxOS::filesystem::Directory::m_files\fP, \fBMaxOS::filesystem::Directory::m_subdirectories\fP, \fBMaxOS::filesystem::format::ext2::Ext2Volume::read_block()\fP, \fBMaxOS::common::Vector< Type >::size()\fP, and \fBMaxOS::common::Spinlock::unlock()\fP\&.
.SS "\fBvoid\fP Ext2Directory::remove_file (\fBconst\fP \fBstring\fP & name)\fC [final]\fP, \fC [virtual]\fP"

.PP
Delete a file from this directory\&. 
.PP
\fBParameters\fP
.RS 4
\fIname\fP The name of the file to delete 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::filesystem::Directory\fP\&.
.PP
Definition at line \fB1066\fP of file \fBext2\&.cpp\fP\&..PP
.nf
1066                                                   {
1067     remove_entry(name, false);
1068 }
.fi

.PP
References \fBMaxOS::filesystem::Directory::name()\fP\&.
.SS "\fBvoid\fP Ext2Directory::remove_subdirectory (\fBconst\fP \fBstring\fP & name)\fC [final]\fP, \fC [virtual]\fP"

.PP
Remove a directory entry from the directory\&. 
.PP
\fBParameters\fP
.RS 4
\fIname\fP The name of the entry to remove 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::filesystem::Directory\fP\&.
.PP
Definition at line \fB1109\fP of file \fBext2\&.cpp\fP\&..PP
.nf
1109                                                           {
1110     remove_entry(name, true);
1111 }
.fi

.PP
References \fBMaxOS::filesystem::Directory::name()\fP\&.
.SS "\fBvoid\fP Ext2Directory::rename_file (\fBconst\fP \fBstring\fP & old_name, \fBconst\fP \fBstring\fP & new_name)\fC [final]\fP, \fC [virtual]\fP"

.PP
Renames the file from the old name to the new name if it exists\&. 
.PP
\fBParameters\fP
.RS 4
\fIold_name\fP The current name of the file that is to be changed 
.br
\fInew_name\fP What the new name should be 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::filesystem::Directory\fP\&.
.PP
Definition at line \fB1076\fP of file \fBext2\&.cpp\fP\&..PP
.nf
1076                                                                               {
1077     rename_entry(old_name, new_name, false);
1078 }
.fi

.SS "\fBvoid\fP Ext2Directory::rename_subdirectory (\fBconst\fP \fBstring\fP & old_name, \fBconst\fP \fBstring\fP & new_name)\fC [final]\fP, \fC [virtual]\fP"

.PP
Renames the directory from the old name to the new name if it exists\&. 
.PP
\fBParameters\fP
.RS 4
\fIold_name\fP The current name of the directory that is to be changed 
.br
\fInew_name\fP What the new name should be 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::filesystem::Directory\fP\&.
.PP
Definition at line \fB1119\fP of file \fBext2\&.cpp\fP\&..PP
.nf
1119                                                                                       {
1120     rename_entry(old_name, new_name, true);
1121 }
.fi


.SH "Author"
.PP 
Generated automatically by Doxygen for Max OS from the source code\&.
