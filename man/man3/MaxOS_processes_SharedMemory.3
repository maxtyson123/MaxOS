.TH "MaxOS::processes::SharedMemory" 3 "Version 0.3" "Max OS" \" -*- nroff -*-
.ad l
.nh
.SH NAME
MaxOS::processes::SharedMemory \- A block memory that is mapped into multiple processes\&.  

.SH SYNOPSIS
.br
.PP
.PP
\fC#include <ipc\&.h>\fP
.PP
Inherits \fBMaxOS::processes::Resource\fP\&.
.SS "Public Member Functions"

.in +1c
.ti -1c
.RI "\fBSharedMemory\fP (\fBconst\fP \fBstring\fP &\fBname\fP, \fBsize_t\fP \fBsize\fP, \fBresource_type_t\fP \fBtype\fP)"
.br
.RI "Creates a new shared memory block\&. "
.ti -1c
.RI "\fBvoid\fP \fBopen\fP (\fBsize_t\fP flags) \fBfinal\fP"
.br
.RI "Map the shared memory into the address space of the owning process\&. "
.ti -1c
.RI "\fBvoid\fP \fBclose\fP (\fBsize_t\fP flags) \fBfinal\fP"
.br
.RI "Frees the page containing the shared memory\&. "
.ti -1c
.RI "\fBint\fP \fBread\fP (\fBvoid\fP *buffer, \fBsize_t\fP \fBsize\fP, \fBsize_t\fP flags) \fBfinal\fP"
.br
.RI "Get the address that the current process has this shared memory mapped to\&. "
.ti -1c
.RI "\fBuintptr_t\fP \fBphysical_address\fP () \fBconst\fP"
.br
.RI "Gets the physical address of the shared memory block\&. "
.ti -1c
.RI "\fBsize_t\fP \fBsize\fP () \fBconst\fP"
.br
.RI "Gets the size of the shared memory block\&. "
.in -1c

Public Member Functions inherited from \fBMaxOS::processes::Resource\fP
.in +1c
.ti -1c
.RI "\fBResource\fP (const \fBstring\fP &\fBname\fP, size_t flags, \fBresource_type_t\fP \fBtype\fP)"
.br
.RI "Constructs a new \fBResource\fP object\&. "
.ti -1c
.RI "\fBstring\fP \fBname\fP ()"
.br
.RI "Gets the name of this resource\&. "
.ti -1c
.RI "\fBresource_type_t\fP \fBtype\fP ()"
.br
.RI "Gets the type of this resource\&. "
.ti -1c
.RI "virtual int \fBwrite\fP (const void *buffer, size_t size, size_t flags)"
.br
.RI "write a certain amount of bytes to a resource "
.in -1c
.SH "Detailed Description"
.PP 
A block memory that is mapped into multiple processes\&. 
.PP
Definition at line \fB29\fP of file \fBipc\&.h\fP\&.
.SH "Constructor & Destructor Documentation"
.PP 
.SS "SharedMemory::SharedMemory (\fBconst\fP \fBstring\fP & name, \fBsize_t\fP size, \fBresource_type_t\fP type)"

.PP
Creates a new shared memory block\&. 
.PP
\fBParameters\fP
.RS 4
\fIname\fP The name of the block 
.br
\fIsize\fP The size of the shared memory region 
.br
\fItype\fP The type of resource 
.RE
.PP

.PP
Definition at line \fB29\fP of file \fBipc\&.cpp\fP\&..PP
.nf
30 : Resource(name, size, syscore::ResourceType::SHARED_MEMORY),
31   m_size(size)
32 {
33 
34     m_physical_address = (uintptr_t) PhysicalMemoryManager::s_current_manager\->allocate_area(0, size);
35 }
.fi

.PP
References \fBMaxOS::memory::PhysicalMemoryManager::s_current_manager\fP, and \fBsize()\fP\&.
.SH "Member Function Documentation"
.PP 
.SS "\fBvoid\fP SharedMemory::close (\fBsize_t\fP flags)\fC [final]\fP, \fC [virtual]\fP"

.PP
Frees the page containing the shared memory\&. 
.PP
\fBParameters\fP
.RS 4
\fIflags\fP Not used for this resource 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::processes::Resource\fP\&.
.PP
Definition at line \fB99\fP of file \fBipc\&.cpp\fP\&..PP
.nf
99                                      {
100 
101     PhysicalMemoryManager::s_current_manager\->free_area(m_physical_address, m_size);
102 
103 }
.fi

.PP
References \fBMaxOS::memory::PhysicalMemoryManager::s_current_manager\fP\&.
.SS "\fBvoid\fP SharedMemory::open (\fBsize_t\fP flags)\fC [final]\fP, \fC [virtual]\fP"

.PP
Map the shared memory into the address space of the owning process\&. 
.PP
\fBParameters\fP
.RS 4
\fIflags\fP Not used for this resource 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::processes::Resource\fP\&.
.PP
Definition at line \fB82\fP of file \fBipc\&.cpp\fP\&..PP
.nf
82                                     {
83 
84     // Process has already opened this memory
85     auto it = m_mappings\&.find(GlobalScheduler::current_process()\->pid());
86     if(it != m_mappings\&.end())
87         return;
88 
89     auto virtual_address = (uintptr_t)GlobalScheduler::current_process()\->memory_manager\->vmm()\->load_shared_memory(m_physical_address, m_size);
90     m_mappings\&.insert(GlobalScheduler::current_process()\->pid(), virtual_address);
91 
92 }
.fi

.PP
References \fBMaxOS::processes::GlobalScheduler::current_process()\fP, \fBMaxOS::common::Map< Key, Value >::end()\fP, \fBMaxOS::common::Map< Key, Value >::find()\fP, and \fBMaxOS::common::Map< Key, Value >::insert()\fP\&.
.SS "\fBuintptr_t\fP SharedMemory::physical_address () const"

.PP
Gets the physical address of the shared memory block\&. 
.PP
\fBReturns\fP
.RS 4
The physical address 
.RE
.PP

.PP
Definition at line \fB62\fP of file \fBipc\&.cpp\fP\&..PP
.nf
62                                                {
63 
64     return m_physical_address;
65 }
.fi

.SS "\fBint\fP SharedMemory::read (\fBvoid\fP * buffer, \fBsize_t\fP size, \fBsize_t\fP flags)\fC [final]\fP, \fC [virtual]\fP"

.PP
Get the address that the current process has this shared memory mapped to\&. 
.PP
\fBParameters\fP
.RS 4
\fIbuffer\fP Not used 
.br
\fIsize\fP Not used 
.br
\fIflags\fP Not used 
.RE
.PP
\fBReturns\fP
.RS 4
The virtual address in the current process's address space or 0 if not found 
.RE
.PP

.PP
Reimplemented from \fBMaxOS::processes::Resource\fP\&.
.PP
Definition at line \fB47\fP of file \fBipc\&.cpp\fP\&..PP
.nf
47                                                               {
48 
49     // Process hasn't opened the resource
50     auto it = m_mappings\&.find(GlobalScheduler::current_process()\->pid());
51     if(it == m_mappings\&.end())
52         return 0;
53 
54     return it\->second;
55 }
.fi

.PP
References \fBMaxOS::processes::GlobalScheduler::current_process()\fP, \fBMaxOS::common::Map< Key, Value >::end()\fP, and \fBMaxOS::common::Map< Key, Value >::find()\fP\&.
.SS "\fBsize_t\fP SharedMemory::size () const"

.PP
Gets the size of the shared memory block\&. 
.PP
\fBReturns\fP
.RS 4
The size 
.RE
.PP

.PP
Definition at line \fB72\fP of file \fBipc\&.cpp\fP\&..PP
.nf
72                                 {
73 
74     return m_size;
75 }
.fi

.PP
Referenced by \fBSharedMemory()\fP\&.

.SH "Author"
.PP 
Generated automatically by Doxygen for Max OS from the source code\&.
