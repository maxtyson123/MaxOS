\doxysection{clock.\+cpp}
\hypertarget{clock_8cpp_source}{}\label{clock_8cpp_source}\index{/home/runner/work/MaxOS/MaxOS/kernel/src/drivers/clock/clock.cpp@{/home/runner/work/MaxOS/MaxOS/kernel/src/drivers/clock/clock.cpp}}
\mbox{\hyperlink{clock_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00001}00001\ \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00002}00002\ \textcolor{comment}{//\ Created\ by\ 98max\ on\ 10/04/2023.}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00003}00003\ \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{clock_8h}{drivers/clock/clock.h}}>}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger_8h}{common/logger.h}}>}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00007}00007\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS}{MaxOS}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00008}00008\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS_1_1common}{MaxOS::common}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00009}00009\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS_1_1hardwarecommunication}{MaxOS::hardwarecommunication}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00010}00010\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS_1_1drivers}{MaxOS::drivers}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00011}00011\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1clock}{MaxOS::drivers::clock}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00014}00014\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1ClockEventHandler_a0a3e53fde094381e04580e3f13de7aa6}{ClockEventHandler::ClockEventHandler}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00016}00016\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1ClockEventHandler_ac54bf96a3122127bf5aac04ad1a63881}{ClockEventHandler::\string~ClockEventHandler}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00023}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1ClockEventHandler_a21d4c9d6f8879a83da6447da6fc0bb43}{00023}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1ClockEventHandler_a21d4c9d6f8879a83da6447da6fc0bb43}{ClockEventHandler::on\_time}}(\mbox{\hyperlink{structMaxOS_1_1common_1_1Time}{common::Time}}\ \textcolor{keyword}{const}\ \&)\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00025}00025\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00033}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1ClockEventHandler_ad2533694a01142627490a6fdf7c58b81}{00033}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{Event<ClockEvents>}}\ *\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1ClockEventHandler_ad2533694a01142627490a6fdf7c58b81}{ClockEventHandler::on\_event}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{Event<ClockEvents>}}\ *\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{event}})\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00035}00035\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{event}}-\/>type)\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00036}00036\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1clock_a17687f96357a81b18a16cc4afcdb29a0a346ff32eaa3c09983fb2ec057816d352}{ClockEvents::TIME}}:}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00037}00037\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1ClockEventHandler_a21d4c9d6f8879a83da6447da6fc0bb43}{on\_time}}(*((\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1TimeEvent}{TimeEvent}}\ *)\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{event}})-\/>time);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00038}00038\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00040}00040\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00041}00041\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00042}00042\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00044}00044\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{event}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00045}00045\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00053}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_af60d01870c81940dcdce350326e81dd7}{00053}}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_af60d01870c81940dcdce350326e81dd7}{Clock::Clock}}(\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController}{AdvancedProgrammableInterruptController}}\ *apic,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint16\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time\_between\_events}})}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00054}00054\ :\ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler}{InterruptHandler}}(0x20),}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00055}00055\ \ \ m\_apic(apic),}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00056}00056\ \ \ m\_ticks\_between\_events(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time\_between\_events}})}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00057}00057\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00058}00058\ \ \ \ \ \mbox{\hyperlink{classLogger_a6fa276d92dbf0dd22dcab146f5c99da6}{Logger::INFO}}()\ <<\ \textcolor{stringliteral}{"{}Setting\ up\ Clock\ \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00059}00059\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00061}00061\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_afc976ce68fa85e15cc06f9ed47bddb7c}{Clock::\string~Clock}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00067}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a1f0352d2346a3bef618e5c6f3bc71c0c}{00067}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a1f0352d2346a3bef618e5c6f3bc71c0c}{Clock::handle\_interrupt}}()\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00069}00069\ \ \ \ \ \textcolor{comment}{//\ Clock\ has\ ticked}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00070}00070\ \ \ \ \ m\_ticks++;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00071}00071\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_abf1a0f66bbce7162968437985fd65471}{m\_ticks\_until\_next\_event}}-\/-\/;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00073}00073\ \ \ \ \ \textcolor{comment}{//\ Dont\ raise\ events\ until\ needed}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00074}00074\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_abf1a0f66bbce7162968437985fd65471}{m\_ticks\_until\_next\_event}}\ !=\ 0)}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00075}00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00076}00076\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00077}00077\ \ \ \ \ \textcolor{comment}{//\ Raise\ the\ time\ event}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00078}00078\ \textcolor{comment}{//\ \ \ \ Time\ time\ =\ get\_time();}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00079}00079\ \textcolor{comment}{//\ \ \ \ raise\_event(new\ TimeEvent(\&time));}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00081}00081\ \ \ \ \ \textcolor{comment}{//\ Reset}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00082}00082\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_abf1a0f66bbce7162968437985fd65471}{m\_ticks\_until\_next\_event}}\ =\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_adf42c9a1226e5b2de6e547eb26d26510}{m\_ticks\_between\_events}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00083}00083\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00092}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{00092}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{Clock::read\_hardware\_clock}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}}\ \mbox{\hyperlink{amd__am79c973_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}})\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00094}00094\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_ad4057fa9725f73ccf20eeaff0cd28a23}{m\_command\_port}}.\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1Port8Bit_a6ede8fba6ba7e26c5982a91a3d5ffa72}{write}}(\mbox{\hyperlink{amd__am79c973_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00095}00095\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a6d62ea94e81648255c5f34900f41b75d}{m\_data\_port}}.\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1Port8Bit_a425297307d64cb5d9889b32767f8fdc3}{read}}();}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00096}00096\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00104}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a855c0942318e3392303e5ce96fd96669}{00104}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a855c0942318e3392303e5ce96fd96669}{Clock::binary\_representation}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{number}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00106}00106\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ the\ conversion\ needed}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00107}00107\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_ab008d858cc950af7173ec4a01fca7d3b}{m\_binary}})}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00108}00108\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{number}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00110}00110\ \ \ \ \ \textcolor{comment}{//\ Convert\ to\ the\ binary\ representation}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00111}00111\ \ \ \ \ \textcolor{keywordflow}{return}\ ((\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{number}}\ /\ 16)\ *\ 10)\ +\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{number}}\ \&\ 0x0f);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00112}00112\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00117}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a7d105f260a9197c78e77e0ba437f0168}{00117}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a7d105f260a9197c78e77e0ba437f0168}{Clock::activate}}()\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00118}00118\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00119}00119\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a40ac82256ef1640b87da43ee6fdc8c09}{s\_active\_clock}}\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00121}00121\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ stats\ from\ the\ clock}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00122}00122\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}}\ \mbox{\hyperlink{intel__i217_8h_ade818037fd6c985038ff29656089758d}{status}}\ =\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{read\_hardware\_clock}}(0xB);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00124}00124\ \ \ \ \ \textcolor{comment}{//\ Store\ the\ clock\ status}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00125}00125\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a93c66ecaa24a0024735e8ca110c23bae}{m\_24\_hour\_clock}}\ =\ \mbox{\hyperlink{intel__i217_8h_ade818037fd6c985038ff29656089758d}{status}}\ \&\ 0x02;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00126}00126\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_ab008d858cc950af7173ec4a01fca7d3b}{m\_binary}}\ =\ \mbox{\hyperlink{intel__i217_8h_ade818037fd6c985038ff29656089758d}{status}}\ \&\ 0x04;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00127}00127\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00128}00128\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00139}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aed23e6f62c03a9f35056a62e97daad69}{00139}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aed23e6f62c03a9f35056a62e97daad69}{Clock::delay}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{milliseconds}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00140}00140\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00141}00141\ \ \ \ \ \textcolor{comment}{//\ Round\ the\ number\ of\ milliseconds\ UP\ to\ the\ nearest\ clock\ accuracy}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00142}00142\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{rounded\_milliseconds}}\ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{milliseconds}}\ +\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee}{clock\_accuracy}}\ -\/\ 1)\ /\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee}{clock\_accuracy}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00143}00143\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00144}00144\ \ \ \ \ \textcolor{comment}{//\ Wait\ until\ the\ time\ has\ passed}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00145}00145\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ticks\_until\_delay\_is\_over}}\ =\ m\_ticks\ +\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{rounded\_milliseconds}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00146}00146\ \ \ \ \ \textcolor{keywordflow}{while}\ (m\_ticks\ <\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ticks\_until\_delay\_is\_over}})}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00147}00147\ \ \ \ \ \ \ \ \ \textcolor{keyword}{asm}\ \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"{}nop"{}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00148}00148\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00149}00149\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00155}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6d0a67fe521cefba6d58d31eaeeaae1}{00155}}\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6d0a67fe521cefba6d58d31eaeeaae1}{Clock::vendor\_name}}()\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00156}00156\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Generic"{}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00157}00157\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00164}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aa090fa2a1970772e55c0064ed975a26a}{00164}}\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aa090fa2a1970772e55c0064ed975a26a}{Clock::device\_name}}()\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00165}00165\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Clock"{}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00166}00166\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00167}00167\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00173}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_afab69ba284bca41ae58a19b1821ad6c1}{00173}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_afab69ba284bca41ae58a19b1821ad6c1}{Clock::calibrate}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ms\_per\_tick}})\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00174}00174\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00175}00175\ \ \ \ \ \mbox{\hyperlink{classLogger_a6fa276d92dbf0dd22dcab146f5c99da6}{Logger::INFO}}()\ <<\ \textcolor{stringliteral}{"{}Calibrating\ Clock\ \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00176}00176\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee}{clock\_accuracy}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ms\_per\_tick}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00177}00177\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00178}00178\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ ticks\ per\ ms}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00179}00179\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT}{PIT}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{pit}}(\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aa1fe13def15785a6c01f4db495228f24}{m\_apic}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00180}00180\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ ticks\_per\_ms\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{pit}}.ticks\_per\_ms();}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00181}00181\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00182}00182\ \ \ \ \ \textcolor{comment}{//\ Configure\ the\ clock\ to\ periodic\ mode}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00183}00183\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lvt}}\ =\ 0x20\ |\ (1\ <<\ 17);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00184}00184\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aa1fe13def15785a6c01f4db495228f24}{m\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController_af632f7fe1f4a8d9716ec845628946eef}{local\_apic}}()-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x320,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lvt}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00185}00185\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00186}00186\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ initial\ count}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00187}00187\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aa1fe13def15785a6c01f4db495228f24}{m\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController_af632f7fe1f4a8d9716ec845628946eef}{local\_apic}}()-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x380,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ms\_per\_tick}}\ *\ ticks\_per\_ms);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00188}00188\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00189}00189\ \ \ \ \ \textcolor{comment}{//\ Clear\ the\ interrupt\ mask\ for\ the\ clock}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00190}00190\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lvt}}\ \&=\ \string~(1\ <<\ 16);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00191}00191\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aa1fe13def15785a6c01f4db495228f24}{m\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController_af632f7fe1f4a8d9716ec845628946eef}{local\_apic}}()-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x380,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lvt}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00193}00193\ \ \ \ \ \mbox{\hyperlink{classLogger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}Clock:\ Calibrated\ to\ "{}}\ <<\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ms\_per\_tick}}\ <<\ \textcolor{stringliteral}{"{}ms\ per\ tick\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00194}00194\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00195}00195\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00201}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a138de5b2eb0367cd755e9e32cac3628f}{00201}}\ \mbox{\hyperlink{structMaxOS_1_1common_1_1Time}{common::Time}}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a138de5b2eb0367cd755e9e32cac3628f}{Clock::get\_time}}()\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00202}00202\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00203}00203\ \ \ \ \ \textcolor{comment}{//\ Wait\ for\ the\ clock\ to\ be\ ready}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00204}00204\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{read\_hardware\_clock}}(0xA)\ \&\ 0x80)}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00205}00205\ \ \ \ \ \ \ \ \ \textcolor{keyword}{asm}\ \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"{}nop"{}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00206}00206\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00207}00207\ \ \ \ \ \textcolor{comment}{//\ Read\ the\ time\ from\ the\ clock}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00208}00208\ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1common_1_1Time}{Time}}\ time\{\};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00209}00209\ \ \ \ \ time.\mbox{\hyperlink{structMaxOS_1_1common_1_1Time_a50022d033aeb34a1870e7d8240a4e1ca}{year}}\ =\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a855c0942318e3392303e5ce96fd96669}{binary\_representation}}(\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{read\_hardware\_clock}}(0x9))\ +\ 2000;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00210}00210\ \ \ \ \ time.month\ =\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a855c0942318e3392303e5ce96fd96669}{binary\_representation}}(\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{read\_hardware\_clock}}(0x8));}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00211}00211\ \ \ \ \ time.day\ =\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a855c0942318e3392303e5ce96fd96669}{binary\_representation}}(\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{read\_hardware\_clock}}(0x7));}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00212}00212\ \ \ \ \ time.hour\ =\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a855c0942318e3392303e5ce96fd96669}{binary\_representation}}(\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{read\_hardware\_clock}}(0x4));}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00213}00213\ \ \ \ \ time.minute\ =\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a855c0942318e3392303e5ce96fd96669}{binary\_representation}}(\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{read\_hardware\_clock}}(0x2));}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00214}00214\ \ \ \ \ time.second\ =\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a855c0942318e3392303e5ce96fd96669}{binary\_representation}}(\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a2d5265022c472412b5055cd6630097ed}{read\_hardware\_clock}}(0x0));}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00215}00215\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00216}00216\ \ \ \ \ \textcolor{comment}{//\ If\ the\ clock\ is\ using\ 12hr\ format\ and\ PM\ is\ set\ then\ add\ 12\ to\ the\ hour}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00217}00217\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a93c66ecaa24a0024735e8ca110c23bae}{m\_24\_hour\_clock}}\ \&\&\ (time.hour\ \&\ 0x80)\ !=\ 0)}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00218}00218\ \ \ \ \ \ \ \ \ time.hour\ =\ ((time.hour\ \&\ 0x7F)\ +\ 12)\ \%\ 24;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00219}00219\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00220}00220\ \ \ \ \ \textcolor{keywordflow}{return}\ time;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00221}00221\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00222}00222\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00223}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6e633c389f02276b3c76ee4ff2c65bb}{00223}}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock}{Clock}}\ *\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6e633c389f02276b3c76ee4ff2c65bb}{Clock::active\_clock}}()\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00224}00224\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a40ac82256ef1640b87da43ee6fdc8c09}{s\_active\_clock}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00225}00225\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00226}00226\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00227}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1TimeEvent_af28de45ceb65c439cdabe43d3e80a42c}{00227}}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1TimeEvent_af28de45ceb65c439cdabe43d3e80a42c}{TimeEvent::TimeEvent}}(\mbox{\hyperlink{structMaxOS_1_1common_1_1Time}{Time}}\ *time)}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00228}00228\ :\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Event}{Event}}(\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1clock_a17687f96357a81b18a16cc4afcdb29a0}{ClockEvents}}::\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1clock_a17687f96357a81b18a16cc4afcdb29a0a346ff32eaa3c09983fb2ec057816d352}{TIME}}),}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00229}00229\ \ \ time(time)}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00230}00230\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00231}00231\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00232}00232\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00233}00233\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00234}00234\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1TimeEvent_a088e3a0bd86ba8e8408ffced42415113}{TimeEvent::\string~TimeEvent}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00235}00235\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00236}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a3862549baa91f68a23e9f76534a917c3}{00236}}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a3862549baa91f68a23e9f76534a917c3}{PIT::PIT}}(\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController}{AdvancedProgrammableInterruptController}}\ *apic)}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00237}00237\ :\ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler}{InterruptHandler}}(0x22),}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00238}00238\ \ \ m\_data\_port(0x40),}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00239}00239\ \ \ m\_command\_port(0x43),}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00240}00240\ \ \ m\_local\_apic(apic-\/>local\_apic()),}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00241}00241\ \ \ m\_io\_apic(apic-\/>io\_apic())}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00242}00242\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00243}00243\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00244}00244\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00245}00245\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00246}00246\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a4d9c324e8e6f22583899e496b4bb3471}{PIT::\string~PIT}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00247}00247\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00251}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a986401ff44e3c9ef81e50778cf56a5ac}{00251}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a986401ff44e3c9ef81e50778cf56a5ac}{PIT::handle\_interrupt}}()\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00252}00252\ \ \ \ \ m\_ticks++;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00253}00253\ \}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00254}00254\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00260}\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_aedde96002f9c62875dd502f5265f0314}{00260}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_aedde96002f9c62875dd502f5265f0314}{PIT::ticks\_per\_ms}}()\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00261}00261\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00262}00262\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ redirect\ for\ the\ timer\ interrupt}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00263}00263\ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1hardwarecommunication_1_1InterruptRedirect}{interrupt\_redirect\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{redirect}}\ =\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00264}00264\ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ 0x2,}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00265}00265\ \ \ \ \ \ \ \ \ \ \ \ \ .index\ =\ 0x14,}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00266}00266\ \ \ \ \ \ \ \ \ \ \ \ \ .interrupt\ =\ 0x22,}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00267}00267\ \ \ \ \ \ \ \ \ \ \ \ \ .destination\ =\ 0x00,}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \ \ \ .flags\ =\ 0x00,}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ .mask\ =\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00270}00270\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00271}00271\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a748b2a35eee6a2bb67eb73f4bfa20a33}{m\_io\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1IOAPIC_a4b794a1a0c15a6262dbd6075961b37c2}{set\_redirect}}(\&\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{redirect}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00272}00272\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00273}00273\ \ \ \ \ \textcolor{comment}{//\ Configure\ the\ PIT\ clock}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00274}00274\ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1drivers_1_1clock_1_1PITCommand}{pit\_command\_t}}\ \mbox{\hyperlink{arp_8h_a4635796d5c7e7a2639b11dfe83718acc}{command}}\ =\ \{}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00275}00275\ \ \ \ \ \ \ \ \ \ \ \ \ .bcd\_mode\ \ \ \ \ \ \ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}})\ \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1clock_a138a8792ceb3e2bd560c677d54724b4ca98ad0e8750ae10ad556ed7a62affb452}{BCDMode::BINARY}},}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00276}00276\ \ \ \ \ \ \ \ \ \ \ \ \ .operating\_mode\ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}})\ \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1clock_a9e1786fd3419e0a129f79ffdf56154f7aca50c2eea44eff0b9ae4e9bbec438a65}{OperatingMode::RATE\_GENERATOR}},}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00277}00277\ \ \ \ \ \ \ \ \ \ \ \ \ .access\_mode\ \ \ \ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}})\ \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1clock_aec467a8b28cb0b1b17948364e6710844adbb4778615de7631ad9e4446450576c9}{AccessMode::LOW\_HIGH\_BYTE}},}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00278}00278\ \ \ \ \ \ \ \ \ \ \ \ \ .channel\ \ \ \ \ \ \ \ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}})\ \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1clock_abcf21589b606dd6e2b8a617cda1b0ac3a81b7fe15c43052525db74111aa314cc9}{Channel::INTERRUPT}}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00279}00279\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00280}00280\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_abc47e347e4512f570d7ee4f72aaa5080}{m\_command\_port}}.\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1Port8Bit_a6ede8fba6ba7e26c5982a91a3d5ffa72}{write}}(*(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}}\ *)\ \&\mbox{\hyperlink{arp_8h_a4635796d5c7e7a2639b11dfe83718acc}{command}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00281}00281\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00282}00282\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ clock\ rate\ to\ 1\ ms;}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00283}00283\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint16\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{rate}}\ =\ 1193182\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00284}00284\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_aef7dc8f712b8a35905493187916478c3}{m\_data\_port}}.\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1Port8Bit_a6ede8fba6ba7e26c5982a91a3d5ffa72}{write}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{rate}}\ \&\ 0xFF);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00285}00285\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_aef7dc8f712b8a35905493187916478c3}{m\_data\_port}}.\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1Port8Bit_a6ede8fba6ba7e26c5982a91a3d5ffa72}{write}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{rate}}\ >>\ 8);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00286}00286\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00287}00287\ \ \ \ \ \textcolor{comment}{//\ Stop\ the\ clock}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00288}00288\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a286c0c1d34a7e2c16a541cc18e2ec0ee}{m\_local\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x380,\ 0x00);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00289}00289\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00290}00290\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ divisor\ to\ 2}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00291}00291\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a286c0c1d34a7e2c16a541cc18e2ec0ee}{m\_local\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x3E0,\ 0x0);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00292}00292\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00293}00293\ \ \ \ \ \textcolor{comment}{//\ Unmask\ the\ PIT\ interrupt}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00294}00294\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a748b2a35eee6a2bb67eb73f4bfa20a33}{m\_io\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1IOAPIC_ad082ec1b5e7905789976e043b67902ac}{set\_redirect\_mask}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{redirect}}.index,\ \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00295}00295\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00296}00296\ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ number\ of\ ticks\ in\ 1\ ms}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00297}00297\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{max}}\ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}})\ -\/1;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00298}00298\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a286c0c1d34a7e2c16a541cc18e2ec0ee}{m\_local\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x380,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{max}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00299}00299\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00300}00300\ \ \ \ \ \textcolor{keywordflow}{while}\ (m\_ticks\ <\ s\_calibrate\_ticks)}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00301}00301\ \ \ \ \ \ \ \ \ \textcolor{keyword}{asm}\ \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"{}nop"{}});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00302}00302\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00303}00303\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{elapsed}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{max}}\ -\/\ (\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a286c0c1d34a7e2c16a541cc18e2ec0ee}{m\_local\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ad1a2879252218ed8d96e385b3cc34a7e}{read}}(0x390));}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00304}00304\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_aedde96002f9c62875dd502f5265f0314}{ticks\_per\_ms}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{elapsed}}\ /\ s\_calibrate\_ticks;}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00305}00305\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00306}00306\ \ \ \ \ \mbox{\hyperlink{classLogger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}Ticks\ per\ ms:\ "{}}\ <<\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{int}})\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_aedde96002f9c62875dd502f5265f0314}{ticks\_per\_ms}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00307}00307\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00308}00308\ \ \ \ \ \textcolor{comment}{//\ Disable\ the\ PIT\ interrupt\ again}}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00309}00309\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a286c0c1d34a7e2c16a541cc18e2ec0ee}{m\_local\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x380,\ 0x00);}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00310}00310\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_a748b2a35eee6a2bb67eb73f4bfa20a33}{m\_io\_apic}}-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1IOAPIC_ad082ec1b5e7905789976e043b67902ac}{set\_redirect\_mask}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{redirect}}.index,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00311}00311\ }
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00312}00312\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT_aedde96002f9c62875dd502f5265f0314}{ticks\_per\_ms}};}
\DoxyCodeLine{\Hypertarget{clock_8cpp_source_l00313}00313\ \}}

\end{DoxyCode}
