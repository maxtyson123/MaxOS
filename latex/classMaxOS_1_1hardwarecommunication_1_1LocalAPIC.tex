\doxysection{Max\+OS\+::hardwarecommunication\+::Local\+APIC Class Reference}
\hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC}{}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC}\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}


Handles the local APIC for the current core.  




{\ttfamily \#include $<$apic.\+h$>$}

\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_aad298560517032c27e104146e740938d}{Local\+APIC}} ()
\begin{DoxyCompactList}\small\item\em Construct a new Local APIC object and map the APIC base address to the higher half if needed as well as enabling the APIC. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ad1a2879252218ed8d96e385b3cc34a7e}{read}} (uint32\+\_\+t reg) const
\begin{DoxyCompactList}\small\item\em read a value from the apic register using the MSR or memory I/O depending on the local apic version \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}} (uint32\+\_\+t reg, uint32\+\_\+t value) const
\begin{DoxyCompactList}\small\item\em write a value to the apic register using the MSR or memory I/O depending on the local apic version \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a6c2c7d947c09f992a1733565d8652eb3}{id}} () const
\begin{DoxyCompactList}\small\item\em Get the id of the local apic. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a45235d175880c3ef2123d57b588bc675}{send\+\_\+eoi}} () const
\begin{DoxyCompactList}\small\item\em Acknowledge that the interrupt has been handled, allowing the PIC to process the next interrupt. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_adc19477b42ca278273df00524bb1bde3}{send\+\_\+init}} (uint8\+\_\+t apic\+\_\+id, bool assert) const
\begin{DoxyCompactList}\small\item\em send the init IPI to another apic \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ab0ba1cbb4a4c4711806bc4fcc66bde28}{send\+\_\+startup}} (uint8\+\_\+t apic\+\_\+id, uint8\+\_\+t vector) const
\begin{DoxyCompactList}\small\item\em send the start up IPI to another apic \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Handles the local APIC for the current core. 

Definition at line \mbox{\hyperlink{apic_8h_source_l00024}{24}} of file \mbox{\hyperlink{apic_8h_source}{apic.\+h}}.



\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_aad298560517032c27e104146e740938d}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_aad298560517032c27e104146e740938d} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!LocalAPIC@{LocalAPIC}}
\index{LocalAPIC@{LocalAPIC}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{LocalAPIC()}{LocalAPIC()}}
{\footnotesize\ttfamily Local\+APIC\+::\+Local\+APIC (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Construct a new Local APIC object and map the APIC base address to the higher half if needed as well as enabling the APIC. 



Definition at line \mbox{\hyperlink{apic_8cpp_source_l00021}{21}} of file \mbox{\hyperlink{apic_8cpp_source}{apic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ APIC\ base\ address}}
\DoxyCodeLine{00024\ \ \ \ \ uint64\_t\ msr\_info\ =\ \mbox{\hyperlink{classMaxOS_1_1system_1_1CPU_ac2eb28384db21eb3075768c17302fff4}{CPU::read\_msr}}(0x1B);}
\DoxyCodeLine{00025\ \ \ \ \ m\_apic\_base\ =\ msr\_info\ \&\ 0xFFFFF000;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{comment}{//\ Reserve\ the\ base\ address\ once}}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ bsp\_setup\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordflow}{if}(!bsp\_setup)}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_aac616421554f724ac8810d5bff76c3f1}{PhysicalMemoryManager::s\_current\_manager}}-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}{reserve}}(m\_apic\_base);}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ the\ APIC\ supports\ x2APIC}}
\DoxyCodeLine{00033\ \ \ \ \ uint32\_t\ ignored,\ xleaf,\ x2leaf;}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1system_1_1CPU_a9ff943a994f211939c9f1a907e73b0e1}{CPU::cpuid}}(0x01,\ \&ignored,\ \&ignored,\ \&x2leaf,\ \&xleaf);}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordflow}{if}\ (x2leaf\ \&\ (1\ <<\ 21))\ \{}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enable\ x2APIC}}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ m\_x2apic\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ msr\_info\ |=\ (1\ <<\ 10);}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1system_1_1CPU_ae37f29176f1bd55eb7401d1d34e7c69b}{CPU::write\_msr}}(0x1B,\ msr\_info);}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1Logger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}CPU\ supports\ x2APIC\(\backslash\)n"{}};}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (xleaf\ \&\ (1\ <<\ 9))\ \{}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ m\_x2apic\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1Logger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}CPU\ supports\ xAPIC\(\backslash\)n"{}};}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Map\ the\ APIC\ base\ address\ to\ the\ higher\ half}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ m\_apic\_base\_high\ =\ (uint64\_t)\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1ad616354df4569df849c6f1331cd4b4}{PhysicalMemoryManager::to\_io\_region}}(m\_apic\_base);}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_aac616421554f724ac8810d5bff76c3f1}{PhysicalMemoryManager::s\_current\_manager}}-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}((\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{physical\_address\_t}}*)\ m\_apic\_base,\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{virtual\_address\_t}}*)\ m\_apic\_base\_high,\ PRESENT\ |\ WRITE);}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1Logger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}APIC\ Base:\ phy=0x"{}}\ <<\ m\_apic\_base\ <<\ \textcolor{stringliteral}{"{},\ virt=0x"{}}\ <<\ m\_apic\_base\_high\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00053\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(\textcolor{keyword}{false},\ \textcolor{stringliteral}{"{}CPU\ does\ not\ support\ xAPIC"{}});}
\DoxyCodeLine{00055\ \ \ \ \ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{if}\ (!(msr\_info\ \&\ (1\ <<\ 11)))\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1Logger_a4cc5871bd96523f5c50a2ac8ccbf44f3}{Logger::WARNING}}()\ <<\ \textcolor{stringliteral}{"{}APIC\ is\ not\ enabled\(\backslash\)n"{}};}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00060\ \ \ \ \ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ Enable\ the\ APIC}}
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0xF0,\ (1\ <<\ 8)\ |\ 0x100);}
\DoxyCodeLine{00064\ \ \ \ \ bsp\_setup\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1Logger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}APIC\ Enabled\(\backslash\)n"{}};}
\DoxyCodeLine{00066\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{logger_8h_source_l00100}{ASSERT}}, \mbox{\hyperlink{cpu_8cpp_source_l00403}{Max\+OS\+::system\+::\+CPU\+::cpuid()}}, \mbox{\hyperlink{logger_8cpp_source_l00193}{Max\+OS\+::\+Logger\+::\+DEBUG()}}, \mbox{\hyperlink{physical_8cpp_source_l00538}{Max\+OS\+::memory\+::\+Physical\+Memory\+Manager\+::map()}}, \mbox{\hyperlink{physical_8h_source_l00043}{Max\+OS\+::memory\+::\+PRESENT}}, \mbox{\hyperlink{cpu_8cpp_source_l00372}{Max\+OS\+::system\+::\+CPU\+::read\+\_\+msr()}}, \mbox{\hyperlink{physical_8cpp_source_l00777}{Max\+OS\+::memory\+::\+Physical\+Memory\+Manager\+::reserve()}}, \mbox{\hyperlink{physical_8h_source_l00185}{Max\+OS\+::memory\+::\+Physical\+Memory\+Manager\+::s\+\_\+current\+\_\+manager}}, \mbox{\hyperlink{physical_8cpp_source_l00915}{Max\+OS\+::memory\+::\+Physical\+Memory\+Manager\+::to\+\_\+io\+\_\+region()}}, \mbox{\hyperlink{logger_8cpp_source_l00205}{Max\+OS\+::\+Logger\+::\+WARNING()}}, \mbox{\hyperlink{apic_8cpp_source_l00091}{write()}}, \mbox{\hyperlink{physical_8h_source_l00044}{Max\+OS\+::memory\+::\+WRITE}}, and \mbox{\hyperlink{cpu_8cpp_source_l00388}{Max\+OS\+::system\+::\+CPU\+::write\+\_\+msr()}}.



\doxysubsection{Member Function Documentation}
\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a6c2c7d947c09f992a1733565d8652eb3}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a6c2c7d947c09f992a1733565d8652eb3} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!id@{id}}
\index{id@{id}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{id()}{id()}}
{\footnotesize\ttfamily uint32\+\_\+t Local\+APIC\+::id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Get the id of the local apic. 

\begin{DoxyReturn}{Returns}
The id of the local apic 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{apic_8cpp_source_l00108}{108}} of file \mbox{\hyperlink{apic_8cpp_source}{apic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ Read\ the\ id}}
\DoxyCodeLine{00111\ \ \ \ \ uint32\_t\ \textcolor{keywordtype}{id}\ =\ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ad1a2879252218ed8d96e385b3cc34a7e}{read}}(0x20);}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ id}}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_x2apic\ ?\ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a6c2c7d947c09f992a1733565d8652eb3}{id}}\ :\ (\textcolor{keywordtype}{id}\ >>\ 24);}
\DoxyCodeLine{00115\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{apic_8cpp_source_l00108}{id()}}, and \mbox{\hyperlink{apic_8cpp_source_l00076}{read()}}.



Referenced by \mbox{\hyperlink{apic_8cpp_source_l00108}{id()}}.

\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ad1a2879252218ed8d96e385b3cc34a7e}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ad1a2879252218ed8d96e385b3cc34a7e} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!read@{read}}
\index{read@{read}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{read()}{read()}}
{\footnotesize\ttfamily uint32\+\_\+t Local\+APIC\+::read (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{reg }\end{DoxyParamCaption}) const}



read a value from the apic register using the MSR or memory I/O depending on the local apic version 


\begin{DoxyParams}{Parameters}
{\em reg} & The register to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The value of the register 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{apic_8cpp_source_l00076}{76}} of file \mbox{\hyperlink{apic_8cpp_source}{apic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ If\ x2APIC\ is\ enabled\ I/O\ is\ done\ through\ the\ MSR}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_x2apic)}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (uint32\_t)\ \mbox{\hyperlink{classMaxOS_1_1system_1_1CPU_ac2eb28384db21eb3075768c17302fff4}{CPU::read\_msr}}((reg\ >>\ 4)\ +\ 0x800);}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{return}\ *(\textcolor{keyword}{volatile}\ uint32\_t*)\ ((uintptr\_t)\ m\_apic\_base\_high\ +\ reg);}
\DoxyCodeLine{00083\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{cpu_8cpp_source_l00372}{Max\+OS\+::system\+::\+CPU\+::read\+\_\+msr()}}.



Referenced by \mbox{\hyperlink{apic_8cpp_source_l00108}{id()}}, \mbox{\hyperlink{apic_8cpp_source_l00131}{send\+\_\+init()}}, and \mbox{\hyperlink{apic_8cpp_source_l00170}{send\+\_\+startup()}}.

\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a45235d175880c3ef2123d57b588bc675}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a45235d175880c3ef2123d57b588bc675} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!send\_eoi@{send\_eoi}}
\index{send\_eoi@{send\_eoi}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{send\_eoi()}{send\_eoi()}}
{\footnotesize\ttfamily void Local\+APIC\+::send\+\_\+eoi (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Acknowledge that the interrupt has been handled, allowing the PIC to process the next interrupt. 



Definition at line \mbox{\hyperlink{apic_8cpp_source_l00120}{120}} of file \mbox{\hyperlink{apic_8cpp_source}{apic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0xB0,\ 0);}
\DoxyCodeLine{00123\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{apic_8cpp_source_l00091}{write()}}.

\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_adc19477b42ca278273df00524bb1bde3}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_adc19477b42ca278273df00524bb1bde3} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!send\_init@{send\_init}}
\index{send\_init@{send\_init}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{send\_init()}{send\_init()}}
{\footnotesize\ttfamily void Local\+APIC\+::send\+\_\+init (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{apic\+\_\+id,  }\item[{bool}]{assert }\end{DoxyParamCaption}) const}



send the init IPI to another apic 


\begin{DoxyParams}{Parameters}
{\em apic\+\_\+id} & The id of the apic to send to \\
\hline
{\em assert} & Is this an assert code (drive / release the signal) \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{apic_8cpp_source_l00131}{131}} of file \mbox{\hyperlink{apic_8cpp_source}{apic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ uint32\_t\ icr\_low\ =\ 0;}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{comment}{//\ Delivery\ mode\ =\ INIT\ (101b\ at\ bits\ 8-\/10)}}
\DoxyCodeLine{00136\ \ \ \ \ icr\_low\ |=\ (0b101\ <<\ 8);}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{comment}{//\ Level\ (bit\ 14):\ 1\ =\ assert,\ 0\ =\ de-\/assert}}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordflow}{if}\ (assert)}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ icr\_low\ |=\ (1\ <<\ 14);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ Trigger\ mode:\ Level\ =\ 1}}
\DoxyCodeLine{00143\ \ \ \ \ icr\_low\ |=\ (1\ <<\ 15);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{if}\ (!m\_x2apic)\ \{}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ target\ core}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x310,\ apic\_id\ <<\ 24);}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ INIT\ (Delivery\ mode\ =\ INIT,\ Level\ =\ 1)}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x300,\ icr\_low);}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait\ for\ delivery}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ad1a2879252218ed8d96e385b3cc34a7e}{read}}(0x300)\ \&\ (1\ <<\ 12))}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{asm}\ \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"{}pause"{}});}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ x2APIC}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1system_1_1CPU_ae37f29176f1bd55eb7401d1d34e7c69b}{CPU::write\_msr}}(0x830,\ (uint64\_t)apic\_id\ <<\ 32\ |\ icr\_low);}
\DoxyCodeLine{00161\ \ \ \ \ \}}
\DoxyCodeLine{00162\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{apic_8cpp_source_l00076}{read()}}, \mbox{\hyperlink{apic_8cpp_source_l00091}{write()}}, and \mbox{\hyperlink{cpu_8cpp_source_l00388}{Max\+OS\+::system\+::\+CPU\+::write\+\_\+msr()}}.

\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ab0ba1cbb4a4c4711806bc4fcc66bde28}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ab0ba1cbb4a4c4711806bc4fcc66bde28} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!send\_startup@{send\_startup}}
\index{send\_startup@{send\_startup}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{send\_startup()}{send\_startup()}}
{\footnotesize\ttfamily void Local\+APIC\+::send\+\_\+startup (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{apic\+\_\+id,  }\item[{uint8\+\_\+t}]{vector }\end{DoxyParamCaption}) const}



send the start up IPI to another apic 


\begin{DoxyParams}{Parameters}
{\em apic\+\_\+id} & The apic to send it to \\
\hline
{\em vector} & Where to start executing \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{apic_8cpp_source_l00170}{170}} of file \mbox{\hyperlink{apic_8cpp_source}{apic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keywordflow}{if}\ (!m\_x2apic)\ \{}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ target\ core}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x310,\ apic\_id\ <<\ 24);}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ SIPI\ (Delivery\ mode\ =\ STARTUP)}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x300,\ 0x4600\ |\ vector);}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait\ for\ delivery}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_ad1a2879252218ed8d96e385b3cc34a7e}{read}}(0x300)\ \&\ (1\ <<\ 12))}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{asm}\ \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"{}pause"{}});}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ x2APIC}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1system_1_1CPU_ae37f29176f1bd55eb7401d1d34e7c69b}{CPU::write\_msr}}(0x831,\ (uint64\_t)apic\_id\ <<\ 32\ |\ 0x4600\ |\ vector);}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{apic_8cpp_source_l00076}{read()}}, \mbox{\hyperlink{apic_8cpp_source_l00091}{write()}}, and \mbox{\hyperlink{cpu_8cpp_source_l00388}{Max\+OS\+::system\+::\+CPU\+::write\+\_\+msr()}}.

\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!write@{write}}
\index{write@{write}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{write()}{write()}}
{\footnotesize\ttfamily void Local\+APIC\+::write (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{reg,  }\item[{uint32\+\_\+t}]{value }\end{DoxyParamCaption}) const}



write a value to the apic register using the MSR or memory I/O depending on the local apic version 


\begin{DoxyParams}{Parameters}
{\em reg} & The register to write to \\
\hline
{\em value} & The value to write \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{apic_8cpp_source_l00091}{91}} of file \mbox{\hyperlink{apic_8cpp_source}{apic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{//\ If\ x2APIC\ is\ enabled\ I/O\ is\ done\ through\ the\ MSR}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_x2apic)\{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1system_1_1CPU_ae37f29176f1bd55eb7401d1d34e7c69b}{CPU::write\_msr}}((reg\ >>\ 4)\ +\ 0x800,\ value);}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00097\ \ \ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{//\ Default\ to\ memory\ I/O}}
\DoxyCodeLine{00100\ \ \ \ \ *(\textcolor{keyword}{volatile}\ uint32\_t*)\ ((uintptr\_t)\ m\_apic\_base\_high\ +\ reg)\ =\ value;}
\DoxyCodeLine{00101\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{cpu_8cpp_source_l00388}{Max\+OS\+::system\+::\+CPU\+::write\+\_\+msr()}}.



Referenced by \mbox{\hyperlink{apic_8cpp_source_l00021}{Local\+APIC()}}, \mbox{\hyperlink{apic_8cpp_source_l00120}{send\+\_\+eoi()}}, \mbox{\hyperlink{apic_8cpp_source_l00131}{send\+\_\+init()}}, \mbox{\hyperlink{apic_8cpp_source_l00170}{send\+\_\+startup()}}, and \mbox{\hyperlink{clock_8cpp_source_l00163}{Max\+OS\+::drivers\+::clock\+::\+Clock\+::setup\+\_\+apic\+\_\+clock()}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Max\+OS/\+Max\+OS/kernel/include/hardwarecommunication/\mbox{\hyperlink{apic_8h}{apic.\+h}}\item 
/home/runner/work/\+Max\+OS/\+Max\+OS/kernel/src/hardwarecommunication/\mbox{\hyperlink{apic_8cpp}{apic.\+cpp}}\end{DoxyCompactItemize}
