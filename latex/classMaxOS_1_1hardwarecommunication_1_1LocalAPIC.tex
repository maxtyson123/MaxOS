\hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC}{}\doxysection{Max\+OS\+::hardwarecommunication\+::Local\+A\+P\+IC Class Reference}
\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC}\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}


{\ttfamily \#include $<$apic.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_aad298560517032c27e104146e740938d}{Local\+A\+P\+IC}} ()
\item 
\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a84eafc2ea20a276e8dc52b6f6f46b73b}{$\sim$\+Local\+A\+P\+IC}} ()
\item 
void \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a85adace2840a5d65abc84c6133e44721}{init}} ()
\item 
uint32\+\_\+t \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_addf8f8c80993f47622329a360596993d}{id}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
uint32\+\_\+t \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a9ccb9dce047006c21d4d62e719ea0de2}{read}} (uint32\+\_\+t reg)
\item 
void \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_abe619fbf5c49415635d3e84d34a46289}{write}} (uint32\+\_\+t reg, uint32\+\_\+t value)
\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a745e7ee6cc83206664fbf157b01fd082}{m\+\_\+apic\+\_\+base}}
\item 
uint32\+\_\+t \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a732229d18e57d83bb36444cc6eed0c69}{m\+\_\+id}}
\item 
bool \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a655174d55ab5579b3c8b0bdbbcfae57a}{m\+\_\+x2apic}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 16 of file apic.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_aad298560517032c27e104146e740938d}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_aad298560517032c27e104146e740938d}} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!LocalAPIC@{LocalAPIC}}
\index{LocalAPIC@{LocalAPIC}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{LocalAPIC()}{LocalAPIC()}}
{\footnotesize\ttfamily Local\+A\+P\+I\+C\+::\+Local\+A\+P\+IC (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 11 of file apic.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{11                      \{}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a84eafc2ea20a276e8dc52b6f6f46b73b}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a84eafc2ea20a276e8dc52b6f6f46b73b}} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!````~LocalAPIC@{$\sim$LocalAPIC}}
\index{````~LocalAPIC@{$\sim$LocalAPIC}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{$\sim$LocalAPIC()}{~LocalAPIC()}}
{\footnotesize\ttfamily Local\+A\+P\+I\+C\+::$\sim$\+Local\+A\+P\+IC (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 15 of file apic.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{15                       \{}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_addf8f8c80993f47622329a360596993d}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_addf8f8c80993f47622329a360596993d}} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!id@{id}}
\index{id@{id}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{id()}{id()}}
{\footnotesize\ttfamily uint32\+\_\+t Local\+A\+P\+I\+C\+::id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 84 of file apic.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{84                        \{}
\DoxyCodeLine{85 }
\DoxyCodeLine{86   \textcolor{comment}{// Read the id}}
\DoxyCodeLine{87   uint32\_t \textcolor{keywordtype}{id} = \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a9ccb9dce047006c21d4d62e719ea0de2}{read}}(0x20);}
\DoxyCodeLine{88 }
\DoxyCodeLine{89   \textcolor{comment}{// Return the id}}
\DoxyCodeLine{90   \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a655174d55ab5579b3c8b0bdbbcfae57a}{m\_x2apic}} ? \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_addf8f8c80993f47622329a360596993d}{id}} : (\textcolor{keywordtype}{id} >> 24);}
\DoxyCodeLine{91 }
\DoxyCodeLine{92 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a85adace2840a5d65abc84c6133e44721}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a85adace2840a5d65abc84c6133e44721}} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!init@{init}}
\index{init@{init}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily void Local\+A\+P\+I\+C\+::init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 19 of file apic.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{19                      \{}
\DoxyCodeLine{20 }
\DoxyCodeLine{21   \textcolor{comment}{// Read information about the local APIC}}
\DoxyCodeLine{22   uint64\_t msr\_info = CPU::read\_msr(0x1B);}
\DoxyCodeLine{23 }
\DoxyCodeLine{24   \textcolor{comment}{// Get the APIC base address}}
\DoxyCodeLine{25   \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a745e7ee6cc83206664fbf157b01fd082}{m\_apic\_base}} = msr\_info \& 0xFFFFF000;}
\DoxyCodeLine{26 }
\DoxyCodeLine{27   \textcolor{comment}{// Read if the APIC supports x2APIC}}
\DoxyCodeLine{28   uint32\_t ignored, xleaf, x2leaf;}
\DoxyCodeLine{29   CPU::cpuid(0x01, \&ignored, \&ignored, \&x2leaf, \&xleaf);}
\DoxyCodeLine{30 }
\DoxyCodeLine{31   \textcolor{keywordflow}{if}(x2leaf \& (1 << 21)) \{}
\DoxyCodeLine{32 }
\DoxyCodeLine{33     \textcolor{comment}{// Enable x2APIC}}
\DoxyCodeLine{34     \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a655174d55ab5579b3c8b0bdbbcfae57a}{m\_x2apic}} = \textcolor{keyword}{true};}
\DoxyCodeLine{35     msr\_info |= (1 << 10);}
\DoxyCodeLine{36     CPU::write\_msr(0x1B, msr\_info);}
\DoxyCodeLine{37     \mbox{\hyperlink{kprint_8h_a21d6766fe400d57e508480323c71a148}{\_kprintf}}(\textcolor{stringliteral}{"CPU supports x2APIC\(\backslash\)n"});}
\DoxyCodeLine{38 }
\DoxyCodeLine{39   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (xleaf \& (1 << 9)) \{}
\DoxyCodeLine{40 }
\DoxyCodeLine{41     \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a655174d55ab5579b3c8b0bdbbcfae57a}{m\_x2apic}} = \textcolor{keyword}{false};}
\DoxyCodeLine{42     \mbox{\hyperlink{kprint_8h_a21d6766fe400d57e508480323c71a148}{\_kprintf}}(\textcolor{stringliteral}{"CPU supports xAPIC\(\backslash\)n"});}
\DoxyCodeLine{43 }
\DoxyCodeLine{44   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{45     \mbox{\hyperlink{kprint_8h_a21d6766fe400d57e508480323c71a148}{\_kprintf}}(\textcolor{stringliteral}{"ERROR: CPU does not support APIC (BAD!!)\(\backslash\)n"});}
\DoxyCodeLine{46   \}}
\DoxyCodeLine{47 }
\DoxyCodeLine{48   \textcolor{comment}{// Get the vector table}}
\DoxyCodeLine{49   uint32\_t spurious\_vector = \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a9ccb9dce047006c21d4d62e719ea0de2}{read}}(0xF0);}
\DoxyCodeLine{50   \mbox{\hyperlink{kprint_8h_a21d6766fe400d57e508480323c71a148}{\_kprintf}}(\textcolor{stringliteral}{"APIC Spurious Vector: 0x\%x\(\backslash\)n"}, spurious\_vector \& 0xFF);}
\DoxyCodeLine{51 }
\DoxyCodeLine{52   \textcolor{comment}{// Enable the APIC}}
\DoxyCodeLine{53   \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_abe619fbf5c49415635d3e84d34a46289}{write}}(0xF0, (1 << 8) | 0x100);}
\DoxyCodeLine{54   \mbox{\hyperlink{kprint_8h_a21d6766fe400d57e508480323c71a148}{\_kprintf}}(\textcolor{stringliteral}{"APIC Enabled\(\backslash\)n"});}
\DoxyCodeLine{55 }
\DoxyCodeLine{56   \textcolor{comment}{// Read the APIC version}}
\DoxyCodeLine{57   uint32\_t \mbox{\hyperlink{ipv4_8h_ab22abc2906422da61885ac6c8e6a1a59}{version}} = \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a9ccb9dce047006c21d4d62e719ea0de2}{read}}(0x30);}
\DoxyCodeLine{58   \mbox{\hyperlink{kprint_8h_a21d6766fe400d57e508480323c71a148}{\_kprintf}}(\textcolor{stringliteral}{"APIC Version: 0x\%x\(\backslash\)n"}, \mbox{\hyperlink{ipv4_8h_ab22abc2906422da61885ac6c8e6a1a59}{version}} \& 0xFF);}
\DoxyCodeLine{59 }
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \}}

\end{DoxyCode}


References \+\_\+kprintf(), and version.



Referenced by Max\+O\+S\+::hardwarecommunication\+::\+Advanced\+Programmable\+Interrupt\+Controller\+::\+Advanced\+Programmable\+Interrupt\+Controller().

\mbox{\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a9ccb9dce047006c21d4d62e719ea0de2}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a9ccb9dce047006c21d4d62e719ea0de2}} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!read@{read}}
\index{read@{read}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{read()}{read()}}
{\footnotesize\ttfamily uint32\+\_\+t Local\+A\+P\+I\+C\+::read (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{reg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line 63 of file apic.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{63                                      \{}
\DoxyCodeLine{64 }
\DoxyCodeLine{65   \textcolor{comment}{// If x2APIC is enabled, use the x2APIC MSR}}
\DoxyCodeLine{66   \textcolor{keywordflow}{if}(\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a655174d55ab5579b3c8b0bdbbcfae57a}{m\_x2apic}}) \{}
\DoxyCodeLine{67       \textcolor{keywordflow}{return} (uint32\_t)CPU::read\_msr((reg >> 4) + 0x800);}
\DoxyCodeLine{68   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{69       \textcolor{keywordflow}{return} (*(\textcolor{keyword}{volatile} uint32\_t*)((uintptr\_t)\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a745e7ee6cc83206664fbf157b01fd082}{m\_apic\_base}} + reg));}
\DoxyCodeLine{70   \}}
\DoxyCodeLine{71 }
\DoxyCodeLine{72 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_abe619fbf5c49415635d3e84d34a46289}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_abe619fbf5c49415635d3e84d34a46289}} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!write@{write}}
\index{write@{write}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{write()}{write()}}
{\footnotesize\ttfamily void Local\+A\+P\+I\+C\+::write (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{reg,  }\item[{uint32\+\_\+t}]{value }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line 74 of file apic.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{74                                                   \{}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \textcolor{comment}{// If x2APIC is enabled, use the x2APIC MSR}}
\DoxyCodeLine{77   \textcolor{keywordflow}{if}(\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a655174d55ab5579b3c8b0bdbbcfae57a}{m\_x2apic}}) \{}
\DoxyCodeLine{78       CPU::write\_msr((reg >> 4) + 0x800, value);}
\DoxyCodeLine{79   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{80       (*(\textcolor{keyword}{volatile} uint32\_t*)((uintptr\_t)\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a745e7ee6cc83206664fbf157b01fd082}{m\_apic\_base}} + reg)) = value;}
\DoxyCodeLine{81     \}}
\DoxyCodeLine{82 \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a745e7ee6cc83206664fbf157b01fd082}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a745e7ee6cc83206664fbf157b01fd082}} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!m\_apic\_base@{m\_apic\_base}}
\index{m\_apic\_base@{m\_apic\_base}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{m\_apic\_base}{m\_apic\_base}}
{\footnotesize\ttfamily uint64\+\_\+t Max\+O\+S\+::hardwarecommunication\+::\+Local\+A\+P\+I\+C\+::m\+\_\+apic\+\_\+base\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line 19 of file apic.\+h.

\mbox{\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a732229d18e57d83bb36444cc6eed0c69}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a732229d18e57d83bb36444cc6eed0c69}} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!m\_id@{m\_id}}
\index{m\_id@{m\_id}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{m\_id}{m\_id}}
{\footnotesize\ttfamily uint32\+\_\+t Max\+O\+S\+::hardwarecommunication\+::\+Local\+A\+P\+I\+C\+::m\+\_\+id\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line 20 of file apic.\+h.

\mbox{\Hypertarget{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a655174d55ab5579b3c8b0bdbbcfae57a}\label{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a655174d55ab5579b3c8b0bdbbcfae57a}} 
\index{MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}!m\_x2apic@{m\_x2apic}}
\index{m\_x2apic@{m\_x2apic}!MaxOS::hardwarecommunication::LocalAPIC@{MaxOS::hardwarecommunication::LocalAPIC}}
\doxysubsubsection{\texorpdfstring{m\_x2apic}{m\_x2apic}}
{\footnotesize\ttfamily bool Max\+O\+S\+::hardwarecommunication\+::\+Local\+A\+P\+I\+C\+::m\+\_\+x2apic\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line 21 of file apic.\+h.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/include/hardwarecommunication/\mbox{\hyperlink{apic_8h}{apic.\+h}}\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/src/hardwarecommunication/\mbox{\hyperlink{apic_8cpp}{apic.\+cpp}}\end{DoxyCompactItemize}
