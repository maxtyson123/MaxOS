\hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager}{}\doxysection{Max\+OS\+::memory\+::Physical\+Memory\+Manager Class Reference}
\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager}\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}


{\ttfamily \#include $<$physical.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab99d6d13a57780003adf4f81c5882fa5}{Physical\+Memory\+Manager}} (unsigned long \mbox{\hyperlink{tcp_8h_acb7bc06bed6f6408d719334fc41698c7}{reserved}}, \mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot}{system\+::\+Multiboot}} $\ast$multiboot, uint64\+\_\+t pml4\+\_\+root\mbox{[}512\mbox{]})
\item 
\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a8cf728268a7e9fb72d0903a49a301b0a}{$\sim$\+Physical\+Memory\+Manager}} ()
\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0bd4c0766bc4c3930920814f2f7de1c5}{get\+\_\+memory\+\_\+size}} ()
\begin{DoxyCompactList}\small\item\em Gets total the memory size available for use (allocated or not) \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af2252a8df82a662c5fbeb48f057ea9f0}{get\+\_\+memory\+\_\+used}} ()
\begin{DoxyCompactList}\small\item\em Gets the memory currently used. \end{DoxyCompactList}\item 
uint64\+\_\+t $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ac54f576d801ed62713b84ae64d83fb64}{get\+\_\+pml4\+\_\+root\+\_\+address}} ()
\begin{DoxyCompactList}\small\item\em Gets the pml4 root address for the kernel. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}{allocate\+\_\+frame}} ()
\begin{DoxyCompactList}\small\item\em Allocates a physical page of memory, if the P\+MM is not initalise it will use the anon memory instead of the bitmap. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af0b6a43f9b559575ece938d3918fc3a1}{free\+\_\+frame}} (void $\ast$\mbox{\hyperlink{gdt_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}})
\begin{DoxyCompactList}\small\item\em Frees a frame in the bit map. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af68e198da5c85cc1443f28ecd0f92bd2}{allocate\+\_\+area}} (uint64\+\_\+t start\+\_\+address, size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Allocate an area of physical memory (ie reserve it) \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad0aaa5f1fb32a28d1d91cc5630d56dad}{free\+\_\+area}} (uint64\+\_\+t start\+\_\+address, size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Frees an area of physical memory. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Allocates a physical address to a virtual address. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a981b3d0afa8d5b41eda2d30a4478974c}{map}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$physical, \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Maps a physical address to a virtual address, using the kernel\textquotesingle{}s pml4 table. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_acadc6bfafbd83d6a73b92cd60e9cd927}{map}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$physical, \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}}, uint64\+\_\+t $\ast$pml4\+\_\+root)
\begin{DoxyCompactList}\small\item\em Maps a physical address to a virtual address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a39a03a4a5c211c9af2ad07f8f4bd3028}{map\+\_\+area}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address\+\_\+start, size\+\_\+t \mbox{\hyperlink{udp_8h_a1892eba2086d12ac2b09005aeb09ea3b}{length}}, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Allocates a new area physical memory to a area virtual address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a155276cb4df27f12ce3cbd011dd93a79}{map\+\_\+area}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$physical\+\_\+address\+\_\+start, \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address\+\_\+start, size\+\_\+t \mbox{\hyperlink{udp_8h_a1892eba2086d12ac2b09005aeb09ea3b}{length}}, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Maps an area of physical memory to a virtual address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ace56d1f37c7be25425fe92c994a5cedd}{identity\+\_\+map}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\+\_\+address}}, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Maps a physical address to its virtual address counter-\/part. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a47cc8d6c823f3c323f88e21437ba88ea}{unmap}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address)
\begin{DoxyCompactList}\small\item\em Unmaps a virtual address using the kernel\textquotesingle{}s pml4 table. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0f453dd61a29a033887b3a531cf3910f}{unmap}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address, uint64\+\_\+t $\ast$pml4\+\_\+root)
\begin{DoxyCompactList}\small\item\em Unmaps a virtual address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0cc0fb25a8d67e16410a847c4fd59ea3}{unmap\+\_\+area}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address\+\_\+start, size\+\_\+t \mbox{\hyperlink{udp_8h_a1892eba2086d12ac2b09005aeb09ea3b}{length}})
\begin{DoxyCompactList}\small\item\em Unmaps an area of virtual memory. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a14f4ff20cc6dda201bb5a4ef6a7654f6}{is\+\_\+mapped}} (uintptr\+\_\+t \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\+\_\+address}}, uintptr\+\_\+t virtual\+\_\+address)
\begin{DoxyCompactList}\small\item\em Checks if a virtual address is mapped and whether it points to the correct physical address. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a344d9602dcf5a77e672a1859fa05e67f}{is\+\_\+anonymous\+\_\+available}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Checks if a physical address is reserved by multiboot mmap. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a66d5d1a4c7c019d77fcee0aa3c128d07}{clean\+\_\+page\+\_\+table}} (uint64\+\_\+t $\ast$table)
\begin{DoxyCompactList}\small\item\em Cleans a page table (fills it with 0 or null entries) \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}{reserve}} (uint64\+\_\+t \mbox{\hyperlink{gdt_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}})
\begin{DoxyCompactList}\small\item\em Reserves a physical address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab420fbeba638178bc689c68afa9d522b}{reserve}} (uint64\+\_\+t \mbox{\hyperlink{gdt_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}}, size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Reserves an area of physical memory. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\+\_\+to\+\_\+frames}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Converts a size to the number of frames. \end{DoxyCompactList}\item 
static size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}{align\+\_\+to\+\_\+page}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Aligns a size to the page size. \end{DoxyCompactList}\item 
static size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}{align\+\_\+direct\+\_\+to\+\_\+page}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Aligns a address to the page size. \end{DoxyCompactList}\item 
static size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}{align\+\_\+up\+\_\+to\+\_\+page}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\+\_\+page\+\_\+size}})
\begin{DoxyCompactList}\small\item\em Aligns a size up to the page size. \end{DoxyCompactList}\item 
static bool \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_aa7f389d1b15d109bd5669d0475ebc912}{check\+\_\+aligned}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Checks if an address is aligned. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Attributes}
\begin{DoxyCompactItemize}
\item 
static const uint32\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\+\_\+page\+\_\+size}} = \{ 0x1000 \}
\item 
static \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager}{Physical\+Memory\+Manager}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1d6ffacb7290c01505c3dec9f9cfd3f1}{s\+\_\+current\+\_\+manager}} = nullptr
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 63 of file physical.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab99d6d13a57780003adf4f81c5882fa5}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab99d6d13a57780003adf4f81c5882fa5}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!PhysicalMemoryManager@{PhysicalMemoryManager}}
\index{PhysicalMemoryManager@{PhysicalMemoryManager}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{PhysicalMemoryManager()}{PhysicalMemoryManager()}}
{\footnotesize\ttfamily Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::\+Physical\+Memory\+Manager (\begin{DoxyParamCaption}\item[{unsigned long}]{reserved,  }\item[{\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot}{system\+::\+Multiboot}} $\ast$}]{multiboot,  }\item[{uint64\+\_\+t}]{pml4\+\_\+root\mbox{[}512\mbox{]} }\end{DoxyParamCaption})}



Definition at line 20 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{21 : m\_kernel\_end((uint64\_t)\&\mbox{\hyperlink{physical_8cpp_a5d533ddf4ea36ed94c6a20a7281cb89f}{\_kernel\_physical\_end}}),}
\DoxyCodeLine{22   m\_multiboot(multiboot),}
\DoxyCodeLine{23   m\_pml4\_root\_address(pml4\_root),}
\DoxyCodeLine{24   m\_pml4\_root((pte\_t *)pml4\_root)}
\DoxyCodeLine{25 \{}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 }
\DoxyCodeLine{28   \textcolor{comment}{// Set the current manager}}
\DoxyCodeLine{29   \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1d6ffacb7290c01505c3dec9f9cfd3f1}{s\_current\_manager}} = \textcolor{keyword}{this};}
\DoxyCodeLine{30 }
\DoxyCodeLine{31   \textcolor{comment}{// SEE boot.s FOR SETUP OF PAGING}}
\DoxyCodeLine{32   m\_pml4\_root = (pte\_t *)pml4\_root;}
\DoxyCodeLine{33   m\_pml4\_root\_address = pml4\_root;}
\DoxyCodeLine{34 }
\DoxyCodeLine{35   \textcolor{comment}{// Store the information about the bitmap}}
\DoxyCodeLine{36   m\_memory\_size = (m\_multiboot-\/>\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot_a260d1ef1c1a5eb68f38cf25808167630}{get\_basic\_meminfo}}()-\/>\mbox{\hyperlink{structmultiboot__tag__basic__meminfo_ae329d0036de802dbac0b6bd991495738}{mem\_upper}} + 1024) * 1024;}
\DoxyCodeLine{37   m\_bitmap\_size = m\_memory\_size / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} + 1;}
\DoxyCodeLine{38   m\_total\_entries = m\_bitmap\_size / ROW\_BITS + 1;}
\DoxyCodeLine{39   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Mem Info: size = \%dmb, bitmap size = \%d, total entries = \%d, page size = \%db\(\backslash\)n"}, ((m\_memory\_size / 1000) * 1024) / 1024 / 1024, m\_bitmap\_size, m\_total\_entries, \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{40 }
\DoxyCodeLine{41   \textcolor{comment}{// Get the mmap that stores the memory to use}}
\DoxyCodeLine{42   m\_mmap\_tag = m\_multiboot-\/>\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot_adab0945a9a6b46d34f1f4fa1757cdd34}{get\_mmap}}();}
\DoxyCodeLine{43   \textcolor{keywordflow}{for} (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *entry = m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a20c4427afce786340b01ded5ed0532a2}{entries}}; (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)entry < (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)m\_mmap\_tag + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a0663e47406ed5799d5bd55ccf2d4fa95}{size}}; entry = (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *)((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})entry + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_aa5532c68672471f9da8ba18a8a16857d}{entry\_size}})) \{}
\DoxyCodeLine{44 }
\DoxyCodeLine{45     \textcolor{comment}{// Skip if the region is not free or there is not enough space}}
\DoxyCodeLine{46     \textcolor{keywordflow}{if} (entry-\/>type != \mbox{\hyperlink{multiboot_8h_a7fe141351ebcde0acbd6118ad0ea1a21}{MULTIBOOT\_MEMORY\_AVAILABLE}} || (entry-\/>addr + entry-\/>len) < \mbox{\hyperlink{fat32_8h_ac35c1fbebe2017fc1ca10f5803668dfd}{reserved}})}
\DoxyCodeLine{47       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \textcolor{comment}{// We want the last entry}}
\DoxyCodeLine{50     m\_mmap = entry;}
\DoxyCodeLine{51   \}}
\DoxyCodeLine{52   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Mmap in use: 0x\%x -\/ 0x\%x\(\backslash\)n"}, m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a3f76a637264b83e30967bcd808ff403c}{addr}}, m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a3f76a637264b83e30967bcd808ff403c}{addr}} + m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a6bfa44919a328492fa4e3d6239a23352}{len}});}
\DoxyCodeLine{53 }
\DoxyCodeLine{54   \textcolor{comment}{// Kernel Memory (anonymous memory to the next page)}}
\DoxyCodeLine{55   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Kernel Memory: kernel\_end = 0x\%x, kernel\_size = 0x\%x, kernel\_physical\_end = 0x\%x\(\backslash\)n"}, \&\mbox{\hyperlink{physical_8cpp_a963a9b86d21e2b5cfdeb947f25826c13}{\_kernel\_end}}, \&\mbox{\hyperlink{physical_8cpp_aea8f7989c93a7869e750d1bbf6c3cf10}{\_kernel\_size}}, \&\mbox{\hyperlink{physical_8cpp_a5d533ddf4ea36ed94c6a20a7281cb89f}{\_kernel\_physical\_end}});}
\DoxyCodeLine{56   m\_anonymous\_memory\_physical\_address = (uint64\_t)\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}{align\_up\_to\_page}}((\textcolor{keywordtype}{size\_t})\&\mbox{\hyperlink{physical_8cpp_a5d533ddf4ea36ed94c6a20a7281cb89f}{\_kernel\_physical\_end}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}, \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{57   m\_anonymous\_memory\_virtual\_address  = (uint64\_t)\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}{align\_up\_to\_page}}((\textcolor{keywordtype}{size\_t})\&\mbox{\hyperlink{physical_8cpp_a963a9b86d21e2b5cfdeb947f25826c13}{\_kernel\_end}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}, \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{58   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Anonymous Memory: physical = 0x\%x, virtual = 0x\%x\(\backslash\)n"}, m\_anonymous\_memory\_physical\_address, m\_anonymous\_memory\_virtual\_address);}
\DoxyCodeLine{59 }
\DoxyCodeLine{60   \textcolor{comment}{// Map the physical memory into the virtual memory}}
\DoxyCodeLine{61   uint64\_t \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} = 0;}
\DoxyCodeLine{62   uint64\_t virtual\_address = \mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_a25fe2fa3e01b0a9593cede08126095bf}{MemoryManager::s\_hh\_direct\_map\_offset}};}
\DoxyCodeLine{63   uint64\_t mem\_end = m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a3f76a637264b83e30967bcd808ff403c}{addr}} + m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a6bfa44919a328492fa4e3d6239a23352}{len}};}
\DoxyCodeLine{64 }
\DoxyCodeLine{65   \textcolor{keywordflow}{while} (\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} < mem\_end) \{}
\DoxyCodeLine{66     \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}((\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}} *)\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}} *)virtual\_address, \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}});}
\DoxyCodeLine{67     \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{68     virtual\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{69   \}}
\DoxyCodeLine{70   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Mapped: physical = 0x\%x-\/0x\%x, virtual = 0x\%x-\/0x\%x\(\backslash\)n"}, 0, \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, \mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_a25fe2fa3e01b0a9593cede08126095bf}{MemoryManager::s\_hh\_direct\_map\_offset}}, virtual\_address); \textcolor{comment}{// TODO: FAILS WHEN TRYING WITH LIKE 2Gb Mem}}
\DoxyCodeLine{71 }
\DoxyCodeLine{72   \textcolor{comment}{// Get the bitmap \& clear it}}
\DoxyCodeLine{73   m\_anonymous\_memory\_physical\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{74   m\_bit\_map = get\_bitmap\_address();}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \textcolor{keywordflow}{for} (uint32\_t \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < m\_total\_entries; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{77     m\_bit\_map[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}] = 0;}
\DoxyCodeLine{78   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Bitmap: location = 0x\%x -\/ 0x\%x\(\backslash\)n"}, m\_bit\_map, m\_bit\_map + m\_bitmap\_size / 8);}
\DoxyCodeLine{79 }
\DoxyCodeLine{80 }
\DoxyCodeLine{81   \textcolor{comment}{//end\_of\_reserved\_area = m\_anonymous\_memory\_physical\_address + page size}}
\DoxyCodeLine{82 }
\DoxyCodeLine{83   \textcolor{comment}{// Calculate how much space the kernel takes up}}
\DoxyCodeLine{84   uint32\_t kernel\_entries = (m\_anonymous\_memory\_physical\_address / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}) + 1;}
\DoxyCodeLine{85   \textcolor{keywordflow}{if} ((((uint32\_t)(m\_anonymous\_memory\_physical\_address)) \% \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}) != 0) \{}
\DoxyCodeLine{86     \textcolor{comment}{// If the kernel takes up more then a whole page(s)}}
\DoxyCodeLine{87     kernel\_entries += 1;}
\DoxyCodeLine{88   \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90   \textcolor{comment}{// Reserve the kernel in the bitmap}}
\DoxyCodeLine{91   uint32\_t kernel\_rows = kernel\_entries / ROW\_BITS;}
\DoxyCodeLine{92   \textcolor{keywordflow}{for} (uint32\_t \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < kernel\_rows; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{93       m\_bit\_map[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}] = 0xFFFFFFFF;}
\DoxyCodeLine{94 }
\DoxyCodeLine{95   \textcolor{comment}{// Change the final row to account for the remaining bits}}
\DoxyCodeLine{96   m\_bit\_map[kernel\_rows] = \string~(0ul) << (kernel\_entries -\/ (kernel\_rows * 64));}
\DoxyCodeLine{97   m\_used\_frames = kernel\_entries;}
\DoxyCodeLine{98   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Kernel: entries = \%d, rows = \%d, used = \%d\(\backslash\)n"}, kernel\_entries, kernel\_rows, m\_used\_frames);}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{comment}{// Reserve the area for the bitmap}}
\DoxyCodeLine{101   \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}{reserve}}((uint64\_t)\mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_ab0647fd9b0c504382c6b52117c883fe0}{MemoryManager::from\_dm\_region}}((uint64\_t)m\_bit\_map), m\_bitmap\_size / 8 + 1);}
\DoxyCodeLine{102 }
\DoxyCodeLine{103   \textcolor{comment}{// Reserve the area for the mmap}}
\DoxyCodeLine{104   \textcolor{keywordflow}{for} (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *entry = m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a20c4427afce786340b01ded5ed0532a2}{entries}}; (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)entry < (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)m\_mmap\_tag + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a0663e47406ed5799d5bd55ccf2d4fa95}{size}}; entry = (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *)((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})entry + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_aa5532c68672471f9da8ba18a8a16857d}{entry\_size}})) \{}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     \textcolor{comment}{// Check if the entry is to be mapped}}
\DoxyCodeLine{107     \textcolor{keywordflow}{if} (entry-\/>type <= \mbox{\hyperlink{multiboot_8h_a7fe141351ebcde0acbd6118ad0ea1a21}{MULTIBOOT\_MEMORY\_AVAILABLE}})}
\DoxyCodeLine{108       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{109 }
\DoxyCodeLine{110     \textcolor{comment}{// Where the free mem starts}}
\DoxyCodeLine{111     \textcolor{keywordflow}{if}(entry-\/>addr >= mem\_end)}
\DoxyCodeLine{112       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{113 }
\DoxyCodeLine{114     \textcolor{comment}{// Reserve the area}}
\DoxyCodeLine{115     \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}{reserve}}(entry-\/>addr, entry-\/>len);}
\DoxyCodeLine{116   \}}
\DoxyCodeLine{117 }
\DoxyCodeLine{118   \textcolor{comment}{// Initialisation Done}}
\DoxyCodeLine{119   m\_initialized = \textcolor{keyword}{true};}
\DoxyCodeLine{120 \}}

\end{DoxyCode}


References \+\_\+kernel\+\_\+end, \+\_\+kernel\+\_\+physical\+\_\+end, \+\_\+kernel\+\_\+size, \+\_\+kprintf, multiboot\+\_\+mmap\+\_\+entry\+::addr, align\+\_\+up\+\_\+to\+\_\+page(), multiboot\+\_\+tag\+\_\+mmap\+::entries, multiboot\+\_\+tag\+\_\+mmap\+::entry\+\_\+size, Max\+O\+S\+::memory\+::\+Memory\+Manager\+::from\+\_\+dm\+\_\+region(), Max\+O\+S\+::system\+::\+Multiboot\+::get\+\_\+basic\+\_\+meminfo(), Max\+O\+S\+::system\+::\+Multiboot\+::get\+\_\+mmap(), Max\+O\+S\+::drivers\+::peripherals\+::i, multiboot\+\_\+mmap\+\_\+entry\+::len, map(), multiboot\+\_\+tag\+\_\+basic\+\_\+meminfo\+::mem\+\_\+upper, M\+U\+L\+T\+I\+B\+O\+O\+T\+\_\+\+M\+E\+M\+O\+R\+Y\+\_\+\+A\+V\+A\+I\+L\+A\+B\+LE, physical\+\_\+address, Max\+O\+S\+::memory\+::\+Present, reserve(), reserved, s\+\_\+current\+\_\+manager, Max\+O\+S\+::memory\+::\+Memory\+Manager\+::s\+\_\+hh\+\_\+direct\+\_\+map\+\_\+offset, s\+\_\+page\+\_\+size, multiboot\+\_\+tag\+\_\+mmap\+::size, and Max\+O\+S\+::memory\+::\+Write.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a8cf728268a7e9fb72d0903a49a301b0a}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a8cf728268a7e9fb72d0903a49a301b0a}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!````~PhysicalMemoryManager@{$\sim$PhysicalMemoryManager}}
\index{````~PhysicalMemoryManager@{$\sim$PhysicalMemoryManager}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{$\sim$PhysicalMemoryManager()}{~PhysicalMemoryManager()}}
{\footnotesize\ttfamily Physical\+Memory\+Manager\+::$\sim$\+Physical\+Memory\+Manager (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 122 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{122                                               \{}
\DoxyCodeLine{123 }
\DoxyCodeLine{124 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!align\_direct\_to\_page@{align\_direct\_to\_page}}
\index{align\_direct\_to\_page@{align\_direct\_to\_page}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{align\_direct\_to\_page()}{align\_direct\_to\_page()}}
{\footnotesize\ttfamily size\+\_\+t Physical\+Memory\+Manager\+::align\+\_\+direct\+\_\+to\+\_\+page (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Aligns a address to the page size. 


\begin{DoxyParams}{Parameters}
{\em size} & The address to align \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The aligned address 
\end{DoxyReturn}


Definition at line 828 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{828                                                               \{}
\DoxyCodeLine{829   \textcolor{keywordflow}{return} (\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} \& (\string~(\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} -\/ 1)));}
\DoxyCodeLine{830 \}}

\end{DoxyCode}


References s\+\_\+page\+\_\+size, and size.



Referenced by reserve().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!align\_to\_page@{align\_to\_page}}
\index{align\_to\_page@{align\_to\_page}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{align\_to\_page()}{align\_to\_page()}}
{\footnotesize\ttfamily size\+\_\+t Physical\+Memory\+Manager\+::align\+\_\+to\+\_\+page (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Aligns a size to the page size. 


\begin{DoxyParams}{Parameters}
{\em size} & The size to align \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The aligned size 
\end{DoxyReturn}


Definition at line 140 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{140                                                        \{}
\DoxyCodeLine{141   \textcolor{keywordflow}{return} ((\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} -\/ 1) /\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}) * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{142 \}}

\end{DoxyCode}


References s\+\_\+page\+\_\+size, and size.



Referenced by reserve(), size\+\_\+to\+\_\+frames(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!align\_up\_to\_page@{align\_up\_to\_page}}
\index{align\_up\_to\_page@{align\_up\_to\_page}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{align\_up\_to\_page()}{align\_up\_to\_page()}}
{\footnotesize\ttfamily size\+\_\+t Physical\+Memory\+Manager\+::align\+\_\+up\+\_\+to\+\_\+page (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t}]{page\+\_\+size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Aligns a size up to the page size. 


\begin{DoxyParams}{Parameters}
{\em size} & The size to align \\
\hline
{\em page\+\_\+size} & The page size to align to \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The aligned size 
\end{DoxyReturn}


Definition at line 150 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{150                                                                             \{}
\DoxyCodeLine{151   \textcolor{keywordflow}{return} (\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} + page\_size -\/ 1) \& \string~(page\_size -\/ 1);}
\DoxyCodeLine{152 \}}

\end{DoxyCode}


References size.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), and Physical\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af68e198da5c85cc1443f28ecd0f92bd2}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af68e198da5c85cc1443f28ecd0f92bd2}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!allocate\_area@{allocate\_area}}
\index{allocate\_area@{allocate\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{allocate\_area()}{allocate\_area()}}
{\footnotesize\ttfamily void $\ast$ Physical\+Memory\+Manager\+::allocate\+\_\+area (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{start\+\_\+address,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Allocate an area of physical memory (ie reserve it) 


\begin{DoxyParams}{Parameters}
{\em start\+\_\+address} & The start of the block \\
\hline
{\em size} & The size to allocate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A pointer to the start of the block (physical address) 
\end{DoxyReturn}


Definition at line 255 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{255                                                                               \{}
\DoxyCodeLine{256 }
\DoxyCodeLine{257   \textcolor{comment}{// Check how many frames are needed}}
\DoxyCodeLine{258   \textcolor{keywordtype}{size\_t} frame\_count = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{259 }
\DoxyCodeLine{260   \textcolor{comment}{// Store the information about the frames needed to be allocated for this size}}
\DoxyCodeLine{261   uint16\_t start\_row = 0;}
\DoxyCodeLine{262   uint16\_t start\_column = 0;}
\DoxyCodeLine{263   \textcolor{keywordtype}{size\_t} adjacent\_frames = 0;}
\DoxyCodeLine{264 }
\DoxyCodeLine{265   \textcolor{comment}{// Loop through the bitmap}}
\DoxyCodeLine{266   \textcolor{keywordflow}{for} (uint16\_t row = 0; row < m\_total\_entries; ++row) \{}
\DoxyCodeLine{267 }
\DoxyCodeLine{268     \textcolor{comment}{// If the row is full continue}}
\DoxyCodeLine{269     \textcolor{keywordflow}{if}(m\_bit\_map[row] == 0xFFFFFFFFFFFFFFF)}
\DoxyCodeLine{270       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{271 }
\DoxyCodeLine{272     \textcolor{keywordflow}{for} (uint16\_t column = 0; column < ROW\_BITS; ++column) \{}
\DoxyCodeLine{273 }
\DoxyCodeLine{274       \textcolor{comment}{// Prevent out-\/of-\/bounds shifts if column exceeds the bit-\/width of uint64\_t}}
\DoxyCodeLine{275       \textcolor{keywordflow}{if} (column >= ROW\_BITS)}
\DoxyCodeLine{276         \textcolor{keywordflow}{break};}
\DoxyCodeLine{277 }
\DoxyCodeLine{278       \textcolor{comment}{// If this bit is not free, reset the adjacent frames}}
\DoxyCodeLine{279       \textcolor{keywordflow}{if} (m\_bit\_map[row] \& (1ULL << column)) \{}
\DoxyCodeLine{280         adjacent\_frames = 0;}
\DoxyCodeLine{281         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{282       \}}
\DoxyCodeLine{283 }
\DoxyCodeLine{284       \textcolor{comment}{// Store the start of the area if it is not already stored}}
\DoxyCodeLine{285       \textcolor{keywordflow}{if}(adjacent\_frames == 0)\{}
\DoxyCodeLine{286         start\_row = row;}
\DoxyCodeLine{287         start\_column = column;}
\DoxyCodeLine{288       \}}
\DoxyCodeLine{289 }
\DoxyCodeLine{290       \textcolor{comment}{// Increment the adjacent frames}}
\DoxyCodeLine{291       adjacent\_frames++;}
\DoxyCodeLine{292 }
\DoxyCodeLine{293       \textcolor{comment}{// If enough frames are found we can allocate the area}}
\DoxyCodeLine{294       \textcolor{keywordflow}{if}(adjacent\_frames == frame\_count)\{}
\DoxyCodeLine{295 }
\DoxyCodeLine{296         \textcolor{comment}{// Mark the frames as used}}
\DoxyCodeLine{297         m\_used\_frames += frame\_count;}
\DoxyCodeLine{298         \textcolor{keywordflow}{for} (uint16\_t \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < frame\_count; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \{}
\DoxyCodeLine{299 }
\DoxyCodeLine{300           \textcolor{comment}{// Get the location of the bit}}
\DoxyCodeLine{301           uint16\_t index = start\_row + (start\_column + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) / ROW\_BITS;}
\DoxyCodeLine{302           uint16\_t bit = (start\_column + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \% ROW\_BITS;}
\DoxyCodeLine{303 }
\DoxyCodeLine{304           \textcolor{comment}{// Skip if index exceeds bounds}}
\DoxyCodeLine{305           \textcolor{keywordflow}{if} (index >= m\_total\_entries || bit >= ROW\_BITS) \{}
\DoxyCodeLine{306             \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(\textcolor{keyword}{false}, \textcolor{stringliteral}{"Index out of bounds\(\backslash\)n"})}
\DoxyCodeLine{307           \}}
\DoxyCodeLine{308 }
\DoxyCodeLine{309           m\_bit\_map[index] |= (1ULL << bit); \textcolor{comment}{// Mark the bit as used}}
\DoxyCodeLine{310         \}}
\DoxyCodeLine{311 }
\DoxyCodeLine{312 }
\DoxyCodeLine{313         \textcolor{comment}{// Return the address}}
\DoxyCodeLine{314         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void}*)(start\_address + (start\_row * ROW\_BITS + start\_column) * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{315       \}}
\DoxyCodeLine{316     \}}
\DoxyCodeLine{317   \}}
\DoxyCodeLine{318 }
\DoxyCodeLine{319   \textcolor{comment}{// Error cant allocate that much}}
\DoxyCodeLine{320   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{321 \}}

\end{DoxyCode}


References A\+S\+S\+E\+RT, Max\+O\+S\+::drivers\+::peripherals\+::i, s\+\_\+page\+\_\+size, size, and size\+\_\+to\+\_\+frames().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!allocate\_frame@{allocate\_frame}}
\index{allocate\_frame@{allocate\_frame}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{allocate\_frame()}{allocate\_frame()}}
{\footnotesize\ttfamily void $\ast$ Physical\+Memory\+Manager\+::allocate\+\_\+frame (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Allocates a physical page of memory, if the P\+MM is not initalise it will use the anon memory instead of the bitmap. 

\begin{DoxyReturn}{Returns}
The physical address of the page 
\end{DoxyReturn}


Definition at line 167 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{167                                             \{}
\DoxyCodeLine{168 }
\DoxyCodeLine{169   \textcolor{comment}{// Check if the pmm is initialized}}
\DoxyCodeLine{170   \textcolor{keywordflow}{if}(!m\_initialized)\{}
\DoxyCodeLine{171 }
\DoxyCodeLine{172     \textcolor{comment}{// Find the first free frame}}
\DoxyCodeLine{173     \textcolor{keywordflow}{while} ((!\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a344d9602dcf5a77e672a1859fa05e67f}{is\_anonymous\_available}}(m\_anonymous\_memory\_physical\_address)) \&\& (m\_anonymous\_memory\_physical\_address < m\_memory\_size)) \{}
\DoxyCodeLine{174       m\_anonymous\_memory\_physical\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{175       m\_anonymous\_memory\_virtual\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{176     \}}
\DoxyCodeLine{177 }
\DoxyCodeLine{178     \textcolor{comment}{// Mark frame as used}}
\DoxyCodeLine{179     m\_anonymous\_memory\_physical\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{180     m\_anonymous\_memory\_virtual\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     \textcolor{comment}{// Return the address}}
\DoxyCodeLine{183     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void}*)(m\_anonymous\_memory\_physical\_address -\/ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{184 }
\DoxyCodeLine{185   \}}
\DoxyCodeLine{186 }
\DoxyCodeLine{187   \textcolor{comment}{// Check if there are enough frames}}
\DoxyCodeLine{188   \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(m\_used\_frames < m\_bitmap\_size, \textcolor{stringliteral}{"No more frames available\(\backslash\)n"})}
\DoxyCodeLine{189 }
\DoxyCodeLine{190   \textcolor{comment}{// Loop through the bitmap}}
\DoxyCodeLine{191   for (uint16\_t row = 0; row < m\_total\_entries; ++row) \{}
\DoxyCodeLine{192 }
\DoxyCodeLine{193     \textcolor{comment}{// If the row is full continue}}
\DoxyCodeLine{194     \textcolor{keywordflow}{if}(m\_bit\_map[row] == 0xFFFFFFFFFFFFFFF)}
\DoxyCodeLine{195       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{196 }
\DoxyCodeLine{197     \textcolor{keywordflow}{for} (uint16\_t column = 0; column < ROW\_BITS; ++column) \{}
\DoxyCodeLine{198 }
\DoxyCodeLine{199       \textcolor{comment}{// Prevent out-\/of-\/bounds shifts if column exceeds the bit-\/width of uint64\_t}}
\DoxyCodeLine{200       \textcolor{keywordflow}{if} (column >= ROW\_BITS)}
\DoxyCodeLine{201         \textcolor{keywordflow}{break};}
\DoxyCodeLine{202 }
\DoxyCodeLine{203       \textcolor{comment}{// Check if the bitmap is free}}
\DoxyCodeLine{204       \textcolor{keywordflow}{if} (m\_bit\_map[row] \& (1ULL << column))}
\DoxyCodeLine{205         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{206 }
\DoxyCodeLine{207 }
\DoxyCodeLine{208       \textcolor{comment}{// Mark the frame as used}}
\DoxyCodeLine{209       m\_bit\_map[row] |= (1ULL << column);}
\DoxyCodeLine{210       m\_used\_frames++;}
\DoxyCodeLine{211 }
\DoxyCodeLine{212       \textcolor{comment}{// Return the address}}
\DoxyCodeLine{213       uint64\_t frame\_address = (row * ROW\_BITS) + column;}
\DoxyCodeLine{214       frame\_address *= \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{215 }
\DoxyCodeLine{216 }
\DoxyCodeLine{217       \textcolor{keywordflow}{if}(frame\_address == 0x543000)\{}
\DoxyCodeLine{218         \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Working: 0x\%x\(\backslash\)n"}, frame\_address);}
\DoxyCodeLine{219       \}}
\DoxyCodeLine{220 }
\DoxyCodeLine{221       \textcolor{comment}{// Make sure we are using the mem mapped region (TODO: This should be handled by being reserved)}}
\DoxyCodeLine{222       \textcolor{keywordflow}{if}(frame\_address < m\_kernel\_end)}
\DoxyCodeLine{223         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{224 }
\DoxyCodeLine{225       \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void}*)(frame\_address);}
\DoxyCodeLine{226     \}}
\DoxyCodeLine{227   \}}
\DoxyCodeLine{228 }
\DoxyCodeLine{229   \textcolor{comment}{// Error frame not found}}
\DoxyCodeLine{230   \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(\textcolor{keyword}{false}, \textcolor{stringliteral}{"Frame not found\(\backslash\)n"})}
\DoxyCodeLine{231   return \textcolor{keywordtype}{nullptr};}
\DoxyCodeLine{232 }
\DoxyCodeLine{233 \}}

\end{DoxyCode}


References \+\_\+kprintf, A\+S\+S\+E\+RT, is\+\_\+anonymous\+\_\+available(), and s\+\_\+page\+\_\+size.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), map(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_aa7f389d1b15d109bd5669d0475ebc912}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_aa7f389d1b15d109bd5669d0475ebc912}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!check\_aligned@{check\_aligned}}
\index{check\_aligned@{check\_aligned}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{check\_aligned()}{check\_aligned()}}
{\footnotesize\ttfamily bool Physical\+Memory\+Manager\+::check\+\_\+aligned (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Checks if an address is aligned. 


\begin{DoxyParams}{Parameters}
{\em size} & The address to check \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the address is aligned 
\end{DoxyReturn}


Definition at line 159 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{159                                                     \{}
\DoxyCodeLine{160     \textcolor{keywordflow}{return} (\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} \% \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}) == 0;}
\DoxyCodeLine{161 \}}

\end{DoxyCode}


References s\+\_\+page\+\_\+size, and size.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a66d5d1a4c7c019d77fcee0aa3c128d07}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a66d5d1a4c7c019d77fcee0aa3c128d07}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!clean\_page\_table@{clean\_page\_table}}
\index{clean\_page\_table@{clean\_page\_table}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{clean\_page\_table()}{clean\_page\_table()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::clean\+\_\+page\+\_\+table (\begin{DoxyParamCaption}\item[{uint64\+\_\+t $\ast$}]{table }\end{DoxyParamCaption})}



Cleans a page table (fills it with 0 or null entries) 


\begin{DoxyParams}{Parameters}
{\em table} & The table to clean \\
\hline
\end{DoxyParams}


Definition at line 692 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{692                                                             \{}
\DoxyCodeLine{693   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < 512; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++)\{}
\DoxyCodeLine{694         table[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}] = 0x00\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}};}
\DoxyCodeLine{695   \}}
\DoxyCodeLine{696 \}}

\end{DoxyCode}


References Max\+O\+S\+::drivers\+::peripherals\+::i, and Max\+O\+S\+::drivers\+::peripherals\+::l.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad0aaa5f1fb32a28d1d91cc5630d56dad}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad0aaa5f1fb32a28d1d91cc5630d56dad}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!free\_area@{free\_area}}
\index{free\_area@{free\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{free\_area()}{free\_area()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::free\+\_\+area (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{start\+\_\+address,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Frees an area of physical memory. 


\begin{DoxyParams}{Parameters}
{\em start\+\_\+address} & The start of the block \\
\hline
{\em size} & The size to free \\
\hline
\end{DoxyParams}


Definition at line 328 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{328                                                                          \{}
\DoxyCodeLine{329 }
\DoxyCodeLine{330     \textcolor{comment}{// Check how many frames are needed}}
\DoxyCodeLine{331     \textcolor{keywordtype}{size\_t} frame\_count = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{332     uint64\_t frame\_address = start\_address / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{333 }
\DoxyCodeLine{334     \textcolor{comment}{// Check if the address is valid}}
\DoxyCodeLine{335     \textcolor{keywordflow}{if}(frame\_address >= m\_bitmap\_size)}
\DoxyCodeLine{336       \textcolor{keywordflow}{return};}
\DoxyCodeLine{337 }
\DoxyCodeLine{338     \textcolor{comment}{// Mark the frames as not used}}
\DoxyCodeLine{339     m\_used\_frames -\/= frame\_count;}
\DoxyCodeLine{340     \textcolor{keywordflow}{for} (uint16\_t \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < frame\_count; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{341       m\_bit\_map[(frame\_address + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) / ROW\_BITS] \&= \string~(1 << ((frame\_address + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \% ROW\_BITS));}
\DoxyCodeLine{342 }
\DoxyCodeLine{343 \}}

\end{DoxyCode}


References Max\+O\+S\+::drivers\+::peripherals\+::i, s\+\_\+page\+\_\+size, size, and size\+\_\+to\+\_\+frames().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af0b6a43f9b559575ece938d3918fc3a1}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af0b6a43f9b559575ece938d3918fc3a1}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!free\_frame@{free\_frame}}
\index{free\_frame@{free\_frame}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{free\_frame()}{free\_frame()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::free\+\_\+frame (\begin{DoxyParamCaption}\item[{void $\ast$}]{address }\end{DoxyParamCaption})}



Frees a frame in the bit map. 


\begin{DoxyParams}{Parameters}
{\em address} & The address to free \\
\hline
\end{DoxyParams}


Definition at line 239 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{239                                                     \{}
\DoxyCodeLine{240 }
\DoxyCodeLine{241     \textcolor{comment}{// Mark the frame as not used}}
\DoxyCodeLine{242     m\_used\_frames-\/-\/;}
\DoxyCodeLine{243 }
\DoxyCodeLine{244     \textcolor{comment}{// Set the bit to 0}}
\DoxyCodeLine{245     uint64\_t frame\_address = (uint64\_t)\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{246     m\_bit\_map[frame\_address / ROW\_BITS] \&= \string~(1 << (frame\_address \% ROW\_BITS));}
\DoxyCodeLine{247 \}}

\end{DoxyCode}


References address, and s\+\_\+page\+\_\+size.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0bd4c0766bc4c3930920814f2f7de1c5}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0bd4c0766bc4c3930920814f2f7de1c5}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!get\_memory\_size@{get\_memory\_size}}
\index{get\_memory\_size@{get\_memory\_size}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{get\_memory\_size()}{get\_memory\_size()}}
{\footnotesize\ttfamily uint64\+\_\+t Physical\+Memory\+Manager\+::get\+\_\+memory\+\_\+size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Gets total the memory size available for use (allocated or not) 

\begin{DoxyReturn}{Returns}
The memory size in bytes 
\end{DoxyReturn}


Definition at line 811 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{811                                                 \{}
\DoxyCodeLine{812   \textcolor{keywordflow}{return} m\_memory\_size;}
\DoxyCodeLine{813 \}}

\end{DoxyCode}


Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af2252a8df82a662c5fbeb48f057ea9f0}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af2252a8df82a662c5fbeb48f057ea9f0}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!get\_memory\_used@{get\_memory\_used}}
\index{get\_memory\_used@{get\_memory\_used}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{get\_memory\_used()}{get\_memory\_used()}}
{\footnotesize\ttfamily uint64\+\_\+t Physical\+Memory\+Manager\+::get\+\_\+memory\+\_\+used (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Gets the memory currently used. 

\begin{DoxyReturn}{Returns}
The memory size in bytes 
\end{DoxyReturn}


Definition at line 819 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{819                                                 \{}
\DoxyCodeLine{820     \textcolor{keywordflow}{return} m\_used\_frames * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{821 \}}

\end{DoxyCode}


References s\+\_\+page\+\_\+size.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ac54f576d801ed62713b84ae64d83fb64}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ac54f576d801ed62713b84ae64d83fb64}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!get\_pml4\_root\_address@{get\_pml4\_root\_address}}
\index{get\_pml4\_root\_address@{get\_pml4\_root\_address}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{get\_pml4\_root\_address()}{get\_pml4\_root\_address()}}
{\footnotesize\ttfamily uint64\+\_\+t $\ast$ Physical\+Memory\+Manager\+::get\+\_\+pml4\+\_\+root\+\_\+address (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Gets the pml4 root address for the kernel. 

\begin{DoxyReturn}{Returns}
The pml4 root address 
\end{DoxyReturn}


Definition at line 803 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{803                                                        \{}
\DoxyCodeLine{804     \textcolor{keywordflow}{return} m\_pml4\_root\_address;}
\DoxyCodeLine{805 \}}

\end{DoxyCode}


Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ace56d1f37c7be25425fe92c994a5cedd}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ace56d1f37c7be25425fe92c994a5cedd}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!identity\_map@{identity\_map}}
\index{identity\_map@{identity\_map}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{identity\_map()}{identity\_map()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::identity\+\_\+map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$}]{physical\+\_\+address,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Maps a physical address to its virtual address counter-\/part. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address} & The physical address to map \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}


Definition at line 583 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{583                                                                                            \{}
\DoxyCodeLine{584 }
\DoxyCodeLine{585   \textcolor{comment}{// Map the physical address to its virtual address counter-\/part}}
\DoxyCodeLine{586   \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{587 }
\DoxyCodeLine{588 \}}

\end{DoxyCode}


References flags, map(), and physical\+\_\+address.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a344d9602dcf5a77e672a1859fa05e67f}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a344d9602dcf5a77e672a1859fa05e67f}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!is\_anonymous\_available@{is\_anonymous\_available}}
\index{is\_anonymous\_available@{is\_anonymous\_available}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{is\_anonymous\_available()}{is\_anonymous\_available()}}
{\footnotesize\ttfamily bool Physical\+Memory\+Manager\+::is\+\_\+anonymous\+\_\+available (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{address }\end{DoxyParamCaption})}



Checks if a physical address is reserved by multiboot mmap. 


\begin{DoxyParams}{Parameters}
{\em address} & The address to check \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the address is reserved 
\end{DoxyReturn}


Definition at line 728 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{728                                                                  \{}
\DoxyCodeLine{729 }
\DoxyCodeLine{730   \textcolor{comment}{// Return false if the address range is entirely within or overlaps with the multiboot reserved region}}
\DoxyCodeLine{731   \textcolor{keywordflow}{if} ((\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} > \mbox{\hyperlink{physical_8cpp_a112857fab0ddec3e5d84827e1bf2ff43}{multiboot\_tag\_start}} \&\& \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} < \mbox{\hyperlink{physical_8cpp_a233e74c4ba81dc1941dddf05bc87ecf1}{multiboot\_tag\_end}}) || (\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} > \mbox{\hyperlink{physical_8cpp_a112857fab0ddec3e5d84827e1bf2ff43}{multiboot\_tag\_start}} \&\& \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} < \mbox{\hyperlink{physical_8cpp_a233e74c4ba81dc1941dddf05bc87ecf1}{multiboot\_tag\_end}})) \{}
\DoxyCodeLine{732     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{733   \}}
\DoxyCodeLine{734 }
\DoxyCodeLine{735   \textcolor{comment}{// Loop through the mmmap entries}}
\DoxyCodeLine{736   \textcolor{keywordflow}{for} (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *entry = m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a20c4427afce786340b01ded5ed0532a2}{entries}}; (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)entry < (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)m\_mmap\_tag + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a0663e47406ed5799d5bd55ccf2d4fa95}{size}}; entry = (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *)((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})entry + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_aa5532c68672471f9da8ba18a8a16857d}{entry\_size}})) \{}
\DoxyCodeLine{737 }
\DoxyCodeLine{738     \textcolor{comment}{// If it doesn't overlap with the mmap entry}}
\DoxyCodeLine{739     \textcolor{keywordflow}{if} ((entry -\/> addr + entry -\/> len) < (\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}))}
\DoxyCodeLine{740       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{741 }
\DoxyCodeLine{742     \textcolor{comment}{// If it is not available}}
\DoxyCodeLine{743     \textcolor{keywordflow}{if}(entry -\/> \mbox{\hyperlink{apic_8h_a1d127017fb298b889f4ba24752d08b8e}{type}} != \mbox{\hyperlink{multiboot_8h_a7fe141351ebcde0acbd6118ad0ea1a21}{MULTIBOOT\_MEMORY\_AVAILABLE}})}
\DoxyCodeLine{744       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{745 }
\DoxyCodeLine{746     \textcolor{comment}{// Check if the address is overwriting with some reserved memory}}
\DoxyCodeLine{747     \textcolor{keywordflow}{if}(m\_multiboot -\/> is\_reserved(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}}))}
\DoxyCodeLine{748        \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{749 }
\DoxyCodeLine{750     \textcolor{comment}{// Memory is available}}
\DoxyCodeLine{751     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{752 }
\DoxyCodeLine{753   \}}
\DoxyCodeLine{754 }
\DoxyCodeLine{755   \textcolor{comment}{// Memory is not available}}
\DoxyCodeLine{756   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{757 \}}

\end{DoxyCode}


References address, multiboot\+\_\+tag\+\_\+mmap\+::entries, multiboot\+\_\+tag\+\_\+mmap\+::entry\+\_\+size, M\+U\+L\+T\+I\+B\+O\+O\+T\+\_\+\+M\+E\+M\+O\+R\+Y\+\_\+\+A\+V\+A\+I\+L\+A\+B\+LE, multiboot\+\_\+tag\+\_\+end, multiboot\+\_\+tag\+\_\+start, s\+\_\+page\+\_\+size, multiboot\+\_\+tag\+\_\+mmap\+::size, and type.



Referenced by allocate\+\_\+frame().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a14f4ff20cc6dda201bb5a4ef6a7654f6}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a14f4ff20cc6dda201bb5a4ef6a7654f6}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!is\_mapped@{is\_mapped}}
\index{is\_mapped@{is\_mapped}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{is\_mapped()}{is\_mapped()}}
{\footnotesize\ttfamily bool Physical\+Memory\+Manager\+::is\+\_\+mapped (\begin{DoxyParamCaption}\item[{uintptr\+\_\+t}]{physical\+\_\+address,  }\item[{uintptr\+\_\+t}]{virtual\+\_\+address }\end{DoxyParamCaption})}



Checks if a virtual address is mapped and whether it points to the correct physical address. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address} & The physical address to check (if 0 then wont check if correct entry) \\
\hline
{\em virtual\+\_\+address} & The address to check if it is mapped to \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the physical address is mapped to the virtual address 
\end{DoxyReturn}


Definition at line 682 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{682                                                                                            \{}
\DoxyCodeLine{683   \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(\textcolor{keyword}{false}, \textcolor{stringliteral}{"Not implemented! Check if physical address is mapped to virtual address 0x\%x -\/> 0x\%x\(\backslash\)n"}, \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, virtual\_address)}
\DoxyCodeLine{684   \textcolor{comment}{// TODO: Implement}}
\DoxyCodeLine{685   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{686 \}}

\end{DoxyCode}


References A\+S\+S\+E\+RT, and physical\+\_\+address.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a981b3d0afa8d5b41eda2d30a4478974c}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a981b3d0afa8d5b41eda2d30a4478974c}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map@{map}}
\index{map@{map}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map()}{map()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ Physical\+Memory\+Manager\+::map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$}]{physical\+\_\+address,  }\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{address,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Maps a physical address to a virtual address, using the kernel\textquotesingle{}s pml4 table. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address} & The physical address to map \\
\hline
{\em address} & The virtual address to map to \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The virtual address 
\end{DoxyReturn}


Definition at line 444 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{444                                                                                                                             \{}
\DoxyCodeLine{445 }
\DoxyCodeLine{446   \textcolor{comment}{// Base information}}
\DoxyCodeLine{447   pml\_t* pml4\_table = (pml\_t *)m\_pml4\_root\_address;}
\DoxyCodeLine{448   \textcolor{keywordtype}{size\_t} base\_addr = 0xFFFF000000000000;}
\DoxyCodeLine{449 }
\DoxyCodeLine{450   \textcolor{comment}{// Get the indexes}}
\DoxyCodeLine{451   uint16\_t pml4\_index = \mbox{\hyperlink{physical_8h_a21b56ad4b688267e89e208897cfdad31}{PML4\_GET\_INDEX}}((uint64\_t) \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{452   uint16\_t pdpr\_index = \mbox{\hyperlink{physical_8h_a363318d5bd935b341ef29aa93046f5de}{PML3\_GET\_INDEX}}((uint64\_t) \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{453   uint16\_t pd\_index   = \mbox{\hyperlink{physical_8h_aeccd6d6989169ce4bea31a8aebc3c312}{PML2\_GET\_INDEX}}((uint64\_t) \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{454   uint16\_t pt\_index   = \mbox{\hyperlink{physical_8h_a39f52e0488e29313ac48c0a06c9f8cbd}{PML1\_GET\_INDEX}}((uint64\_t) \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{455 }
\DoxyCodeLine{456   \textcolor{comment}{// Get the tables}}
\DoxyCodeLine{457   pml\_t *pdpr\_table =(pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index));}
\DoxyCodeLine{458   pml\_t *pd\_table = (pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index, (uint64\_t) pdpr\_index));}
\DoxyCodeLine{459   pml\_t *pt\_table = (pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index, (uint64\_t) pdpr\_index, (uint64\_t) pd\_index));}
\DoxyCodeLine{460 }
\DoxyCodeLine{461   \textcolor{comment}{// Create the tables}}
\DoxyCodeLine{462   create\_table(pml4\_table, pdpr\_table, pml4\_index);}
\DoxyCodeLine{463   create\_table(pdpr\_table, pd\_table, pdpr\_index);}
\DoxyCodeLine{464   create\_table(pd\_table, pt\_table, pd\_index);}
\DoxyCodeLine{465 }
\DoxyCodeLine{466   \textcolor{comment}{// Get the entry}}
\DoxyCodeLine{467   pte\_t* pte = \&pt\_table -\/> \mbox{\hyperlink{physical_8h_a571f2ec04bb9a58c7be02c94a37de231}{entries}}[pt\_index];}
\DoxyCodeLine{468 }
\DoxyCodeLine{469   \textcolor{comment}{// If it already exists return the address}}
\DoxyCodeLine{470   \textcolor{keywordflow}{if}(pte -\/> \mbox{\hyperlink{physical_8h_a85692f5f8e411b5cb7164a7ab671ddd4}{present}})}
\DoxyCodeLine{471     \textcolor{keywordflow}{return} \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}};}
\DoxyCodeLine{472 }
\DoxyCodeLine{473   \textcolor{comment}{// Map the physical address to the virtual address}}
\DoxyCodeLine{474  *pte = create\_page\_table\_entry((uint64\_t)\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{475 }
\DoxyCodeLine{476 }
\DoxyCodeLine{477   \textcolor{comment}{// Flush the TLB}}
\DoxyCodeLine{478   \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"invlpg (\%0)"} ::\textcolor{stringliteral}{"r"} (\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}}) : \textcolor{stringliteral}{"memory"});}
\DoxyCodeLine{479 }
\DoxyCodeLine{480   \textcolor{keywordflow}{return} \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}};}
\DoxyCodeLine{481 \}}

\end{DoxyCode}


References address, entries, E\+N\+T\+R\+I\+E\+S\+\_\+\+T\+O\+\_\+\+A\+D\+D\+R\+E\+SS, flags, Max\+O\+S\+::drivers\+::peripherals\+::l, physical\+\_\+address, P\+M\+L1\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L2\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L3\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L4\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, and present.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_acadc6bfafbd83d6a73b92cd60e9cd927}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_acadc6bfafbd83d6a73b92cd60e9cd927}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map@{map}}
\index{map@{map}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map()}{map()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ Physical\+Memory\+Manager\+::map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$}]{physical,  }\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address,  }\item[{size\+\_\+t}]{flags,  }\item[{uint64\+\_\+t $\ast$}]{pml4\+\_\+table }\end{DoxyParamCaption})}



Maps a physical address to a virtual address. 


\begin{DoxyParams}{Parameters}
{\em physical} & The physical address \\
\hline
{\em virtual\+\_\+address} & The virtual address \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
{\em pml4\+\_\+table} & The pml4 table to use \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The virtual address 
\end{DoxyReturn}


Definition at line 491 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{491                                                                                                                                                   \{}
\DoxyCodeLine{492 }
\DoxyCodeLine{493     \textcolor{comment}{// Get the indexes}}
\DoxyCodeLine{494     uint16\_t pml4\_index = \mbox{\hyperlink{physical_8h_a21b56ad4b688267e89e208897cfdad31}{PML4\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{495     uint16\_t pdpr\_index = \mbox{\hyperlink{physical_8h_a363318d5bd935b341ef29aa93046f5de}{PML3\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{496     uint16\_t pd\_index   = \mbox{\hyperlink{physical_8h_aeccd6d6989169ce4bea31a8aebc3c312}{PML2\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{497     uint16\_t pt\_index   = \mbox{\hyperlink{physical_8h_a39f52e0488e29313ac48c0a06c9f8cbd}{PML1\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{498 }
\DoxyCodeLine{499     \textcolor{comment}{// If it is in a lower region then assume it is the user space}}
\DoxyCodeLine{500     uint8\_t is\_user = \mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_a7d412394ef0b7e29bbe278406751761b}{MemoryManager::in\_higher\_region}}((uint64\_t)virtual\_address);}
\DoxyCodeLine{501     \textcolor{keywordflow}{if}(is\_user) \{}
\DoxyCodeLine{502 }
\DoxyCodeLine{503       \textcolor{comment}{// Change the flags to user}}
\DoxyCodeLine{504       \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}} |= \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebae45ca5ccdd807182c984942dde55ebaa}{User}};}
\DoxyCodeLine{505       is\_user = \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebae45ca5ccdd807182c984942dde55ebaa}{User}};}
\DoxyCodeLine{506 }
\DoxyCodeLine{507     \}}
\DoxyCodeLine{508 }
\DoxyCodeLine{509     \textcolor{comment}{// Store the tables}}
\DoxyCodeLine{510     uint64\_t* pdpr\_table = get\_or\_create\_table(pml4\_table, pml4\_index, \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}} | is\_user);}
\DoxyCodeLine{511     uint64\_t* pd\_table = get\_or\_create\_table(pdpr\_table, pdpr\_index, \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}} | is\_user);}
\DoxyCodeLine{512     uint64\_t* pt\_table = get\_or\_create\_table(pd\_table, pd\_index, \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}} | is\_user);}
\DoxyCodeLine{513 }
\DoxyCodeLine{514     \textcolor{comment}{// If the page is already mapped return the address}}
\DoxyCodeLine{515     \textcolor{keywordflow}{if}(pt\_table[pt\_index] \& 0b1)}
\DoxyCodeLine{516       \textcolor{keywordflow}{return} virtual\_address;}
\DoxyCodeLine{517 }
\DoxyCodeLine{518     \textcolor{comment}{// Map the physical address to the virtual address}}
\DoxyCodeLine{519     pt\_table[pt\_index] = (uint64\_t) physical | \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}};}
\DoxyCodeLine{520 }
\DoxyCodeLine{521     \textcolor{comment}{// Flush the TLB}}
\DoxyCodeLine{522     \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"invlpg (\%0)"} ::\textcolor{stringliteral}{"r"} (virtual\_address) : \textcolor{stringliteral}{"memory"});}
\DoxyCodeLine{523 }
\DoxyCodeLine{524     \textcolor{keywordflow}{return} virtual\_address;}
\DoxyCodeLine{525 \}}

\end{DoxyCode}


References flags, Max\+O\+S\+::memory\+::\+Memory\+Manager\+::in\+\_\+higher\+\_\+region(), P\+M\+L1\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L2\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L3\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L4\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, Max\+O\+S\+::memory\+::\+Present, Max\+O\+S\+::memory\+::\+User, and Max\+O\+S\+::memory\+::\+Write.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map@{map}}
\index{map@{map}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map()}{map()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ Physical\+Memory\+Manager\+::map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Allocates a physical address to a virtual address. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address} & The virtual address \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The virtual address 
\end{DoxyReturn}


Definition at line 533 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{533                                                                                               \{}
\DoxyCodeLine{534 }
\DoxyCodeLine{535   \textcolor{comment}{// Create a new physical address for the frame}}
\DoxyCodeLine{536   \mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}}* \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} = (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}} *)\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}{allocate\_frame}}();}
\DoxyCodeLine{537 }
\DoxyCodeLine{538   \textcolor{comment}{// Map the physical address to the virtual address}}
\DoxyCodeLine{539   \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, virtual\_address, \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{540 }
\DoxyCodeLine{541 \}}

\end{DoxyCode}


References allocate\+\_\+frame(), flags, and physical\+\_\+address.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), identity\+\_\+map(), map\+\_\+area(), Physical\+Memory\+Manager(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a155276cb4df27f12ce3cbd011dd93a79}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a155276cb4df27f12ce3cbd011dd93a79}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map\_area@{map\_area}}
\index{map\_area@{map\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map\_area()}{map\_area()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::map\+\_\+area (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$}]{physical\+\_\+address\+\_\+start,  }\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address\+\_\+start,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Maps an area of physical memory to a virtual address. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address\+\_\+start} & The start of the physical address \\
\hline
{\em virtual\+\_\+address\+\_\+start} & The start of the virtual address \\
\hline
{\em length} & The length of the area \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}


Definition at line 567 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{567                                                                                                                                                       \{}
\DoxyCodeLine{568 }
\DoxyCodeLine{569   \textcolor{comment}{// Get the size of the area}}
\DoxyCodeLine{570   \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{intel__i217_8h_aebb70c2aab3407a9f05334c47131a43b}{length}});}
\DoxyCodeLine{571 }
\DoxyCodeLine{572   \textcolor{comment}{// Map the required frames}}
\DoxyCodeLine{573   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{574     \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(physical\_address\_start + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}), virtual\_address\_start + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}), \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{575 }
\DoxyCodeLine{576 \}}

\end{DoxyCode}


References flags, Max\+O\+S\+::drivers\+::peripherals\+::i, length, map(), s\+\_\+page\+\_\+size, size, and size\+\_\+to\+\_\+frames().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a39a03a4a5c211c9af2ad07f8f4bd3028}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a39a03a4a5c211c9af2ad07f8f4bd3028}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map\_area@{map\_area}}
\index{map\_area@{map\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map\_area()}{map\_area()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::map\+\_\+area (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address\+\_\+start,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Allocates a new area physical memory to a area virtual address. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address\+\_\+start} & The start of the virtual address \\
\hline
{\em length} & The length of the area \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}


Definition at line 549 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{549                                                                                                           \{}
\DoxyCodeLine{550 }
\DoxyCodeLine{551     \textcolor{comment}{// Get the size of the area}}
\DoxyCodeLine{552     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{intel__i217_8h_aebb70c2aab3407a9f05334c47131a43b}{length}});}
\DoxyCodeLine{553 }
\DoxyCodeLine{554     \textcolor{comment}{// Map the required frames}}
\DoxyCodeLine{555     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{556         \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(virtual\_address\_start + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}), \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{557 }
\DoxyCodeLine{558 \}}

\end{DoxyCode}


References flags, Max\+O\+S\+::drivers\+::peripherals\+::i, length, map(), s\+\_\+page\+\_\+size, size, and size\+\_\+to\+\_\+frames().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!reserve@{reserve}}
\index{reserve@{reserve}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{reserve()}{reserve()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::reserve (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{address }\end{DoxyParamCaption})}



Reserves a physical address. 


\begin{DoxyParams}{Parameters}
{\em address} & The address to reserve \\
\hline
\end{DoxyParams}


Definition at line 836 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{836                                                     \{}
\DoxyCodeLine{837 }
\DoxyCodeLine{838   \textcolor{comment}{// If the address is not part of physical memory then return}}
\DoxyCodeLine{839   \textcolor{keywordflow}{if}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} >= m\_memory\_size)}
\DoxyCodeLine{840     \textcolor{keywordflow}{return};}
\DoxyCodeLine{841 }
\DoxyCodeLine{842   \textcolor{comment}{// Get the address to a page}}
\DoxyCodeLine{843   \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}{align\_direct\_to\_page}}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{844 }
\DoxyCodeLine{845   \textcolor{comment}{// Set the bit to 1 in the bitmap}}
\DoxyCodeLine{846   m\_bit\_map[\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} / ROW\_BITS] |= (1 << (\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} \% ROW\_BITS));}
\DoxyCodeLine{847 }
\DoxyCodeLine{848 \}}

\end{DoxyCode}


References address, and align\+\_\+direct\+\_\+to\+\_\+page().



Referenced by Physical\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab420fbeba638178bc689c68afa9d522b}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab420fbeba638178bc689c68afa9d522b}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!reserve@{reserve}}
\index{reserve@{reserve}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{reserve()}{reserve()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::reserve (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{address,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Reserves an area of physical memory. 


\begin{DoxyParams}{Parameters}
{\em address} & The start of the area \\
\hline
{\em size} & The size of the area \\
\hline
\end{DoxyParams}


Definition at line 855 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{855                                                                  \{}
\DoxyCodeLine{856   \textcolor{keywordflow}{if}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} >= m\_memory\_size)}
\DoxyCodeLine{857     \textcolor{keywordflow}{return};}
\DoxyCodeLine{858 }
\DoxyCodeLine{859   \textcolor{comment}{// Align address and size to page boundaries}}
\DoxyCodeLine{860   \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}{align\_direct\_to\_page}}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{861   \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}{align\_to\_page}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{862 }
\DoxyCodeLine{863   \textcolor{comment}{// Calculate how many pages need to be reserved}}
\DoxyCodeLine{864   \textcolor{keywordtype}{size\_t} page\_count = \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{865   \textcolor{comment}{// Convert the starting address to a frame index}}
\DoxyCodeLine{866   uint64\_t frame\_index = \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{867 }
\DoxyCodeLine{868   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < page\_count; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \{}
\DoxyCodeLine{869     m\_bit\_map[(frame\_index + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) / ROW\_BITS] |= (1ULL << ((frame\_index + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \% ROW\_BITS));}
\DoxyCodeLine{870   \}}
\DoxyCodeLine{871 }
\DoxyCodeLine{872   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Reserved Address: 0x\%x -\/ 0x\%x\(\backslash\)n"}, \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}}, \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} + \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{873 \}}

\end{DoxyCode}


References \+\_\+kprintf, address, align\+\_\+direct\+\_\+to\+\_\+page(), align\+\_\+to\+\_\+page(), Max\+O\+S\+::drivers\+::peripherals\+::i, s\+\_\+page\+\_\+size, and size.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!size\_to\_frames@{size\_to\_frames}}
\index{size\_to\_frames@{size\_to\_frames}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{size\_to\_frames()}{size\_to\_frames()}}
{\footnotesize\ttfamily size\+\_\+t Physical\+Memory\+Manager\+::size\+\_\+to\+\_\+frames (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Converts a size to the number of frames. 


\begin{DoxyParams}{Parameters}
{\em size} & The size to convert \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of frames 
\end{DoxyReturn}


Definition at line 131 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{131                                                         \{}
\DoxyCodeLine{132     \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}{align\_to\_page}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}) / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{133 \}}

\end{DoxyCode}


References align\+\_\+to\+\_\+page(), s\+\_\+page\+\_\+size, and size.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), allocate\+\_\+area(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::free(), free\+\_\+area(), map\+\_\+area(), and unmap\+\_\+area().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a47cc8d6c823f3c323f88e21437ba88ea}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a47cc8d6c823f3c323f88e21437ba88ea}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!unmap@{unmap}}
\index{unmap@{unmap}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{unmap()}{unmap()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::unmap (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address }\end{DoxyParamCaption})}



Unmaps a virtual address using the kernel\textquotesingle{}s pml4 table. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address} & The virtual address to unmap \\
\hline
\end{DoxyParams}


Definition at line 594 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{594                                                                     \{}
\DoxyCodeLine{595 }
\DoxyCodeLine{596   \textcolor{comment}{// Base information}}
\DoxyCodeLine{597   pml\_t* pml4\_table = (pml\_t *)m\_pml4\_root\_address;}
\DoxyCodeLine{598   \textcolor{keywordtype}{size\_t} base\_addr = 0xFFFF000000000000;}
\DoxyCodeLine{599 }
\DoxyCodeLine{600   \textcolor{comment}{// Get the indexes}}
\DoxyCodeLine{601   uint16\_t pml4\_index = \mbox{\hyperlink{physical_8h_a21b56ad4b688267e89e208897cfdad31}{PML4\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{602   uint16\_t pdpr\_index = \mbox{\hyperlink{physical_8h_a363318d5bd935b341ef29aa93046f5de}{PML3\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{603   uint16\_t pd\_index   = \mbox{\hyperlink{physical_8h_aeccd6d6989169ce4bea31a8aebc3c312}{PML2\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{604   uint16\_t pt\_index   = \mbox{\hyperlink{physical_8h_a39f52e0488e29313ac48c0a06c9f8cbd}{PML1\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{605 }
\DoxyCodeLine{606   \textcolor{comment}{// Get the tables}}
\DoxyCodeLine{607   pml\_t *pdpr\_table =(pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index));}
\DoxyCodeLine{608   pml\_t *pd\_table = (pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index, (uint64\_t) pdpr\_index));}
\DoxyCodeLine{609   uint64\_t* pt\_table = (uint64\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index, (uint64\_t) pdpr\_index, (uint64\_t) pd\_index));}
\DoxyCodeLine{610 }
\DoxyCodeLine{611   \textcolor{comment}{// Check if the entry is present}}
\DoxyCodeLine{612   \textcolor{keywordflow}{if}(table\_has\_entry(pml4\_table, pml4\_index) \&\& table\_has\_entry(pdpr\_table, pdpr\_index) \&\& table\_has\_entry(pd\_table, pd\_index))}
\DoxyCodeLine{613     \textcolor{keywordflow}{return};}
\DoxyCodeLine{614 }
\DoxyCodeLine{615   \textcolor{comment}{// Check if the entry isn't present}}
\DoxyCodeLine{616   \textcolor{keywordflow}{if}(!(pt\_table[pt\_index] \& 0b1))}
\DoxyCodeLine{617     \textcolor{keywordflow}{return};}
\DoxyCodeLine{618 }
\DoxyCodeLine{619   \textcolor{comment}{// Unmap the entry}}
\DoxyCodeLine{620   pt\_table[pt\_index] = 0x00\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}};}
\DoxyCodeLine{621 }
\DoxyCodeLine{622   \textcolor{comment}{// Flush the TLB}}
\DoxyCodeLine{623   \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"invlpg (\%0)"} ::\textcolor{stringliteral}{"r"} (virtual\_address) : \textcolor{stringliteral}{"memory"});}
\DoxyCodeLine{624 \}}

\end{DoxyCode}


References E\+N\+T\+R\+I\+E\+S\+\_\+\+T\+O\+\_\+\+A\+D\+D\+R\+E\+SS, Max\+O\+S\+::drivers\+::peripherals\+::l, P\+M\+L1\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L2\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L3\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, and P\+M\+L4\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::free(), and unmap\+\_\+area().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0f453dd61a29a033887b3a531cf3910f}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0f453dd61a29a033887b3a531cf3910f}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!unmap@{unmap}}
\index{unmap@{unmap}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{unmap()}{unmap()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::unmap (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address,  }\item[{uint64\+\_\+t $\ast$}]{pml4\+\_\+root }\end{DoxyParamCaption})}



Unmaps a virtual address. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address} & The virtual address to unmap \\
\hline
{\em pml4\+\_\+root} & The pml4 table to use \\
\hline
\end{DoxyParams}


Definition at line 631 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{631                                                                                          \{}
\DoxyCodeLine{632 }
\DoxyCodeLine{633     \textcolor{comment}{// Get the indexes}}
\DoxyCodeLine{634     uint16\_t pml4\_index = \mbox{\hyperlink{physical_8h_a21b56ad4b688267e89e208897cfdad31}{PML4\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{635     uint16\_t pdpr\_index = \mbox{\hyperlink{physical_8h_a363318d5bd935b341ef29aa93046f5de}{PML3\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{636     uint16\_t pd\_index   = \mbox{\hyperlink{physical_8h_aeccd6d6989169ce4bea31a8aebc3c312}{PML2\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{637     uint16\_t pt\_index   = \mbox{\hyperlink{physical_8h_a39f52e0488e29313ac48c0a06c9f8cbd}{PML1\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{638 }
\DoxyCodeLine{639     \textcolor{comment}{// Get the tables}}
\DoxyCodeLine{640     uint64\_t* pdpr\_table = get\_table\_if\_exists(pml4\_root, pml4\_index);}
\DoxyCodeLine{641     uint64\_t* pd\_table = get\_table\_if\_exists(pdpr\_table, pdpr\_index);}
\DoxyCodeLine{642     uint64\_t* pt\_table = get\_table\_if\_exists(pd\_table, pd\_index);}
\DoxyCodeLine{643 }
\DoxyCodeLine{644     \textcolor{comment}{// Check if the tables are present (if any are not then a pt entry will not be present)}}
\DoxyCodeLine{645     \textcolor{keywordflow}{if}(pt\_table == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{646       \textcolor{keywordflow}{return};}
\DoxyCodeLine{647 }
\DoxyCodeLine{648 }
\DoxyCodeLine{649     \textcolor{comment}{// Check if the entry is present}}
\DoxyCodeLine{650     \textcolor{keywordflow}{if}(!(pt\_table[pt\_index] \& 0b1))}
\DoxyCodeLine{651       \textcolor{keywordflow}{return};}
\DoxyCodeLine{652 }
\DoxyCodeLine{653     \textcolor{comment}{// Unmap the entry}}
\DoxyCodeLine{654     pt\_table[pt\_index] = 0x00\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}};}
\DoxyCodeLine{655 }
\DoxyCodeLine{656     \textcolor{comment}{// Flush the TLB}}
\DoxyCodeLine{657     \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"invlpg (\%0)"} ::\textcolor{stringliteral}{"r"} (virtual\_address) : \textcolor{stringliteral}{"memory"});}
\DoxyCodeLine{658 }
\DoxyCodeLine{659 \}}

\end{DoxyCode}


References Max\+O\+S\+::drivers\+::peripherals\+::l, P\+M\+L1\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L2\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L3\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, and P\+M\+L4\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0cc0fb25a8d67e16410a847c4fd59ea3}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0cc0fb25a8d67e16410a847c4fd59ea3}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!unmap\_area@{unmap\_area}}
\index{unmap\_area@{unmap\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{unmap\_area()}{unmap\_area()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::unmap\+\_\+area (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address\+\_\+start,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Unmaps an area of virtual memory. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address\+\_\+start} & The start of the area \\
\hline
{\em length} & The length of the area \\
\hline
\end{DoxyParams}


Definition at line 666 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{666                                                                                               \{}
\DoxyCodeLine{667 }
\DoxyCodeLine{668     \textcolor{comment}{// Get the size of the area}}
\DoxyCodeLine{669     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{intel__i217_8h_aebb70c2aab3407a9f05334c47131a43b}{length}});}
\DoxyCodeLine{670 }
\DoxyCodeLine{671     \textcolor{comment}{// Unmap the required frames}}
\DoxyCodeLine{672     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{673       \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a47cc8d6c823f3c323f88e21437ba88ea}{unmap}}(virtual\_address\_start + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}));}
\DoxyCodeLine{674 \}}

\end{DoxyCode}


References Max\+O\+S\+::drivers\+::peripherals\+::i, length, s\+\_\+page\+\_\+size, size, size\+\_\+to\+\_\+frames(), and unmap().



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1d6ffacb7290c01505c3dec9f9cfd3f1}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1d6ffacb7290c01505c3dec9f9cfd3f1}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!s\_current\_manager@{s\_current\_manager}}
\index{s\_current\_manager@{s\_current\_manager}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{s\_current\_manager}{s\_current\_manager}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager}{Physical\+Memory\+Manager}} $\ast$ Physical\+Memory\+Manager\+::s\+\_\+current\+\_\+manager = nullptr\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 139 of file physical.\+h.



Referenced by Physical\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!s\_page\_size@{s\_page\_size}}
\index{s\_page\_size@{s\_page\_size}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{s\_page\_size}{s\_page\_size}}
{\footnotesize\ttfamily const uint32\+\_\+t Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::s\+\_\+page\+\_\+size = \{ 0x1000 \}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 104 of file physical.\+h.



Referenced by align\+\_\+direct\+\_\+to\+\_\+page(), align\+\_\+to\+\_\+page(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), allocate\+\_\+area(), allocate\+\_\+frame(), check\+\_\+aligned(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::free(), free\+\_\+area(), free\+\_\+frame(), get\+\_\+memory\+\_\+used(), is\+\_\+anonymous\+\_\+available(), map\+\_\+area(), Max\+O\+S\+::memory\+::\+Memory\+Manager\+::\+Memory\+Manager(), Physical\+Memory\+Manager(), reserve(), size\+\_\+to\+\_\+frames(), unmap\+\_\+area(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/include/memory/\mbox{\hyperlink{physical_8h}{physical.\+h}}\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/src/memory/\mbox{\hyperlink{physical_8cpp}{physical.\+cpp}}\end{DoxyCompactItemize}
