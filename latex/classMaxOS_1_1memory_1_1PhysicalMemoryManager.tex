\hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager}{}\doxysection{Max\+OS\+::memory\+::Physical\+Memory\+Manager Class Reference}
\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager}\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}


{\ttfamily \#include $<$physical.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab99d6d13a57780003adf4f81c5882fa5}{Physical\+Memory\+Manager}} (unsigned long \mbox{\hyperlink{tcp_8h_acb7bc06bed6f6408d719334fc41698c7}{reserved}}, \mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot}{system\+::\+Multiboot}} $\ast$multiboot, uint64\+\_\+t pml4\+\_\+root\mbox{[}512\mbox{]})
\item 
\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a8cf728268a7e9fb72d0903a49a301b0a}{$\sim$\+Physical\+Memory\+Manager}} ()
\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0bd4c0766bc4c3930920814f2f7de1c5}{get\+\_\+memory\+\_\+size}} ()
\begin{DoxyCompactList}\small\item\em Gets total the memory size available for use (allocated or not) \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af2252a8df82a662c5fbeb48f057ea9f0}{get\+\_\+memory\+\_\+used}} ()
\begin{DoxyCompactList}\small\item\em Gets the memory currently used. \end{DoxyCompactList}\item 
uint64\+\_\+t $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ac54f576d801ed62713b84ae64d83fb64}{get\+\_\+pml4\+\_\+root\+\_\+address}} ()
\begin{DoxyCompactList}\small\item\em Gets the pml4 root address for the kernel. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}{allocate\+\_\+frame}} ()
\begin{DoxyCompactList}\small\item\em Allocates a physical page of memory, if the P\+MM is not initalise it will use the anon memory instead of the bitmap. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af0b6a43f9b559575ece938d3918fc3a1}{free\+\_\+frame}} (void $\ast$\mbox{\hyperlink{gdt_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}})
\begin{DoxyCompactList}\small\item\em Frees a frame in the bit map. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af68e198da5c85cc1443f28ecd0f92bd2}{allocate\+\_\+area}} (uint64\+\_\+t start\+\_\+address, size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Allocate an area of physical memory (ie reserve it) \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad0aaa5f1fb32a28d1d91cc5630d56dad}{free\+\_\+area}} (uint64\+\_\+t start\+\_\+address, size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Frees an area of physical memory. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Allocates a physical address to a virtual address. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a981b3d0afa8d5b41eda2d30a4478974c}{map}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$physical, \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Maps a physical address to a virtual address, using the kernel\textquotesingle{}s pml4 table. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_acadc6bfafbd83d6a73b92cd60e9cd927}{map}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$physical, \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}}, uint64\+\_\+t $\ast$pml4\+\_\+root)
\begin{DoxyCompactList}\small\item\em Maps a physical address to a virtual address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a39a03a4a5c211c9af2ad07f8f4bd3028}{map\+\_\+area}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address\+\_\+start, size\+\_\+t \mbox{\hyperlink{udp_8h_a1892eba2086d12ac2b09005aeb09ea3b}{length}}, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Allocates a new area physical memory to a area virtual address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a155276cb4df27f12ce3cbd011dd93a79}{map\+\_\+area}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$physical\+\_\+address\+\_\+start, \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address\+\_\+start, size\+\_\+t \mbox{\hyperlink{udp_8h_a1892eba2086d12ac2b09005aeb09ea3b}{length}}, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Maps an area of physical memory to a virtual address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ace56d1f37c7be25425fe92c994a5cedd}{identity\+\_\+map}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\+\_\+address}}, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Maps a physical address to its virtual address counter-\/part. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a47cc8d6c823f3c323f88e21437ba88ea}{unmap}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address)
\begin{DoxyCompactList}\small\item\em Unmaps a virtual address using the kernel\textquotesingle{}s pml4 table. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0f453dd61a29a033887b3a531cf3910f}{unmap}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address, uint64\+\_\+t $\ast$pml4\+\_\+root)
\begin{DoxyCompactList}\small\item\em Unmaps a virtual address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0cc0fb25a8d67e16410a847c4fd59ea3}{unmap\+\_\+area}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address\+\_\+start, size\+\_\+t \mbox{\hyperlink{udp_8h_a1892eba2086d12ac2b09005aeb09ea3b}{length}})
\begin{DoxyCompactList}\small\item\em Unmaps an area of virtual memory. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a344d9602dcf5a77e672a1859fa05e67f}{is\+\_\+anonymous\+\_\+available}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Checks if a physical address is reserved by multiboot mmap. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a66d5d1a4c7c019d77fcee0aa3c128d07}{clean\+\_\+page\+\_\+table}} (uint64\+\_\+t $\ast$table)
\begin{DoxyCompactList}\small\item\em Cleans a page table (fills it with 0 or null entries) \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}{reserve}} (uint64\+\_\+t \mbox{\hyperlink{gdt_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}})
\begin{DoxyCompactList}\small\item\em Reserves a physical address. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab420fbeba638178bc689c68afa9d522b}{reserve}} (uint64\+\_\+t \mbox{\hyperlink{gdt_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}}, size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Reserves an area of physical memory. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af43b96063c89e26eecb6aa9c8e46f4fb}{get\+\_\+physical\+\_\+address}} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$virtual\+\_\+address, uint64\+\_\+t $\ast$pml4\+\_\+root)
\begin{DoxyCompactList}\small\item\em Gets the physical address from a virtual address (if it exists) \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a9bee7cca21ce9658ca4dd48cedb6f8a9}{is\+\_\+mapped}} (uintptr\+\_\+t \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\+\_\+address}}, uintptr\+\_\+t virtual\+\_\+address, uint64\+\_\+t $\ast$pml4\+\_\+root)
\begin{DoxyCompactList}\small\item\em Checks if a physical address is mapped to a virtual address. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\+\_\+to\+\_\+frames}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Converts a size to the number of frames. \end{DoxyCompactList}\item 
static size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}{align\+\_\+to\+\_\+page}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Aligns a size to the page size. \end{DoxyCompactList}\item 
static size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}{align\+\_\+direct\+\_\+to\+\_\+page}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Aligns a address to the page size. \end{DoxyCompactList}\item 
static size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}{align\+\_\+up\+\_\+to\+\_\+page}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\+\_\+page\+\_\+size}})
\begin{DoxyCompactList}\small\item\em Aligns a size up to the page size. \end{DoxyCompactList}\item 
static bool \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_aa7f389d1b15d109bd5669d0475ebc912}{check\+\_\+aligned}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Checks if an address is aligned. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Attributes}
\begin{DoxyCompactItemize}
\item 
static const uint32\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\+\_\+page\+\_\+size}} = \{ 0x1000 \}
\item 
static \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager}{Physical\+Memory\+Manager}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1d6ffacb7290c01505c3dec9f9cfd3f1}{s\+\_\+current\+\_\+manager}} = nullptr
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 64 of file physical.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab99d6d13a57780003adf4f81c5882fa5}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab99d6d13a57780003adf4f81c5882fa5}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!PhysicalMemoryManager@{PhysicalMemoryManager}}
\index{PhysicalMemoryManager@{PhysicalMemoryManager}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{PhysicalMemoryManager()}{PhysicalMemoryManager()}}
{\footnotesize\ttfamily Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::\+Physical\+Memory\+Manager (\begin{DoxyParamCaption}\item[{unsigned long}]{reserved,  }\item[{\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot}{system\+::\+Multiboot}} $\ast$}]{multiboot,  }\item[{uint64\+\_\+t}]{pml4\+\_\+root\mbox{[}512\mbox{]} }\end{DoxyParamCaption})}



Definition at line 22 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{23 : m\_kernel\_end((uint64\_t)\&\mbox{\hyperlink{physical_8cpp_a5d533ddf4ea36ed94c6a20a7281cb89f}{\_kernel\_physical\_end}}),}
\DoxyCodeLine{24   m\_multiboot(multiboot),}
\DoxyCodeLine{25   m\_pml4\_root\_address(pml4\_root),}
\DoxyCodeLine{26   m\_pml4\_root((pte\_t *)pml4\_root)}
\DoxyCodeLine{27 \{}
\DoxyCodeLine{28 }
\DoxyCodeLine{29   \textcolor{comment}{// Clear the spinlock}}
\DoxyCodeLine{30   m\_lock = \mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock}{Spinlock}}();}
\DoxyCodeLine{31   m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a7c26334ccfa43ef932ef3c73e2c11492}{unlock}}();}
\DoxyCodeLine{32 }
\DoxyCodeLine{33   \textcolor{comment}{// Set the current manager}}
\DoxyCodeLine{34   \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1d6ffacb7290c01505c3dec9f9cfd3f1}{s\_current\_manager}} = \textcolor{keyword}{this};}
\DoxyCodeLine{35 }
\DoxyCodeLine{36   \textcolor{comment}{// SEE boot.s FOR SETUP OF PAGING}}
\DoxyCodeLine{37   m\_pml4\_root = (pte\_t *)pml4\_root;}
\DoxyCodeLine{38   m\_pml4\_root\_address = pml4\_root;}
\DoxyCodeLine{39   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"PML4: 0x\%x\(\backslash\)n"}, m\_pml4\_root);}
\DoxyCodeLine{40 }
\DoxyCodeLine{41   \textcolor{comment}{// Store the information about the bitmap}}
\DoxyCodeLine{42   m\_memory\_size = (m\_multiboot-\/>\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot_a260d1ef1c1a5eb68f38cf25808167630}{get\_basic\_meminfo}}()-\/>\mbox{\hyperlink{structmultiboot__tag__basic__meminfo_ae329d0036de802dbac0b6bd991495738}{mem\_upper}} + 1024) * 1024;}
\DoxyCodeLine{43   m\_bitmap\_size = m\_memory\_size / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} + 1;}
\DoxyCodeLine{44   m\_total\_entries = m\_bitmap\_size / ROW\_BITS + 1;}
\DoxyCodeLine{45   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Mem Info: size = \%dmb, bitmap size = \%d, total entries = \%d, page size = \%db\(\backslash\)n"}, ((m\_memory\_size / 1000) * 1024) / 1024 / 1024, m\_bitmap\_size, m\_total\_entries, \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{46 }
\DoxyCodeLine{47   \textcolor{comment}{// Get the mmap that stores the memory to use}}
\DoxyCodeLine{48   m\_mmap\_tag = m\_multiboot-\/>\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot_adab0945a9a6b46d34f1f4fa1757cdd34}{get\_mmap}}();}
\DoxyCodeLine{49   \textcolor{keywordflow}{for} (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *entry = m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a20c4427afce786340b01ded5ed0532a2}{entries}}; (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)entry < (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)m\_mmap\_tag + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a0663e47406ed5799d5bd55ccf2d4fa95}{size}}; entry = (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *)((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})entry + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_aa5532c68672471f9da8ba18a8a16857d}{entry\_size}})) \{}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{comment}{// Skip if the region is not free or there is not enough space}}
\DoxyCodeLine{52     \textcolor{keywordflow}{if} (entry-\/>type != \mbox{\hyperlink{multiboot_8h_a7fe141351ebcde0acbd6118ad0ea1a21}{MULTIBOOT\_MEMORY\_AVAILABLE}} || (entry-\/>addr + entry-\/>len) < \mbox{\hyperlink{fat32_8h_ac35c1fbebe2017fc1ca10f5803668dfd}{reserved}})}
\DoxyCodeLine{53       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{54 }
\DoxyCodeLine{55     \textcolor{comment}{// We want the last entry}}
\DoxyCodeLine{56     m\_mmap = entry;}
\DoxyCodeLine{57   \}}
\DoxyCodeLine{58   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Mmap in use: 0x\%x -\/ 0x\%x\(\backslash\)n"}, m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a3f76a637264b83e30967bcd808ff403c}{addr}}, m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a3f76a637264b83e30967bcd808ff403c}{addr}} + m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a6bfa44919a328492fa4e3d6239a23352}{len}});}
\DoxyCodeLine{59 }
\DoxyCodeLine{60   \textcolor{comment}{// Kernel Memory (anonymous memory to the next page)}}
\DoxyCodeLine{61   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Kernel Memory: kernel\_end = 0x\%x, kernel\_size = 0x\%x, kernel\_physical\_end = 0x\%x\(\backslash\)n"}, \&\mbox{\hyperlink{physical_8cpp_a963a9b86d21e2b5cfdeb947f25826c13}{\_kernel\_end}}, \&\mbox{\hyperlink{physical_8cpp_aea8f7989c93a7869e750d1bbf6c3cf10}{\_kernel\_size}}, \&\mbox{\hyperlink{physical_8cpp_a5d533ddf4ea36ed94c6a20a7281cb89f}{\_kernel\_physical\_end}});}
\DoxyCodeLine{62   m\_anonymous\_memory\_physical\_address = (uint64\_t)\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}{align\_up\_to\_page}}((\textcolor{keywordtype}{size\_t})\&\mbox{\hyperlink{physical_8cpp_a5d533ddf4ea36ed94c6a20a7281cb89f}{\_kernel\_physical\_end}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}, \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{63   m\_anonymous\_memory\_virtual\_address  = (uint64\_t)\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}{align\_up\_to\_page}}((\textcolor{keywordtype}{size\_t})\&\mbox{\hyperlink{physical_8cpp_a963a9b86d21e2b5cfdeb947f25826c13}{\_kernel\_end}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}, \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{64   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Anonymous Memory: physical = 0x\%x, virtual = 0x\%x\(\backslash\)n"}, m\_anonymous\_memory\_physical\_address, m\_anonymous\_memory\_virtual\_address);}
\DoxyCodeLine{65 }
\DoxyCodeLine{66   \textcolor{comment}{// Map the physical memory into the virtual memory}}
\DoxyCodeLine{67   uint64\_t \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} = 0;}
\DoxyCodeLine{68   uint64\_t virtual\_address = \mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_a25fe2fa3e01b0a9593cede08126095bf}{MemoryManager::s\_hh\_direct\_map\_offset}};}
\DoxyCodeLine{69   uint64\_t mem\_end = m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a3f76a637264b83e30967bcd808ff403c}{addr}} + m\_mmap-\/>\mbox{\hyperlink{structmultiboot__mmap__entry_a6bfa44919a328492fa4e3d6239a23352}{len}};}
\DoxyCodeLine{70 }
\DoxyCodeLine{71   \textcolor{keywordflow}{while} (\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} < mem\_end) \{}
\DoxyCodeLine{72     \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}((\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}} *)\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}} *)virtual\_address, \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}});}
\DoxyCodeLine{73     \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{74     virtual\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{75   \}}
\DoxyCodeLine{76   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Mapped: physical = 0x\%x-\/0x\%x, virtual = 0x\%x-\/0x\%x\(\backslash\)n"}, 0, \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, \mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_a25fe2fa3e01b0a9593cede08126095bf}{MemoryManager::s\_hh\_direct\_map\_offset}}, virtual\_address); \textcolor{comment}{// TODO: FAILS WHEN TRYING WITH LIKE 2Gb Mem}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78   \textcolor{comment}{// Calculate the bitmap address}}
\DoxyCodeLine{79   m\_anonymous\_memory\_physical\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{80   m\_bit\_map = get\_bitmap\_address();}
\DoxyCodeLine{81 }
\DoxyCodeLine{82   \textcolor{comment}{// Clear the bitmap}}
\DoxyCodeLine{83   \textcolor{keywordflow}{for} (uint32\_t \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < m\_total\_entries; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{84     m\_bit\_map[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}] = 0;}
\DoxyCodeLine{85 }
\DoxyCodeLine{86   \textcolor{comment}{// Reserve the area for the bitmap}}
\DoxyCodeLine{87   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Bitmap: location = 0x\%x -\/ 0x\%x (range of 0x\%x)\(\backslash\)n"}, m\_bit\_map, m\_bit\_map + m\_bitmap\_size / 8, m\_bitmap\_size / 8);}
\DoxyCodeLine{88   \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}{reserve}}((uint64\_t)\mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_ab0647fd9b0c504382c6b52117c883fe0}{MemoryManager::from\_dm\_region}}((uint64\_t)m\_bit\_map), m\_bitmap\_size / 8 );}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 }
\DoxyCodeLine{91   \textcolor{comment}{// Calculate how much space the kernel takes up}}
\DoxyCodeLine{92   uint32\_t kernel\_entries = (m\_anonymous\_memory\_physical\_address / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}) + 1;}
\DoxyCodeLine{93   \textcolor{keywordflow}{if} ((((uint32\_t)(m\_anonymous\_memory\_physical\_address)) \% \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}) != 0) \{}
\DoxyCodeLine{94     \textcolor{comment}{// If the kernel takes up more then a whole page(s)}}
\DoxyCodeLine{95     kernel\_entries += 1;}
\DoxyCodeLine{96   \}}
\DoxyCodeLine{97 }
\DoxyCodeLine{98   \textcolor{comment}{// Reserve the kernel in the bitmap}}
\DoxyCodeLine{99   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Kernel: location = 0x\%x -\/ 0x\%x (range of 0x\%x)\(\backslash\)n"}, 0, m\_anonymous\_memory\_physical\_address, kernel\_entries * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{100   \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}{reserve}}(0, kernel\_entries * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{101 }
\DoxyCodeLine{102 }
\DoxyCodeLine{103   \textcolor{comment}{// Reserve the area for the mmap}}
\DoxyCodeLine{104   \textcolor{keywordflow}{for} (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *entry = m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a20c4427afce786340b01ded5ed0532a2}{entries}}; (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)entry < (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)m\_mmap\_tag + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a0663e47406ed5799d5bd55ccf2d4fa95}{size}}; entry = (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *)((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})entry + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_aa5532c68672471f9da8ba18a8a16857d}{entry\_size}})) \{}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     \textcolor{comment}{// Check if the entry is to be mapped}}
\DoxyCodeLine{107     \textcolor{keywordflow}{if} (entry-\/>type <= \mbox{\hyperlink{multiboot_8h_a7fe141351ebcde0acbd6118ad0ea1a21}{MULTIBOOT\_MEMORY\_AVAILABLE}})}
\DoxyCodeLine{108       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{109 }
\DoxyCodeLine{110     \textcolor{comment}{// Where the free mem starts}}
\DoxyCodeLine{111     \textcolor{keywordflow}{if}(entry-\/>addr >= mem\_end)}
\DoxyCodeLine{112       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{113 }
\DoxyCodeLine{114     \textcolor{comment}{// Reserve the area}}
\DoxyCodeLine{115     \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}{reserve}}(entry-\/>addr, entry-\/>len);}
\DoxyCodeLine{116   \}}
\DoxyCodeLine{117 }
\DoxyCodeLine{118   \textcolor{comment}{// Reserve the area for each multiboot module}}
\DoxyCodeLine{119   \textcolor{keywordflow}{for}(\mbox{\hyperlink{structmultiboot__tag}{multiboot\_tag}}* tag = multiboot -\/> get\_start\_tag(); tag-\/>\mbox{\hyperlink{structmultiboot__tag_ac2a46af85d217c774d2a618291539334}{type}} != \mbox{\hyperlink{multiboot_8h_a9ba1adbd7639e20f723e51dd9668a981}{MULTIBOOT\_TAG\_TYPE\_END}}; tag = (\textcolor{keyword}{struct }\mbox{\hyperlink{structmultiboot__tag}{multiboot\_tag}} *) ((\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *) tag + ((tag-\/>size + 7) \& \string~7))) \{}
\DoxyCodeLine{120 }
\DoxyCodeLine{121     \textcolor{comment}{// Check if the tag is a module}}
\DoxyCodeLine{122     \textcolor{keywordflow}{if}(tag -\/> \mbox{\hyperlink{apic_8h_a1d127017fb298b889f4ba24752d08b8e}{type}} != \mbox{\hyperlink{multiboot_8h_a10b78479319b8790657f13414cf34736}{MULTIBOOT\_TAG\_TYPE\_MODULE}})}
\DoxyCodeLine{123       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{124 }
\DoxyCodeLine{125     \textcolor{comment}{// Get the module tag}}
\DoxyCodeLine{126     \textcolor{keyword}{struct }\mbox{\hyperlink{structmultiboot__tag__module}{multiboot\_tag\_module}}* module = (\textcolor{keyword}{struct }\mbox{\hyperlink{structmultiboot__tag__module}{multiboot\_tag\_module}}*)tag;}
\DoxyCodeLine{127 }
\DoxyCodeLine{128     \textcolor{comment}{// Reserve the address}}
\DoxyCodeLine{129     \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}{reserve}}(module-\/>\mbox{\hyperlink{structmultiboot__tag__module_af2870ead515a1c38d4484645ab54fb03}{mod\_start}}, module-\/>\mbox{\hyperlink{structmultiboot__tag__module_ae0a4f42952619e0807cbb5debbf6e5af}{mod\_end}} -\/ module-\/>\mbox{\hyperlink{structmultiboot__tag__module_af2870ead515a1c38d4484645ab54fb03}{mod\_start}});}
\DoxyCodeLine{130   \}}
\DoxyCodeLine{131 }
\DoxyCodeLine{132   \textcolor{comment}{// Initialisation Done}}
\DoxyCodeLine{133   m\_initialized = \textcolor{keyword}{true};}
\DoxyCodeLine{134 \}}

\end{DoxyCode}


References \+\_\+kernel\+\_\+end, \+\_\+kernel\+\_\+physical\+\_\+end, \+\_\+kernel\+\_\+size, \+\_\+kprintf, multiboot\+\_\+mmap\+\_\+entry\+::addr, align\+\_\+up\+\_\+to\+\_\+page(), multiboot\+\_\+tag\+\_\+mmap\+::entries, multiboot\+\_\+tag\+\_\+mmap\+::entry\+\_\+size, Max\+O\+S\+::memory\+::\+Memory\+Manager\+::from\+\_\+dm\+\_\+region(), Max\+O\+S\+::system\+::\+Multiboot\+::get\+\_\+basic\+\_\+meminfo(), Max\+O\+S\+::system\+::\+Multiboot\+::get\+\_\+mmap(), Max\+O\+S\+::drivers\+::peripherals\+::i, multiboot\+\_\+mmap\+\_\+entry\+::len, map(), multiboot\+\_\+tag\+\_\+basic\+\_\+meminfo\+::mem\+\_\+upper, multiboot\+\_\+tag\+\_\+module\+::mod\+\_\+end, multiboot\+\_\+tag\+\_\+module\+::mod\+\_\+start, M\+U\+L\+T\+I\+B\+O\+O\+T\+\_\+\+M\+E\+M\+O\+R\+Y\+\_\+\+A\+V\+A\+I\+L\+A\+B\+LE, M\+U\+L\+T\+I\+B\+O\+O\+T\+\_\+\+T\+A\+G\+\_\+\+T\+Y\+P\+E\+\_\+\+E\+ND, M\+U\+L\+T\+I\+B\+O\+O\+T\+\_\+\+T\+A\+G\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+O\+D\+U\+LE, physical\+\_\+address, Max\+O\+S\+::memory\+::\+Present, reserve(), reserved, s\+\_\+current\+\_\+manager, Max\+O\+S\+::memory\+::\+Memory\+Manager\+::s\+\_\+hh\+\_\+direct\+\_\+map\+\_\+offset, s\+\_\+page\+\_\+size, multiboot\+\_\+tag\+\_\+mmap\+::size, type, Max\+O\+S\+::common\+::\+Spinlock\+::unlock(), and Max\+O\+S\+::memory\+::\+Write.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a8cf728268a7e9fb72d0903a49a301b0a}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a8cf728268a7e9fb72d0903a49a301b0a}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!````~PhysicalMemoryManager@{$\sim$PhysicalMemoryManager}}
\index{````~PhysicalMemoryManager@{$\sim$PhysicalMemoryManager}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{$\sim$PhysicalMemoryManager()}{~PhysicalMemoryManager()}}
{\footnotesize\ttfamily Physical\+Memory\+Manager\+::$\sim$\+Physical\+Memory\+Manager (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 136 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{136                                               \{}
\DoxyCodeLine{137 }
\DoxyCodeLine{138 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!align\_direct\_to\_page@{align\_direct\_to\_page}}
\index{align\_direct\_to\_page@{align\_direct\_to\_page}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{align\_direct\_to\_page()}{align\_direct\_to\_page()}}
{\footnotesize\ttfamily size\+\_\+t Physical\+Memory\+Manager\+::align\+\_\+direct\+\_\+to\+\_\+page (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Aligns a address to the page size. 


\begin{DoxyParams}{Parameters}
{\em size} & The address to align \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The aligned address 
\end{DoxyReturn}


Definition at line 854 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{854                                                               \{}
\DoxyCodeLine{855   \textcolor{keywordflow}{return} (\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} \& (\string~(\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} -\/ 1)));}
\DoxyCodeLine{856 \}}

\end{DoxyCode}


References s\+\_\+page\+\_\+size, and size.



Referenced by reserve().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!align\_to\_page@{align\_to\_page}}
\index{align\_to\_page@{align\_to\_page}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{align\_to\_page()}{align\_to\_page()}}
{\footnotesize\ttfamily size\+\_\+t Physical\+Memory\+Manager\+::align\+\_\+to\+\_\+page (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Aligns a size to the page size. 


\begin{DoxyParams}{Parameters}
{\em size} & The size to align \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The aligned size 
\end{DoxyReturn}


Definition at line 154 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{154                                                        \{}
\DoxyCodeLine{155   \textcolor{keywordflow}{return} ((\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} -\/ 1) /\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}) * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{156 \}}

\end{DoxyCode}


References s\+\_\+page\+\_\+size, and size.



Referenced by size\+\_\+to\+\_\+frames(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!align\_up\_to\_page@{align\_up\_to\_page}}
\index{align\_up\_to\_page@{align\_up\_to\_page}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{align\_up\_to\_page()}{align\_up\_to\_page()}}
{\footnotesize\ttfamily size\+\_\+t Physical\+Memory\+Manager\+::align\+\_\+up\+\_\+to\+\_\+page (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t}]{page\+\_\+size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Aligns a size up to the page size. 


\begin{DoxyParams}{Parameters}
{\em size} & The size to align \\
\hline
{\em page\+\_\+size} & The page size to align to \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The aligned size 
\end{DoxyReturn}


Definition at line 164 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{164                                                                             \{}
\DoxyCodeLine{165   \textcolor{keywordflow}{return} (\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} + page\_size -\/ 1) \& \string~(page\_size -\/ 1);}
\DoxyCodeLine{166 \}}

\end{DoxyCode}


References size.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), Physical\+Memory\+Manager(), and reserve().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af68e198da5c85cc1443f28ecd0f92bd2}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af68e198da5c85cc1443f28ecd0f92bd2}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!allocate\_area@{allocate\_area}}
\index{allocate\_area@{allocate\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{allocate\_area()}{allocate\_area()}}
{\footnotesize\ttfamily void $\ast$ Physical\+Memory\+Manager\+::allocate\+\_\+area (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{start\+\_\+address,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Allocate an area of physical memory (ie reserve it) 


\begin{DoxyParams}{Parameters}
{\em start\+\_\+address} & The start of the block \\
\hline
{\em size} & The size to allocate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A pointer to the start of the block (physical address) 
\end{DoxyReturn}


Definition at line 278 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{278                                                                               \{}
\DoxyCodeLine{279 }
\DoxyCodeLine{280   \textcolor{comment}{// Wait to be able to allocate}}
\DoxyCodeLine{281   m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a27a03c3d6b4cdd677e7d16e59689e38e}{lock}}();}
\DoxyCodeLine{282 }
\DoxyCodeLine{283   \textcolor{comment}{// Check how many frames are needed}}
\DoxyCodeLine{284   \textcolor{keywordtype}{size\_t} frame\_count = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{285 }
\DoxyCodeLine{286   \textcolor{comment}{// Store the information about the frames needed to be allocated for this size}}
\DoxyCodeLine{287   uint16\_t start\_row = 0;}
\DoxyCodeLine{288   uint16\_t start\_column = 0;}
\DoxyCodeLine{289   \textcolor{keywordtype}{size\_t} adjacent\_frames = 0;}
\DoxyCodeLine{290 }
\DoxyCodeLine{291   \textcolor{comment}{// Loop through the bitmap}}
\DoxyCodeLine{292   \textcolor{keywordflow}{for} (uint16\_t row = 0; row < m\_total\_entries; ++row) \{}
\DoxyCodeLine{293 }
\DoxyCodeLine{294     \textcolor{comment}{// If the row is full continue}}
\DoxyCodeLine{295     \textcolor{keywordflow}{if}(m\_bit\_map[row] == 0xFFFFFFFFFFFFFFF)}
\DoxyCodeLine{296       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{297 }
\DoxyCodeLine{298     \textcolor{keywordflow}{for} (uint16\_t column = 0; column < ROW\_BITS; ++column) \{}
\DoxyCodeLine{299 }
\DoxyCodeLine{300       \textcolor{comment}{// Prevent out-\/of-\/bounds shifts if column exceeds the bit-\/width of uint64\_t}}
\DoxyCodeLine{301       \textcolor{keywordflow}{if} (column >= ROW\_BITS)}
\DoxyCodeLine{302         \textcolor{keywordflow}{break};}
\DoxyCodeLine{303 }
\DoxyCodeLine{304       \textcolor{comment}{// If this bit is not free, reset the adjacent frames}}
\DoxyCodeLine{305       \textcolor{keywordflow}{if} (m\_bit\_map[row] \& (1ULL << column)) \{}
\DoxyCodeLine{306         adjacent\_frames = 0;}
\DoxyCodeLine{307         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{308       \}}
\DoxyCodeLine{309 }
\DoxyCodeLine{310       \textcolor{comment}{// Store the start of the area if it is not already stored}}
\DoxyCodeLine{311       \textcolor{keywordflow}{if}(adjacent\_frames == 0)\{}
\DoxyCodeLine{312         start\_row = row;}
\DoxyCodeLine{313         start\_column = column;}
\DoxyCodeLine{314       \}}
\DoxyCodeLine{315 }
\DoxyCodeLine{316       \textcolor{comment}{// Increment the adjacent frames}}
\DoxyCodeLine{317       adjacent\_frames++;}
\DoxyCodeLine{318 }
\DoxyCodeLine{319       \textcolor{comment}{// If enough frames are found we can allocate the area}}
\DoxyCodeLine{320       \textcolor{keywordflow}{if}(adjacent\_frames == frame\_count)\{}
\DoxyCodeLine{321 }
\DoxyCodeLine{322         \textcolor{comment}{// Mark the frames as used}}
\DoxyCodeLine{323         m\_used\_frames += frame\_count;}
\DoxyCodeLine{324         \textcolor{keywordflow}{for} (uint16\_t \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < frame\_count; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \{}
\DoxyCodeLine{325 }
\DoxyCodeLine{326           \textcolor{comment}{// Get the location of the bit}}
\DoxyCodeLine{327           uint16\_t index = start\_row + (start\_column + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) / ROW\_BITS;}
\DoxyCodeLine{328           uint16\_t bit = (start\_column + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \% ROW\_BITS;}
\DoxyCodeLine{329 }
\DoxyCodeLine{330           \textcolor{comment}{// Skip if index exceeds bounds}}
\DoxyCodeLine{331           \textcolor{keywordflow}{if} (index >= m\_total\_entries || bit >= ROW\_BITS) \{}
\DoxyCodeLine{332             \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(\textcolor{keyword}{false}, \textcolor{stringliteral}{"Index out of bounds\(\backslash\)n"})}
\DoxyCodeLine{333           \}}
\DoxyCodeLine{334 }
\DoxyCodeLine{335           m\_bit\_map[index] |= (1ULL << bit); \textcolor{comment}{// Mark the bit as used}}
\DoxyCodeLine{336         \}}
\DoxyCodeLine{337 }
\DoxyCodeLine{338         \textcolor{comment}{// Clear the lock}}
\DoxyCodeLine{339         m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a7c26334ccfa43ef932ef3c73e2c11492}{unlock}}();}
\DoxyCodeLine{340 }
\DoxyCodeLine{341         \textcolor{comment}{// Return the address}}
\DoxyCodeLine{342         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void}*)(start\_address + (start\_row * ROW\_BITS + start\_column) * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{343       \}}
\DoxyCodeLine{344     \}}
\DoxyCodeLine{345   \}}
\DoxyCodeLine{346 }
\DoxyCodeLine{347   \textcolor{comment}{// Error cant allocate that much}}
\DoxyCodeLine{348   m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a7c26334ccfa43ef932ef3c73e2c11492}{unlock}}();}
\DoxyCodeLine{349   \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(\textcolor{keyword}{false}, \textcolor{stringliteral}{"Cannot allocate that much memory\(\backslash\)n"})}
\DoxyCodeLine{350   return \textcolor{keywordtype}{nullptr};}
\DoxyCodeLine{351 \}}

\end{DoxyCode}


References A\+S\+S\+E\+RT, Max\+O\+S\+::drivers\+::peripherals\+::i, Max\+O\+S\+::common\+::\+Spinlock\+::lock(), s\+\_\+page\+\_\+size, size, size\+\_\+to\+\_\+frames(), and Max\+O\+S\+::common\+::\+Spinlock\+::unlock().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!allocate\_frame@{allocate\_frame}}
\index{allocate\_frame@{allocate\_frame}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{allocate\_frame()}{allocate\_frame()}}
{\footnotesize\ttfamily void $\ast$ Physical\+Memory\+Manager\+::allocate\+\_\+frame (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Allocates a physical page of memory, if the P\+MM is not initalise it will use the anon memory instead of the bitmap. 

\begin{DoxyReturn}{Returns}
The physical address of the page 
\end{DoxyReturn}


Definition at line 181 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{181                                             \{}
\DoxyCodeLine{182 }
\DoxyCodeLine{183   \textcolor{comment}{// Wait for the lock}}
\DoxyCodeLine{184   m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a27a03c3d6b4cdd677e7d16e59689e38e}{lock}}();}
\DoxyCodeLine{185 }
\DoxyCodeLine{186   \textcolor{comment}{// Check if the pmm is initialized}}
\DoxyCodeLine{187   \textcolor{keywordflow}{if}(!m\_initialized)\{}
\DoxyCodeLine{188 }
\DoxyCodeLine{189     \textcolor{comment}{// Find the first free frame}}
\DoxyCodeLine{190     \textcolor{keywordflow}{while} ((!\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a344d9602dcf5a77e672a1859fa05e67f}{is\_anonymous\_available}}(m\_anonymous\_memory\_physical\_address)) \&\& (m\_anonymous\_memory\_physical\_address < m\_memory\_size)) \{}
\DoxyCodeLine{191       m\_anonymous\_memory\_physical\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{192       m\_anonymous\_memory\_virtual\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{193     \}}
\DoxyCodeLine{194 }
\DoxyCodeLine{195     \textcolor{comment}{// Mark frame as used}}
\DoxyCodeLine{196     m\_anonymous\_memory\_physical\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{197     m\_anonymous\_memory\_virtual\_address += \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{198 }
\DoxyCodeLine{199     \textcolor{comment}{// Clear the lock}}
\DoxyCodeLine{200     m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a7c26334ccfa43ef932ef3c73e2c11492}{unlock}}();}
\DoxyCodeLine{201 }
\DoxyCodeLine{202     \textcolor{comment}{// Return the address}}
\DoxyCodeLine{203     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void}*)(m\_anonymous\_memory\_physical\_address -\/ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{204 }
\DoxyCodeLine{205   \}}
\DoxyCodeLine{206 }
\DoxyCodeLine{207   \textcolor{comment}{// Check if there are enough frames}}
\DoxyCodeLine{208   \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(m\_used\_frames < m\_bitmap\_size, \textcolor{stringliteral}{"No more frames available\(\backslash\)n"})}
\DoxyCodeLine{209 }
\DoxyCodeLine{210   \textcolor{comment}{// Loop through the bitmap}}
\DoxyCodeLine{211   for (uint16\_t row = 0; row < m\_total\_entries; ++row) \{}
\DoxyCodeLine{212 }
\DoxyCodeLine{213     \textcolor{comment}{// If the row is full continue}}
\DoxyCodeLine{214     \textcolor{keywordflow}{if}(m\_bit\_map[row] == 0xFFFFFFFFFFFFFFF)}
\DoxyCodeLine{215       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{216 }
\DoxyCodeLine{217     \textcolor{keywordflow}{for} (uint16\_t column = 0; column < ROW\_BITS; ++column) \{}
\DoxyCodeLine{218 }
\DoxyCodeLine{219       \textcolor{comment}{// Prevent out-\/of-\/bounds shifts if column exceeds the bit-\/width of uint64\_t}}
\DoxyCodeLine{220       \textcolor{keywordflow}{if} (column >= ROW\_BITS)}
\DoxyCodeLine{221         \textcolor{keywordflow}{break};}
\DoxyCodeLine{222 }
\DoxyCodeLine{223       \textcolor{comment}{// Check if the bitmap is free}}
\DoxyCodeLine{224       \textcolor{keywordflow}{if} (m\_bit\_map[row] \& (1ULL << column))}
\DoxyCodeLine{225         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{226 }
\DoxyCodeLine{227 }
\DoxyCodeLine{228       \textcolor{comment}{// Mark the frame as used}}
\DoxyCodeLine{229       m\_bit\_map[row] |= (1ULL << column);}
\DoxyCodeLine{230       m\_used\_frames++;}
\DoxyCodeLine{231 }
\DoxyCodeLine{232       \textcolor{comment}{// Return the address}}
\DoxyCodeLine{233       uint64\_t frame\_address = (row * ROW\_BITS) + column;}
\DoxyCodeLine{234       frame\_address *= \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{235 }
\DoxyCodeLine{236 }
\DoxyCodeLine{237       \textcolor{comment}{// Clear the lock}}
\DoxyCodeLine{238       m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a7c26334ccfa43ef932ef3c73e2c11492}{unlock}}();}
\DoxyCodeLine{239 }
\DoxyCodeLine{240       \textcolor{comment}{// Return the address}}
\DoxyCodeLine{241       \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void}*)(frame\_address);}
\DoxyCodeLine{242     \}}
\DoxyCodeLine{243   \}}
\DoxyCodeLine{244 }
\DoxyCodeLine{245   \textcolor{comment}{// Error frame not found}}
\DoxyCodeLine{246   \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(\textcolor{keyword}{false}, \textcolor{stringliteral}{"Frame not found\(\backslash\)n"})}
\DoxyCodeLine{247   m\_lock.unlock();}
\DoxyCodeLine{248   return \textcolor{keywordtype}{nullptr};}
\DoxyCodeLine{249 }
\DoxyCodeLine{250 \}}

\end{DoxyCode}


References A\+S\+S\+E\+RT, is\+\_\+anonymous\+\_\+available(), Max\+O\+S\+::common\+::\+Spinlock\+::lock(), s\+\_\+page\+\_\+size, and Max\+O\+S\+::common\+::\+Spinlock\+::unlock().



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), map(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_aa7f389d1b15d109bd5669d0475ebc912}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_aa7f389d1b15d109bd5669d0475ebc912}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!check\_aligned@{check\_aligned}}
\index{check\_aligned@{check\_aligned}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{check\_aligned()}{check\_aligned()}}
{\footnotesize\ttfamily bool Physical\+Memory\+Manager\+::check\+\_\+aligned (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Checks if an address is aligned. 


\begin{DoxyParams}{Parameters}
{\em size} & The address to check \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the address is aligned 
\end{DoxyReturn}


Definition at line 173 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{173                                                     \{}
\DoxyCodeLine{174     \textcolor{keywordflow}{return} (\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} \% \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}) == 0;}
\DoxyCodeLine{175 \}}

\end{DoxyCode}


References s\+\_\+page\+\_\+size, and size.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a66d5d1a4c7c019d77fcee0aa3c128d07}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a66d5d1a4c7c019d77fcee0aa3c128d07}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!clean\_page\_table@{clean\_page\_table}}
\index{clean\_page\_table@{clean\_page\_table}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{clean\_page\_table()}{clean\_page\_table()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::clean\+\_\+page\+\_\+table (\begin{DoxyParamCaption}\item[{uint64\+\_\+t $\ast$}]{table }\end{DoxyParamCaption})}



Cleans a page table (fills it with 0 or null entries) 


\begin{DoxyParams}{Parameters}
{\em table} & The table to clean \\
\hline
\end{DoxyParams}


Definition at line 718 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{718                                                             \{}
\DoxyCodeLine{719   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < 512; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++)\{}
\DoxyCodeLine{720         table[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}] = 0x00\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}};}
\DoxyCodeLine{721   \}}
\DoxyCodeLine{722 \}}

\end{DoxyCode}


References Max\+O\+S\+::drivers\+::peripherals\+::i, and Max\+O\+S\+::drivers\+::peripherals\+::l.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad0aaa5f1fb32a28d1d91cc5630d56dad}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad0aaa5f1fb32a28d1d91cc5630d56dad}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!free\_area@{free\_area}}
\index{free\_area@{free\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{free\_area()}{free\_area()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::free\+\_\+area (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{start\+\_\+address,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Frees an area of physical memory. 


\begin{DoxyParams}{Parameters}
{\em start\+\_\+address} & The start of the block \\
\hline
{\em size} & The size to free \\
\hline
\end{DoxyParams}


Definition at line 358 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{358                                                                          \{}
\DoxyCodeLine{359 }
\DoxyCodeLine{360     \textcolor{comment}{// Check how many frames are needed}}
\DoxyCodeLine{361     \textcolor{keywordtype}{size\_t} frame\_count = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{362     uint64\_t frame\_address = start\_address / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{363 }
\DoxyCodeLine{364     \textcolor{comment}{// Check if the address is valid}}
\DoxyCodeLine{365     \textcolor{keywordflow}{if}(frame\_address >= m\_bitmap\_size)}
\DoxyCodeLine{366       \textcolor{keywordflow}{return};}
\DoxyCodeLine{367 }
\DoxyCodeLine{368     \textcolor{comment}{// Wait to be able to free}}
\DoxyCodeLine{369     m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a27a03c3d6b4cdd677e7d16e59689e38e}{lock}}();}
\DoxyCodeLine{370 }
\DoxyCodeLine{371     \textcolor{comment}{// Mark the frames as not used}}
\DoxyCodeLine{372     m\_used\_frames -\/= frame\_count;}
\DoxyCodeLine{373     \textcolor{keywordflow}{for} (uint16\_t \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < frame\_count; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{374       m\_bit\_map[(frame\_address + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) / ROW\_BITS] \&= \string~(1 << ((frame\_address + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \% ROW\_BITS));}
\DoxyCodeLine{375 }
\DoxyCodeLine{376 }
\DoxyCodeLine{377     \textcolor{comment}{// Clear the lock}}
\DoxyCodeLine{378     m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a7c26334ccfa43ef932ef3c73e2c11492}{unlock}}();}
\DoxyCodeLine{379 \}}

\end{DoxyCode}


References Max\+O\+S\+::drivers\+::peripherals\+::i, Max\+O\+S\+::common\+::\+Spinlock\+::lock(), s\+\_\+page\+\_\+size, size, size\+\_\+to\+\_\+frames(), and Max\+O\+S\+::common\+::\+Spinlock\+::unlock().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af0b6a43f9b559575ece938d3918fc3a1}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af0b6a43f9b559575ece938d3918fc3a1}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!free\_frame@{free\_frame}}
\index{free\_frame@{free\_frame}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{free\_frame()}{free\_frame()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::free\+\_\+frame (\begin{DoxyParamCaption}\item[{void $\ast$}]{address }\end{DoxyParamCaption})}



Frees a frame in the bit map. 


\begin{DoxyParams}{Parameters}
{\em address} & The address to free \\
\hline
\end{DoxyParams}


Definition at line 256 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{256                                                     \{}
\DoxyCodeLine{257 }
\DoxyCodeLine{258     \textcolor{comment}{// Wait for the lock}}
\DoxyCodeLine{259     m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a27a03c3d6b4cdd677e7d16e59689e38e}{lock}}();}
\DoxyCodeLine{260 }
\DoxyCodeLine{261     \textcolor{comment}{// Mark the frame as not used}}
\DoxyCodeLine{262     m\_used\_frames-\/-\/;}
\DoxyCodeLine{263 }
\DoxyCodeLine{264     \textcolor{comment}{// Set the bit to 0}}
\DoxyCodeLine{265     uint64\_t frame\_address = (uint64\_t)\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{266     m\_bit\_map[frame\_address / ROW\_BITS] \&= \string~(1 << (frame\_address \% ROW\_BITS));}
\DoxyCodeLine{267 }
\DoxyCodeLine{268     \textcolor{comment}{// Clear the lock}}
\DoxyCodeLine{269     m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a7c26334ccfa43ef932ef3c73e2c11492}{unlock}}();}
\DoxyCodeLine{270 \}}

\end{DoxyCode}


References address, Max\+O\+S\+::common\+::\+Spinlock\+::lock(), s\+\_\+page\+\_\+size, and Max\+O\+S\+::common\+::\+Spinlock\+::unlock().



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::$\sim$\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0bd4c0766bc4c3930920814f2f7de1c5}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0bd4c0766bc4c3930920814f2f7de1c5}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!get\_memory\_size@{get\_memory\_size}}
\index{get\_memory\_size@{get\_memory\_size}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{get\_memory\_size()}{get\_memory\_size()}}
{\footnotesize\ttfamily uint64\+\_\+t Physical\+Memory\+Manager\+::get\+\_\+memory\+\_\+size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Gets total the memory size available for use (allocated or not) 

\begin{DoxyReturn}{Returns}
The memory size in bytes 
\end{DoxyReturn}


Definition at line 837 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{837                                                 \{}
\DoxyCodeLine{838   \textcolor{keywordflow}{return} m\_memory\_size;}
\DoxyCodeLine{839 \}}

\end{DoxyCode}


Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af2252a8df82a662c5fbeb48f057ea9f0}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af2252a8df82a662c5fbeb48f057ea9f0}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!get\_memory\_used@{get\_memory\_used}}
\index{get\_memory\_used@{get\_memory\_used}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{get\_memory\_used()}{get\_memory\_used()}}
{\footnotesize\ttfamily uint64\+\_\+t Physical\+Memory\+Manager\+::get\+\_\+memory\+\_\+used (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Gets the memory currently used. 

\begin{DoxyReturn}{Returns}
The memory size in bytes 
\end{DoxyReturn}


Definition at line 845 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{845                                                 \{}
\DoxyCodeLine{846     \textcolor{keywordflow}{return} m\_used\_frames * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{847 \}}

\end{DoxyCode}


References s\+\_\+page\+\_\+size.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af43b96063c89e26eecb6aa9c8e46f4fb}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af43b96063c89e26eecb6aa9c8e46f4fb}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!get\_physical\_address@{get\_physical\_address}}
\index{get\_physical\_address@{get\_physical\_address}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{get\_physical\_address()}{get\_physical\_address()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$ Physical\+Memory\+Manager\+::get\+\_\+physical\+\_\+address (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address,  }\item[{uint64\+\_\+t $\ast$}]{pml4\+\_\+root }\end{DoxyParamCaption})}



Gets the physical address from a virtual address (if it exists) 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address} & The virtual address to get the physical address from \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The physical address or nullptr if it does not exist 
\end{DoxyReturn}


Definition at line 920 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{920                                                                                                                        \{}
\DoxyCodeLine{921 }
\DoxyCodeLine{922 }
\DoxyCodeLine{923     \textcolor{comment}{// Get the indexes}}
\DoxyCodeLine{924     uint16\_t pml4\_index = \mbox{\hyperlink{physical_8h_a21b56ad4b688267e89e208897cfdad31}{PML4\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{925     uint16\_t pdpr\_index = \mbox{\hyperlink{physical_8h_a363318d5bd935b341ef29aa93046f5de}{PML3\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{926     uint16\_t pd\_index   = \mbox{\hyperlink{physical_8h_aeccd6d6989169ce4bea31a8aebc3c312}{PML2\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{927     uint16\_t pt\_index   = \mbox{\hyperlink{physical_8h_a39f52e0488e29313ac48c0a06c9f8cbd}{PML1\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{928 }
\DoxyCodeLine{929     \textcolor{comment}{// Get the tables}}
\DoxyCodeLine{930     uint64\_t* pdpr\_table = get\_table\_if\_exists(pml4\_root, pml4\_index);}
\DoxyCodeLine{931     uint64\_t* pd\_table = get\_table\_if\_exists(pdpr\_table, pdpr\_index);}
\DoxyCodeLine{932     uint64\_t* pt\_table = get\_table\_if\_exists(pd\_table, pd\_index);}
\DoxyCodeLine{933 }
\DoxyCodeLine{934     \textcolor{comment}{// Check if the tables are present (if any are not then a pt entry will not be present)}}
\DoxyCodeLine{935     \textcolor{keywordflow}{if}(pt\_table == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{936       \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{937 }
\DoxyCodeLine{938 }
\DoxyCodeLine{939     \textcolor{comment}{// Check if the entry is present}}
\DoxyCodeLine{940     \textcolor{keywordflow}{if}(!(pt\_table[pt\_index] \& 0b1))}
\DoxyCodeLine{941       \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{942 }
\DoxyCodeLine{943     \textcolor{comment}{// Return the physical address}}
\DoxyCodeLine{944     \textcolor{keywordflow}{return} (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}} *)(pt\_table[pt\_index] \& 0xFFFFFFFFFFFFF000);}
\DoxyCodeLine{945 \}}

\end{DoxyCode}


References P\+M\+L1\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L2\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L3\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, and P\+M\+L4\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX.



Referenced by is\+\_\+mapped(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ac54f576d801ed62713b84ae64d83fb64}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ac54f576d801ed62713b84ae64d83fb64}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!get\_pml4\_root\_address@{get\_pml4\_root\_address}}
\index{get\_pml4\_root\_address@{get\_pml4\_root\_address}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{get\_pml4\_root\_address()}{get\_pml4\_root\_address()}}
{\footnotesize\ttfamily uint64\+\_\+t $\ast$ Physical\+Memory\+Manager\+::get\+\_\+pml4\+\_\+root\+\_\+address (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Gets the pml4 root address for the kernel. 

\begin{DoxyReturn}{Returns}
The pml4 root address 
\end{DoxyReturn}


Definition at line 829 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{829                                                        \{}
\DoxyCodeLine{830     \textcolor{keywordflow}{return} m\_pml4\_root\_address;}
\DoxyCodeLine{831 \}}

\end{DoxyCode}


Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ace56d1f37c7be25425fe92c994a5cedd}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ace56d1f37c7be25425fe92c994a5cedd}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!identity\_map@{identity\_map}}
\index{identity\_map@{identity\_map}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{identity\_map()}{identity\_map()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::identity\+\_\+map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$}]{physical\+\_\+address,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Maps a physical address to its virtual address counter-\/part. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address} & The physical address to map \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}


Definition at line 621 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{621                                                                                            \{}
\DoxyCodeLine{622 }
\DoxyCodeLine{623   \textcolor{comment}{// Map the physical address to its virtual address counter-\/part}}
\DoxyCodeLine{624   \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{625 }
\DoxyCodeLine{626 \}}

\end{DoxyCode}


References flags, map(), and physical\+\_\+address.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a344d9602dcf5a77e672a1859fa05e67f}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a344d9602dcf5a77e672a1859fa05e67f}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!is\_anonymous\_available@{is\_anonymous\_available}}
\index{is\_anonymous\_available@{is\_anonymous\_available}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{is\_anonymous\_available()}{is\_anonymous\_available()}}
{\footnotesize\ttfamily bool Physical\+Memory\+Manager\+::is\+\_\+anonymous\+\_\+available (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{address }\end{DoxyParamCaption})}



Checks if a physical address is reserved by multiboot mmap. 


\begin{DoxyParams}{Parameters}
{\em address} & The address to check \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the address is reserved 
\end{DoxyReturn}


Definition at line 754 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{754                                                                  \{}
\DoxyCodeLine{755 }
\DoxyCodeLine{756   \textcolor{comment}{// Return false if the address range is entirely within or overlaps with the multiboot reserved region}}
\DoxyCodeLine{757   \textcolor{keywordflow}{if} ((\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} > \mbox{\hyperlink{physical_8cpp_a112857fab0ddec3e5d84827e1bf2ff43}{multiboot\_tag\_start}} \&\& \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} < \mbox{\hyperlink{physical_8cpp_a233e74c4ba81dc1941dddf05bc87ecf1}{multiboot\_tag\_end}}) || (\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}} > \mbox{\hyperlink{physical_8cpp_a112857fab0ddec3e5d84827e1bf2ff43}{multiboot\_tag\_start}} \&\& \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} < \mbox{\hyperlink{physical_8cpp_a233e74c4ba81dc1941dddf05bc87ecf1}{multiboot\_tag\_end}})) \{}
\DoxyCodeLine{758     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{759   \}}
\DoxyCodeLine{760 }
\DoxyCodeLine{761   \textcolor{comment}{// Loop through the mmmap entries}}
\DoxyCodeLine{762   \textcolor{keywordflow}{for} (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *entry = m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a20c4427afce786340b01ded5ed0532a2}{entries}}; (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)entry < (\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *)m\_mmap\_tag + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_a0663e47406ed5799d5bd55ccf2d4fa95}{size}}; entry = (\mbox{\hyperlink{structmultiboot__mmap__entry}{multiboot\_mmap\_entry}} *)((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})entry + m\_mmap\_tag-\/>\mbox{\hyperlink{structmultiboot__tag__mmap_aa5532c68672471f9da8ba18a8a16857d}{entry\_size}})) \{}
\DoxyCodeLine{763 }
\DoxyCodeLine{764     \textcolor{comment}{// If it doesn't overlap with the mmap entry}}
\DoxyCodeLine{765     \textcolor{keywordflow}{if} ((entry -\/> addr + entry -\/> len) < (\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}))}
\DoxyCodeLine{766       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{767 }
\DoxyCodeLine{768     \textcolor{comment}{// If it is not available}}
\DoxyCodeLine{769     \textcolor{keywordflow}{if}(entry -\/> \mbox{\hyperlink{apic_8h_a1d127017fb298b889f4ba24752d08b8e}{type}} != \mbox{\hyperlink{multiboot_8h_a7fe141351ebcde0acbd6118ad0ea1a21}{MULTIBOOT\_MEMORY\_AVAILABLE}})}
\DoxyCodeLine{770       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{771 }
\DoxyCodeLine{772     \textcolor{comment}{// Check if the address is overwriting with some reserved memory}}
\DoxyCodeLine{773     \textcolor{keywordflow}{if}(m\_multiboot -\/> is\_reserved(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}}))}
\DoxyCodeLine{774        \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{775 }
\DoxyCodeLine{776     \textcolor{comment}{// Memory is available}}
\DoxyCodeLine{777     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{778 }
\DoxyCodeLine{779   \}}
\DoxyCodeLine{780 }
\DoxyCodeLine{781   \textcolor{comment}{// Memory is not available}}
\DoxyCodeLine{782   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{783 \}}

\end{DoxyCode}


References address, multiboot\+\_\+tag\+\_\+mmap\+::entries, multiboot\+\_\+tag\+\_\+mmap\+::entry\+\_\+size, M\+U\+L\+T\+I\+B\+O\+O\+T\+\_\+\+M\+E\+M\+O\+R\+Y\+\_\+\+A\+V\+A\+I\+L\+A\+B\+LE, multiboot\+\_\+tag\+\_\+end, multiboot\+\_\+tag\+\_\+start, s\+\_\+page\+\_\+size, multiboot\+\_\+tag\+\_\+mmap\+::size, and type.



Referenced by allocate\+\_\+frame().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a9bee7cca21ce9658ca4dd48cedb6f8a9}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a9bee7cca21ce9658ca4dd48cedb6f8a9}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!is\_mapped@{is\_mapped}}
\index{is\_mapped@{is\_mapped}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{is\_mapped()}{is\_mapped()}}
{\footnotesize\ttfamily bool Physical\+Memory\+Manager\+::is\+\_\+mapped (\begin{DoxyParamCaption}\item[{uintptr\+\_\+t}]{physical\+\_\+address,  }\item[{uintptr\+\_\+t}]{virtual\+\_\+address,  }\item[{uint64\+\_\+t $\ast$}]{pml4\+\_\+root }\end{DoxyParamCaption})}



Checks if a physical address is mapped to a virtual address. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address} & The physical address to check \\
\hline
{\em virtual\+\_\+address} & The virtual address to check \\
\hline
{\em pml4\+\_\+root} & The pml4 table to use \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the physical address is mapped to the virtual address 
\end{DoxyReturn}


Definition at line 955 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{955                                                                                                                 \{}
\DoxyCodeLine{956 }
\DoxyCodeLine{957   \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af43b96063c89e26eecb6aa9c8e46f4fb}{get\_physical\_address}}((\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}}*)virtual\_address, pml4\_root) == (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}}*)\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}};}
\DoxyCodeLine{958 }
\DoxyCodeLine{959 \}}

\end{DoxyCode}


References get\+\_\+physical\+\_\+address(), and physical\+\_\+address.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a981b3d0afa8d5b41eda2d30a4478974c}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a981b3d0afa8d5b41eda2d30a4478974c}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map@{map}}
\index{map@{map}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map()}{map()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ Physical\+Memory\+Manager\+::map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$}]{physical\+\_\+address,  }\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{address,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Maps a physical address to a virtual address, using the kernel\textquotesingle{}s pml4 table. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address} & The physical address to map \\
\hline
{\em address} & The virtual address to map to \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The virtual address 
\end{DoxyReturn}


Definition at line 483 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{483                                                                                                                             \{}
\DoxyCodeLine{484 }
\DoxyCodeLine{485   \textcolor{comment}{// Base information}}
\DoxyCodeLine{486   pml\_t* pml4\_table = (pml\_t *)m\_pml4\_root\_address;}
\DoxyCodeLine{487   \textcolor{keywordtype}{size\_t} base\_addr = 0xFFFF000000000000;}
\DoxyCodeLine{488 }
\DoxyCodeLine{489   \textcolor{comment}{// Get the indexes}}
\DoxyCodeLine{490   uint16\_t pml4\_index = \mbox{\hyperlink{physical_8h_a21b56ad4b688267e89e208897cfdad31}{PML4\_GET\_INDEX}}((uint64\_t) \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{491   uint16\_t pdpr\_index = \mbox{\hyperlink{physical_8h_a363318d5bd935b341ef29aa93046f5de}{PML3\_GET\_INDEX}}((uint64\_t) \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{492   uint16\_t pd\_index   = \mbox{\hyperlink{physical_8h_aeccd6d6989169ce4bea31a8aebc3c312}{PML2\_GET\_INDEX}}((uint64\_t) \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{493   uint16\_t pt\_index   = \mbox{\hyperlink{physical_8h_a39f52e0488e29313ac48c0a06c9f8cbd}{PML1\_GET\_INDEX}}((uint64\_t) \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{494 }
\DoxyCodeLine{495   \textcolor{comment}{// Get the tables}}
\DoxyCodeLine{496   pml\_t *pdpr\_table =(pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index));}
\DoxyCodeLine{497   pml\_t *pd\_table = (pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index, (uint64\_t) pdpr\_index));}
\DoxyCodeLine{498   pml\_t *pt\_table = (pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index, (uint64\_t) pdpr\_index, (uint64\_t) pd\_index));}
\DoxyCodeLine{499 }
\DoxyCodeLine{500   \textcolor{comment}{// Create the tables}}
\DoxyCodeLine{501   create\_table(pml4\_table, pdpr\_table, pml4\_index);}
\DoxyCodeLine{502   create\_table(pdpr\_table, pd\_table, pdpr\_index);}
\DoxyCodeLine{503   create\_table(pd\_table, pt\_table, pd\_index);}
\DoxyCodeLine{504 }
\DoxyCodeLine{505   \textcolor{comment}{// Get the entry}}
\DoxyCodeLine{506   pte\_t* pte = \&pt\_table -\/> \mbox{\hyperlink{physical_8h_a571f2ec04bb9a58c7be02c94a37de231}{entries}}[pt\_index];}
\DoxyCodeLine{507 }
\DoxyCodeLine{508   \textcolor{comment}{// If it already exists return the address}}
\DoxyCodeLine{509   \textcolor{keywordflow}{if}(pte -\/> \mbox{\hyperlink{physical_8h_a85692f5f8e411b5cb7164a7ab671ddd4}{present}})}
\DoxyCodeLine{510     \textcolor{keywordflow}{return} \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}};}
\DoxyCodeLine{511 }
\DoxyCodeLine{512   \textcolor{comment}{// Map the physical address to the virtual address}}
\DoxyCodeLine{513  *pte = create\_page\_table\_entry((uint64\_t)\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{514 }
\DoxyCodeLine{515 }
\DoxyCodeLine{516   \textcolor{comment}{// Flush the TLB}}
\DoxyCodeLine{517   \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"invlpg (\%0)"} ::\textcolor{stringliteral}{"r"} (\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}}) : \textcolor{stringliteral}{"memory"});}
\DoxyCodeLine{518 }
\DoxyCodeLine{519   \textcolor{keywordflow}{return} \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}};}
\DoxyCodeLine{520 \}}

\end{DoxyCode}


References address, entries, E\+N\+T\+R\+I\+E\+S\+\_\+\+T\+O\+\_\+\+A\+D\+D\+R\+E\+SS, flags, Max\+O\+S\+::drivers\+::peripherals\+::l, physical\+\_\+address, P\+M\+L1\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L2\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L3\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L4\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, and present.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_acadc6bfafbd83d6a73b92cd60e9cd927}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_acadc6bfafbd83d6a73b92cd60e9cd927}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map@{map}}
\index{map@{map}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map()}{map()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ Physical\+Memory\+Manager\+::map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$}]{physical,  }\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address,  }\item[{size\+\_\+t}]{flags,  }\item[{uint64\+\_\+t $\ast$}]{pml4\+\_\+table }\end{DoxyParamCaption})}



Maps a physical address to a virtual address. 


\begin{DoxyParams}{Parameters}
{\em physical} & The physical address \\
\hline
{\em virtual\+\_\+address} & The virtual address \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
{\em pml4\+\_\+table} & The pml4 table to use \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The virtual address 
\end{DoxyReturn}


Definition at line 530 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{530                                                                                                                                                   \{}
\DoxyCodeLine{531 }
\DoxyCodeLine{532     \textcolor{comment}{// Get the indexes}}
\DoxyCodeLine{533     uint16\_t pml4\_index = \mbox{\hyperlink{physical_8h_a21b56ad4b688267e89e208897cfdad31}{PML4\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{534     uint16\_t pdpr\_index = \mbox{\hyperlink{physical_8h_a363318d5bd935b341ef29aa93046f5de}{PML3\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{535     uint16\_t pd\_index   = \mbox{\hyperlink{physical_8h_aeccd6d6989169ce4bea31a8aebc3c312}{PML2\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{536     uint16\_t pt\_index   = \mbox{\hyperlink{physical_8h_a39f52e0488e29313ac48c0a06c9f8cbd}{PML1\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{537 }
\DoxyCodeLine{538     \textcolor{comment}{// If it is in a lower region then assume it is the user space}}
\DoxyCodeLine{539     uint8\_t is\_user = !(\mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_a7d412394ef0b7e29bbe278406751761b}{MemoryManager::in\_higher\_region}}((uint64\_t)virtual\_address));}
\DoxyCodeLine{540     \textcolor{keywordflow}{if}(is\_user) \{}
\DoxyCodeLine{541       \textcolor{comment}{// Change the flags to user}}
\DoxyCodeLine{542       \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}} |= \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebae45ca5ccdd807182c984942dde55ebaa}{User}};}
\DoxyCodeLine{543       is\_user = \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebae45ca5ccdd807182c984942dde55ebaa}{User}};}
\DoxyCodeLine{544 }
\DoxyCodeLine{545     \}}
\DoxyCodeLine{546 }
\DoxyCodeLine{547     \textcolor{comment}{// Store the tables}}
\DoxyCodeLine{548     uint64\_t* pdpr\_table = get\_or\_create\_table(pml4\_table, pml4\_index, \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}} | is\_user);}
\DoxyCodeLine{549     uint64\_t* pd\_table = get\_or\_create\_table(pdpr\_table, pdpr\_index, \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}} | is\_user);}
\DoxyCodeLine{550     uint64\_t* pt\_table = get\_or\_create\_table(pd\_table, pd\_index, \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}} | is\_user);}
\DoxyCodeLine{551 }
\DoxyCodeLine{552     \textcolor{comment}{// If the page is already mapped return the address}}
\DoxyCodeLine{553     \textcolor{keywordflow}{if}(pt\_table[pt\_index] \& 0b1)}
\DoxyCodeLine{554       \textcolor{keywordflow}{return} virtual\_address;}
\DoxyCodeLine{555 }
\DoxyCodeLine{556     \textcolor{comment}{// Map the physical address to the virtual address}}
\DoxyCodeLine{557     pt\_table[pt\_index] = (uint64\_t) physical | \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}};}
\DoxyCodeLine{558 }
\DoxyCodeLine{559     \textcolor{comment}{// Flush the TLB}}
\DoxyCodeLine{560     \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"invlpg (\%0)"} ::\textcolor{stringliteral}{"r"} (virtual\_address) : \textcolor{stringliteral}{"memory"});}
\DoxyCodeLine{561 }
\DoxyCodeLine{562     \textcolor{keywordflow}{return} virtual\_address;}
\DoxyCodeLine{563 \}}

\end{DoxyCode}


References flags, Max\+O\+S\+::memory\+::\+Memory\+Manager\+::in\+\_\+higher\+\_\+region(), P\+M\+L1\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L2\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L3\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L4\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, Max\+O\+S\+::memory\+::\+Present, Max\+O\+S\+::memory\+::\+User, and Max\+O\+S\+::memory\+::\+Write.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map@{map}}
\index{map@{map}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map()}{map()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$ Physical\+Memory\+Manager\+::map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Allocates a physical address to a virtual address. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address} & The virtual address \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The virtual address 
\end{DoxyReturn}


Definition at line 571 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{571                                                                                               \{}
\DoxyCodeLine{572 }
\DoxyCodeLine{573   \textcolor{comment}{// Create a new physical address for the frame}}
\DoxyCodeLine{574   \mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}}* \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} = (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}} *)\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}{allocate\_frame}}();}
\DoxyCodeLine{575 }
\DoxyCodeLine{576   \textcolor{comment}{// Map the physical address to the virtual address}}
\DoxyCodeLine{577   \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, virtual\_address, \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{578 }
\DoxyCodeLine{579 \}}

\end{DoxyCode}


References allocate\+\_\+frame(), flags, and physical\+\_\+address.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), identity\+\_\+map(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::load\+\_\+physical\+\_\+into\+\_\+address\+\_\+space(), map\+\_\+area(), Physical\+Memory\+Manager(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a155276cb4df27f12ce3cbd011dd93a79}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a155276cb4df27f12ce3cbd011dd93a79}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map\_area@{map\_area}}
\index{map\_area@{map\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map\_area()}{map\_area()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::map\+\_\+area (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\+\_\+address\+\_\+t}} $\ast$}]{physical\+\_\+address\+\_\+start,  }\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address\+\_\+start,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Maps an area of physical memory to a virtual address. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address\+\_\+start} & The start of the physical address \\
\hline
{\em virtual\+\_\+address\+\_\+start} & The start of the virtual address \\
\hline
{\em length} & The length of the area \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}


Definition at line 605 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{605                                                                                                                                                       \{}
\DoxyCodeLine{606 }
\DoxyCodeLine{607   \textcolor{comment}{// Get the size of the area}}
\DoxyCodeLine{608   \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{intel__i217_8h_aebb70c2aab3407a9f05334c47131a43b}{length}});}
\DoxyCodeLine{609 }
\DoxyCodeLine{610   \textcolor{comment}{// Map the required frames}}
\DoxyCodeLine{611   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{612     \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(physical\_address\_start + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}), virtual\_address\_start + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}), \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{613 }
\DoxyCodeLine{614 \}}

\end{DoxyCode}


References flags, Max\+O\+S\+::drivers\+::peripherals\+::i, length, map(), s\+\_\+page\+\_\+size, size, and size\+\_\+to\+\_\+frames().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a39a03a4a5c211c9af2ad07f8f4bd3028}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a39a03a4a5c211c9af2ad07f8f4bd3028}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!map\_area@{map\_area}}
\index{map\_area@{map\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{map\_area()}{map\_area()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::map\+\_\+area (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address\+\_\+start,  }\item[{size\+\_\+t}]{length,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Allocates a new area physical memory to a area virtual address. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address\+\_\+start} & The start of the virtual address \\
\hline
{\em length} & The length of the area \\
\hline
{\em flags} & The flags to set the mapping to \\
\hline
\end{DoxyParams}


Definition at line 587 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{587                                                                                                           \{}
\DoxyCodeLine{588 }
\DoxyCodeLine{589     \textcolor{comment}{// Get the size of the area}}
\DoxyCodeLine{590     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{intel__i217_8h_aebb70c2aab3407a9f05334c47131a43b}{length}});}
\DoxyCodeLine{591 }
\DoxyCodeLine{592     \textcolor{comment}{// Map the required frames}}
\DoxyCodeLine{593     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{594         \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(virtual\_address\_start + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}), \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{595 }
\DoxyCodeLine{596 \}}

\end{DoxyCode}


References flags, Max\+O\+S\+::drivers\+::peripherals\+::i, length, map(), s\+\_\+page\+\_\+size, size, and size\+\_\+to\+\_\+frames().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1cd55c3baaf52d7e41acc76541dd31e1}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!reserve@{reserve}}
\index{reserve@{reserve}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{reserve()}{reserve()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::reserve (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{address }\end{DoxyParamCaption})}



Reserves a physical address. 


\begin{DoxyParams}{Parameters}
{\em address} & The address to reserve \\
\hline
\end{DoxyParams}


Definition at line 862 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{862                                                     \{}
\DoxyCodeLine{863 }
\DoxyCodeLine{864 }
\DoxyCodeLine{865   \textcolor{comment}{// If the address is not part of physical memory then return}}
\DoxyCodeLine{866   \textcolor{keywordflow}{if}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} >= m\_memory\_size)}
\DoxyCodeLine{867     \textcolor{keywordflow}{return};}
\DoxyCodeLine{868 }
\DoxyCodeLine{869   \textcolor{comment}{// Get the address to a page}}
\DoxyCodeLine{870   \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}{align\_direct\_to\_page}}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{871 }
\DoxyCodeLine{872   \textcolor{comment}{// Set the bit to 1 in the bitmap}}
\DoxyCodeLine{873   m\_bit\_map[\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} / ROW\_BITS] |= (1 << (\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} \% ROW\_BITS));}
\DoxyCodeLine{874 }
\DoxyCodeLine{875 }
\DoxyCodeLine{876   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Reserved Address: 0x\%x\(\backslash\)n"}, \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{877 }
\DoxyCodeLine{878 \}}

\end{DoxyCode}


References \+\_\+kprintf, address, and align\+\_\+direct\+\_\+to\+\_\+page().



Referenced by Physical\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab420fbeba638178bc689c68afa9d522b}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab420fbeba638178bc689c68afa9d522b}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!reserve@{reserve}}
\index{reserve@{reserve}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{reserve()}{reserve()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::reserve (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{address,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Reserves an area of physical memory. 


\begin{DoxyParams}{Parameters}
{\em address} & The start of the area \\
\hline
{\em size} & The size of the area \\
\hline
\end{DoxyParams}


Definition at line 885 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{885                                                                  \{}
\DoxyCodeLine{886 }
\DoxyCodeLine{887   \textcolor{keywordflow}{if}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} >= m\_memory\_size)}
\DoxyCodeLine{888     \textcolor{keywordflow}{return};}
\DoxyCodeLine{889 }
\DoxyCodeLine{890   \textcolor{comment}{// Wait to be able to reserve}}
\DoxyCodeLine{891   m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a27a03c3d6b4cdd677e7d16e59689e38e}{lock}}();}
\DoxyCodeLine{892 }
\DoxyCodeLine{893   \textcolor{comment}{// Align address and size to page boundaries}}
\DoxyCodeLine{894   \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a11cc364e5cd2a0bebeabd79b2bd35c0d}{align\_direct\_to\_page}}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{895   \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}{align\_up\_to\_page}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}});}
\DoxyCodeLine{896 }
\DoxyCodeLine{897   \textcolor{comment}{// Calculate how many pages need to be reserved}}
\DoxyCodeLine{898   \textcolor{keywordtype}{size\_t} page\_count = \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{899   \textcolor{comment}{// Convert the starting address to a frame index}}
\DoxyCodeLine{900   uint64\_t frame\_index = \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{901 }
\DoxyCodeLine{902   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < page\_count; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \{}
\DoxyCodeLine{903     m\_bit\_map[(frame\_index + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) / ROW\_BITS] |= (1ULL << ((frame\_index + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}) \% ROW\_BITS));}
\DoxyCodeLine{904   \}}
\DoxyCodeLine{905 }
\DoxyCodeLine{906   \textcolor{comment}{// Update the used frames}}
\DoxyCodeLine{907   m\_used\_frames += page\_count;}
\DoxyCodeLine{908 }
\DoxyCodeLine{909   \textcolor{comment}{// Clear the lock}}
\DoxyCodeLine{910   m\_lock.\mbox{\hyperlink{classMaxOS_1_1common_1_1Spinlock_a7c26334ccfa43ef932ef3c73e2c11492}{unlock}}();}
\DoxyCodeLine{911   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Reserved Address: 0x\%x -\/ 0x\%x (length of 0x\%x)\(\backslash\)n"}, \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}}, \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} + \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{912 \}}

\end{DoxyCode}


References \+\_\+kprintf, address, align\+\_\+direct\+\_\+to\+\_\+page(), align\+\_\+up\+\_\+to\+\_\+page(), Max\+O\+S\+::drivers\+::peripherals\+::i, Max\+O\+S\+::common\+::\+Spinlock\+::lock(), s\+\_\+page\+\_\+size, size, and Max\+O\+S\+::common\+::\+Spinlock\+::unlock().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!size\_to\_frames@{size\_to\_frames}}
\index{size\_to\_frames@{size\_to\_frames}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{size\_to\_frames()}{size\_to\_frames()}}
{\footnotesize\ttfamily size\+\_\+t Physical\+Memory\+Manager\+::size\+\_\+to\+\_\+frames (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Converts a size to the number of frames. 


\begin{DoxyParams}{Parameters}
{\em size} & The size to convert \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of frames 
\end{DoxyReturn}


Definition at line 145 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{145                                                         \{}
\DoxyCodeLine{146     \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}{align\_to\_page}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}) / \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}};}
\DoxyCodeLine{147 \}}

\end{DoxyCode}


References align\+\_\+to\+\_\+page(), s\+\_\+page\+\_\+size, and size.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), allocate\+\_\+area(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::free(), free\+\_\+area(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::load\+\_\+physical\+\_\+into\+\_\+address\+\_\+space(), map\+\_\+area(), unmap\+\_\+area(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::$\sim$\+Virtual\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a47cc8d6c823f3c323f88e21437ba88ea}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a47cc8d6c823f3c323f88e21437ba88ea}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!unmap@{unmap}}
\index{unmap@{unmap}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{unmap()}{unmap()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::unmap (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address }\end{DoxyParamCaption})}



Unmaps a virtual address using the kernel\textquotesingle{}s pml4 table. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address} & The virtual address to unmap \\
\hline
\end{DoxyParams}


Definition at line 632 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{632                                                                     \{}
\DoxyCodeLine{633 }
\DoxyCodeLine{634   \textcolor{comment}{// Base information}}
\DoxyCodeLine{635   pml\_t* pml4\_table = (pml\_t *)m\_pml4\_root\_address;}
\DoxyCodeLine{636   \textcolor{keywordtype}{size\_t} base\_addr = 0xFFFF000000000000;}
\DoxyCodeLine{637 }
\DoxyCodeLine{638   \textcolor{comment}{// Get the indexes}}
\DoxyCodeLine{639   uint16\_t pml4\_index = \mbox{\hyperlink{physical_8h_a21b56ad4b688267e89e208897cfdad31}{PML4\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{640   uint16\_t pdpr\_index = \mbox{\hyperlink{physical_8h_a363318d5bd935b341ef29aa93046f5de}{PML3\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{641   uint16\_t pd\_index   = \mbox{\hyperlink{physical_8h_aeccd6d6989169ce4bea31a8aebc3c312}{PML2\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{642   uint16\_t pt\_index   = \mbox{\hyperlink{physical_8h_a39f52e0488e29313ac48c0a06c9f8cbd}{PML1\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{643 }
\DoxyCodeLine{644   \textcolor{comment}{// Get the tables}}
\DoxyCodeLine{645   pml\_t *pdpr\_table =(pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index));}
\DoxyCodeLine{646   pml\_t *pd\_table = (pml\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}},510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index, (uint64\_t) pdpr\_index));}
\DoxyCodeLine{647   uint64\_t* pt\_table = (uint64\_t *) (base\_addr | \mbox{\hyperlink{physical_8cpp_a9a863ef3a659fd011f2a7ee0bf553338}{ENTRIES\_TO\_ADDRESS}}(510\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}}, (uint64\_t) pml4\_index, (uint64\_t) pdpr\_index, (uint64\_t) pd\_index));}
\DoxyCodeLine{648 }
\DoxyCodeLine{649   \textcolor{comment}{// Check if the entry is present}}
\DoxyCodeLine{650   \textcolor{keywordflow}{if}(table\_has\_entry(pml4\_table, pml4\_index) \&\& table\_has\_entry(pdpr\_table, pdpr\_index) \&\& table\_has\_entry(pd\_table, pd\_index))}
\DoxyCodeLine{651     \textcolor{keywordflow}{return};}
\DoxyCodeLine{652 }
\DoxyCodeLine{653   \textcolor{comment}{// Check if the entry isn't present}}
\DoxyCodeLine{654   \textcolor{keywordflow}{if}(!(pt\_table[pt\_index] \& 0b1))}
\DoxyCodeLine{655     \textcolor{keywordflow}{return};}
\DoxyCodeLine{656 }
\DoxyCodeLine{657   \textcolor{comment}{// Unmap the entry}}
\DoxyCodeLine{658   pt\_table[pt\_index] = 0x00\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}};}
\DoxyCodeLine{659 }
\DoxyCodeLine{660   \textcolor{comment}{// Flush the TLB}}
\DoxyCodeLine{661   \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"invlpg (\%0)"} ::\textcolor{stringliteral}{"r"} (virtual\_address) : \textcolor{stringliteral}{"memory"});}
\DoxyCodeLine{662 \}}

\end{DoxyCode}


References E\+N\+T\+R\+I\+E\+S\+\_\+\+T\+O\+\_\+\+A\+D\+D\+R\+E\+SS, Max\+O\+S\+::drivers\+::peripherals\+::l, P\+M\+L1\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L2\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L3\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, and P\+M\+L4\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX.



Referenced by Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::free(), and unmap\+\_\+area().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0f453dd61a29a033887b3a531cf3910f}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0f453dd61a29a033887b3a531cf3910f}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!unmap@{unmap}}
\index{unmap@{unmap}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{unmap()}{unmap()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::unmap (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address,  }\item[{uint64\+\_\+t $\ast$}]{pml4\+\_\+root }\end{DoxyParamCaption})}



Unmaps a virtual address. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address} & The virtual address to unmap \\
\hline
{\em pml4\+\_\+root} & The pml4 table to use \\
\hline
\end{DoxyParams}


Definition at line 669 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{669                                                                                          \{}
\DoxyCodeLine{670 }
\DoxyCodeLine{671     \textcolor{comment}{// Get the indexes}}
\DoxyCodeLine{672     uint16\_t pml4\_index = \mbox{\hyperlink{physical_8h_a21b56ad4b688267e89e208897cfdad31}{PML4\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{673     uint16\_t pdpr\_index = \mbox{\hyperlink{physical_8h_a363318d5bd935b341ef29aa93046f5de}{PML3\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{674     uint16\_t pd\_index   = \mbox{\hyperlink{physical_8h_aeccd6d6989169ce4bea31a8aebc3c312}{PML2\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{675     uint16\_t pt\_index   = \mbox{\hyperlink{physical_8h_a39f52e0488e29313ac48c0a06c9f8cbd}{PML1\_GET\_INDEX}}((uint64\_t) virtual\_address);}
\DoxyCodeLine{676 }
\DoxyCodeLine{677     \textcolor{comment}{// Get the tables}}
\DoxyCodeLine{678     uint64\_t* pdpr\_table = get\_table\_if\_exists(pml4\_root, pml4\_index);}
\DoxyCodeLine{679     uint64\_t* pd\_table = get\_table\_if\_exists(pdpr\_table, pdpr\_index);}
\DoxyCodeLine{680     uint64\_t* pt\_table = get\_table\_if\_exists(pd\_table, pd\_index);}
\DoxyCodeLine{681 }
\DoxyCodeLine{682     \textcolor{comment}{// Check if the tables are present (if any are not then a pt entry will not be present)}}
\DoxyCodeLine{683     \textcolor{keywordflow}{if}(pt\_table == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{684       \textcolor{keywordflow}{return};}
\DoxyCodeLine{685 }
\DoxyCodeLine{686 }
\DoxyCodeLine{687     \textcolor{comment}{// Check if the entry is present}}
\DoxyCodeLine{688     \textcolor{keywordflow}{if}(!(pt\_table[pt\_index] \& 0b1))}
\DoxyCodeLine{689       \textcolor{keywordflow}{return};}
\DoxyCodeLine{690 }
\DoxyCodeLine{691     \textcolor{comment}{// Unmap the entry}}
\DoxyCodeLine{692     pt\_table[pt\_index] = 0x00\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca9a4f202c896c19c7829a34eef07920c0}{l}};}
\DoxyCodeLine{693 }
\DoxyCodeLine{694     \textcolor{comment}{// Flush the TLB}}
\DoxyCodeLine{695     \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"invlpg (\%0)"} ::\textcolor{stringliteral}{"r"} (virtual\_address) : \textcolor{stringliteral}{"memory"});}
\DoxyCodeLine{696 }
\DoxyCodeLine{697 \}}

\end{DoxyCode}


References Max\+O\+S\+::drivers\+::peripherals\+::l, P\+M\+L1\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L2\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, P\+M\+L3\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX, and P\+M\+L4\+\_\+\+G\+E\+T\+\_\+\+I\+N\+D\+EX.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0cc0fb25a8d67e16410a847c4fd59ea3}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0cc0fb25a8d67e16410a847c4fd59ea3}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!unmap\_area@{unmap\_area}}
\index{unmap\_area@{unmap\_area}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{unmap\_area()}{unmap\_area()}}
{\footnotesize\ttfamily void Physical\+Memory\+Manager\+::unmap\+\_\+area (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\+\_\+address\+\_\+t}} $\ast$}]{virtual\+\_\+address\+\_\+start,  }\item[{size\+\_\+t}]{length }\end{DoxyParamCaption})}



Unmaps an area of virtual memory. 


\begin{DoxyParams}{Parameters}
{\em virtual\+\_\+address\+\_\+start} & The start of the area \\
\hline
{\em length} & The length of the area \\
\hline
\end{DoxyParams}


Definition at line 704 of file physical.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{704                                                                                               \{}
\DoxyCodeLine{705 }
\DoxyCodeLine{706     \textcolor{comment}{// Get the size of the area}}
\DoxyCodeLine{707     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{size\_to\_frames}}(\mbox{\hyperlink{intel__i217_8h_aebb70c2aab3407a9f05334c47131a43b}{length}});}
\DoxyCodeLine{708 }
\DoxyCodeLine{709     \textcolor{comment}{// Unmap the required frames}}
\DoxyCodeLine{710     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}; ++\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}})}
\DoxyCodeLine{711       \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a47cc8d6c823f3c323f88e21437ba88ea}{unmap}}(virtual\_address\_start + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{s\_page\_size}}));}
\DoxyCodeLine{712 \}}

\end{DoxyCode}


References Max\+O\+S\+::drivers\+::peripherals\+::i, length, s\+\_\+page\+\_\+size, size, size\+\_\+to\+\_\+frames(), and unmap().



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1d6ffacb7290c01505c3dec9f9cfd3f1}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1d6ffacb7290c01505c3dec9f9cfd3f1}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!s\_current\_manager@{s\_current\_manager}}
\index{s\_current\_manager@{s\_current\_manager}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{s\_current\_manager}{s\_current\_manager}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager}{Physical\+Memory\+Manager}} $\ast$ Physical\+Memory\+Manager\+::s\+\_\+current\+\_\+manager = nullptr\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 141 of file physical.\+h.



Referenced by Physical\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}\label{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}} 
\index{MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}!s\_page\_size@{s\_page\_size}}
\index{s\_page\_size@{s\_page\_size}!MaxOS::memory::PhysicalMemoryManager@{MaxOS::memory::PhysicalMemoryManager}}
\doxysubsubsection{\texorpdfstring{s\_page\_size}{s\_page\_size}}
{\footnotesize\ttfamily const uint32\+\_\+t Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::s\+\_\+page\+\_\+size = \{ 0x1000 \}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 107 of file physical.\+h.



Referenced by align\+\_\+direct\+\_\+to\+\_\+page(), align\+\_\+to\+\_\+page(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::allocate(), allocate\+\_\+area(), allocate\+\_\+frame(), check\+\_\+aligned(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::free(), free\+\_\+area(), free\+\_\+frame(), get\+\_\+memory\+\_\+used(), is\+\_\+anonymous\+\_\+available(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::load\+\_\+physical\+\_\+into\+\_\+address\+\_\+space(), map\+\_\+area(), Max\+O\+S\+::memory\+::\+Memory\+Manager\+::\+Memory\+Manager(), Physical\+Memory\+Manager(), reserve(), size\+\_\+to\+\_\+frames(), unmap\+\_\+area(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager(), and Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Manager\+::$\sim$\+Virtual\+Memory\+Manager().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/include/memory/\mbox{\hyperlink{physical_8h}{physical.\+h}}\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/src/memory/\mbox{\hyperlink{physical_8cpp}{physical.\+cpp}}\end{DoxyCompactItemize}
