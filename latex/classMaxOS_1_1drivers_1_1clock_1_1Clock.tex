\doxysection{Max\+OS\+::drivers\+::clock\+::Clock Class Reference}
\hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock}{}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock}\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}


\doxylink{classMaxOS_1_1drivers_1_1Driver}{Driver} for the APIC clock.  




{\ttfamily \#include $<$clock.\+h$>$}

Inheritance diagram for Max\+OS\+::drivers\+::clock\+::Clock\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=1.848185cm]{classMaxOS_1_1drivers_1_1clock_1_1Clock}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_af60d01870c81940dcdce350326e81dd7}{Clock}} (\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController}{hardwarecommunication\+::\+Advanced\+Programmable\+Interrupt\+Controller}} \texorpdfstring{$\ast$}{*}apic, \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint16\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time\+\_\+between\+\_\+events}}=10)
\begin{DoxyCompactList}\small\item\em Constructor for the \doxylink{classMaxOS_1_1drivers_1_1clock_1_1Clock}{Clock} class. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a7d105f260a9197c78e77e0ba437f0168}{activate}} () \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{override}}
\begin{DoxyCompactList}\small\item\em Activates the clock, setting the binary coded decimal representation flag. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aed23e6f62c03a9f35056a62e97daad69}{delay}} (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{milliseconds}}) \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{const}}
\begin{DoxyCompactList}\small\item\em Delays the program for a specified number of milliseconds (rounded up to the nearest degree of accuracy -\/ ensured the delay is at least the specified number of milliseconds). This on the kernel level is a busy wait, for user level see the sleep function in the Thread class. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_afab69ba284bca41ae58a19b1821ad6c1}{calibrate}} (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ms\+\_\+per\+\_\+tick}}=1)
\begin{DoxyCompactList}\small\item\em Configures the APIC clock to fire an interrupt at a specified interval in milliseconds. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_ab780e51fe8d4680eaa20d7ce53936e90}{setup\+\_\+apic\+\_\+clock}} (\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC}{hardwarecommunication\+::\+Local\+APIC}} \texorpdfstring{$\ast$}{*}local\+\_\+apic) \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{const}}
\begin{DoxyCompactList}\small\item\em Sets up the APIC clock to fire interrupts at the desired rate. \end{DoxyCompactList}\item 
\mbox{\hyperlink{string_8h_a4a6e5834af96b66d8015f5a24c09e1b3}{string}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6d0a67fe521cefba6d58d31eaeeaae1}{vendor\+\_\+name}} () \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{final}}
\begin{DoxyCompactList}\small\item\em Gets the vendor who created the device. \end{DoxyCompactList}\item 
\mbox{\hyperlink{string_8h_a4a6e5834af96b66d8015f5a24c09e1b3}{string}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aa090fa2a1970772e55c0064ed975a26a}{device\+\_\+name}} () \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{final}}
\begin{DoxyCompactList}\small\item\em Gets the name of the device. \end{DoxyCompactList}\item 
\mbox{\hyperlink{time_8h_aa43c26697e3d2c2912707fe9ee60bc7f}{common\+::time\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_a0fa3464d6ab6a9a79b3c1149301b3cba}{get\+\_\+time}} ()
\begin{DoxyCompactList}\small\item\em Reads the current time from the APIC clock (in 24hr time) \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classMaxOS_1_1drivers_1_1Driver}{Max\+OS\+::drivers\+::\+Driver}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{virtual}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1Driver_aa8d91fd440659b56c4ecf5c877925210}{deactivate}} ()
\begin{DoxyCompactList}\small\item\em Deactivate the driver. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{virtual}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1Driver_a87dab1f49da667742d00da02d6e8ef8e}{initialise}} ()
\begin{DoxyCompactList}\small\item\em Initialise the driver. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{virtual}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1Driver_a2371d6b69c1bf351e9c80bde265ac8be}{reset}} ()
\begin{DoxyCompactList}\small\item\em Reset the driver. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler}{Max\+OS\+::hardwarecommunication\+::\+Interrupt\+Handler}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{virtual}} \mbox{\hyperlink{cpu_8h_a605489186b2c614af947b15ae8a77418}{system\+::cpu\+\_\+status\+\_\+t}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler_a3f4303652151fbba92aa7b4513ae0875}{handle\+\_\+interrupt}} (\mbox{\hyperlink{cpu_8h_a605489186b2c614af947b15ae8a77418}{system\+::cpu\+\_\+status\+\_\+t}} \texorpdfstring{$\ast$}{*}status)
\begin{DoxyCompactList}\small\item\em Handles an interrupt and returns the status. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{static}} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock}{Clock}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6e633c389f02276b3c76ee4ff2c65bb}{active\+\_\+clock}} ()
\begin{DoxyCompactList}\small\item\em Gets the currently active clock. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee}{clock\+\_\+accuracy}} = 1
\begin{DoxyCompactList}\small\item\em How accurate the clock is in microseconds (how often should an interrupt be raised) \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Protected Member Functions inherited from \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler}{Max\+OS\+::hardwarecommunication\+::\+Interrupt\+Handler}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler_a79b1054c04bbcc2c72a6d6938212909c}{Interrupt\+Handler}} (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\+\_\+t}} interrupt\+\_\+number, \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{int64\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{redirect}}=-\/1, \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{redirect\+\_\+index}}=0)
\begin{DoxyCompactList}\small\item\em Creates a new interrupt handler and registers it with the interrupt manager. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler_a12b87c89015a61b702184070354e7876}{\texorpdfstring{$\sim$}{\string~}\+Interrupt\+Handler}} ()
\begin{DoxyCompactList}\small\item\em Destroys the interrupt handler and unregisters it from the interrupt manager. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes inherited from \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler}{Max\+OS\+::hardwarecommunication\+::\+Interrupt\+Handler}}}
\begin{DoxyCompactItemize}
\item 
uint8\+\_\+t \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler_aac2ba4da525d342fc83fe344780c1850}{m\+\_\+interrupt\+\_\+number}}
\begin{DoxyCompactList}\small\item\em The interrupt number this handler handles. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\doxylink{classMaxOS_1_1drivers_1_1Driver}{Driver} for the APIC clock. 

Definition at line \mbox{\hyperlink{clock_8h_source_l00123}{123}} of file \mbox{\hyperlink{clock_8h_source}{clock.\+h}}.



\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_af60d01870c81940dcdce350326e81dd7}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_af60d01870c81940dcdce350326e81dd7} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!Clock@{Clock}}
\index{Clock@{Clock}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{Clock()}{Clock()}}
{\footnotesize\ttfamily Clock\+::\+Clock (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController}{hardwarecommunication\+::\+Advanced\+Programmable\+Interrupt\+Controller}} \texorpdfstring{$\ast$}{*}}]{apic,  }\item[{\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint16\+\_\+t}}}]{time\+\_\+between\+\_\+events = {\ttfamily 10} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}



Constructor for the \doxylink{classMaxOS_1_1drivers_1_1clock_1_1Clock}{Clock} class. 


\begin{DoxyParams}{Parameters}
{\em apic} & The apic controller for this core \\
\hline
{\em time\+\_\+between\+\_\+events} & The time between events in 10ths of a second \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{clock_8cpp_source_l00024}{24}} of file \mbox{\hyperlink{clock_8cpp_source}{clock.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00025\ :\ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler}{InterruptHandler}}(0x20),}
\DoxyCodeLine{00026\ \ \ m\_apic(apic),}
\DoxyCodeLine{00027\ \ \ m\_ticks\_between\_events(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time\_between\_events}})}
\DoxyCodeLine{00028\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1Logger_a6fa276d92dbf0dd22dcab146f5c99da6}{Logger::INFO}}()\ <<\ \textcolor{stringliteral}{"{}Setting\ up\ Clock\ \(\backslash\)n"{}};}
\DoxyCodeLine{00030\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{logger_8cpp_source_l00171}{Max\+OS\+::\+Logger\+::\+INFO()}}.



\doxysubsection{Member Function Documentation}
\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_a7d105f260a9197c78e77e0ba437f0168}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_a7d105f260a9197c78e77e0ba437f0168} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!activate@{activate}}
\index{activate@{activate}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{activate()}{activate()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} Clock\+::activate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Activates the clock, setting the binary coded decimal representation flag. 



Reimplemented from \mbox{\hyperlink{classMaxOS_1_1drivers_1_1Driver_a92276c08d77279b6a86c900190ef797b}{Max\+OS\+::drivers\+::\+Driver}}.



Definition at line \mbox{\hyperlink{clock_8cpp_source_l00088}{88}} of file \mbox{\hyperlink{clock_8cpp_source}{clock.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ s\_active\_clock\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ stats\ from\ the\ clock}}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint8\_t}}\ status\ =\ read\_hardware\_clock(0xB);}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{comment}{//\ Store\ the\ clock\ status}}
\DoxyCodeLine{00096\ \ \ \ \ m\_24\_hour\_clock\ =\ status\ \&\ 0x02;}
\DoxyCodeLine{00097\ \ \ \ \ m\_binary\ =\ status\ \&\ 0x04;}
\DoxyCodeLine{00098\ \}}

\end{DoxyCode}
\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6e633c389f02276b3c76ee4ff2c65bb}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6e633c389f02276b3c76ee4ff2c65bb} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!active\_clock@{active\_clock}}
\index{active\_clock@{active\_clock}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{active\_clock()}{active\_clock()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock}{Clock}} \texorpdfstring{$\ast$}{*} Clock\+::active\+\_\+clock (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Gets the currently active clock. 

\begin{DoxyReturn}{Returns}
The clock being used by the kernel 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{clock_8cpp_source_l00208}{208}} of file \mbox{\hyperlink{clock_8cpp_source}{clock.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{return}\ s\_active\_clock;}
\DoxyCodeLine{00210\ \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{ext2_8cpp_source_l00370}{Max\+OS\+::filesystem\+::format\+::ext2\+::\+Ext2\+Volume\+::create\+\_\+inode()}}, \mbox{\hyperlink{cpu_8cpp_source_l00228}{Max\+OS\+::system\+::\+Core\+::init()}}, \mbox{\hyperlink{cpu_8cpp_source_l00059}{Max\+OS\+::system\+::\+Core\+::wake\+\_\+up()}}, and \mbox{\hyperlink{ext2_8cpp_source_l00741}{Max\+OS\+::filesystem\+::format\+::ext2\+::\+Ext2\+File\+::write()}}.

\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_afab69ba284bca41ae58a19b1821ad6c1}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_afab69ba284bca41ae58a19b1821ad6c1} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!calibrate@{calibrate}}
\index{calibrate@{calibrate}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{calibrate()}{calibrate()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} Clock\+::calibrate (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\+\_\+t}}}]{ms\+\_\+per\+\_\+tick = {\ttfamily 1} }\end{DoxyParamCaption})}



Configures the APIC clock to fire an interrupt at a specified interval in milliseconds. 


\begin{DoxyParams}{Parameters}
{\em ms\+\_\+per\+\_\+tick} & How many milliseconds per interrupt \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{clock_8cpp_source_l00144}{144}} of file \mbox{\hyperlink{clock_8cpp_source}{clock.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1Logger_a6fa276d92dbf0dd22dcab146f5c99da6}{Logger::INFO}}()\ <<\ \textcolor{stringliteral}{"{}Calibrating\ Clock\ \(\backslash\)n"{}};}
\DoxyCodeLine{00147\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee}{clock\_accuracy}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ms\_per\_tick}};}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ ticks\ per\ ms}}
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1PIT}{PIT}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{pit}}(m\_apic);}
\DoxyCodeLine{00151\ \ \ \ \ m\_pit\_ticks\_per\_ms\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{pit}}.ticks\_per\_ms();}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//\ Calibrate\ the\ BSP\ apic\ to\ the\ desired\ time}}
\DoxyCodeLine{00154\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_ab780e51fe8d4680eaa20d7ce53936e90}{setup\_apic\_clock}}(m\_apic-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1AdvancedProgrammableInterruptController_af632f7fe1f4a8d9716ec845628946eef}{local\_apic}}());}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1Logger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}Clock:\ Calibrated\ to\ "{}}\ <<\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ms\_per\_tick}}\ <<\ \textcolor{stringliteral}{"{}ms\ per\ kernel\ tick\(\backslash\)n"{}};}
\DoxyCodeLine{00157\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{clock_8h_source_l00155}{clock\+\_\+accuracy}}, \mbox{\hyperlink{logger_8cpp_source_l00193}{Max\+OS\+::\+Logger\+::\+DEBUG()}}, \mbox{\hyperlink{logger_8cpp_source_l00171}{Max\+OS\+::\+Logger\+::\+INFO()}}, \mbox{\hyperlink{apic_8cpp_source_l00480}{Max\+OS\+::hardwarecommunication\+::\+Advanced\+Programmable\+Interrupt\+Controller\+::local\+\_\+apic()}}, and \mbox{\hyperlink{clock_8cpp_source_l00163}{setup\+\_\+apic\+\_\+clock()}}.

\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_aed23e6f62c03a9f35056a62e97daad69}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_aed23e6f62c03a9f35056a62e97daad69} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!delay@{delay}}
\index{delay@{delay}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{delay()}{delay()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} Clock\+::delay (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\+\_\+t}}}]{milliseconds }\end{DoxyParamCaption}) const}



Delays the program for a specified number of milliseconds (rounded up to the nearest degree of accuracy -\/ ensured the delay is at least the specified number of milliseconds). This on the kernel level is a busy wait, for user level see the sleep function in the Thread class. 

\begin{DoxySeeAlso}{See also}
Thread\+::sleep
\end{DoxySeeAlso}

\begin{DoxyParams}{Parameters}
{\em milliseconds} & How many milliseconds to delay the program for. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{clock_8cpp_source_l00110}{110}} of file \mbox{\hyperlink{clock_8cpp_source}{clock.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{comment}{//\ Round\ the\ number\ of\ milliseconds\ UP\ to\ the\ nearest\ clock\ accuracy}}
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{rounded\_milliseconds}}\ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{milliseconds}}\ +\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee}{clock\_accuracy}}\ -\/\ 1)\ /\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee}{clock\_accuracy}};}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{comment}{//\ Wait\ until\ the\ time\ has\ passed}}
\DoxyCodeLine{00116\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ticks\_until\_delay\_is\_over}}\ =\ m\_ticks\ +\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{rounded\_milliseconds}};}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordflow}{while}\ (m\_ticks\ <\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{ticks\_until\_delay\_is\_over}})}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{keyword}{asm}\ \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"{}nop"{}});}
\DoxyCodeLine{00119\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{clock_8h_source_l00155}{clock\+\_\+accuracy}}.

\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_aa090fa2a1970772e55c0064ed975a26a}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_aa090fa2a1970772e55c0064ed975a26a} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!device\_name@{device\_name}}
\index{device\_name@{device\_name}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{device\_name()}{device\_name()}}
{\footnotesize\ttfamily \mbox{\hyperlink{string_8h_a4a6e5834af96b66d8015f5a24c09e1b3}{string}} Clock\+::device\+\_\+name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [final]}, {\ttfamily [virtual]}}



Gets the name of the device. 

\begin{DoxyReturn}{Returns}
The name of the device 
\end{DoxyReturn}


Reimplemented from \mbox{\hyperlink{classMaxOS_1_1drivers_1_1Driver_a2870bc0edff29cd802f10e6acc50cf89}{Max\+OS\+::drivers\+::\+Driver}}.



Definition at line \mbox{\hyperlink{clock_8cpp_source_l00135}{135}} of file \mbox{\hyperlink{clock_8cpp_source}{clock.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Clock"{}};}
\DoxyCodeLine{00137\ \}}

\end{DoxyCode}
\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_a0fa3464d6ab6a9a79b3c1149301b3cba}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_a0fa3464d6ab6a9a79b3c1149301b3cba} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!get\_time@{get\_time}}
\index{get\_time@{get\_time}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{get\_time()}{get\_time()}}
{\footnotesize\ttfamily \mbox{\hyperlink{time_8h_aa43c26697e3d2c2912707fe9ee60bc7f}{common\+::time\+\_\+t}} Clock\+::get\+\_\+time (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Reads the current time from the APIC clock (in 24hr time) 

\begin{DoxyReturn}{Returns}
The current time in a Time struct format 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{clock_8cpp_source_l00182}{182}} of file \mbox{\hyperlink{clock_8cpp_source}{clock.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{comment}{//\ Wait\ for\ the\ clock\ to\ be\ ready}}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordflow}{while}\ (read\_hardware\_clock(0xA)\ \&\ 0x80)}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keyword}{asm}\ \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"{}nop"{}});}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ Read\ the\ time\ from\ the\ clock}}
\DoxyCodeLine{00189\ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1common_1_1Time}{time\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}\{\};}
\DoxyCodeLine{00190\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}.year\ =\ binary\_representation(read\_hardware\_clock(0x9))\ +\ 2000;}
\DoxyCodeLine{00191\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}.month\ =\ binary\_representation(read\_hardware\_clock(0x8));}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}.day\ =\ binary\_representation(read\_hardware\_clock(0x7));}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}.hour\ =\ binary\_representation(read\_hardware\_clock(0x4));}
\DoxyCodeLine{00194\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}.minute\ =\ binary\_representation(read\_hardware\_clock(0x2));}
\DoxyCodeLine{00195\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}.second\ =\ binary\_representation(read\_hardware\_clock(0x0));}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ If\ the\ clock\ is\ using\ 12hr\ format\ and\ PM\ is\ set\ then\ add\ 12\ to\ the\ hour}}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{if}\ (!m\_24\_hour\_clock\ \&\&\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}.hour\ \&\ 0x80)\ !=\ 0)}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}.hour\ =\ ((\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}}.hour\ \&\ 0x7F)\ +\ 12)\ \%\ 24;}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{time}};}
\DoxyCodeLine{00202\ \}}

\end{DoxyCode}
\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_ab780e51fe8d4680eaa20d7ce53936e90}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_ab780e51fe8d4680eaa20d7ce53936e90} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!setup\_apic\_clock@{setup\_apic\_clock}}
\index{setup\_apic\_clock@{setup\_apic\_clock}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{setup\_apic\_clock()}{setup\_apic\_clock()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} Clock\+::setup\+\_\+apic\+\_\+clock (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC}{hardwarecommunication\+::\+Local\+APIC}} \texorpdfstring{$\ast$}{*}}]{local\+\_\+apic }\end{DoxyParamCaption}) const}



Sets up the APIC clock to fire interrupts at the desired rate. 


\begin{DoxyParams}{Parameters}
{\em local\+\_\+apic} & The local APIC to setup the clock on \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{clock_8cpp_source_l00163}{163}} of file \mbox{\hyperlink{clock_8cpp_source}{clock.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{comment}{//\ Configure\ the\ clock\ to\ periodic\ mode}}
\DoxyCodeLine{00166\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lvt}}\ =\ 0x20\ |\ (1\ <<\ 17);}
\DoxyCodeLine{00167\ \ \ \ \ local\_apic-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x320,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lvt}});}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ initial\ count}}
\DoxyCodeLine{00170\ \ \ \ \ local\_apic-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x380,\ m\_pit\_ticks\_per\_ms\ *\ \mbox{\hyperlink{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee}{clock\_accuracy}});}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//\ Clear\ the\ interrupt\ mask\ for\ the\ clock}}
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lvt}}\ \&=\ \string~(1\ <<\ 16);}
\DoxyCodeLine{00174\ \ \ \ \ local\_apic-\/>\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1LocalAPIC_a58100a1d7ff3dac52a6abfb1d5686561}{write}}(0x320,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lvt}});}
\DoxyCodeLine{00175\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{clock_8h_source_l00155}{clock\+\_\+accuracy}}, and \mbox{\hyperlink{apic_8cpp_source_l00091}{Max\+OS\+::hardwarecommunication\+::\+Local\+APIC\+::write()}}.



Referenced by \mbox{\hyperlink{clock_8cpp_source_l00144}{calibrate()}}.

\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6d0a67fe521cefba6d58d31eaeeaae1}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_af6d0a67fe521cefba6d58d31eaeeaae1} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!vendor\_name@{vendor\_name}}
\index{vendor\_name@{vendor\_name}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{vendor\_name()}{vendor\_name()}}
{\footnotesize\ttfamily \mbox{\hyperlink{string_8h_a4a6e5834af96b66d8015f5a24c09e1b3}{string}} Clock\+::vendor\+\_\+name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [final]}, {\ttfamily [virtual]}}



Gets the vendor who created the device. 

\begin{DoxyReturn}{Returns}
The name of the vendor 
\end{DoxyReturn}


Reimplemented from \mbox{\hyperlink{classMaxOS_1_1drivers_1_1Driver_a1d0f9643af1af6964724b898cecd1bae}{Max\+OS\+::drivers\+::\+Driver}}.



Definition at line \mbox{\hyperlink{clock_8cpp_source_l00126}{126}} of file \mbox{\hyperlink{clock_8cpp_source}{clock.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Generic"{}};}
\DoxyCodeLine{00128\ \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\Hypertarget{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee}\label{classMaxOS_1_1drivers_1_1clock_1_1Clock_aecea13aad11f6fd54bc99bea83a076ee} 
\index{MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}!clock\_accuracy@{clock\_accuracy}}
\index{clock\_accuracy@{clock\_accuracy}!MaxOS::drivers::clock::Clock@{MaxOS::drivers::clock::Clock}}
\doxysubsubsection{\texorpdfstring{clock\_accuracy}{clock\_accuracy}}
{\footnotesize\ttfamily uint64\+\_\+t Max\+OS\+::drivers\+::clock\+::\+Clock\+::clock\+\_\+accuracy = 1}



How accurate the clock is in microseconds (how often should an interrupt be raised) 



Definition at line \mbox{\hyperlink{clock_8h_source_l00155}{155}} of file \mbox{\hyperlink{clock_8h_source}{clock.\+h}}.



Referenced by \mbox{\hyperlink{clock_8cpp_source_l00144}{calibrate()}}, \mbox{\hyperlink{clock_8cpp_source_l00110}{delay()}}, and \mbox{\hyperlink{clock_8cpp_source_l00163}{setup\+\_\+apic\+\_\+clock()}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Max\+OS/\+Max\+OS/kernel/include/drivers/clock/\mbox{\hyperlink{clock_8h}{clock.\+h}}\item 
/home/runner/work/\+Max\+OS/\+Max\+OS/kernel/src/drivers/clock/\mbox{\hyperlink{clock_8cpp}{clock.\+cpp}}\end{DoxyCompactItemize}
