\hypertarget{classMaxOS_1_1processes_1_1Scheduler}{}\doxysection{Max\+OS\+::processes\+::Scheduler Class Reference}
\label{classMaxOS_1_1processes_1_1Scheduler}\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}


Schedules processes to run on the C\+PU.  




{\ttfamily \#include $<$scheduler.\+h$>$}

Inheritance diagram for Max\+OS\+::processes\+::Scheduler\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classMaxOS_1_1processes_1_1Scheduler}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a1e1373e40f4d1f0caeee2e80018f9f40}{Scheduler}} (\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptManager}{hardwarecommunication\+::\+Interrupt\+Manager}} $\ast$interrupt\+\_\+manager)
\item 
\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_afc8187779b46f64039d3ffa58f0dbe51}{$\sim$\+Scheduler}} ()
\item 
system\+::cpu\+\_\+status\+\_\+t $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a5d9c7ddda5adeedff09093b7492101f8}{handle\+\_\+interrupt}} (system\+::cpu\+\_\+status\+\_\+t $\ast$\mbox{\hyperlink{intel__i217_8h_ade818037fd6c985038ff29656089758d}{status}}) final
\begin{DoxyCompactList}\small\item\em Handles the interrupt 0x20. \end{DoxyCompactList}\item 
system\+::cpu\+\_\+status\+\_\+t $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_aecc29abbf74f6f611762c4298d5c3a1d}{schedule}} (system\+::cpu\+\_\+status\+\_\+t $\ast$\mbox{\hyperlink{intel__i217_8h_ade818037fd6c985038ff29656089758d}{status}})
\begin{DoxyCompactList}\small\item\em Schedules the next thread to run. \end{DoxyCompactList}\item 
system\+::cpu\+\_\+status\+\_\+t $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a2a9bbde7bc0893ac458cbf3ef756effa}{schedule\+\_\+next}} (system\+::cpu\+\_\+status\+\_\+t $\ast$\mbox{\hyperlink{intel__i217_8h_ade818037fd6c985038ff29656089758d}{status}})
\begin{DoxyCompactList}\small\item\em Schedules the next thread to run. \end{DoxyCompactList}\item 
system\+::cpu\+\_\+status\+\_\+t $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4e3cb6c6cc95d62dc6149c0ec934c723}{yield}} ()
\begin{DoxyCompactList}\small\item\em Yield the current thread. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a57f5f5eecb3fbbc693b6462c880129b0}{add\+\_\+process}} (\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$process)
\begin{DoxyCompactList}\small\item\em Adds a process to the scheduler. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a00c2995b3a91021eb4f278a591ff994f}{remove\+\_\+process}} (\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$process)
\begin{DoxyCompactList}\small\item\em Removes a process from the scheduler if the process has no threads, if it does then the threads are stopped but the process is not removed (this will be done automatically when all threads are stopped) \end{DoxyCompactList}\item 
system\+::cpu\+\_\+status\+\_\+t $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a501213a82c4fa7c7aa8bc6ff39377c0f}{force\+\_\+remove\+\_\+process}} (\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$process)
\begin{DoxyCompactList}\small\item\em Removes a process from the scheduler and deletes all threads, begins running the next process. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a85c088e0e4d5e5d6fb646c842127c36c}{add\+\_\+thread}} (\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}} $\ast$thread)
\begin{DoxyCompactList}\small\item\em Adds a thread to the scheduler. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_acbcdbf248b726135c442c3e59773acd2}{get\+\_\+ticks}} ()
\begin{DoxyCompactList}\small\item\em Gets how long the system has been running for. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a8273f5b5d5dbfd7fbd10480c32db9ad4}{load\+\_\+multiboot\+\_\+elfs}} (\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot}{system\+::\+Multiboot}} $\ast$multiboot)
\begin{DoxyCompactList}\small\item\em Loads any valid E\+LF files from the multiboot structure. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ad7bd11e0611b0cad2fc18e3499d82dec}{activate}} ()
\begin{DoxyCompactList}\small\item\em Activates the scheduler. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af4792bed046b34d0010412e336ec2970}{deactivate}} ()
\begin{DoxyCompactList}\small\item\em Deactivates the scheduler. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler}{Scheduler}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ac85b93968affc260d78005549dc3c08f}{get\+\_\+system\+\_\+scheduler}} ()
\begin{DoxyCompactList}\small\item\em Gets the system scheduler. \end{DoxyCompactList}\item 
static \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ab49af6f7dc81af748175b2578b179ff5}{get\+\_\+current\+\_\+process}} ()
\begin{DoxyCompactList}\small\item\em Gets the current process. \end{DoxyCompactList}\item 
static \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a51b58af8b283f0f98131dd2d6ce51540}{get\+\_\+process}} (uint64\+\_\+t pid)
\begin{DoxyCompactList}\small\item\em Gets a process by its P\+ID. \end{DoxyCompactList}\item 
static \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a7fb0b3234c276a5f0cea6290482748c0}{get\+\_\+current\+\_\+thread}} ()
\begin{DoxyCompactList}\small\item\em Gets the currently executing thread. \end{DoxyCompactList}\item 
static \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a73cf68e70de225ce465f249989766468}{get\+\_\+thread}} (uint64\+\_\+t tid)
\begin{DoxyCompactList}\small\item\em Gets a thread by its T\+ID. \end{DoxyCompactList}\item 
static \mbox{\hyperlink{classMaxOS_1_1processes_1_1IPC}{I\+PC}} $\ast$ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ae6958c54e9ac634d3de0fa67749ac983}{get\+\_\+ipc}} ()
\begin{DoxyCompactList}\small\item\em Gets the \mbox{\hyperlink{classMaxOS_1_1processes_1_1IPC}{I\+PC}} handler. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
Schedules processes to run on the C\+PU. 

Definition at line 23 of file scheduler.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a1e1373e40f4d1f0caeee2e80018f9f40}\label{classMaxOS_1_1processes_1_1Scheduler_a1e1373e40f4d1f0caeee2e80018f9f40}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!Scheduler@{Scheduler}}
\index{Scheduler@{Scheduler}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{Scheduler()}{Scheduler()}}
{\footnotesize\ttfamily Scheduler\+::\+Scheduler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptManager}{hardwarecommunication\+::\+Interrupt\+Manager}} $\ast$}]{interrupt\+\_\+manager }\end{DoxyParamCaption})}



Definition at line 17 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{18 : \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler_a23513de3e722d6f7183a9b51b1d86c48}{InterruptHandler}}(0x20, interrupt\_manager),}
\DoxyCodeLine{19   m\_current\_thread\_index(0),}
\DoxyCodeLine{20   m\_active(\textcolor{keyword}{false}),}
\DoxyCodeLine{21   m\_ticks(0),}
\DoxyCodeLine{22   m\_next\_pid(-\/1),}
\DoxyCodeLine{23   m\_next\_tid(-\/1)}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \{}
\DoxyCodeLine{26   s\_instance = \textcolor{keyword}{this};}
\DoxyCodeLine{27 }
\DoxyCodeLine{28   \textcolor{comment}{// Create the IPC handler}}
\DoxyCodeLine{29   m\_ipc = \textcolor{keyword}{new} \mbox{\hyperlink{classMaxOS_1_1processes_1_1IPC}{IPC}}();}
\DoxyCodeLine{30 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_afc8187779b46f64039d3ffa58f0dbe51}\label{classMaxOS_1_1processes_1_1Scheduler_afc8187779b46f64039d3ffa58f0dbe51}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!````~Scheduler@{$\sim$Scheduler}}
\index{````~Scheduler@{$\sim$Scheduler}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{$\sim$Scheduler()}{~Scheduler()}}
{\footnotesize\ttfamily Scheduler\+::$\sim$\+Scheduler (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 32 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{32                       \{}
\DoxyCodeLine{33   s\_instance = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{34   m\_active = \textcolor{keyword}{false};}
\DoxyCodeLine{35 }
\DoxyCodeLine{36   \textcolor{comment}{// Delete the IPC handler}}
\DoxyCodeLine{37   \textcolor{keyword}{delete} m\_ipc;}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_ad7bd11e0611b0cad2fc18e3499d82dec}\label{classMaxOS_1_1processes_1_1Scheduler_ad7bd11e0611b0cad2fc18e3499d82dec}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!activate@{activate}}
\index{activate@{activate}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{activate()}{activate()}}
{\footnotesize\ttfamily void Scheduler\+::activate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Activates the scheduler. 



Definition at line 237 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{237                          \{}
\DoxyCodeLine{238     m\_active = \textcolor{keyword}{true};}
\DoxyCodeLine{239 \}}

\end{DoxyCode}


Referenced by kernel\+Main().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a57f5f5eecb3fbbc693b6462c880129b0}\label{classMaxOS_1_1processes_1_1Scheduler_a57f5f5eecb3fbbc693b6462c880129b0}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!add\_process@{add\_process}}
\index{add\_process@{add\_process}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{add\_process()}{add\_process()}}
{\footnotesize\ttfamily uint64\+\_\+t Scheduler\+::add\+\_\+process (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$}]{process }\end{DoxyParamCaption})}



Adds a process to the scheduler. 


\begin{DoxyParams}{Parameters}
{\em process} & The process to add \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The process ID 
\end{DoxyReturn}


Definition at line 161 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{161                                                 \{}
\DoxyCodeLine{162 }
\DoxyCodeLine{163   \textcolor{comment}{// Get the next process ID}}
\DoxyCodeLine{164   m\_next\_pid++;}
\DoxyCodeLine{165 }
\DoxyCodeLine{166   \textcolor{comment}{// Add the process to the list}}
\DoxyCodeLine{167   m\_processes.push\_back(process);}
\DoxyCodeLine{168   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Adding process \%d: \%s\(\backslash\)n"}, m\_next\_pid, process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a56404d627bd310d8de08fba3d8d2792f}{name}}.\mbox{\hyperlink{classMaxOS_1_1String_a2af521b9de69dcbe3f1125390fbb3b5a}{c\_str}}());}
\DoxyCodeLine{169 }
\DoxyCodeLine{170   \textcolor{comment}{// Return the process ID}}
\DoxyCodeLine{171   \textcolor{keywordflow}{return} m\_next\_pid;}
\DoxyCodeLine{172 }
\DoxyCodeLine{173 \}}

\end{DoxyCode}


References \+\_\+kprintf, Max\+O\+S\+::\+String\+::c\+\_\+str(), and Max\+O\+S\+::processes\+::\+Process\+::name.



Referenced by kernel\+Main(), and Max\+O\+S\+::processes\+::\+Process\+::set\+\_\+up().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a85c088e0e4d5e5d6fb646c842127c36c}\label{classMaxOS_1_1processes_1_1Scheduler_a85c088e0e4d5e5d6fb646c842127c36c}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!add\_thread@{add\_thread}}
\index{add\_thread@{add\_thread}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{add\_thread()}{add\_thread()}}
{\footnotesize\ttfamily uint64\+\_\+t Scheduler\+::add\+\_\+thread (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}} $\ast$}]{thread }\end{DoxyParamCaption})}



Adds a thread to the scheduler. 


\begin{DoxyParams}{Parameters}
{\em thread} & The thread to add \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The thread ID 
\end{DoxyReturn}


Definition at line 180 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{180                                              \{}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     \textcolor{comment}{// Get the next thread ID}}
\DoxyCodeLine{183     m\_next\_tid++;}
\DoxyCodeLine{184 }
\DoxyCodeLine{185     \textcolor{comment}{// Add the thread to the list}}
\DoxyCodeLine{186     m\_threads.push\_back(thread);}
\DoxyCodeLine{187     \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Adding thread \%d to process \%d\(\backslash\)n"}, m\_next\_tid, thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a130e3726d7c4912ab2fdf6bf587f757f}{parent\_pid}});}
\DoxyCodeLine{188 }
\DoxyCodeLine{189     \textcolor{comment}{// Return the thread ID}}
\DoxyCodeLine{190     \textcolor{keywordflow}{return} m\_next\_tid;}
\DoxyCodeLine{191 }
\DoxyCodeLine{192 \}}

\end{DoxyCode}


References \+\_\+kprintf, and Max\+O\+S\+::processes\+::\+Thread\+::parent\+\_\+pid.

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_af4792bed046b34d0010412e336ec2970}\label{classMaxOS_1_1processes_1_1Scheduler_af4792bed046b34d0010412e336ec2970}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!deactivate@{deactivate}}
\index{deactivate@{deactivate}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{deactivate()}{deactivate()}}
{\footnotesize\ttfamily void Scheduler\+::deactivate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Deactivates the scheduler. 



Definition at line 354 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{354                            \{}
\DoxyCodeLine{355     m\_active = \textcolor{keyword}{false};}
\DoxyCodeLine{356 }
\DoxyCodeLine{357 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a501213a82c4fa7c7aa8bc6ff39377c0f}\label{classMaxOS_1_1processes_1_1Scheduler_a501213a82c4fa7c7aa8bc6ff39377c0f}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!force\_remove\_process@{force\_remove\_process}}
\index{force\_remove\_process@{force\_remove\_process}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{force\_remove\_process()}{force\_remove\_process()}}
{\footnotesize\ttfamily cpu\+\_\+status\+\_\+t $\ast$ Scheduler\+::force\+\_\+remove\+\_\+process (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$}]{process }\end{DoxyParamCaption})}



Removes a process from the scheduler and deletes all threads, begins running the next process. 


\begin{DoxyParams}{Parameters}
{\em process} & The process to remove \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The status of the C\+PU for the next process to run or nullptr if the process was not found 
\end{DoxyReturn}


Definition at line 283 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{283                                                               \{}
\DoxyCodeLine{284 }
\DoxyCodeLine{285   \textcolor{comment}{// If there is no process, fail}}
\DoxyCodeLine{286   \textcolor{keywordflow}{if} (!process)}
\DoxyCodeLine{287       \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{288 }
\DoxyCodeLine{289   \textcolor{comment}{// Remove all the threads}}
\DoxyCodeLine{290   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} thread : process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a8cf973832029fbb77ad9e69b234813ef}{get\_threads}}())\{}
\DoxyCodeLine{291 }
\DoxyCodeLine{292     \textcolor{comment}{// Remove the thread from the scheduler}}
\DoxyCodeLine{293     \textcolor{keywordtype}{int} index = m\_threads.find(thread) -\/ m\_threads.begin();}
\DoxyCodeLine{294     m\_threads.erase(m\_threads.begin() + index);}
\DoxyCodeLine{295 }
\DoxyCodeLine{296     \textcolor{comment}{// Delete the thread}}
\DoxyCodeLine{297     process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_af57385b2fab714504b20e95ceb0a8bbd}{remove\_thread}}(thread-\/>tid);}
\DoxyCodeLine{298 }
\DoxyCodeLine{299   \}}
\DoxyCodeLine{300 }
\DoxyCodeLine{301 }
\DoxyCodeLine{302   \textcolor{comment}{// Process will be dead now so run the next process (don't care about the execution state being outdated as we are removing it anyway)}}
\DoxyCodeLine{303   \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a2a9bbde7bc0893ac458cbf3ef756effa}{schedule\_next}}(\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a7fb0b3234c276a5f0cea6290482748c0}{get\_current\_thread}}()-\/>execution\_state);}
\DoxyCodeLine{304 \}}

\end{DoxyCode}


References get\+\_\+current\+\_\+thread(), Max\+O\+S\+::processes\+::\+Process\+::get\+\_\+threads(), Max\+O\+S\+::processes\+::\+Process\+::remove\+\_\+thread(), and schedule\+\_\+next().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_ab49af6f7dc81af748175b2578b179ff5}\label{classMaxOS_1_1processes_1_1Scheduler_ab49af6f7dc81af748175b2578b179ff5}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!get\_current\_process@{get\_current\_process}}
\index{get\_current\_process@{get\_current\_process}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{get\_current\_process()}{get\_current\_process()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$ Scheduler\+::get\+\_\+current\+\_\+process (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Gets the current process. 

\begin{DoxyReturn}{Returns}
The current process, or nullptr if not found 
\end{DoxyReturn}


Definition at line 310 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{310                                         \{}
\DoxyCodeLine{311 }
\DoxyCodeLine{312   \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}* current\_process = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{313 }
\DoxyCodeLine{314   \textcolor{comment}{// Find the process that has the thread being executed}}
\DoxyCodeLine{315   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} process : s\_instance -\/> m\_processes)}
\DoxyCodeLine{316     \textcolor{keywordflow}{if} (process-\/>get\_pid() == \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a7fb0b3234c276a5f0cea6290482748c0}{get\_current\_thread}}() -\/> parent\_pid) \{}
\DoxyCodeLine{317       current\_process = process;}
\DoxyCodeLine{318       \textcolor{keywordflow}{break};}
\DoxyCodeLine{319     \}}
\DoxyCodeLine{320 }
\DoxyCodeLine{321   \textcolor{keywordflow}{return} current\_process;}
\DoxyCodeLine{322 \}}

\end{DoxyCode}


References get\+\_\+current\+\_\+thread().



Referenced by Max\+O\+S\+::processes\+::\+I\+P\+C\+::alloc\+\_\+shared\+\_\+memory(), Max\+O\+S\+::processes\+::\+I\+P\+C\+::create\+\_\+message\+\_\+endpoint(), Max\+O\+S\+::processes\+::\+I\+P\+C\+::free\+\_\+message\+\_\+endpoint(), schedule\+\_\+next(), and Max\+O\+S\+::processes\+::\+I\+P\+C\+::send\+\_\+message().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a7fb0b3234c276a5f0cea6290482748c0}\label{classMaxOS_1_1processes_1_1Scheduler_a7fb0b3234c276a5f0cea6290482748c0}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!get\_current\_thread@{get\_current\_thread}}
\index{get\_current\_thread@{get\_current\_thread}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{get\_current\_thread()}{get\_current\_thread()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}} $\ast$ Scheduler\+::get\+\_\+current\+\_\+thread (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Gets the currently executing thread. 

\begin{DoxyReturn}{Returns}
The currently executing thread 
\end{DoxyReturn}


Definition at line 345 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{345                                       \{}
\DoxyCodeLine{346 }
\DoxyCodeLine{347   \textcolor{keywordflow}{return} s\_instance -\/> m\_threads[s\_instance -\/> m\_current\_thread\_index];}
\DoxyCodeLine{348 }
\DoxyCodeLine{349 \}}

\end{DoxyCode}


Referenced by force\+\_\+remove\+\_\+process(), get\+\_\+current\+\_\+process(), and yield().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_ae6958c54e9ac634d3de0fa67749ac983}\label{classMaxOS_1_1processes_1_1Scheduler_ae6958c54e9ac634d3de0fa67749ac983}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!get\_ipc@{get\_ipc}}
\index{get\_ipc@{get\_ipc}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{get\_ipc()}{get\_ipc()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1processes_1_1IPC}{I\+PC}} $\ast$ Scheduler\+::get\+\_\+ipc (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Gets the \mbox{\hyperlink{classMaxOS_1_1processes_1_1IPC}{I\+PC}} handler. 

\begin{DoxyReturn}{Returns}
The \mbox{\hyperlink{classMaxOS_1_1processes_1_1IPC}{I\+PC}} handler or nullptr if not found 
\end{DoxyReturn}


Definition at line 395 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{395                         \{}
\DoxyCodeLine{396 }
\DoxyCodeLine{397   \textcolor{keywordflow}{return} s\_instance -\/> m\_ipc;}
\DoxyCodeLine{398 }
\DoxyCodeLine{399 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a51b58af8b283f0f98131dd2d6ce51540}\label{classMaxOS_1_1processes_1_1Scheduler_a51b58af8b283f0f98131dd2d6ce51540}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!get\_process@{get\_process}}
\index{get\_process@{get\_process}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{get\_process()}{get\_process()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$ Scheduler\+::get\+\_\+process (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{pid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Gets a process by its P\+ID. 


\begin{DoxyParams}{Parameters}
{\em pid} & The process ID \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The process or nullptr if not found 
\end{DoxyReturn}


Definition at line 329 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{329                                             \{}
\DoxyCodeLine{330 }
\DoxyCodeLine{331   \textcolor{comment}{// Try to find the process}}
\DoxyCodeLine{332   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} process : s\_instance-\/>m\_processes)}
\DoxyCodeLine{333     \textcolor{keywordflow}{if} (process-\/>get\_pid() == pid)}
\DoxyCodeLine{334       \textcolor{keywordflow}{return} process;}
\DoxyCodeLine{335 }
\DoxyCodeLine{336   \textcolor{comment}{// Not found}}
\DoxyCodeLine{337   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{338 \}}

\end{DoxyCode}


Referenced by Max\+O\+S\+::processes\+::\+I\+P\+C\+::send\+\_\+message().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_ac85b93968affc260d78005549dc3c08f}\label{classMaxOS_1_1processes_1_1Scheduler_ac85b93968affc260d78005549dc3c08f}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!get\_system\_scheduler@{get\_system\_scheduler}}
\index{get\_system\_scheduler@{get\_system\_scheduler}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{get\_system\_scheduler()}{get\_system\_scheduler()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler}{Scheduler}} $\ast$ Scheduler\+::get\+\_\+system\+\_\+scheduler (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Gets the system scheduler. 

\begin{DoxyReturn}{Returns}
The system scheduler or nullptr if not found 
\end{DoxyReturn}


Definition at line 198 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{198                                            \{}
\DoxyCodeLine{199 }
\DoxyCodeLine{200   \textcolor{keywordflow}{if}(s\_instance)}
\DoxyCodeLine{201     \textcolor{keywordflow}{return} s\_instance;}
\DoxyCodeLine{202 }
\DoxyCodeLine{203   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{204 \}}

\end{DoxyCode}


Referenced by Max\+O\+S\+::processes\+::\+Process\+::remove\+\_\+thread(), and Max\+O\+S\+::processes\+::\+Process\+::set\+\_\+up().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a73cf68e70de225ce465f249989766468}\label{classMaxOS_1_1processes_1_1Scheduler_a73cf68e70de225ce465f249989766468}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!get\_thread@{get\_thread}}
\index{get\_thread@{get\_thread}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{get\_thread()}{get\_thread()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}} $\ast$ Scheduler\+::get\+\_\+thread (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{tid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Gets a thread by its T\+ID. 


\begin{DoxyParams}{Parameters}
{\em tid} & The thread ID \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The thread or nullptr if not found 
\end{DoxyReturn}


Definition at line 407 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{407                                           \{}
\DoxyCodeLine{408 }
\DoxyCodeLine{409   \textcolor{comment}{// Try to find the thread}}
\DoxyCodeLine{410   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} thread : s\_instance -\/> m\_threads)}
\DoxyCodeLine{411     \textcolor{keywordflow}{if} (thread -\/> tid == tid)}
\DoxyCodeLine{412       \textcolor{keywordflow}{return} thread;}
\DoxyCodeLine{413 }
\DoxyCodeLine{414   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{415 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_acbcdbf248b726135c442c3e59773acd2}\label{classMaxOS_1_1processes_1_1Scheduler_acbcdbf248b726135c442c3e59773acd2}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!get\_ticks@{get\_ticks}}
\index{get\_ticks@{get\_ticks}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{get\_ticks()}{get\_ticks()}}
{\footnotesize\ttfamily uint64\+\_\+t Scheduler\+::get\+\_\+ticks (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Gets how long the system has been running for. 

\begin{DoxyReturn}{Returns}
The number of ticks 
\end{DoxyReturn}


Definition at line 210 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{210                               \{}
\DoxyCodeLine{211     \textcolor{keywordflow}{return} m\_ticks;}
\DoxyCodeLine{212 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a5d9c7ddda5adeedff09093b7492101f8}\label{classMaxOS_1_1processes_1_1Scheduler_a5d9c7ddda5adeedff09093b7492101f8}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!handle\_interrupt@{handle\_interrupt}}
\index{handle\_interrupt@{handle\_interrupt}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{handle\_interrupt()}{handle\_interrupt()}}
{\footnotesize\ttfamily cpu\+\_\+status\+\_\+t $\ast$ Scheduler\+::handle\+\_\+interrupt (\begin{DoxyParamCaption}\item[{system\+::cpu\+\_\+status\+\_\+t $\ast$}]{status }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [final]}, {\ttfamily [virtual]}}



Handles the interrupt 0x20. 


\begin{DoxyParams}{Parameters}
{\em status} & The current C\+PU status \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The new C\+PU status 
\end{DoxyReturn}
Note\+: Could have set scheduler to just be the handle interrupt function, / but in the future there may be a need to schedule at other times

Reimplemented from \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler_a3f4303652151fbba92aa7b4513ae0875}{Max\+O\+S\+::hardwarecommunication\+::\+Interrupt\+Handler}}.



Definition at line 46 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{46                                                               \{}
\DoxyCodeLine{47 }
\DoxyCodeLine{48     \textcolor{comment}{// Schedule the next thread}}
\DoxyCodeLine{49     \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_aecc29abbf74f6f611762c4298d5c3a1d}{schedule}}(\mbox{\hyperlink{intel__i217_8h_ade818037fd6c985038ff29656089758d}{status}});}
\DoxyCodeLine{50 }
\DoxyCodeLine{53 \}}

\end{DoxyCode}


References schedule(), and status.

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a8273f5b5d5dbfd7fbd10480c32db9ad4}\label{classMaxOS_1_1processes_1_1Scheduler_a8273f5b5d5dbfd7fbd10480c32db9ad4}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!load\_multiboot\_elfs@{load\_multiboot\_elfs}}
\index{load\_multiboot\_elfs@{load\_multiboot\_elfs}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{load\_multiboot\_elfs()}{load\_multiboot\_elfs()}}
{\footnotesize\ttfamily void Scheduler\+::load\+\_\+multiboot\+\_\+elfs (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot}{system\+::\+Multiboot}} $\ast$}]{multiboot }\end{DoxyParamCaption})}



Loads any valid E\+LF files from the multiboot structure. 


\begin{DoxyParams}{Parameters}
{\em multiboot} & The multiboot structure \\
\hline
\end{DoxyParams}


Definition at line 364 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{364                                                               \{}
\DoxyCodeLine{365 }
\DoxyCodeLine{366   \textcolor{keywordflow}{for}(\mbox{\hyperlink{structmultiboot__tag}{multiboot\_tag}}* tag = multiboot -\/> get\_start\_tag(); tag-\/>\mbox{\hyperlink{structmultiboot__tag_ac2a46af85d217c774d2a618291539334}{type}} != \mbox{\hyperlink{multiboot_8h_a9ba1adbd7639e20f723e51dd9668a981}{MULTIBOOT\_TAG\_TYPE\_END}}; tag = (\textcolor{keyword}{struct }\mbox{\hyperlink{structmultiboot__tag}{multiboot\_tag}} *) ((\mbox{\hyperlink{multiboot_8h_a037f602538fccf97e90021c19fdfc047}{multiboot\_uint8\_t}} *) tag + ((tag-\/>size + 7) \& \string~7))) \{}
\DoxyCodeLine{367     \textcolor{keywordflow}{if}(tag -\/> \mbox{\hyperlink{apic_8h_a1d127017fb298b889f4ba24752d08b8e}{type}} != \mbox{\hyperlink{multiboot_8h_a10b78479319b8790657f13414cf34736}{MULTIBOOT\_TAG\_TYPE\_MODULE}})}
\DoxyCodeLine{368       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{369 }
\DoxyCodeLine{370     \textcolor{comment}{// Get the module tag}}
\DoxyCodeLine{371     \textcolor{keyword}{struct }\mbox{\hyperlink{structmultiboot__tag__module}{multiboot\_tag\_module}}* module = (\textcolor{keyword}{struct }\mbox{\hyperlink{structmultiboot__tag__module}{multiboot\_tag\_module}}*)tag;}
\DoxyCodeLine{372 }
\DoxyCodeLine{373     \textcolor{comment}{// Create the elf}}
\DoxyCodeLine{374     \mbox{\hyperlink{classMaxOS_1_1processes_1_1Elf64}{Elf64}}* elf = \textcolor{keyword}{new} \mbox{\hyperlink{classMaxOS_1_1processes_1_1Elf64}{Elf64}}((uintptr\_t)MemoryManager::to\_dm\_region((uintptr\_t )module-\/>\mbox{\hyperlink{structmultiboot__tag__module_af2870ead515a1c38d4484645ab54fb03}{mod\_start}}));}
\DoxyCodeLine{375     \textcolor{keywordflow}{if}(!elf-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Elf64_a3cd39d79f5b60621dc69839866fe3bd4}{is\_valid}}())}
\DoxyCodeLine{376       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{377 }
\DoxyCodeLine{378     \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Creating process from multiboot module for \%s (at 0x\%x)\(\backslash\)n"}, module-\/>\mbox{\hyperlink{structmultiboot__tag__module_ae28133d78349211f87ff9fcfb9ab3056}{cmdline}}, module-\/>\mbox{\hyperlink{structmultiboot__tag__module_af2870ead515a1c38d4484645ab54fb03}{mod\_start}});}
\DoxyCodeLine{379 }
\DoxyCodeLine{380     \textcolor{comment}{// Create an array of args for the process}}
\DoxyCodeLine{381     \textcolor{keywordtype}{char}* args[1] = \{module-\/>\mbox{\hyperlink{structmultiboot__tag__module_ae28133d78349211f87ff9fcfb9ab3056}{cmdline}}\};}
\DoxyCodeLine{382 }
\DoxyCodeLine{383     \textcolor{comment}{// Create the process}}
\DoxyCodeLine{384     \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}* process = \textcolor{keyword}{new} \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}(module-\/>\mbox{\hyperlink{structmultiboot__tag__module_ae28133d78349211f87ff9fcfb9ab3056}{cmdline}}, args, 1, elf);}
\DoxyCodeLine{385 }
\DoxyCodeLine{386     \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Elf loaded to pid \%d\(\backslash\)n"}, process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a56b7359906f289d7054247885002e2e5}{get\_pid}}());}
\DoxyCodeLine{387   \}}
\DoxyCodeLine{388 }
\DoxyCodeLine{389 \}}

\end{DoxyCode}


References \+\_\+kprintf, multiboot\+\_\+tag\+\_\+module\+::cmdline, Max\+O\+S\+::processes\+::\+Process\+::get\+\_\+pid(), Max\+O\+S\+::processes\+::\+Elf64\+::is\+\_\+valid(), multiboot\+\_\+tag\+\_\+module\+::mod\+\_\+start, M\+U\+L\+T\+I\+B\+O\+O\+T\+\_\+\+T\+A\+G\+\_\+\+T\+Y\+P\+E\+\_\+\+E\+ND, M\+U\+L\+T\+I\+B\+O\+O\+T\+\_\+\+T\+A\+G\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+O\+D\+U\+LE, and type.



Referenced by kernel\+Main().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a00c2995b3a91021eb4f278a591ff994f}\label{classMaxOS_1_1processes_1_1Scheduler_a00c2995b3a91021eb4f278a591ff994f}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!remove\_process@{remove\_process}}
\index{remove\_process@{remove\_process}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{remove\_process()}{remove\_process()}}
{\footnotesize\ttfamily uint64\+\_\+t Scheduler\+::remove\+\_\+process (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}} $\ast$}]{process }\end{DoxyParamCaption})}



Removes a process from the scheduler if the process has no threads, if it does then the threads are stopped but the process is not removed (this will be done automatically when all threads are stopped) 


\begin{DoxyParams}{Parameters}
{\em process} & The process to remove \\
\hline
{\em force} & If true, the process will be removed and so will all threads \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/1 if the process has threads, 0 otherwise 
\end{DoxyReturn}


Definition at line 247 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{247                                                    \{}
\DoxyCodeLine{248 }
\DoxyCodeLine{249   \textcolor{comment}{// Check if the process has no threads}}
\DoxyCodeLine{250   \textcolor{keywordflow}{if} (!process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a8cf973832029fbb77ad9e69b234813ef}{get\_threads}}().empty()) \{}
\DoxyCodeLine{251 }
\DoxyCodeLine{252     \textcolor{comment}{// Set the threads to stopped or remove them if forced}}
\DoxyCodeLine{253     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} thread : process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a8cf973832029fbb77ad9e69b234813ef}{get\_threads}}())}
\DoxyCodeLine{254         thread-\/>thread\_state = \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6ae7c1b950bc6f83844022db5d32c7cb67}{ThreadState::STOPPED}};}
\DoxyCodeLine{255 }
\DoxyCodeLine{256     \textcolor{comment}{// Need to wait until the threads are stopped before removing the process (this will be called again when all threads are stopped)}}
\DoxyCodeLine{257     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{258 }
\DoxyCodeLine{259   \}}
\DoxyCodeLine{260 }
\DoxyCodeLine{261   \textcolor{comment}{// Remove the process}}
\DoxyCodeLine{262   \textcolor{keywordflow}{for} (uint16\_t \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < m\_processes.size(); \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++) \{}
\DoxyCodeLine{263     \textcolor{keywordflow}{if} (m\_processes[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}] == process) \{}
\DoxyCodeLine{264         m\_processes.erase(m\_processes.begin() + \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}});}
\DoxyCodeLine{265 }
\DoxyCodeLine{266         \textcolor{comment}{// Delete the process mem}}
\DoxyCodeLine{267         \textcolor{keyword}{delete} process;}
\DoxyCodeLine{268         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{269     \}}
\DoxyCodeLine{270   \}}
\DoxyCodeLine{271 }
\DoxyCodeLine{272   \textcolor{comment}{// Process not found}}
\DoxyCodeLine{273   \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{274 }
\DoxyCodeLine{275 \}}

\end{DoxyCode}


References Max\+O\+S\+::processes\+::\+Process\+::get\+\_\+threads(), Max\+O\+S\+::drivers\+::peripherals\+::i, and Max\+O\+S\+::processes\+::\+S\+T\+O\+P\+P\+ED.

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_aecc29abbf74f6f611762c4298d5c3a1d}\label{classMaxOS_1_1processes_1_1Scheduler_aecc29abbf74f6f611762c4298d5c3a1d}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!schedule@{schedule}}
\index{schedule@{schedule}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{schedule()}{schedule()}}
{\footnotesize\ttfamily cpu\+\_\+status\+\_\+t $\ast$ Scheduler\+::schedule (\begin{DoxyParamCaption}\item[{system\+::cpu\+\_\+status\+\_\+t $\ast$}]{status }\end{DoxyParamCaption})}



Schedules the next thread to run. 


\begin{DoxyParams}{Parameters}
{\em cpu\+\_\+state} & The current C\+PU state \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The next C\+PU state 
\end{DoxyReturn}


Definition at line 61 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{61                                                          \{}
\DoxyCodeLine{62 }
\DoxyCodeLine{63   \textcolor{comment}{// If there are no threads to schedule or not active, return the current state}}
\DoxyCodeLine{64   \textcolor{keywordflow}{if} (m\_threads.empty() || !m\_active)}
\DoxyCodeLine{65       \textcolor{keywordflow}{return} cpu\_state;}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 }
\DoxyCodeLine{68   \textcolor{comment}{// Thread that we are dealing with}}
\DoxyCodeLine{69   \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}}* current\_thread = m\_threads[m\_current\_thread\_index];}
\DoxyCodeLine{70 }
\DoxyCodeLine{71   \textcolor{comment}{// Ticked}}
\DoxyCodeLine{72   m\_ticks++;}
\DoxyCodeLine{73   current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_adac2079967569c8686ab0d05631065bc}{ticks}}++;}
\DoxyCodeLine{74 }
\DoxyCodeLine{75    \textcolor{comment}{// Wait for a bit so that the scheduler doesn't run too fast}}
\DoxyCodeLine{76    \textcolor{keywordflow}{if} (m\_ticks \% s\_ticks\_per\_event != 0) \textcolor{keywordflow}{return} cpu\_state;}
\DoxyCodeLine{77 }
\DoxyCodeLine{78    \textcolor{comment}{// Schedule the next thread}}
\DoxyCodeLine{79    \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a2a9bbde7bc0893ac458cbf3ef756effa}{schedule\_next}}(cpu\_state);}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \}}

\end{DoxyCode}


References schedule\+\_\+next(), and Max\+O\+S\+::processes\+::\+Thread\+::ticks.



Referenced by handle\+\_\+interrupt().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a2a9bbde7bc0893ac458cbf3ef756effa}\label{classMaxOS_1_1processes_1_1Scheduler_a2a9bbde7bc0893ac458cbf3ef756effa}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!schedule\_next@{schedule\_next}}
\index{schedule\_next@{schedule\_next}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{schedule\_next()}{schedule\_next()}}
{\footnotesize\ttfamily system\+::cpu\+\_\+status\+\_\+t $\ast$ Scheduler\+::schedule\+\_\+next (\begin{DoxyParamCaption}\item[{system\+::cpu\+\_\+status\+\_\+t $\ast$}]{cpu\+\_\+state }\end{DoxyParamCaption})}



Schedules the next thread to run. 


\begin{DoxyParams}{Parameters}
{\em status} & The current C\+PU status of the thread \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The next C\+PU status 
\end{DoxyReturn}


Definition at line 88 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{88                                                                           \{}
\DoxyCodeLine{89 }
\DoxyCodeLine{90   \textcolor{comment}{// Get the current thread}}
\DoxyCodeLine{91   \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}}* current\_thread = m\_threads[m\_current\_thread\_index];}
\DoxyCodeLine{92 }
\DoxyCodeLine{93   \textcolor{comment}{// Save the current state}}
\DoxyCodeLine{94   current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_afcde2d4d3ee4c3540120034dbbff1807}{execution\_state}} = cpu\_state;}
\DoxyCodeLine{95   \textcolor{keywordflow}{if}(current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a07fecafeda2dc5867ef07db926de4617}{thread\_state}} == \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a8695b2e56da39ed2d5181d7ee8b56e2a}{ThreadState::RUNNING}})}
\DoxyCodeLine{96     current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a07fecafeda2dc5867ef07db926de4617}{thread\_state}} = \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6af8ac7aeb93d575fba401d37e30e60510}{ThreadState::WAITING}};}
\DoxyCodeLine{97 }
\DoxyCodeLine{98   \textcolor{comment}{// Switch to the next thread}}
\DoxyCodeLine{99   m\_current\_thread\_index++;}
\DoxyCodeLine{100   m\_current\_thread\_index \%= m\_threads.size();}
\DoxyCodeLine{101 }
\DoxyCodeLine{102   current\_thread = m\_threads[m\_current\_thread\_index];}
\DoxyCodeLine{103 }
\DoxyCodeLine{104   \textcolor{comment}{// If the current thread is in the process then we can get the process}}
\DoxyCodeLine{105   \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}* current\_process = \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ab49af6f7dc81af748175b2578b179ff5}{get\_current\_process}}();}
\DoxyCodeLine{106 }
\DoxyCodeLine{107   \textcolor{comment}{// Handle state changes}}
\DoxyCodeLine{108   \textcolor{keywordflow}{switch} (current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a07fecafeda2dc5867ef07db926de4617}{thread\_state}}) \{}
\DoxyCodeLine{109 }
\DoxyCodeLine{110     \textcolor{keywordflow}{case} \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a3195a4effaa582ba0523a5208e945cbd}{ThreadState::NEW}}:}
\DoxyCodeLine{111       current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a07fecafeda2dc5867ef07db926de4617}{thread\_state}} = \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a8695b2e56da39ed2d5181d7ee8b56e2a}{ThreadState::RUNNING}};}
\DoxyCodeLine{112       \textcolor{keywordflow}{break};}
\DoxyCodeLine{113 }
\DoxyCodeLine{114     \textcolor{keywordflow}{case} \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6aa7c0931b486735232aaaf97e696ea8a5}{ThreadState::SLEEPING}}:}
\DoxyCodeLine{115 }
\DoxyCodeLine{116       \textcolor{comment}{// If the wake-\/up time hasn't occurred yet, run the next thread}}
\DoxyCodeLine{117       \textcolor{keywordflow}{if} (current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a2cda049e10651cb61318f38cd88f22e2}{wakeup\_time}} > m\_ticks)}
\DoxyCodeLine{118         \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a2a9bbde7bc0893ac458cbf3ef756effa}{schedule\_next}}(current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_afcde2d4d3ee4c3540120034dbbff1807}{execution\_state}});}
\DoxyCodeLine{119 }
\DoxyCodeLine{120       \textcolor{keywordflow}{break};}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     \textcolor{keywordflow}{case} \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6ae7c1b950bc6f83844022db5d32c7cb67}{ThreadState::STOPPED}}:}
\DoxyCodeLine{123 }
\DoxyCodeLine{124       \textcolor{comment}{// Find the process that has the thread and remove it}}
\DoxyCodeLine{125       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} thread : current\_process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a8cf973832029fbb77ad9e69b234813ef}{get\_threads}}()) \{}
\DoxyCodeLine{126         \textcolor{keywordflow}{if} (thread == current\_thread) \{}
\DoxyCodeLine{127           current\_process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_af57385b2fab714504b20e95ceb0a8bbd}{remove\_thread}}(m\_current\_thread\_index);}
\DoxyCodeLine{128           \textcolor{keywordflow}{break};}
\DoxyCodeLine{129         \}}
\DoxyCodeLine{130       \}}
\DoxyCodeLine{131 }
\DoxyCodeLine{132       \textcolor{comment}{// Remove the thread}}
\DoxyCodeLine{133       m\_threads.erase(m\_threads.begin() + m\_current\_thread\_index);}
\DoxyCodeLine{134 }
\DoxyCodeLine{135       \textcolor{comment}{// Run the next thread}}
\DoxyCodeLine{136       \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a2a9bbde7bc0893ac458cbf3ef756effa}{schedule\_next}}(cpu\_state);}
\DoxyCodeLine{137 }
\DoxyCodeLine{138     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{139       \textcolor{keywordflow}{break};}
\DoxyCodeLine{140   \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142   \textcolor{comment}{// Prepare the next thread to run}}
\DoxyCodeLine{143   current\_thread -\/> thread\_state = \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a8695b2e56da39ed2d5181d7ee8b56e2a}{ThreadState::RUNNING}};}
\DoxyCodeLine{144 }
\DoxyCodeLine{145   \textcolor{comment}{// Load the threads memory manager}}
\DoxyCodeLine{146   MemoryManager::switch\_active\_memory\_manager(current\_process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_af8482adefd92ca758c67a98a197444ea}{memory\_manager}});}
\DoxyCodeLine{147 }
\DoxyCodeLine{148   \textcolor{comment}{// Load the TSS for the thread}}
\DoxyCodeLine{149   \mbox{\hyperlink{classMaxOS_1_1system_1_1CPU_ade5429bb69b2f7800bf398b65de78cb9}{system::CPU::get\_instance}}() -\/> \mbox{\hyperlink{structMaxOS_1_1system_1_1tss}{tss}}.\mbox{\hyperlink{structMaxOS_1_1system_1_1tss_a5719c6cb9ae842f74c0e1eccc4f89f3b}{rsp0}} = current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a481f7dd08b6060645c93919018f64fe4}{get\_tss\_pointer}}();}
\DoxyCodeLine{150 }
\DoxyCodeLine{151   \textcolor{comment}{// Return the next thread's state}}
\DoxyCodeLine{152   \textcolor{keywordflow}{return} current\_thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_afcde2d4d3ee4c3540120034dbbff1807}{execution\_state}};}
\DoxyCodeLine{153 \}}

\end{DoxyCode}


References Max\+O\+S\+::processes\+::\+Thread\+::execution\+\_\+state, get\+\_\+current\+\_\+process(), Max\+O\+S\+::system\+::\+C\+P\+U\+::get\+\_\+instance(), Max\+O\+S\+::processes\+::\+Process\+::get\+\_\+threads(), Max\+O\+S\+::processes\+::\+Thread\+::get\+\_\+tss\+\_\+pointer(), Max\+O\+S\+::processes\+::\+Process\+::memory\+\_\+manager, Max\+O\+S\+::processes\+::\+N\+EW, Max\+O\+S\+::processes\+::\+Process\+::remove\+\_\+thread(), Max\+O\+S\+::system\+::tss\+::rsp0, Max\+O\+S\+::processes\+::\+R\+U\+N\+N\+I\+NG, Max\+O\+S\+::processes\+::\+S\+L\+E\+E\+P\+I\+NG, Max\+O\+S\+::processes\+::\+S\+T\+O\+P\+P\+ED, Max\+O\+S\+::processes\+::\+Thread\+::thread\+\_\+state, Max\+O\+S\+::processes\+::\+W\+A\+I\+T\+I\+NG, and Max\+O\+S\+::processes\+::\+Thread\+::wakeup\+\_\+time.



Referenced by force\+\_\+remove\+\_\+process(), schedule(), and yield().

\mbox{\Hypertarget{classMaxOS_1_1processes_1_1Scheduler_a4e3cb6c6cc95d62dc6149c0ec934c723}\label{classMaxOS_1_1processes_1_1Scheduler_a4e3cb6c6cc95d62dc6149c0ec934c723}} 
\index{MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}!yield@{yield}}
\index{yield@{yield}!MaxOS::processes::Scheduler@{MaxOS::processes::Scheduler}}
\doxysubsubsection{\texorpdfstring{yield()}{yield()}}
{\footnotesize\ttfamily cpu\+\_\+status\+\_\+t $\ast$ Scheduler\+::yield (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Yield the current thread. 



Definition at line 217 of file scheduler.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{217                                \{}
\DoxyCodeLine{218 }
\DoxyCodeLine{219   \textcolor{comment}{// If this is the only thread, can't yield}}
\DoxyCodeLine{220   \textcolor{keywordflow}{if} (m\_threads.size() <= 1)}
\DoxyCodeLine{221       \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a7fb0b3234c276a5f0cea6290482748c0}{get\_current\_thread}}()-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_afcde2d4d3ee4c3540120034dbbff1807}{execution\_state}};}
\DoxyCodeLine{222 }
\DoxyCodeLine{223   \textcolor{comment}{// Set the current thread to waiting if running}}
\DoxyCodeLine{224   \textcolor{keywordflow}{if} (m\_threads[m\_current\_thread\_index]-\/>thread\_state == \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a8695b2e56da39ed2d5181d7ee8b56e2a}{ThreadState::RUNNING}})}
\DoxyCodeLine{225       m\_threads[m\_current\_thread\_index]-\/>thread\_state = \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6af8ac7aeb93d575fba401d37e30e60510}{ThreadState::WAITING}};}
\DoxyCodeLine{226 }
\DoxyCodeLine{227   \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Yielding thread \%d\(\backslash\)n"}, m\_current\_thread\_index);}
\DoxyCodeLine{228 }
\DoxyCodeLine{229   \textcolor{comment}{// Schedule the next thread}}
\DoxyCodeLine{230   \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a2a9bbde7bc0893ac458cbf3ef756effa}{schedule\_next}}(\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a7fb0b3234c276a5f0cea6290482748c0}{get\_current\_thread}}()-\/>execution\_state);}
\DoxyCodeLine{231 }
\DoxyCodeLine{232 \}}

\end{DoxyCode}


References \+\_\+kprintf, Max\+O\+S\+::processes\+::\+Thread\+::execution\+\_\+state, get\+\_\+current\+\_\+thread(), Max\+O\+S\+::processes\+::\+R\+U\+N\+N\+I\+NG, schedule\+\_\+next(), and Max\+O\+S\+::processes\+::\+W\+A\+I\+T\+I\+NG.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/include/processes/\mbox{\hyperlink{scheduler_8h}{scheduler.\+h}}\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/src/processes/\mbox{\hyperlink{scheduler_8cpp}{scheduler.\+cpp}}\end{DoxyCompactItemize}
