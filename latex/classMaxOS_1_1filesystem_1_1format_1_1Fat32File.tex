\doxysection{Max\+OS\+::filesystem\+::format\+::Fat32\+File Class Reference}
\hypertarget{classMaxOS_1_1filesystem_1_1format_1_1Fat32File}{}\label{classMaxOS_1_1filesystem_1_1format_1_1Fat32File}\index{MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}}


Handles the file operations on the FAT32 filesystem.  




{\ttfamily \#include $<$fat32.\+h$>$}

Inheritance diagram for Max\+OS\+::filesystem\+::format\+::Fat32\+File\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classMaxOS_1_1filesystem_1_1format_1_1Fat32File}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_a5211e5c750a0cd115248ede7f3dd553b}{Fat32\+File}} (\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume}{Fat32\+Volume}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{volume}}, \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Directory}{Fat32\+Directory}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{parent}}, \mbox{\hyperlink{fat32_8h_abfb5b0d8f0d8f55352e5a36ace46c5e6}{dir\+\_\+entry\+\_\+t}} \texorpdfstring{$\ast$}{*}info, \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{const}} \mbox{\hyperlink{string_8h_a4a6e5834af96b66d8015f5a24c09e1b3}{string}} \&\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ada67576556e0415df8bf213d0ce50991}{name}})
\begin{DoxyCompactList}\small\item\em Construct a new Fat32 \doxylink{classMaxOS_1_1filesystem_1_1File}{File} object. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_aaa7afcb13be4b94941bddbc1b98e9cf0}{write}} (\mbox{\hyperlink{buffer_8h_ae34c2f95637029a49836360ddf075b3d}{common\+::buffer\+\_\+t}} \texorpdfstring{$\ast$}{*}data, \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{size\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{amount}}) \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{final}}
\begin{DoxyCompactList}\small\item\em write data to the file (at the current seek position, updated to be += amount) \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_a82edeaaf7f5ff1654f34e5b2da809889}{read}} (\mbox{\hyperlink{buffer_8h_ae34c2f95637029a49836360ddf075b3d}{common\+::buffer\+\_\+t}} \texorpdfstring{$\ast$}{*}data, \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{size\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{amount}}) \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{final}}
\begin{DoxyCompactList}\small\item\em read data from the file (at the current seek position, updated to be += amount) \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_aedf8ab18a47f703fb50ebfee7c116198}{flush}} () \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{final}}
\begin{DoxyCompactList}\small\item\em Flush the file to the disk. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_aaaf4bb26323f73f610d2893886a912d3}{first\+\_\+cluster}} () const
\begin{DoxyCompactList}\small\item\em Get the first cluster of the directory. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File}{Max\+OS\+::filesystem\+::\+File}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_aa5315e6f1fdd27481ec88524041f2410}{seek}} (\mbox{\hyperlink{filesystem_8h_a873ee5a569a9920bf834c717148328c1}{Seek\+Type}} \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{seek\+\_\+type}}, \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{size\+\_\+t}} offset)
\begin{DoxyCompactList}\small\item\em Seek to a position in the file. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_aad915e3cebd2721cc1780896170a1c21}{position}} () \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{const}}
\begin{DoxyCompactList}\small\item\em Get where the file is currently at (amount read/write/seeked) \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{size\+\_\+t}} \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_a7db57a4132bb250ee7c7c67441fca2de}{size}} () \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{const}}
\begin{DoxyCompactList}\small\item\em Get the size of the file. \end{DoxyCompactList}\item 
\mbox{\hyperlink{string_8h_a4a6e5834af96b66d8015f5a24c09e1b3}{string}} \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ada67576556e0415df8bf213d0ce50991}{name}} ()
\begin{DoxyCompactList}\small\item\em Get the name of the file. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Protected Attributes inherited from \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File}{Max\+OS\+::filesystem\+::\+File}}}
\begin{DoxyCompactItemize}
\item 
uint32\+\_\+t \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\+\_\+offset}} = 0
\begin{DoxyCompactList}\small\item\em The current offset in the file. \end{DoxyCompactList}\item 
\mbox{\hyperlink{string_8h_a4a6e5834af96b66d8015f5a24c09e1b3}{string}} \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_a98335b9c813e11733b3b12a7b4fb9087}{m\+\_\+name}}
\begin{DoxyCompactList}\small\item\em The name of the file. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_a2ea111d653133dd808f65809c969358f}{m\+\_\+size}} = 0
\begin{DoxyCompactList}\small\item\em The size of the file. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Handles the file operations on the FAT32 filesystem. 

Definition at line \mbox{\hyperlink{fat32_8h_source_l00207}{207}} of file \mbox{\hyperlink{fat32_8h_source}{fat32.\+h}}.



\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_a5211e5c750a0cd115248ede7f3dd553b}\label{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_a5211e5c750a0cd115248ede7f3dd553b} 
\index{MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}!Fat32File@{Fat32File}}
\index{Fat32File@{Fat32File}!MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}}
\doxysubsubsection{\texorpdfstring{Fat32File()}{Fat32File()}}
{\footnotesize\ttfamily Fat32\+File\+::\+Fat32\+File (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume}{Fat32\+Volume}} \texorpdfstring{$\ast$}{*}}]{volume,  }\item[{\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Directory}{Fat32\+Directory}} \texorpdfstring{$\ast$}{*}}]{parent,  }\item[{\mbox{\hyperlink{fat32_8h_abfb5b0d8f0d8f55352e5a36ace46c5e6}{dir\+\_\+entry\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{info,  }\item[{\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{const}} \mbox{\hyperlink{string_8h_a4a6e5834af96b66d8015f5a24c09e1b3}{string}} \&}]{name }\end{DoxyParamCaption})}



Construct a new Fat32 \doxylink{classMaxOS_1_1filesystem_1_1File}{File} object. 


\begin{DoxyParams}{Parameters}
{\em volume} & The helper volume object \\
\hline
{\em parent} & The directory that contains this file \\
\hline
{\em info} & The directory entry information that describes this file \\
\hline
{\em name} & The name of the file \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{fat32_8cpp_source_l00239}{239}} of file \mbox{\hyperlink{fat32_8cpp_source}{fat32.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ :\ m\_volume(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{volume}}),}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ m\_parent\_directory(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{parent}}),}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ m\_entry(info),}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ m\_first\_cluster((info-\/>first\_cluster\_high\ <<\ 16)\ |\ info-\/>first\_cluster\_low)\ \{}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_a98335b9c813e11733b3b12a7b4fb9087}{m\_name}}\ =\ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ada67576556e0415df8bf213d0ce50991}{name}};}
\DoxyCodeLine{00246\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_a2ea111d653133dd808f65809c969358f}{m\_size}}\ =\ info-\/>size;}
\DoxyCodeLine{00247\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}}\ =\ 0;}
\DoxyCodeLine{00248\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{filesystem_8h_source_l00035}{Max\+OS\+::filesystem\+::\+File\+::m\+\_\+name}}, \mbox{\hyperlink{filesystem_8h_source_l00034}{Max\+OS\+::filesystem\+::\+File\+::m\+\_\+offset}}, \mbox{\hyperlink{filesystem_8h_source_l00036}{Max\+OS\+::filesystem\+::\+File\+::m\+\_\+size}}, and \mbox{\hyperlink{filesystem_8cpp_source_l00082}{Max\+OS\+::filesystem\+::\+File\+::name()}}.



\doxysubsection{Member Function Documentation}
\Hypertarget{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_aaaf4bb26323f73f610d2893886a912d3}\label{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_aaaf4bb26323f73f610d2893886a912d3} 
\index{MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}!first\_cluster@{first\_cluster}}
\index{first\_cluster@{first\_cluster}!MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}}
\doxysubsubsection{\texorpdfstring{first\_cluster()}{first\_cluster()}}
{\footnotesize\ttfamily uint32\+\_\+t Max\+OS\+::filesystem\+::format\+::\+Fat32\+File\+::first\+\_\+cluster (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Get the first cluster of the directory. 

\begin{DoxyReturn}{Returns}
The first cluster of the directory 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{fat32_8h_source_l00228}{228}} of file \mbox{\hyperlink{fat32_8h_source}{fat32.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00228\ \{\ \textcolor{keywordflow}{return}\ m\_first\_cluster;\ \}}

\end{DoxyCode}
\Hypertarget{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_aedf8ab18a47f703fb50ebfee7c116198}\label{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_aedf8ab18a47f703fb50ebfee7c116198} 
\index{MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}!flush@{flush}}
\index{flush@{flush}!MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}}
\doxysubsubsection{\texorpdfstring{flush()}{flush()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} Fat32\+File\+::flush (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [final]}, {\ttfamily [virtual]}}



Flush the file to the disk. 



Reimplemented from \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_af87fa862de707575b8badd044a5af80e}{Max\+OS\+::filesystem\+::\+File}}.



Definition at line \mbox{\hyperlink{fat32_8cpp_source_l00413}{413}} of file \mbox{\hyperlink{fat32_8cpp_source}{fat32.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00414\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_af87fa862de707575b8badd044a5af80e}{File::flush}}();}
\DoxyCodeLine{00415\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{filesystem_8cpp_source_l00041}{Max\+OS\+::filesystem\+::\+File\+::flush()}}.

\Hypertarget{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_a82edeaaf7f5ff1654f34e5b2da809889}\label{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_a82edeaaf7f5ff1654f34e5b2da809889} 
\index{MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}!read@{read}}
\index{read@{read}!MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}}
\doxysubsubsection{\texorpdfstring{read()}{read()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} Fat32\+File\+::read (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{buffer_8h_ae34c2f95637029a49836360ddf075b3d}{common\+::buffer\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{data,  }\item[{\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{size\+\_\+t}}}]{amount }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [final]}, {\ttfamily [virtual]}}



read data from the file (at the current seek position, updated to be += amount) 


\begin{DoxyParams}{Parameters}
{\em data} & The byte buffer to read into \\
\hline
{\em amount} & The amount of data to read \\
\hline
\end{DoxyParams}


Reimplemented from \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_a3385ab264cdca0faed533b17d701bab4}{Max\+OS\+::filesystem\+::\+File}}.



Definition at line \mbox{\hyperlink{fat32_8cpp_source_l00361}{361}} of file \mbox{\hyperlink{fat32_8cpp_source}{fat32.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}}\ =\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.bytes\_per\_sector\ *\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.sectors\_per\_cluster;}
\DoxyCodeLine{00363\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Buffer}{buffer\_t}}\ buffer(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}});}
\DoxyCodeLine{00364\ \ \ \ \ buffer.clear();}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}}\ =\ 0;}
\DoxyCodeLine{00367\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_read}}\ =\ 0;}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{comment}{//\ Read\ the\ file}}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}\ =\ m\_first\_cluster;}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}\ !=\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}})\ ClusterState::END\_OF\_CHAIN;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}\ =\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a12b7e165dde3e75b98bd43835e5cf96a}{next\_cluster}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}))\ \{}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ clusters\ before\ the\ offset}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}}\ +\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}})\ <\ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}})\ \{}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}};}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ each\ sector\ in\ the\ cluster}}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{filesystem_8h_af466a9d32fd2bf17acb2efa91031ded0}{lba\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lba}}\ =\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_aba48c72b1770313b4b4a9a01af962008}{data\_lba}}\ +\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}\ -\/\ 2)\ *\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.sectors\_per\_cluster;}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}\ =\ 0;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}\ <\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.sectors\_per\_cluster;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}++)}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a5d5ea78e0213ece71259dc171b3bd239}{disk}}-\/>\mbox{\hyperlink{classMaxOS_1_1drivers_1_1disk_1_1Disk_a9fa1c1952cece4f322ba0f2552f16c24}{read}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lba}}\ +\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}},\ \&buffer,\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.bytes\_per\_sector);}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ buffer.set\_offset(0);}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ offset\ is\ in\ the\ middle\ of\ the\ cluster}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_offset}}\ =\ 0;}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}}\ >\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}})}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_offset}}\ =\ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}}\ -\/\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}};}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ how\ many\ bytes\ are\ being\ copied\ (read\ from\ cluster\ at\ offset?\ or\ read\ part\ of\ cluster?)}}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster\_remaining\_bytes}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}}\ -\/\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_offset}};}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{data\_remaining\_bytes}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{amount}}\ -\/\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_read}};}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}}\ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster\_remaining\_bytes}}\ <\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{data\_remaining\_bytes}})\ ?\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster\_remaining\_bytes}}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{data\_remaining\_bytes}};}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}}\ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}}\ >\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}})\ ?\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}}\ :\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}};}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ the\ data}}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ buffer.copy\_from(data,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}},\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_offset}},\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_read}});}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_read}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}};}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}};}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Dont\ read\ more\ than\ needed}}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_read}}\ >=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{amount}})}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00405\ \ \ \ \ \}}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_read}};}
\DoxyCodeLine{00408\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{fat32_8h_source_l00176}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Volume\+::bpb}}, \mbox{\hyperlink{buffer_8cpp_source_l00065}{Max\+OS\+::common\+::\+Buffer\+::clear()}}, \mbox{\hyperlink{buffer_8cpp_source_l00195}{Max\+OS\+::common\+::\+Buffer\+::copy\+\_\+from()}}, \mbox{\hyperlink{fat32_8h_source_l00184}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Volume\+::data\+\_\+lba}}, \mbox{\hyperlink{fat32_8h_source_l00187}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Volume\+::disk}}, \mbox{\hyperlink{filesystem_8h_source_l00034}{Max\+OS\+::filesystem\+::\+File\+::m\+\_\+offset}}, \mbox{\hyperlink{fat32_8cpp_source_l00065}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Volume\+::next\+\_\+cluster()}}, \mbox{\hyperlink{disk_8cpp_source_l00026}{Max\+OS\+::drivers\+::disk\+::\+Disk\+::read()}}, and \mbox{\hyperlink{buffer_8cpp_source_l00128}{Max\+OS\+::common\+::\+Buffer\+::set\+\_\+offset()}}.

\Hypertarget{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_aaa7afcb13be4b94941bddbc1b98e9cf0}\label{classMaxOS_1_1filesystem_1_1format_1_1Fat32File_aaa7afcb13be4b94941bddbc1b98e9cf0} 
\index{MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}!write@{write}}
\index{write@{write}!MaxOS::filesystem::format::Fat32File@{MaxOS::filesystem::format::Fat32File}}
\doxysubsubsection{\texorpdfstring{write()}{write()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{void}} Fat32\+File\+::write (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{buffer_8h_ae34c2f95637029a49836360ddf075b3d}{common\+::buffer\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{data,  }\item[{\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{size\+\_\+t}}}]{amount }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [final]}, {\ttfamily [virtual]}}



write data to the file (at the current seek position, updated to be += amount) 


\begin{DoxyParams}{Parameters}
{\em data} & The byte buffer to write \\
\hline
{\em amount} & The amount of data to write\\
\hline
\end{DoxyParams}
\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000061}{Todo}}]When in userspace\+: save timestamps \end{DoxyRefDesc}


Reimplemented from \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ab034c679d2ed6aae636ad8ec224e6fa1}{Max\+OS\+::filesystem\+::\+File}}.



Definition at line \mbox{\hyperlink{fat32_8cpp_source_l00260}{260}} of file \mbox{\hyperlink{fat32_8cpp_source}{fat32.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}}\ =\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.bytes\_per\_sector\ *\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.sectors\_per\_cluster;}
\DoxyCodeLine{00263\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Buffer}{buffer\_t}}\ buffer(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}});}
\DoxyCodeLine{00264\ \ \ \ \ buffer.clear();}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}}\ =\ 0;}
\DoxyCodeLine{00267\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint64\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}}\ =\ 0;}
\DoxyCodeLine{00268\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{last}}\ =\ m\_first\_cluster;}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{comment}{//\ Read\ the\ file}}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{last}};}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}\ !=\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}})\ ClusterState::END\_OF\_CHAIN;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}\ =\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a12b7e165dde3e75b98bd43835e5cf96a}{next\_cluster}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}))\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{last}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}};}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ cluster\ to\ read\ from\ (blank\ file)}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}\ ==\ 0)}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ clusters\ before\ the\ offset}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}}\ +\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}})\ <\ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}})\ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}};}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ each\ sector\ in\ the\ cluster\ (prevent\ overwriting\ the\ data)}}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{filesystem_8h_af466a9d32fd2bf17acb2efa91031ded0}{lba\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lba}}\ =\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_aba48c72b1770313b4b4a9a01af962008}{data\_lba}}\ +\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster}}\ -\/\ 2)\ *\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.sectors\_per\_cluster;}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}\ =\ 0;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}\ <\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.sectors\_per\_cluster;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}++)}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a5d5ea78e0213ece71259dc171b3bd239}{disk}}-\/>\mbox{\hyperlink{classMaxOS_1_1drivers_1_1disk_1_1Disk_a9fa1c1952cece4f322ba0f2552f16c24}{read}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lba}}\ +\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}},\ \&buffer,\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.bytes\_per\_sector);}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ buffer.set\_offset(0);}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ offset\ is\ in\ the\ middle\ of\ the\ cluster}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_offset}}\ =\ 0;}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}}\ >\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}})}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_offset}}\ =\ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}}\ -\/\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}};}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ how\ many\ bytes\ are\ being\ copied\ (read\ from\ cluster\ at\ offset?}}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ or\ read\ part\ of\ cluster?)}}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster\_remaining\_bytes}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}}\ -\/\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_offset}};}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{data\_remaining\_bytes}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{amount}}\ -\/\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}};}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}}\ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster\_remaining\_bytes}}\ <\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{data\_remaining\_bytes}})\ ?\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{cluster\_remaining\_bytes}}}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{data\_remaining\_bytes}};}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}}\ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}}\ >\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}})\ ?\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}}\ :\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}};}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ the\ data}}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ buffer.copy\_from(data,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}},\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_offset}},\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}});}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}};}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}};}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ buffer.set\_offset(0);}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Write\ the\ data\ back\ to\ the\ disk}}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}\ =\ 0;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}\ <\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.sectors\_per\_cluster;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}++)}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a5d5ea78e0213ece71259dc171b3bd239}{disk}}-\/>\mbox{\hyperlink{classMaxOS_1_1drivers_1_1disk_1_1Disk_a849c586fbc52b1994c282492addc4772}{write}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lba}}\ +\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}},\ \&buffer,\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.bytes\_per\_sector);}
\DoxyCodeLine{00313\ \ \ \ \ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{comment}{//\ Extend\ the\ file}}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}}\ <\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{amount}})\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Allocate\ a\ new\ cluster}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{uint32\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{new\_cluster}}\ =\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a2ad6d0cd23155bcee69a6c712edd3d5e}{allocate\_cluster}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{last}});}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{new\_cluster}}\ ==\ 0)}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{last}}\ ==\ 0)}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ m\_first\_cluster\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{new\_cluster}};}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ the\ data}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}}\ =\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{amount}}\ -\/\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}})\ >\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}}\ ?\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{buffer\_space}}\ :\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{amount}}\ -\/\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}});}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ buffer.copy\_from(data,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}},\ 0,\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}});}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}};}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{current\_offset}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_to\_copy}};}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ buffer.set\_offset(0);}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Write\ the\ data\ back\ to\ the\ disk}}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{filesystem_8h_af466a9d32fd2bf17acb2efa91031ded0}{lba\_t}}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lba}}\ =\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_aba48c72b1770313b4b4a9a01af962008}{data\_lba}}\ +\ (\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{new\_cluster}}\ -\/\ 2)\ *\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.sectors\_per\_cluster;}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}\ =\ 0;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}\ <\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.sectors\_per\_cluster;\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}}++)}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a5d5ea78e0213ece71259dc171b3bd239}{disk}}-\/>\mbox{\hyperlink{classMaxOS_1_1drivers_1_1disk_1_1Disk_a849c586fbc52b1994c282492addc4772}{write}}(\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{lba}}\ +\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{sector}},\ \&buffer,\ m\_volume-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Volume_a88fa8cf8322df1bc922905e66d5569f4}{bpb}}.bytes\_per\_sector);}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Go\ to\ the\ next\ cluster}}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{last}}\ =\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{new\_cluster}};}
\DoxyCodeLine{00339\ \ \ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{comment}{//\ Update\ file\ size}}
\DoxyCodeLine{00342\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}}\ +=\ \mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{bytes\_written}};}
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}}\ >\ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_a2ea111d653133dd808f65809c969358f}{m\_size}})}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_a2ea111d653133dd808f65809c969358f}{m\_size}}\ =\ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_ad49f67cc5e79f5fa95d68a381843cec5}{m\_offset}};}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ Update\ entry\ info}}
\DoxyCodeLine{00347\ \ \ \ \ m\_entry-\/>size\ =\ \mbox{\hyperlink{classMaxOS_1_1filesystem_1_1File_a2ea111d653133dd808f65809c969358f}{m\_size}};}
\DoxyCodeLine{00348\ \ \ \ \ m\_entry-\/>first\_cluster\_high\ =\ (m\_first\_cluster\ >>\ 16)\ \&\ 0xFFFF;}
\DoxyCodeLine{00349\ \ \ \ \ m\_entry-\/>first\_cluster\_low\ =\ m\_first\_cluster\ \&\ 0xFFFF;}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \ \ m\_parent\_directory-\/>\mbox{\hyperlink{classMaxOS_1_1filesystem_1_1format_1_1Fat32Directory_af6a79f3a013a04d730d409bf317c2da4}{save\_entry\_to\_disk}}(m\_entry);}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{fat32_8cpp_source_l00141}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Volume\+::allocate\+\_\+cluster()}}, \mbox{\hyperlink{fat32_8h_source_l00176}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Volume\+::bpb}}, \mbox{\hyperlink{buffer_8cpp_source_l00065}{Max\+OS\+::common\+::\+Buffer\+::clear()}}, \mbox{\hyperlink{buffer_8cpp_source_l00195}{Max\+OS\+::common\+::\+Buffer\+::copy\+\_\+from()}}, \mbox{\hyperlink{fat32_8h_source_l00184}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Volume\+::data\+\_\+lba}}, \mbox{\hyperlink{fat32_8h_source_l00187}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Volume\+::disk}}, \mbox{\hyperlink{filesystem_8h_source_l00034}{Max\+OS\+::filesystem\+::\+File\+::m\+\_\+offset}}, \mbox{\hyperlink{filesystem_8h_source_l00036}{Max\+OS\+::filesystem\+::\+File\+::m\+\_\+size}}, \mbox{\hyperlink{fat32_8cpp_source_l00065}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Volume\+::next\+\_\+cluster()}}, \mbox{\hyperlink{disk_8cpp_source_l00026}{Max\+OS\+::drivers\+::disk\+::\+Disk\+::read()}}, \mbox{\hyperlink{fat32_8cpp_source_l00589}{Max\+OS\+::filesystem\+::format\+::\+Fat32\+Directory\+::save\+\_\+entry\+\_\+to\+\_\+disk()}}, \mbox{\hyperlink{buffer_8cpp_source_l00128}{Max\+OS\+::common\+::\+Buffer\+::set\+\_\+offset()}}, and \mbox{\hyperlink{disk_8cpp_source_l00050}{Max\+OS\+::drivers\+::disk\+::\+Disk\+::write()}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Max\+OS/\+Max\+OS/kernel/include/filesystem/format/\mbox{\hyperlink{fat32_8h}{fat32.\+h}}\item 
/home/runner/work/\+Max\+OS/\+Max\+OS/kernel/src/filesystem/format/\mbox{\hyperlink{fat32_8cpp}{fat32.\+cpp}}\end{DoxyCompactItemize}
