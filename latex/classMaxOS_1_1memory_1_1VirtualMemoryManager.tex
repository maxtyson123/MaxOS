\hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager}{}\doxysection{Max\+OS\+::memory\+::Virtual\+Memory\+Manager Class Reference}
\label{classMaxOS_1_1memory_1_1VirtualMemoryManager}\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}


{\ttfamily \#include $<$virtual.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a89f26f978695bfe043afd51b4388b323}{Virtual\+Memory\+Manager}} (bool is\+\_\+kernel)
\item 
\mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a77e2717ead1bd12e12da9c824b0c7921}{$\sim$\+Virtual\+Memory\+Manager}} ()
\item 
void $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a433396979e1b088454eefbce0964b709}{allocate}} (size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Allocate a new chunk of virtual memory. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a4c1a63b53f6acbba12095a1a13fc0ecf}{allocate}} (uint64\+\_\+t \mbox{\hyperlink{gdt_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}}, size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Allocate a new chunk of virtual memory at a specific address (ie for mmap io devices) \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a96b3efdb246def1b85d311a61e401af6}{free}} (void $\ast$\mbox{\hyperlink{gdt_8h_ab6b52376c1b9d81e6ea6f95a1225f832}{address}})
\begin{DoxyCompactList}\small\item\em Free a chunk of virtual memory. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a2e0c30587858d4cfaad1cf6fc0fe75e7}{load\+\_\+physical\+\_\+into\+\_\+address\+\_\+space}} (uintptr\+\_\+t \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\+\_\+address}}, size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, size\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}})
\begin{DoxyCompactList}\small\item\em Load physical memory into the V\+MM\textquotesingle{}s address space. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a72b37f7562ad7124879790a22e81004a}{load\+\_\+shared\+\_\+memory}} (\mbox{\hyperlink{namespaceMaxOS_afa22b691550d34d82dd6a5e3f77b31cb}{string}} \mbox{\hyperlink{fat32_8h_abfa8a0ef7b1321866a7c4099554fdfb0}{name}})
\begin{DoxyCompactList}\small\item\em Load shared memory into the V\+MM\textquotesingle{}s address space. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a3c0629ad1bc52a1263e23974845f45b3}{load\+\_\+shared\+\_\+memory}} (uintptr\+\_\+t \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\+\_\+address}}, size\+\_\+t \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}})
\begin{DoxyCompactList}\small\item\em Load shared memory into the V\+MM\textquotesingle{}s address space. \end{DoxyCompactList}\item 
uint64\+\_\+t $\ast$ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_ade54deeabc206c039877770118c4288a}{get\+\_\+pml4\+\_\+root\+\_\+address\+\_\+physical}} ()
\begin{DoxyCompactList}\small\item\em Get the physical address of the P\+M\+L4 root. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a4ae320422dd476cfbf63d810fc725bd5}{memory\+\_\+used}} ()
\begin{DoxyCompactList}\small\item\em Returns the amount of memory used. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 45 of file virtual.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_a89f26f978695bfe043afd51b4388b323}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_a89f26f978695bfe043afd51b4388b323}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!VirtualMemoryManager@{VirtualMemoryManager}}
\index{VirtualMemoryManager@{VirtualMemoryManager}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{VirtualMemoryManager()}{VirtualMemoryManager()}}
{\footnotesize\ttfamily Virtual\+Memory\+Manager\+::\+Virtual\+Memory\+Manager (\begin{DoxyParamCaption}\item[{bool}]{is\+\_\+kernel }\end{DoxyParamCaption})}



Definition at line 13 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{14 : m\_physical\_memory\_manager(\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a1d6ffacb7290c01505c3dec9f9cfd3f1}{PhysicalMemoryManager::s\_current\_manager}}),    \textcolor{comment}{//Todo: dont need to store this as its a static?}}
\DoxyCodeLine{15   m\_is\_kernel(is\_kernel)}
\DoxyCodeLine{16 \{}
\DoxyCodeLine{17 }
\DoxyCodeLine{18     \textcolor{comment}{// If not the kernel, we need to allocate a new PML4 table  TODO: Might not need a variable? Check if there isnt a kernel one and just assume it is the kernel one}}
\DoxyCodeLine{19     \textcolor{keywordflow}{if}(!m\_is\_kernel)\{}
\DoxyCodeLine{20 }
\DoxyCodeLine{21       \textcolor{comment}{// Get a new pml4 table}}
\DoxyCodeLine{22       m\_pml4\_root\_physical\_address = (uint64\_t*)m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}{allocate\_frame}}();}
\DoxyCodeLine{23       m\_pml4\_root\_address = (uint64\_t*)\mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_ab093d27663b4911c7995f36945ccd1e9}{MemoryManager::to\_dm\_region}}((uint64\_t)m\_pml4\_root\_physical\_address);}
\DoxyCodeLine{24 }
\DoxyCodeLine{25       \textcolor{comment}{// Clear the table}}
\DoxyCodeLine{26       m\_physical\_memory\_manager -\/> clean\_page\_table(m\_pml4\_root\_address);}
\DoxyCodeLine{27 }
\DoxyCodeLine{28       \textcolor{comment}{// Map the higher half of the kernel (p4 256 -\/ 511)}}
\DoxyCodeLine{29       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 256; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < 512; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++)\{}
\DoxyCodeLine{30 }
\DoxyCodeLine{31         \textcolor{comment}{// Recursive Map the pml4 table (so that we can access the new pml4 table later on)}}
\DoxyCodeLine{32         \textcolor{keywordflow}{if}(\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} == 510) \{}
\DoxyCodeLine{33           m\_pml4\_root\_address[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}] = (uint64\_t)m\_pml4\_root\_physical\_address | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}};}
\DoxyCodeLine{34           \textcolor{keywordflow}{continue};}
\DoxyCodeLine{35         \}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37         \textcolor{comment}{// Set the new pml4 table to the old (kernel) pml4 table}}
\DoxyCodeLine{38         m\_pml4\_root\_address[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}] = m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ac54f576d801ed62713b84ae64d83fb64}{get\_pml4\_root\_address}}()[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}];}
\DoxyCodeLine{39 }
\DoxyCodeLine{40       \}}
\DoxyCodeLine{41       \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Mapped higher half of kernel\(\backslash\)n"});}
\DoxyCodeLine{42 }
\DoxyCodeLine{43 }
\DoxyCodeLine{44 }
\DoxyCodeLine{45     \}\textcolor{keywordflow}{else}\{}
\DoxyCodeLine{46       m\_pml4\_root\_address = m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ac54f576d801ed62713b84ae64d83fb64}{get\_pml4\_root\_address}}();}
\DoxyCodeLine{47       m\_pml4\_root\_physical\_address = (uint64\_t*)\mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_a3cd0e4168f302070311c1896f22d08f8}{MemoryManager::to\_lower\_region}}((uint64\_t)m\_pml4\_root\_address);}
\DoxyCodeLine{48     \};}
\DoxyCodeLine{49 }
\DoxyCodeLine{50     \textcolor{comment}{// Log the VMM's PML4 address}}
\DoxyCodeLine{51     \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"VMM PML4: physical -\/ 0x\%x, virtual -\/ 0x\%x\(\backslash\)n"}, m\_pml4\_root\_physical\_address, m\_pml4\_root\_address);}
\DoxyCodeLine{52 }
\DoxyCodeLine{53     \textcolor{comment}{// Space to store VMM chunks}}
\DoxyCodeLine{54     uint64\_t vmm\_space = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a5caa4d8e8944cd72c5a01635b056be9c}{PhysicalMemoryManager::align\_to\_page}}(\mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_a25fe2fa3e01b0a9593cede08126095bf}{MemoryManager::s\_hh\_direct\_map\_offset}} + m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a0bd4c0766bc4c3930920814f2f7de1c5}{get\_memory\_size}}() + \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{PhysicalMemoryManager::s\_page\_size}});}
\DoxyCodeLine{55     m\_first\_region = (virtual\_memory\_region\_t*)vmm\_space;}
\DoxyCodeLine{56     m\_current\_region = m\_first\_region;}
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \textcolor{comment}{// Allocate space for the vmm}}
\DoxyCodeLine{59     \textcolor{keywordtype}{void}* vmm\_space\_physical = m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}{allocate\_frame}}();}
\DoxyCodeLine{60     \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(vmm\_space\_physical != \textcolor{keyword}{nullptr}, \textcolor{stringliteral}{"Failed to allocate VMM space\(\backslash\)n"});}
\DoxyCodeLine{61     m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(vmm\_space\_physical, (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}}*)vmm\_space, \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}}, m\_pml4\_root\_address);}
\DoxyCodeLine{62     m\_first\_region-\/>next = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{63     \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Allocated VMM: physical: 0x\%x, virtual: 0x\%x\(\backslash\)n"}, vmm\_space\_physical, vmm\_space);}
\DoxyCodeLine{64     \textcolor{keywordflow}{if}(!m\_is\_kernel)}
\DoxyCodeLine{65       \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(vmm\_space\_physical != m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af43b96063c89e26eecb6aa9c8e46f4fb}{get\_physical\_address}}((\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}}*)vmm\_space, m\_pml4\_root\_address), \textcolor{stringliteral}{"Physical address does not match mapped address: 0x\%x != 0x\%x\(\backslash\)n"}, vmm\_space\_physical, m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af43b96063c89e26eecb6aa9c8e46f4fb}{get\_physical\_address}}((\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}}*)vmm\_space, m\_pml4\_root\_address));}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     \textcolor{comment}{// Calculate the next available address}}
\DoxyCodeLine{68     m\_next\_available\_address = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{PhysicalMemoryManager::s\_page\_size}};}
\DoxyCodeLine{69     \textcolor{keywordflow}{if}(m\_is\_kernel)\{}
\DoxyCodeLine{70 }
\DoxyCodeLine{71       \textcolor{comment}{// Kernel needs to start at the higher half}}
\DoxyCodeLine{72       m\_next\_available\_address += vmm\_space + s\_reserved\_space;}
\DoxyCodeLine{73 }
\DoxyCodeLine{74     \}}
\DoxyCodeLine{75     \mbox{\hyperlink{kprint_8h_ad0dbdc0814f8a967875ad592df02a663}{\_kprintf}}(\textcolor{stringliteral}{"Next available address: 0x\%x\(\backslash\)n"}, m\_next\_available\_address);}
\DoxyCodeLine{76 }
\DoxyCodeLine{77 }
\DoxyCodeLine{78 \}}

\end{DoxyCode}


References \+\_\+kprintf, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::align\+\_\+to\+\_\+page(), Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::allocate\+\_\+frame(), A\+S\+S\+E\+RT, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::get\+\_\+memory\+\_\+size(), Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::get\+\_\+physical\+\_\+address(), Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::get\+\_\+pml4\+\_\+root\+\_\+address(), Max\+O\+S\+::drivers\+::peripherals\+::i, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::map(), Max\+O\+S\+::memory\+::\+Present, Max\+O\+S\+::memory\+::\+Memory\+Manager\+::s\+\_\+hh\+\_\+direct\+\_\+map\+\_\+offset, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::s\+\_\+page\+\_\+size, Max\+O\+S\+::memory\+::\+Memory\+Manager\+::to\+\_\+dm\+\_\+region(), Max\+O\+S\+::memory\+::\+Memory\+Manager\+::to\+\_\+lower\+\_\+region(), and Max\+O\+S\+::memory\+::\+Write.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_a77e2717ead1bd12e12da9c824b0c7921}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_a77e2717ead1bd12e12da9c824b0c7921}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!````~VirtualMemoryManager@{$\sim$VirtualMemoryManager}}
\index{````~VirtualMemoryManager@{$\sim$VirtualMemoryManager}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{$\sim$VirtualMemoryManager()}{~VirtualMemoryManager()}}
{\footnotesize\ttfamily Virtual\+Memory\+Manager\+::$\sim$\+Virtual\+Memory\+Manager (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 80 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{80                                             \{}
\DoxyCodeLine{81 }
\DoxyCodeLine{82   \textcolor{comment}{// Free all the frames used by the VMM}}
\DoxyCodeLine{83   virtual\_memory\_region\_t* region = m\_first\_region;}
\DoxyCodeLine{84 }
\DoxyCodeLine{85   \textcolor{comment}{// Loop through the regions}}
\DoxyCodeLine{86   \textcolor{keywordflow}{while}(region != \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{87 }
\DoxyCodeLine{88     \textcolor{comment}{// Loop through the chunks}}
\DoxyCodeLine{89     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < s\_chunks\_per\_page; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++)\{}
\DoxyCodeLine{90 }
\DoxyCodeLine{91         \textcolor{comment}{// Loop through the pages}}
\DoxyCodeLine{92         \textcolor{keywordtype}{size\_t} pages = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{PhysicalMemoryManager::size\_to\_frames}}(region-\/>chunks[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}].size);}
\DoxyCodeLine{93         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca69abb821b2faaa50a438714c8a237cf0}{j}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca69abb821b2faaa50a438714c8a237cf0}{j}} < pages; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca69abb821b2faaa50a438714c8a237cf0}{j}}++)\{}
\DoxyCodeLine{94 }
\DoxyCodeLine{95               \textcolor{comment}{// Get the frame}}
\DoxyCodeLine{96               \mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}}* frame = m\_physical\_memory\_manager -\/> get\_physical\_address((\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}}*)region-\/>chunks[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}].start\_address + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebca69abb821b2faaa50a438714c8a237cf0}{j}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{PhysicalMemoryManager::s\_page\_size}}), m\_pml4\_root\_address);}
\DoxyCodeLine{97 }
\DoxyCodeLine{98               \textcolor{comment}{// Free the frame}}
\DoxyCodeLine{99               m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_af0b6a43f9b559575ece938d3918fc3a1}{free\_frame}}(frame);}
\DoxyCodeLine{100 }
\DoxyCodeLine{101         \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{103     \}}
\DoxyCodeLine{104 }
\DoxyCodeLine{105     \textcolor{comment}{// Move to the next region}}
\DoxyCodeLine{106     region = region-\/>next;}
\DoxyCodeLine{107 }
\DoxyCodeLine{108   \}}
\DoxyCodeLine{109 }
\DoxyCodeLine{110 \}}

\end{DoxyCode}


References Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::free\+\_\+frame(), Max\+O\+S\+::drivers\+::peripherals\+::i, Max\+O\+S\+::drivers\+::peripherals\+::j, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::s\+\_\+page\+\_\+size, and Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::size\+\_\+to\+\_\+frames().



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_a433396979e1b088454eefbce0964b709}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_a433396979e1b088454eefbce0964b709}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!allocate@{allocate}}
\index{allocate@{allocate}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{allocate()}{allocate()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void $\ast$ Virtual\+Memory\+Manager\+::allocate (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Allocate a new chunk of virtual memory. 


\begin{DoxyParams}{Parameters}
{\em size} & The size of the memory to allocate \\
\hline
{\em flags} & The flags to set on the memory \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The address of the allocated memory 
\end{DoxyReturn}


Definition at line 119 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{119                                                               \{}
\DoxyCodeLine{120 }
\DoxyCodeLine{121   \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a433396979e1b088454eefbce0964b709}{allocate}}(0, \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{122 \}}

\end{DoxyCode}


References flags, and size.



Referenced by load\+\_\+physical\+\_\+into\+\_\+address\+\_\+space(), and Max\+O\+S\+::memory\+::\+Memory\+Manager\+::\+Memory\+Manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_a4c1a63b53f6acbba12095a1a13fc0ecf}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_a4c1a63b53f6acbba12095a1a13fc0ecf}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!allocate@{allocate}}
\index{allocate@{allocate}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{allocate()}{allocate()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void $\ast$ Virtual\+Memory\+Manager\+::allocate (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{address,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Allocate a new chunk of virtual memory at a specific address (ie for mmap io devices) 


\begin{DoxyParams}{Parameters}
{\em address} & The address to allocate at \\
\hline
{\em size} & The size of the memory to allocate \\
\hline
{\em flags} & The flags to set on the memory \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The address of the allocated memory or nullptr if failed 
\end{DoxyReturn}


Definition at line 132 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{132                                                                                 \{}
\DoxyCodeLine{133 }
\DoxyCodeLine{134   \textcolor{comment}{// Make sure allocating something}}
\DoxyCodeLine{135   \textcolor{keywordflow}{if}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} == 0)}
\DoxyCodeLine{136     \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{137 }
\DoxyCodeLine{138   \textcolor{comment}{// If specific address is given}}
\DoxyCodeLine{139   \textcolor{keywordflow}{if}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} != 0)\{}
\DoxyCodeLine{140 }
\DoxyCodeLine{141       \textcolor{comment}{// Make sure isn't already allocated}}
\DoxyCodeLine{142       \textcolor{keywordflow}{if}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} < m\_next\_available\_address)}
\DoxyCodeLine{143         \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{144 }
\DoxyCodeLine{145       \textcolor{comment}{// Make sure its aligned}}
\DoxyCodeLine{146       \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_aa7f389d1b15d109bd5669d0475ebc912}{PhysicalMemoryManager::check\_aligned}}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}}))}
\DoxyCodeLine{147         \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{148 }
\DoxyCodeLine{149   \}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151   \textcolor{comment}{// Make sure the size is aligned}}
\DoxyCodeLine{152   \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ab9f9868ea17c935bf249e47371e97fb5}{PhysicalMemoryManager::align\_up\_to\_page}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{PhysicalMemoryManager::s\_page\_size}});}
\DoxyCodeLine{153 }
\DoxyCodeLine{154   \textcolor{comment}{// Check the free list for a chunk}}
\DoxyCodeLine{155   \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{free\_chunk\_t}}* reusable\_chunk = find\_and\_remove\_free\_chunk(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{156   \textcolor{keywordflow}{if}(reusable\_chunk != \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{157 }
\DoxyCodeLine{158     \textcolor{comment}{// If the chunk is not being reserved}}
\DoxyCodeLine{159     \textcolor{keywordflow}{if}(!(\mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}} \& \mbox{\hyperlink{namespaceMaxOS_1_1memory_a12ca8e10f17e52d8375319daaaf6f380a5379a330d2ed6de35d3e88ff46a14731}{Reserve}}))\{}
\DoxyCodeLine{160 }
\DoxyCodeLine{161       \textcolor{comment}{// Map the memory}}
\DoxyCodeLine{162       \textcolor{keywordtype}{size\_t} pages = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{PhysicalMemoryManager::size\_to\_frames}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{163       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < pages; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++)\{}
\DoxyCodeLine{164 }
\DoxyCodeLine{165         \textcolor{comment}{// Allocate a new frame}}
\DoxyCodeLine{166         \mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}}* frame = m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}{allocate\_frame}}();}
\DoxyCodeLine{167         \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(frame != \textcolor{keyword}{nullptr}, \textcolor{stringliteral}{"Failed to allocate frame (from free chunk list)\(\backslash\)n"});}
\DoxyCodeLine{168 }
\DoxyCodeLine{169         \textcolor{comment}{// Map the frame}}
\DoxyCodeLine{170         m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(frame, (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}}*)reusable\_chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af4ea572cd555fa81cc1331663a88481f}{start\_address}} + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{PhysicalMemoryManager::s\_page\_size}}), \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}}, m\_pml4\_root\_address);}
\DoxyCodeLine{171 }
\DoxyCodeLine{172       \}}
\DoxyCodeLine{173 }
\DoxyCodeLine{174     \}}
\DoxyCodeLine{175 }
\DoxyCodeLine{176     \textcolor{comment}{// Return the address}}
\DoxyCodeLine{177     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void}*)reusable\_chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af4ea572cd555fa81cc1331663a88481f}{start\_address}};}
\DoxyCodeLine{178 }
\DoxyCodeLine{179   \}}
\DoxyCodeLine{180 }
\DoxyCodeLine{181 }
\DoxyCodeLine{182   \textcolor{comment}{// Is there space in the current region}}
\DoxyCodeLine{183   \textcolor{keywordflow}{if}(m\_current\_chunk >= s\_chunks\_per\_page)}
\DoxyCodeLine{184     new\_region();}
\DoxyCodeLine{185 }
\DoxyCodeLine{186   \textcolor{comment}{// If we need to allocate at a specific address}}
\DoxyCodeLine{187   \textcolor{keywordflow}{if}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} != 0)\{}
\DoxyCodeLine{188     m\_next\_available\_address = \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}};    \textcolor{comment}{//TODO: Creates mem fragmentation -\/ fix}}
\DoxyCodeLine{189   \}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191   \textcolor{comment}{// Allocate the memory}}
\DoxyCodeLine{192   \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{virtual\_memory\_chunk\_t}}* chunk = \&m\_current\_region-\/>chunks[m\_current\_chunk];}
\DoxyCodeLine{193   chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa801ec740419740a3d9576bcdf821930}{size}} = \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}};}
\DoxyCodeLine{194   chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_a3197fff13af0c0c20e83ad26c4e5d6f6}{flags}} = \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}};}
\DoxyCodeLine{195   chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{start\_address}} = m\_next\_available\_address;}
\DoxyCodeLine{196 }
\DoxyCodeLine{197   \textcolor{comment}{// Update the next available address}}
\DoxyCodeLine{198   m\_next\_available\_address += \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}};}
\DoxyCodeLine{199   m\_current\_chunk++;}
\DoxyCodeLine{200 }
\DoxyCodeLine{201   \textcolor{comment}{// If just reserving the space don't map it}}
\DoxyCodeLine{202   \textcolor{keywordflow}{if}(\mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}} \& \mbox{\hyperlink{namespaceMaxOS_1_1memory_a12ca8e10f17e52d8375319daaaf6f380a5379a330d2ed6de35d3e88ff46a14731}{Reserve}})}
\DoxyCodeLine{203     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void}*)chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{start\_address}};}
\DoxyCodeLine{204 }
\DoxyCodeLine{205   \textcolor{comment}{// Map the memory}}
\DoxyCodeLine{206   \textcolor{keywordtype}{size\_t} pages = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{PhysicalMemoryManager::size\_to\_frames}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{207   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < pages; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++)\{}
\DoxyCodeLine{208 }
\DoxyCodeLine{209     \textcolor{comment}{// Allocate a new frame}}
\DoxyCodeLine{210     \mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}}* frame = m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afbe57cbd6b31ef26b53176f0fd0fc8fe}{allocate\_frame}}();}
\DoxyCodeLine{211     \mbox{\hyperlink{kprint_8h_adf7b5d69e4c25995b3211b91b27f33b6}{ASSERT}}(frame != \textcolor{keyword}{nullptr}, \textcolor{stringliteral}{"Failed to allocate frame (from current region)\(\backslash\)n"});}
\DoxyCodeLine{212 }
\DoxyCodeLine{213     \textcolor{comment}{// Map the frame}}
\DoxyCodeLine{214     m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}(frame, (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}}*)chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{start\_address}} + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{PhysicalMemoryManager::s\_page\_size}}), \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}}, m\_pml4\_root\_address);}
\DoxyCodeLine{215 }
\DoxyCodeLine{216   \}}
\DoxyCodeLine{217 }
\DoxyCodeLine{218   \textcolor{comment}{// Return the address}}
\DoxyCodeLine{219   \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void}*)chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{start\_address}};}
\DoxyCodeLine{220 \}}

\end{DoxyCode}


References address, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::align\+\_\+up\+\_\+to\+\_\+page(), Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::allocate\+\_\+frame(), A\+S\+S\+E\+RT, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::check\+\_\+aligned(), flags, Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Chunk\+::flags, Max\+O\+S\+::drivers\+::peripherals\+::i, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::map(), Max\+O\+S\+::memory\+::\+Present, Max\+O\+S\+::memory\+::\+Reserve, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::s\+\_\+page\+\_\+size, size, Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Chunk\+::size, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::size\+\_\+to\+\_\+frames(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Chunk\+::start\+\_\+address, Max\+O\+S\+::memory\+::\+Free\+Chunk\+::start\+\_\+address, and Max\+O\+S\+::memory\+::\+Write.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_a96b3efdb246def1b85d311a61e401af6}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_a96b3efdb246def1b85d311a61e401af6}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!free@{free}}
\index{free@{free}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{free()}{free()}}
{\footnotesize\ttfamily void Virtual\+Memory\+Manager\+::free (\begin{DoxyParamCaption}\item[{void $\ast$}]{address }\end{DoxyParamCaption})}



Free a chunk of virtual memory. 


\begin{DoxyParams}{Parameters}
{\em address} & The address of the memory to free \\
\hline
\end{DoxyParams}


Definition at line 249 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{249                                              \{}
\DoxyCodeLine{250 }
\DoxyCodeLine{251   \textcolor{comment}{// Make sure freeing something}}
\DoxyCodeLine{252   \textcolor{keywordflow}{if}(\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{253     \textcolor{keywordflow}{return};}
\DoxyCodeLine{254 }
\DoxyCodeLine{255   \textcolor{comment}{// Find the chunk}}
\DoxyCodeLine{256   virtual\_memory\_region\_t* region = m\_first\_region;}
\DoxyCodeLine{257   \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{virtual\_memory\_chunk\_t}}* chunk = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{258   \textcolor{keywordflow}{while}(region != \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{259 }
\DoxyCodeLine{260       \textcolor{comment}{// Loop through the chunks}}
\DoxyCodeLine{261       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < s\_chunks\_per\_page; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++)\{}
\DoxyCodeLine{262 }
\DoxyCodeLine{263         \textcolor{comment}{// Check if the address is in the chunk}}
\DoxyCodeLine{264         \textcolor{keywordflow}{if}(region-\/>chunks[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}].start\_address == (uintptr\_t)\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}})\{}
\DoxyCodeLine{265               chunk = \&region-\/>chunks[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}];}
\DoxyCodeLine{266               \textcolor{keywordflow}{break};}
\DoxyCodeLine{267         \}}
\DoxyCodeLine{268       \}}
\DoxyCodeLine{269 }
\DoxyCodeLine{270       \textcolor{comment}{// If the chunk was found}}
\DoxyCodeLine{271       \textcolor{keywordflow}{if}(chunk != \textcolor{keyword}{nullptr})}
\DoxyCodeLine{272         \textcolor{keywordflow}{break};}
\DoxyCodeLine{273 }
\DoxyCodeLine{274       \textcolor{comment}{// Move to the next region}}
\DoxyCodeLine{275       region = region-\/>next;}
\DoxyCodeLine{276   \}}
\DoxyCodeLine{277 }
\DoxyCodeLine{278   \textcolor{comment}{// Make sure the chunk was found}}
\DoxyCodeLine{279   \textcolor{keywordflow}{if}(chunk == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{280     \textcolor{keywordflow}{return};}
\DoxyCodeLine{281 }
\DoxyCodeLine{282   \textcolor{comment}{// If the chunk is shared, dont unmap it incase other processes are using it}}
\DoxyCodeLine{283   \textcolor{keywordflow}{if}(chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_a3197fff13af0c0c20e83ad26c4e5d6f6}{flags}} \& \mbox{\hyperlink{namespaceMaxOS_1_1memory_a12ca8e10f17e52d8375319daaaf6f380ae460bd3f004b1f64b4a2a6548b7fdefe}{Shared}})\{}
\DoxyCodeLine{284 }
\DoxyCodeLine{285     \textcolor{comment}{// Let the IPC handle the shared memory}}
\DoxyCodeLine{286     Scheduler::get\_ipc()-\/>free\_shared\_memory((uintptr\_t)\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}});}
\DoxyCodeLine{287 }
\DoxyCodeLine{288   \}}
\DoxyCodeLine{289 }
\DoxyCodeLine{290   \textcolor{comment}{// Unmap the memory}}
\DoxyCodeLine{291   \textcolor{keywordtype}{size\_t} pages = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{PhysicalMemoryManager::size\_to\_frames}}(chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa801ec740419740a3d9576bcdf821930}{size}});}
\DoxyCodeLine{292   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < pages; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++)\{}
\DoxyCodeLine{293 }
\DoxyCodeLine{294         \textcolor{comment}{// Unmap the frame}}
\DoxyCodeLine{295         m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a47cc8d6c823f3c323f88e21437ba88ea}{unmap}}((\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}}*)chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{start\_address}} + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{PhysicalMemoryManager::s\_page\_size}}), m\_pml4\_root\_address);}
\DoxyCodeLine{296 }
\DoxyCodeLine{297   \}}
\DoxyCodeLine{298 }
\DoxyCodeLine{299   \textcolor{comment}{// Add the chunk to the free list}}
\DoxyCodeLine{300   add\_free\_chunk(chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{start\_address}}, chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa801ec740419740a3d9576bcdf821930}{size}});}
\DoxyCodeLine{301 }
\DoxyCodeLine{302   \textcolor{comment}{// Clear the chunk}}
\DoxyCodeLine{303   chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa801ec740419740a3d9576bcdf821930}{size}} = 0;}
\DoxyCodeLine{304   chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_a3197fff13af0c0c20e83ad26c4e5d6f6}{flags}} = 0;}
\DoxyCodeLine{305   chunk-\/>\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{start\_address}} = 0;}
\DoxyCodeLine{306 \}}

\end{DoxyCode}


References address, Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Chunk\+::flags, Max\+O\+S\+::drivers\+::peripherals\+::i, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::s\+\_\+page\+\_\+size, Max\+O\+S\+::memory\+::\+Shared, Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Chunk\+::size, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::size\+\_\+to\+\_\+frames(), Max\+O\+S\+::memory\+::\+Virtual\+Memory\+Chunk\+::start\+\_\+address, and Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::unmap().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_ade54deeabc206c039877770118c4288a}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_ade54deeabc206c039877770118c4288a}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!get\_pml4\_root\_address\_physical@{get\_pml4\_root\_address\_physical}}
\index{get\_pml4\_root\_address\_physical@{get\_pml4\_root\_address\_physical}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{get\_pml4\_root\_address\_physical()}{get\_pml4\_root\_address\_physical()}}
{\footnotesize\ttfamily uint64\+\_\+t $\ast$ Virtual\+Memory\+Manager\+::get\+\_\+pml4\+\_\+root\+\_\+address\+\_\+physical (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Get the physical address of the P\+M\+L4 root. 

\begin{DoxyReturn}{Returns}
The physical address of the P\+M\+L4 root 
\end{DoxyReturn}


Definition at line 395 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{395                                                                \{}
\DoxyCodeLine{396     \textcolor{keywordflow}{return} m\_pml4\_root\_physical\_address;}
\DoxyCodeLine{397 \}}

\end{DoxyCode}


Referenced by Max\+O\+S\+::memory\+::\+Memory\+Manager\+::switch\+\_\+active\+\_\+memory\+\_\+manager().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_a2e0c30587858d4cfaad1cf6fc0fe75e7}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_a2e0c30587858d4cfaad1cf6fc0fe75e7}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!load\_physical\_into\_address\_space@{load\_physical\_into\_address\_space}}
\index{load\_physical\_into\_address\_space@{load\_physical\_into\_address\_space}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{load\_physical\_into\_address\_space()}{load\_physical\_into\_address\_space()}}
{\footnotesize\ttfamily void $\ast$ Virtual\+Memory\+Manager\+::load\+\_\+physical\+\_\+into\+\_\+address\+\_\+space (\begin{DoxyParamCaption}\item[{uintptr\+\_\+t}]{physical\+\_\+address,  }\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t}]{flags }\end{DoxyParamCaption})}



Load physical memory into the V\+MM\textquotesingle{}s address space. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address} & The physical address of the memory \\
\hline
{\em size} & The size of the memory \\
\hline
{\em flags} & The flags to set on the memory \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The address of the memory in the V\+MM\textquotesingle{}s address space 
\end{DoxyReturn}


Definition at line 440 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{440                                                                                                                  \{}
\DoxyCodeLine{441 }
\DoxyCodeLine{442   \textcolor{comment}{// Reserve some space}}
\DoxyCodeLine{443   \textcolor{keywordtype}{void}* \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} = \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a433396979e1b088454eefbce0964b709}{allocate}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_a12ca8e10f17e52d8375319daaaf6f380a5379a330d2ed6de35d3e88ff46a14731}{Reserve}});}
\DoxyCodeLine{444 }
\DoxyCodeLine{445   \textcolor{comment}{// Map the shared memory}}
\DoxyCodeLine{446   \textcolor{keywordtype}{size\_t} pages = \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_ad09e22d0fe86e952a3eb92718fcd3c32}{PhysicalMemoryManager::size\_to\_frames}}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}});}
\DoxyCodeLine{447   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < pages; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++)\{}
\DoxyCodeLine{448 }
\DoxyCodeLine{449     \textcolor{comment}{// Map the frame}}
\DoxyCodeLine{450     m\_physical\_memory\_manager-\/>\mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a732ea9bd93397bbddd596bee127ac8f3}{map}}((\mbox{\hyperlink{namespaceMaxOS_1_1memory_a86d1744b2aea4590cf02ef32ff8acc63}{physical\_address\_t}}*)(\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{PhysicalMemoryManager::s\_page\_size}})), (\mbox{\hyperlink{namespaceMaxOS_1_1memory_a1a4a2cf740017bbb681bbe110a18fdcb}{virtual\_address\_t}}*)((uintptr\_t)\mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}} + (\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} * \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_afe7fbedb30365ee050a210d4854a15b8}{PhysicalMemoryManager::s\_page\_size}})), \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84eba980a5bc5e6393398f4e52e1c27bdd382}{Present}} | \mbox{\hyperlink{namespaceMaxOS_1_1memory_ae0e83b5743a37b4d0d2a93bb3bbe84ebabc3cb78aef6a50841121fd08c2a49151}{Write}}, m\_pml4\_root\_address);}
\DoxyCodeLine{451 }
\DoxyCodeLine{452   \}}
\DoxyCodeLine{453 }
\DoxyCodeLine{454   \textcolor{comment}{// All done}}
\DoxyCodeLine{455   \textcolor{keywordflow}{return} \mbox{\hyperlink{amd__am79c973_8h_ac0d31ca829f934cccd89f8054e02773e}{address}};}
\DoxyCodeLine{456 \}}

\end{DoxyCode}


References address, allocate(), flags, Max\+O\+S\+::drivers\+::peripherals\+::i, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::map(), physical\+\_\+address, Max\+O\+S\+::memory\+::\+Present, Max\+O\+S\+::memory\+::\+Reserve, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::s\+\_\+page\+\_\+size, size, Max\+O\+S\+::memory\+::\+Physical\+Memory\+Manager\+::size\+\_\+to\+\_\+frames(), and Max\+O\+S\+::memory\+::\+Write.



Referenced by load\+\_\+shared\+\_\+memory().

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_a72b37f7562ad7124879790a22e81004a}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_a72b37f7562ad7124879790a22e81004a}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!load\_shared\_memory@{load\_shared\_memory}}
\index{load\_shared\_memory@{load\_shared\_memory}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{load\_shared\_memory()}{load\_shared\_memory()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void $\ast$ Virtual\+Memory\+Manager\+::load\+\_\+shared\+\_\+memory (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceMaxOS_afa22b691550d34d82dd6a5e3f77b31cb}{string}}}]{name }\end{DoxyParamCaption})}



Load shared memory into the V\+MM\textquotesingle{}s address space. 


\begin{DoxyParams}{Parameters}
{\em name} & The name of the shared memory \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The address of the shared memory in the V\+MM\textquotesingle{}s address space 
\end{DoxyReturn}


Definition at line 404 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{404                                                           \{}
\DoxyCodeLine{405 }
\DoxyCodeLine{406   \textcolor{comment}{// Get the shared memory block}}
\DoxyCodeLine{407   \mbox{\hyperlink{structMaxOS_1_1processes_1_1IPCSharedMemory}{ipc\_shared\_memory\_t}}* block = Scheduler::get\_ipc()-\/>get\_shared\_memory(\mbox{\hyperlink{fat32_8h_abfa8a0ef7b1321866a7c4099554fdfb0}{name}});}
\DoxyCodeLine{408 }
\DoxyCodeLine{409   \textcolor{comment}{// Load the shared memory}}
\DoxyCodeLine{410   \textcolor{keywordflow}{if}(block != \textcolor{keyword}{nullptr})}
\DoxyCodeLine{411     \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a72b37f7562ad7124879790a22e81004a}{load\_shared\_memory}}(block-\/>\mbox{\hyperlink{structMaxOS_1_1processes_1_1IPCSharedMemory_a1f60d921fae8fb9aa8991215561b6674}{physical\_address}}, block-\/>\mbox{\hyperlink{structMaxOS_1_1processes_1_1IPCSharedMemory_a6d1434ed1aae638f2d3bd3a209ddfe01}{size}});}
\DoxyCodeLine{412 }
\DoxyCodeLine{413   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{414 \}}

\end{DoxyCode}


References name, Max\+O\+S\+::processes\+::\+I\+P\+C\+Shared\+Memory\+::physical\+\_\+address, and Max\+O\+S\+::processes\+::\+I\+P\+C\+Shared\+Memory\+::size.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_a3c0629ad1bc52a1263e23974845f45b3}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_a3c0629ad1bc52a1263e23974845f45b3}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!load\_shared\_memory@{load\_shared\_memory}}
\index{load\_shared\_memory@{load\_shared\_memory}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{load\_shared\_memory()}{load\_shared\_memory()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void $\ast$ Virtual\+Memory\+Manager\+::load\+\_\+shared\+\_\+memory (\begin{DoxyParamCaption}\item[{uintptr\+\_\+t}]{physical\+\_\+address,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Load shared memory into the V\+MM\textquotesingle{}s address space. 


\begin{DoxyParams}{Parameters}
{\em physical\+\_\+address} & The physical address of the shared memory \\
\hline
{\em size} & The size of the shared memory \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The address of the shared memory in the V\+MM\textquotesingle{}s address space 
\end{DoxyReturn}


Definition at line 422 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{422                                                                                       \{}
\DoxyCodeLine{423 }
\DoxyCodeLine{424   \textcolor{comment}{// Make sure there is somthing to map}}
\DoxyCodeLine{425   \textcolor{keywordflow}{if}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} == 0 || \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}} == 0)}
\DoxyCodeLine{426     \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{427 }
\DoxyCodeLine{428   \textcolor{comment}{// Load it into physical memory}}
\DoxyCodeLine{429   \textcolor{keywordflow}{return} \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a2e0c30587858d4cfaad1cf6fc0fe75e7}{load\_physical\_into\_address\_space}}(\mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}}, \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}, \mbox{\hyperlink{namespaceMaxOS_1_1memory_a12ca8e10f17e52d8375319daaaf6f380ae460bd3f004b1f64b4a2a6548b7fdefe}{Shared}});}
\DoxyCodeLine{430 \}}

\end{DoxyCode}


References load\+\_\+physical\+\_\+into\+\_\+address\+\_\+space(), physical\+\_\+address, Max\+O\+S\+::memory\+::\+Shared, and size.

\mbox{\Hypertarget{classMaxOS_1_1memory_1_1VirtualMemoryManager_a4ae320422dd476cfbf63d810fc725bd5}\label{classMaxOS_1_1memory_1_1VirtualMemoryManager_a4ae320422dd476cfbf63d810fc725bd5}} 
\index{MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}!memory\_used@{memory\_used}}
\index{memory\_used@{memory\_used}!MaxOS::memory::VirtualMemoryManager@{MaxOS::memory::VirtualMemoryManager}}
\doxysubsubsection{\texorpdfstring{memory\_used()}{memory\_used()}}
{\footnotesize\ttfamily size\+\_\+t Virtual\+Memory\+Manager\+::memory\+\_\+used (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Returns the amount of memory used. 

\begin{DoxyReturn}{Returns}
The amount of memory used 
\end{DoxyReturn}


Definition at line 312 of file virtual.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{312                                          \{}
\DoxyCodeLine{313 }
\DoxyCodeLine{314   \textcolor{comment}{// Loop through all the regions and add up the size of the allocated chunks}}
\DoxyCodeLine{315   \textcolor{keywordtype}{size\_t} result = 0;}
\DoxyCodeLine{316 }
\DoxyCodeLine{317   \textcolor{comment}{// Iterate through the regions}}
\DoxyCodeLine{318   virtual\_memory\_region\_t *region = m\_first\_region;}
\DoxyCodeLine{319   \textcolor{keywordflow}{while} (region != \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{320 }
\DoxyCodeLine{321     \textcolor{comment}{// Loop through the chunks}}
\DoxyCodeLine{322     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} = 0; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}} < s\_chunks\_per\_page; \mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}++) \{}
\DoxyCodeLine{323 }
\DoxyCodeLine{324       \textcolor{comment}{// Check if the address is in the chunk}}
\DoxyCodeLine{325       \textcolor{keywordflow}{if} (region-\/>chunks[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}].size != 0)}
\DoxyCodeLine{326         result += region-\/>chunks[\mbox{\hyperlink{namespaceMaxOS_1_1drivers_1_1peripherals_a891861cdf457ecedb7e3a5fa56515ebcaf552e09750e0ce71af8fc4fa0b32b8ff}{i}}].size;}
\DoxyCodeLine{327     \}}
\DoxyCodeLine{328 }
\DoxyCodeLine{329     \textcolor{comment}{// Move to the next region}}
\DoxyCodeLine{330     region = region-\/>next;}
\DoxyCodeLine{331   \}}
\DoxyCodeLine{332 }
\DoxyCodeLine{333   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{334 \}}

\end{DoxyCode}


References Max\+O\+S\+::drivers\+::peripherals\+::i.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/include/memory/\mbox{\hyperlink{virtual_8h}{virtual.\+h}}\item 
/home/runner/work/\+Max\+O\+S/\+Max\+O\+S/kernel/src/memory/\mbox{\hyperlink{virtual_8cpp}{virtual.\+cpp}}\end{DoxyCompactItemize}
