\doxysection{scheduler.\+cpp}
\hypertarget{scheduler_8cpp_source}{}\label{scheduler_8cpp_source}\index{/home/runner/work/MaxOS/MaxOS/kernel/src/processes/scheduler.cpp@{/home/runner/work/MaxOS/MaxOS/kernel/src/processes/scheduler.cpp}}
\mbox{\hyperlink{scheduler_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00001}00001\ \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00002}00002\ \textcolor{comment}{//\ Created\ by\ 98max\ on\ 25/02/2025.}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00003}00003\ \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{scheduler_8h}{processes/scheduler.h}}>}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger_8h}{common/logger.h}}>}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00008}00008\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS}{MaxOS}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00009}00009\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS_1_1processes}{MaxOS::processes}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00010}00010\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS_1_1memory}{MaxOS::memory}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00011}00011\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS_1_1hardwarecommunication}{MaxOS::hardwarecommunication}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00012}00012\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceMaxOS_1_1system}{MaxOS::system}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00014}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a7a2f7908835cfe127ad167734f0674a3}{00014}}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a7a2f7908835cfe127ad167734f0674a3}{Scheduler::Scheduler}}(\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot}{Multiboot}}\&\ multiboot)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00015}00015\ :\ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler}{InterruptHandler}}(0x20),}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00016}00016\ \ \ m\_current\_thread\_index(0),}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00017}00017\ \ \ m\_active(false),}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00018}00018\ \ \ m\_ticks(0),}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00019}00019\ \ \ m\_next\_pid(-\/1),}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00020}00020\ \ \ m\_next\_tid(-\/1),}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00021}00021\ \ \ m\_shared\_memory\_registry(\mbox{\hyperlink{namespaceMaxOS_1_1processes_a9ac9ad12caad00b9d7eb53504318c263}{resource\_type\_t}}::SHARED\_MEMORY),}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00022}00022\ \ \ m\_shared\_messages\_registry(\mbox{\hyperlink{namespaceMaxOS_1_1processes_a9ac9ad12caad00b9d7eb53504318c263}{resource\_type\_t}}::MESSAGE\_ENDPOINT)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00023}00023\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00025}00025\ \ \ \ \ \textcolor{comment}{//\ Set\ up\ the\ basic\ scheduler}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00026}00026\ \ \ \ \ \mbox{\hyperlink{classLogger_a6fa276d92dbf0dd22dcab146f5c99da6}{Logger::INFO}}()\ <<\ \textcolor{stringliteral}{"{}Setting\ up\ Scheduler\ \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00027}00027\ \ \ \ \ s\_instance\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00029}00029\ \ \ \ \ \textcolor{comment}{//\ Create\ the\ idle\ process}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00030}00030\ \ \ \ \ \textcolor{keyword}{auto}*\ idle\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}(\textcolor{stringliteral}{"{}kernelMain\ Idle"{}},\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr},\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00031}00031\ \ \ \ \ idle-\/>memory\_manager\ =\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_a80d8e713d6ad371a4b564a5202542d48}{MemoryManager::s\_kernel\_memory\_manager}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00032}00032\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a57f5f5eecb3fbbc693b6462c880129b0}{add\_process}}(idle);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00033}00033\ \ \ \ \ idle-\/>set\_pid(0);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00035}00035\ \ \ \ \ \textcolor{comment}{//\ Load\ the\ elfs}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00036}00036\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a8273f5b5d5dbfd7fbd10480c32db9ad4}{load\_multiboot\_elfs}}(\&multiboot);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00037}00037\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00039}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_afc8187779b46f64039d3ffa58f0dbe51}{00039}}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_afc8187779b46f64039d3ffa58f0dbe51}{Scheduler::\string~Scheduler}}()\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00041}00041\ \ \ \ \ \textcolor{comment}{//\ Deactivate\ this\ scheduler}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00042}00042\ \ \ \ \ s\_instance\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00043}00043\ \ \ \ \ m\_active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00044}00044\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00045}00045\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00052}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a5d9c7ddda5adeedff09093b7492101f8}{00052}}\ cpu\_status\_t*\ \mbox{\hyperlink{classMaxOS_1_1hardwarecommunication_1_1InterruptHandler_abd792bc53ec7dd1b70c8386853cc3c33}{Scheduler::handle\_interrupt}}(cpu\_status\_t*\ \mbox{\hyperlink{intel__i217_8h_ade818037fd6c985038ff29656089758d}{status}})\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00054}00054\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_aecc29abbf74f6f611762c4298d5c3a1d}{schedule}}(\mbox{\hyperlink{intel__i217_8h_ade818037fd6c985038ff29656089758d}{status}});}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00055}00055\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00064}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_aecc29abbf74f6f611762c4298d5c3a1d}{00064}}\ cpu\_status\_t*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_aecc29abbf74f6f611762c4298d5c3a1d}{Scheduler::schedule}}(cpu\_status\_t*\ cpu\_state)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00066}00066\ \ \ \ \ \textcolor{comment}{//\ Scheduler\ cant\ schedule\ anything}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00067}00067\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_threads.empty()\ ||\ !m\_active)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00068}00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cpu\_state;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00070}00070\ \ \ \ \ \textcolor{comment}{//\ Thread\ that\ we\ are\ dealing\ with}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00071}00071\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}}*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}\ =\ m\_threads[m\_current\_thread\_index];}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00073}00073\ \ \ \ \ \textcolor{comment}{//\ Ticked}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00074}00074\ \ \ \ \ m\_ticks++;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00075}00075\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_adac2079967569c8686ab0d05631065bc}{ticks}}++;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00076}00076\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00077}00077\ \ \ \ \ \textcolor{comment}{//\ Wait\ for\ a\ bit\ so\ that\ the\ scheduler\ doesn't\ run\ too\ fast\ TODO:\ fix}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00078}00078\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_ticks\ \%\ s\_ticks\_per\_event\ !=\ 0)\ \textcolor{keywordflow}{return}\ cpu\_state;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00079}00079\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00080}00080\ \ \ \ \ \textcolor{comment}{//\ Schedule\ the\ next\ thread}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00081}00081\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af0094b696d420844c5475311e556dd70}{schedule\_next}}(cpu\_state);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00082}00082\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00083}00083\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00090}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af0094b696d420844c5475311e556dd70}{00090}}\ cpu\_status\_t*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af0094b696d420844c5475311e556dd70}{Scheduler::schedule\_next}}(cpu\_status\_t*\ cpu\_state)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00092}00092\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ thread\ that\ is\ executing\ right\ now}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00093}00093\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}}*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}\ =\ m\_threads[m\_current\_thread\_index];}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00094}00094\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00095}00095\ \ \ \ \ \textcolor{comment}{//\ Save\ its\ state}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00096}00096\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_afcde2d4d3ee4c3540120034dbbff1807}{execution\_state}}\ =\ cpu\_state;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00097}00097\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a21abe4a5d20033649696849094c415d0}{save\_sse\_state}}();}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00098}00098\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a07fecafeda2dc5867ef07db926de4617}{thread\_state}}\ ==\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a43491564ebcfd38568918efbd6e840fd}{ThreadState::RUNNING}})}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00099}00099\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a07fecafeda2dc5867ef07db926de4617}{thread\_state}}\ =\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a2baa69eafc7204f3bd8648eba580c489}{ThreadState::READY}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00101}00101\ \ \ \ \ \textcolor{comment}{//\ Switch\ to\ the\ thread\ that\ will\ now\ run}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00102}00102\ \ \ \ \ m\_current\_thread\_index++;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00103}00103\ \ \ \ \ m\_current\_thread\_index\ \%=\ m\_threads.size();}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00104}00104\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}\ =\ m\_threads[m\_current\_thread\_index];}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00106}00106\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}*\ owner\_process\ =\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ae6984a0be65698916c382ed9abd9fc79}{current\_process}}();}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00107}00107\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00108}00108\ \ \ \ \ \textcolor{comment}{//\ Handle\ state\ changes}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00109}00109\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a07fecafeda2dc5867ef07db926de4617}{thread\_state}})\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00111}00111\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a24d459a81449d7210c8f9a86c2913034}{ThreadState::NEW}}:}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a07fecafeda2dc5867ef07db926de4617}{thread\_state}}\ =\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a43491564ebcfd38568918efbd6e840fd}{ThreadState::RUNNING}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00113}00113\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00115}00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a7850588c11fe6db41b8b2dd6c455f8f3}{ThreadState::SLEEPING}}:}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00116}00116\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00117}00117\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ wake-\/up\ time\ hasn't\ occurred\ yet,\ run\ the\ next\ thread}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00118}00118\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a2cda049e10651cb61318f38cd88f22e2}{wakeup\_time}}\ >\ m\_ticks)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af0094b696d420844c5475311e556dd70}{schedule\_next}}(\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_afcde2d4d3ee4c3540120034dbbff1807}{execution\_state}});}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00122}00122\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00123}00123\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a09d4d696b4e935115b9313e3c412509a}{ThreadState::STOPPED}}:}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00124}00124\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ process\ that\ has\ the\ thread\ and\ remove\ it}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00126}00126\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ thread:\ owner\_process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a8595e1ab73f585be41005a6bbd88eb2f}{threads}}())\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (thread\ ==\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}})\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ owner\_process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_af57385b2fab714504b20e95ceb0a8bbd}{remove\_thread}}(m\_current\_thread\_index);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00129}00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00131}00131\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00132}00132\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ thread}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00134}00134\ \ \ \ \ \ \ \ \ \ \ \ \ m\_threads.erase(m\_threads.begin()\ +\ m\_current\_thread\_index);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00135}00135\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Run\ the\ next\ thread}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af0094b696d420844c5475311e556dd70}{schedule\_next}}(cpu\_state);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00138}00138\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00139}00139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00140}00140\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00141}00141\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00143}00143\ \ \ \ \ \textcolor{comment}{//\ Prepare\ the\ next\ thread\ to\ run}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00144}00144\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a07fecafeda2dc5867ef07db926de4617}{thread\_state}}\ =\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a43491564ebcfd38568918efbd6e840fd}{ThreadState::RUNNING}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00145}00145\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_acd31b38f01bba4e58e8426f5f0be25f7}{restore\_sse\_state}}();}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00146}00146\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00147}00147\ \ \ \ \ \textcolor{comment}{//\ Load\ the\ thread's\ memory\ manager\ and\ task\ state}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00148}00148\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1memory_1_1MemoryManager_ae584e29e4d2925e3e30be409af2dc2e5}{MemoryManager::switch\_active\_memory\_manager}}(owner\_process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_af8482adefd92ca758c67a98a197444ea}{memory\_manager}});}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00149}00149\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1system_1_1CPU_a6cf50fdc207845c90071a63aaa550d7b}{CPU::tss}}.rsp0\ =\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a9baa5fdcd84593974738c3f62f050283}{tss\_pointer}}();}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00151}00151\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_afcde2d4d3ee4c3540120034dbbff1807}{execution\_state}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00152}00152\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00153}00153\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00154}00154\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00161}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a57f5f5eecb3fbbc693b6462c880129b0}{00161}}\ uint64\_t\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a57f5f5eecb3fbbc693b6462c880129b0}{Scheduler::add\_process}}(\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}*\ process)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00162}00162\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00163}00163\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ next\ process\ ID}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00164}00164\ \ \ \ \ m\_next\_pid++;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00166}00166\ \ \ \ \ \textcolor{comment}{//\ Add\ the\ process\ to\ the\ list}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00167}00167\ \ \ \ \ m\_processes.push\_back(process);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00168}00168\ \ \ \ \ \mbox{\hyperlink{classLogger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}Adding\ process\ "{}}\ <<\ m\_next\_pid\ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a56404d627bd310d8de08fba3d8d2792f}{name}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00169}00169\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00170}00170\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ process\ ID}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00171}00171\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_next\_pid;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00172}00172\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00173}00173\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00180}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a85c088e0e4d5e5d6fb646c842127c36c}{00180}}\ uint64\_t\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a85c088e0e4d5e5d6fb646c842127c36c}{Scheduler::add\_thread}}(\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}}*\ thread)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00181}00181\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00182}00182\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ next\ thread\ ID}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00183}00183\ \ \ \ \ m\_next\_tid++;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00184}00184\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00185}00185\ \ \ \ \ \textcolor{comment}{//\ Add\ the\ thread\ to\ the\ list}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00186}00186\ \ \ \ \ m\_threads.push\_back(thread);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00187}00187\ \ \ \ \ \mbox{\hyperlink{classLogger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}Adding\ thread\ "{}}\ <<\ m\_next\_tid\ <<\ \textcolor{stringliteral}{"{}\ to\ process\ "{}}\ <<\ thread-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a130e3726d7c4912ab2fdf6bf587f757f}{parent\_pid}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00188}00188\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00189}00189\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ thread\ ID}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00190}00190\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_next\_tid;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00191}00191\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00198}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af1bf088153c111f0a4d9411b28471739}{00198}}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler}{Scheduler}}*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af1bf088153c111f0a4d9411b28471739}{Scheduler::system\_scheduler}}()\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00199}00199\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00200}00200\ \ \ \ \ \textcolor{keywordflow}{return}\ s\_instance;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00201}00201\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00202}00202\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00208}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a349f28166719d94bd978439f24cd2448}{00208}}\ uint64\_t\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a349f28166719d94bd978439f24cd2448}{Scheduler::ticks}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00209}00209\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00210}00210\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_ticks;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00211}00211\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00212}00212\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00216}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4e3cb6c6cc95d62dc6149c0ec934c723}{00216}}\ cpu\_status\_t*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4e3cb6c6cc95d62dc6149c0ec934c723}{Scheduler::yield}}()\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00217}00217\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00218}00218\ \ \ \ \ \textcolor{comment}{//\ If\ this\ is\ the\ only\ thread,\ can't\ yield}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00219}00219\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_threads.size()\ <=\ 1)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00220}00220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}()-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_afcde2d4d3ee4c3540120034dbbff1807}{execution\_state}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00221}00221\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00222}00222\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ current\ thread\ to\ waiting\ if\ running}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00223}00223\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_threads[m\_current\_thread\_index]-\/>thread\_state\ ==\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a43491564ebcfd38568918efbd6e840fd}{ThreadState::RUNNING}})}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00224}00224\ \ \ \ \ \ \ \ \ m\_threads[m\_current\_thread\_index]-\/>thread\_state\ =\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a2baa69eafc7204f3bd8648eba580c489}{ThreadState::READY}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00225}00225\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00226}00226\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00227}00227\ \ \ \ \ \textcolor{comment}{//\ Schedule\ the\ next\ thread}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00228}00228\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af0094b696d420844c5475311e556dd70}{schedule\_next}}(\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}()-\/>execution\_state);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00229}00229\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00230}00230\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00234}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ad7bd11e0611b0cad2fc18e3499d82dec}{00234}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ad7bd11e0611b0cad2fc18e3499d82dec}{Scheduler::activate}}()\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00235}00235\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00236}00236\ \ \ \ \ m\_active\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00237}00237\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00238}00238\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00246}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a00c2995b3a91021eb4f278a591ff994f}{00246}}\ uint64\_t\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a00c2995b3a91021eb4f278a591ff994f}{Scheduler::remove\_process}}(\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}*\ process)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00247}00247\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00248}00248\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ the\ process\ has\ no\ threads}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00249}00249\ \ \ \ \ \textcolor{keywordflow}{if}\ (!process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a8595e1ab73f585be41005a6bbd88eb2f}{threads}}().empty())\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00250}00250\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00251}00251\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ threads\ to\ stopped\ or\ remove\ them\ if\ forced}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00252}00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ thread:\ process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a8595e1ab73f585be41005a6bbd88eb2f}{threads}}())}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00253}00253\ \ \ \ \ \ \ \ \ \ \ \ \ thread-\/>thread\_state\ =\ \mbox{\hyperlink{namespaceMaxOS_1_1processes_ac30559a70f01633a1d96a916375bbcf6a09d4d696b4e935115b9313e3c412509a}{ThreadState::STOPPED}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00254}00254\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00255}00255\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Need\ to\ wait\ until\ the\ threads\ are\ stopped\ before\ removing\ the\ process\ (this\ will\ be\ called\ again\ when\ all\ threads\ are\ stopped)}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00256}00256\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00257}00257\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00258}00258\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00259}00259\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00260}00260\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ process}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00261}00261\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ m\_processes.size();\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00262}00262\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_processes[i]\ ==\ process)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \ \ \ m\_processes.erase(m\_processes.begin()\ +\ i);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00264}00264\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00265}00265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Delete\ the\ process\ mem}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00266}00266\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ process;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00267}00267\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00268}00268\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00269}00269\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00271}00271\ \ \ \ \ \textcolor{comment}{//\ Process\ not\ found}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00272}00272\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00273}00273\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00274}00274\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00281}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a501213a82c4fa7c7aa8bc6ff39377c0f}{00281}}\ cpu\_status\_t*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a501213a82c4fa7c7aa8bc6ff39377c0f}{Scheduler::force\_remove\_process}}(\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}*\ process)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00282}00282\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00283}00283\ \ \ \ \ \textcolor{comment}{//\ If\ there\ is\ no\ process,\ fail}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00284}00284\ \ \ \ \ \textcolor{keywordflow}{if}\ (!process)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00285}00285\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00286}00286\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00287}00287\ \ \ \ \ \textcolor{comment}{//\ Remove\ all\ the\ threads}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00288}00288\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ thread:\ process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_a8595e1ab73f585be41005a6bbd88eb2f}{threads}}())\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00289}00289\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00290}00290\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ thread\ from\ the\ scheduler}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00291}00291\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ m\_threads.find(thread)\ -\/\ m\_threads.begin();}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00292}00292\ \ \ \ \ \ \ \ \ m\_threads.erase(m\_threads.begin()\ +\ index);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00293}00293\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00294}00294\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Delete\ the\ thread}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00295}00295\ \ \ \ \ \ \ \ \ process-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Process_af57385b2fab714504b20e95ceb0a8bbd}{remove\_thread}}(thread-\/>tid);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00296}00296\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00297}00297\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00298}00298\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00299}00299\ \ \ \ \ \textcolor{comment}{//\ Process\ will\ be\ dead\ now\ so\ run\ the\ next\ process\ (don't\ care\ about\ the\ execution\ state\ being\ outdated\ as\ it\ is\ being}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00300}00300\ \ \ \ \ \textcolor{comment}{//\ removed\ regardless)}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00301}00301\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af0094b696d420844c5475311e556dd70}{schedule\_next}}(\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}()-\/>execution\_state);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00302}00302\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00303}00303\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00309}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ae6984a0be65698916c382ed9abd9fc79}{00309}}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ae6984a0be65698916c382ed9abd9fc79}{Scheduler::current\_process}}()\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00310}00310\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00311}00311\ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ae6984a0be65698916c382ed9abd9fc79}{current\_process}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00312}00312\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00313}00313\ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ there\ is\ something\ with\ process\ attached}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00314}00314\ \ \ \ \ \textcolor{keywordflow}{if}\ (!s\_instance)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00315}00315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00316}00316\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00317}00317\ \ \ \ \ \textcolor{comment}{//\ Find\ the\ process\ that\ has\ the\ thread\ being\ executed}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00318}00318\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ process:\ s\_instance-\/>m\_processes)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00319}00319\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (process-\/>pid()\ ==\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{current\_thread}}()-\/>\mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread_a130e3726d7c4912ab2fdf6bf587f757f}{parent\_pid}})\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ae6984a0be65698916c382ed9abd9fc79}{current\_process}}\ =\ process;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00321}00321\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00322}00322\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00323}00323\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00324}00324\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_ae6984a0be65698916c382ed9abd9fc79}{current\_process}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00325}00325\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00326}00326\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00333}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a51b58af8b283f0f98131dd2d6ce51540}{00333}}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a51b58af8b283f0f98131dd2d6ce51540}{Scheduler::get\_process}}(uint64\_t\ pid)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00334}00334\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00335}00335\ \ \ \ \ \textcolor{comment}{//\ Try\ to\ find\ the\ process}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00336}00336\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ process:\ s\_instance-\/>m\_processes)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00337}00337\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (process-\/>pid()\ ==\ pid)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00338}00338\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ process;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00339}00339\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00340}00340\ \ \ \ \ \textcolor{comment}{//\ Not\ found}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00341}00341\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00342}00342\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00343}00343\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00344}00344\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00350}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{00350}}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}}*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a4b29a981d21849fa08d64a51a5111932}{Scheduler::current\_thread}}()\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00351}00351\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00352}00352\ \ \ \ \ \textcolor{keywordflow}{return}\ s\_instance-\/>m\_threads[s\_instance-\/>m\_current\_thread\_index];}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00353}00353\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00354}00354\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00358}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af4792bed046b34d0010412e336ec2970}{00358}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_af4792bed046b34d0010412e336ec2970}{Scheduler::deactivate}}()\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00359}00359\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00360}00360\ \ \ \ \ m\_active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00361}00361\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00362}00362\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00368}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a8273f5b5d5dbfd7fbd10480c32db9ad4}{00368}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a8273f5b5d5dbfd7fbd10480c32db9ad4}{Scheduler::load\_multiboot\_elfs}}(\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot}{Multiboot}}*\ multiboot)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00369}00369\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00370}00370\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{structmultiboot__tag}{multiboot\_tag}}*\ tag\ =\ multiboot-\/>\mbox{\hyperlink{classMaxOS_1_1system_1_1Multiboot_a30987e6538d9e0aa663a7d5663cb452b}{start\_tag}}();\ tag-\/>type\ !=\ \mbox{\hyperlink{multiboot_8h_a9ba1adbd7639e20f723e51dd9668a981}{MULTIBOOT\_TAG\_TYPE\_END}};\ tag\ =\ (\textcolor{keyword}{struct\ }\mbox{\hyperlink{structmultiboot__tag}{multiboot\_tag}}*)\ ((\mbox{\hyperlink{classMaxOS_1_1common_1_1Rectangle}{multiboot\_uint8\_t}}*)\ tag\ +\ ((tag-\/>size\ +\ 7)\ \&\ \string~7)))\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00371}00371\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00372}00372\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Tag\ is\ not\ an\ ELF}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00373}00373\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tag-\/>type\ !=\ \mbox{\hyperlink{multiboot_8h_a10b78479319b8790657f13414cf34736}{MULTIBOOT\_TAG\_TYPE\_MODULE}})}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00374}00374\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00375}00375\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00376}00376\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Try\ create\ the\ elf\ from\ the\ module}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00377}00377\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ \textcolor{keyword}{module}\ =\ (struct\ multiboot\_tag\_module*)\ tag;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00378}00378\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ elf\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Elf64}{Elf64}}((uintptr\_t)\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1PhysicalMemoryManager_a061e07bff657447294f4005f550d87ac}{PhysicalMemoryManager::to\_dm\_region}}(module-\/>mod\_start));}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00379}00379\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!elf-\/>is\_valid())}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00380}00380\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00381}00381\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00382}00382\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classLogger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}Creating\ process\ from\ multiboot\ module\ for\ "{}}\ <<\ \textcolor{keyword}{module}-\/>cmdline\ <<\ "{}\ (at\ 0x"{}\ <<\ (uint64\_t)\ module-\/>mod\_start\ <<\ "{})\(\backslash\)n"{};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00383}00383\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00384}00384\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ an\ array\ of\ args\ for\ the\ process\ TODO:\ handle\ multiple\ args\ ("{}"{}\ \&\ spaces)}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00385}00385\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}*\ args[1]\ =\ \{\textcolor{keyword}{module}-\/>cmdline\};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00386}00386\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00387}00387\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ the\ process}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00388}00388\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ process\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Process}{Process}}(module-\/>cmdline,\ args,\ 1,\ elf);}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00389}00389\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00390}00390\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classLogger_a1df434c9cd82457b6830c0500731a601}{Logger::DEBUG}}()\ <<\ \textcolor{stringliteral}{"{}Elf\ loaded\ to\ pid\ "{}}\ <<\ process-\/>pid()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00391}00391\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ elf;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00392}00392\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00393}00393\ \}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00394}00394\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00401}\mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a73cf68e70de225ce465f249989766468}{00401}}\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Thread}{Thread}}*\ \mbox{\hyperlink{classMaxOS_1_1processes_1_1Scheduler_a73cf68e70de225ce465f249989766468}{Scheduler::get\_thread}}(uint64\_t\ tid)\ \{}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00402}00402\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00403}00403\ \ \ \ \ \textcolor{comment}{//\ Try\ to\ find\ the\ thread}}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00404}00404\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ thread:\ s\_instance-\/>m\_threads)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00405}00405\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (thread-\/>tid\ ==\ tid)}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00406}00406\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ thread;}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00407}00407\ }
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00408}00408\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{scheduler_8cpp_source_l00409}00409\ \}}

\end{DoxyCode}
