\doxysection{virtual.\+h}
\hypertarget{virtual_8h_source}{}\label{virtual_8h_source}\index{/home/runner/work/MaxOS/MaxOS/kernel/include/memory/virtual.h@{/home/runner/work/MaxOS/MaxOS/kernel/include/memory/virtual.h}}
\mbox{\hyperlink{virtual_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00001}\mbox{\hyperlink{virtual_8h_a20e8ff4d4c943d29eee7cfd80a5ff0f3}{00001}}\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00009}00009\ \textcolor{preprocessor}{\#ifndef\ MAXOS\_VIRTUAL\_H}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00010}00010\ \textcolor{preprocessor}{\#define\ MAXOS\_VIRTUAL\_H}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00013}00013\ \textcolor{preprocessor}{\#include\ <stddef.h>}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00014}00014\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{physical_8h}{memory/physical.h}}>}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00015}00015\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{string_8h}{common/string.h}}>}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00018}00018\ \textcolor{keyword}{namespace\ }MaxOS\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00019}00019\ \ \ \ \ \textcolor{keyword}{namespace\ }memory\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00028}\mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380}{00028}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380}{VirtualFlags}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00029}\mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380a9b2ec1c1148770ef7ebf973def754e7c}{00029}}\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380a9b2ec1c1148770ef7ebf973def754e7c}{RESERVE}}\ =\ (1\ <<\ 9),\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00030}\mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380a997819290df7a1861b890d56d9f7c973}{00030}}\ \ \ \ \ \ \ \ \ \ \ \ \ SHARED\ =\ (1\ <<\ 10),\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00032}00032\ \ \ \ \ \ \ \ \ \}\ virtual\_flags\_t;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00040}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{00040}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{VirtualMemoryChunk}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00041}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{00041}}\ \ \ \ \ \ \ \ \ \ \ \ \ uintptr\_t\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{start\_address}};\ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00042}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa801ec740419740a3d9576bcdf821930}{00042}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa801ec740419740a3d9576bcdf821930}{size}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00043}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_a3197fff13af0c0c20e83ad26c4e5d6f6}{00043}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_a3197fff13af0c0c20e83ad26c4e5d6f6}{flags}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00045}00045\ \ \ \ \ \ \ \ \ \}\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{virtual\_memory\_chunk\_t}};}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00051}\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{00051}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{FreeChunk}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00052}\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af4ea572cd555fa81cc1331663a88481f}{00052}}\ \ \ \ \ \ \ \ \ \ \ \ \ uintptr\_t\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af4ea572cd555fa81cc1331663a88481f}{start\_address}};\ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00053}\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_a1e9de0a61bdb8069cf83698811dfa1d0}{00053}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_a1e9de0a61bdb8069cf83698811dfa1d0}{size}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00054}\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af778aef094fc1dffa4cd9abbaf9892a8}{00054}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{FreeChunk}}*\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af778aef094fc1dffa4cd9abbaf9892a8}{next}};\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00055}00055\ \ \ \ \ \ \ \ \ \}\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{free\_chunk\_t}};}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00057}00057\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNKS\_PER\_PAGE\ =\ \mbox{\hyperlink{physical_8h_acbb7ce85d6b04d80fa29a7292d4bc3ed}{PAGE\_SIZE}}\ /\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{virtual\_memory\_chunk\_t}})\ -\/\ 1;\ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00058}00058\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ VMM\_RESERVED\ =\ 0x138000000;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00066}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion}{00066}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion}{VirtualMemoryRegion}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00067}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion_acb2a48316bf199fbf739cce981aeea5a}{00067}}\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{virtual\_memory\_chunk\_t}}\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion_acb2a48316bf199fbf739cce981aeea5a}{chunks}}[CHUNKS\_PER\_PAGE];\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00068}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion_ad413d0bc698f58b335e61665a18cff9f}{00068}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion}{VirtualMemoryRegion}}*\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion_ad413d0bc698f58b335e61665a18cff9f}{next}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00069}00069\ \ \ \ \ \ \ \ \ \}\ \_\_attribute\_\_((packed))\ virtual\_memory\_region\_t;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00070}00070\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00077}\mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager}{00077}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager}{VirtualMemoryManager}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t*\ m\_pml4\_root\_address;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t*\ m\_pml4\_root\_physical\_address;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ virtual\_memory\_region\_t*\ m\_first\_region;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ virtual\_memory\_region\_t*\ m\_current\_region;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ m\_current\_chunk\ =\ 0;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ m\_next\_available\_address;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{free\_chunk\_t}}*\ m\_free\_chunks\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ add\_free\_chunk(uintptr\_t\ start\_address,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ext2_8h_aaba88b24a21a6c70c895c0d55f4a69a0}{size}});}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{free\_chunk\_t}}*\ find\_and\_remove\_free\_chunk(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ext2_8h_aaba88b24a21a6c70c895c0d55f4a69a0}{size}});}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ new\_region();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ fill\_up\_to\_address(uintptr\_t\ address,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}},\ \textcolor{keywordtype}{bool}\ mark\_used);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00094}00094\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager}{VirtualMemoryManager}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager}{\string~VirtualMemoryManager}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00099}00099\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a433396979e1b088454eefbce0964b709}{allocate}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ext2_8h_aaba88b24a21a6c70c895c0d55f4a69a0}{size}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a433396979e1b088454eefbce0964b709}{allocate}}(uint64\_t\ address,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ext2_8h_aaba88b24a21a6c70c895c0d55f4a69a0}{size}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00102}00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{ext2_8h_a047d6d6c3bceaea709fe00e953a0c52f}{free}}(\textcolor{keywordtype}{void}*\ address);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a2e0c30587858d4cfaad1cf6fc0fe75e7}{load\_physical\_into\_address\_space}}(uintptr\_t\ \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ext2_8h_aaba88b24a21a6c70c895c0d55f4a69a0}{size}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{amd__am79c973_8h_a1e87af3c18a2fd36c61faf89949bdc3f}{flags}});}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00106}00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_aeb6cda8549b46a97ef761d10a7e21b32}{load\_shared\_memory}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&\mbox{\hyperlink{fat32_8h_abfa8a0ef7b1321866a7c4099554fdfb0}{name}});}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_aeb6cda8549b46a97ef761d10a7e21b32}{load\_shared\_memory}}(uintptr\_t\ \mbox{\hyperlink{physical_8h_a069784144afa0b45c14ce1788adb541a}{physical\_address}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ext2_8h_aaba88b24a21a6c70c895c0d55f4a69a0}{size}});}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00108}00108\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a89aed6e936e4089ff4355568f0ee32ee}{pml4\_root\_address}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a569e9f953df4b59d853219009a2f232f}{pml4\_root\_address\_physical}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00111}00111\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a4ae320422dd476cfbf63d810fc725bd5}{memory\_used}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00114}00114\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00115}00115\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00116}00116\ \}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00117}00117\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00118}00118\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00119}00119\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ MAXOS\_VIRTUAL\_H}}

\end{DoxyCode}
