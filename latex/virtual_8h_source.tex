\doxysection{virtual.\+h}
\hypertarget{virtual_8h_source}{}\label{virtual_8h_source}\index{/home/runner/work/MaxOS/MaxOS/kernel/include/memory/virtual.h@{/home/runner/work/MaxOS/MaxOS/kernel/include/memory/virtual.h}}
\mbox{\hyperlink{virtual_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00001}00001\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00009}00009\ \textcolor{preprocessor}{\#ifndef\ MAXOS\_VIRTUAL\_H}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00010}00010\ \textcolor{preprocessor}{\#define\ MAXOS\_VIRTUAL\_H}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00013}00013\ \textcolor{preprocessor}{\#include\ <stddef.h>}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00014}00014\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{physical_8h}{memory/physical.h}}>}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00015}00015\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{string_8h}{common/string.h}}>}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00018}00018\ \textcolor{keyword}{namespace\ }MaxOS\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00019}00019\ \ \ \ \ \textcolor{keyword}{namespace\ }memory\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00031}\mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380}{00031}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380}{VirtualFlags}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00033}\mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380a9b2ec1c1148770ef7ebf973def754e7c}{00033}}\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380a9b2ec1c1148770ef7ebf973def754e7c}{RESERVE}}\ =\ (1\ <<\ 9),\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00034}\mbox{\hyperlink{virtual_8h_a12ca8e10f17e52d8375319daaaf6f380a997819290df7a1861b890d56d9f7c973}{00034}}\ \ \ \ \ \ \ \ \ \ \ \ \ SHARED\ =\ (1\ <<\ 10),\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00036}\mbox{\hyperlink{virtual_8h_a90b70bec64a59b73946d84a9e7572b8e}{00036}}\ \ \ \ \ \ \ \ \ \}\ virtual\_flags\_t;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00047}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{00047}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{VirtualMemoryChunk}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00048}00048\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00049}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{00049}}\ \ \ \ \ \ \ \ \ \ \ \ \ uintptr\_t\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa470b01af19e3aaeb7505cdd0b5ad647}{start\_address}};\ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00050}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa801ec740419740a3d9576bcdf821930}{00050}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_aa801ec740419740a3d9576bcdf821930}{size}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00051}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_a3197fff13af0c0c20e83ad26c4e5d6f6}{00051}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk_a3197fff13af0c0c20e83ad26c4e5d6f6}{flags}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00052}00052\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00053}\mbox{\hyperlink{virtual_8h_a420231f8e8c3f193602e00af76a7a44b}{00053}}\ \ \ \ \ \ \ \ \ \}\ virtual\_memory\_chunk\_t;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00062}\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{00062}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{FreeChunk}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00064}\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af4ea572cd555fa81cc1331663a88481f}{00064}}\ \ \ \ \ \ \ \ \ \ \ \ \ uintptr\_t\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af4ea572cd555fa81cc1331663a88481f}{start\_address}};\ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00065}\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_a1e9de0a61bdb8069cf83698811dfa1d0}{00065}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_a1e9de0a61bdb8069cf83698811dfa1d0}{size}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00066}\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af778aef094fc1dffa4cd9abbaf9892a8}{00066}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{FreeChunk}}*\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk_af778aef094fc1dffa4cd9abbaf9892a8}{next}};\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00067}00067\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00068}\mbox{\hyperlink{virtual_8h_a1784dc53ca0b9a38fa243ee638fab7d4}{00068}}\ \ \ \ \ \ \ \ \ \}\ free\_chunk\_t;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00070}00070\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNKS\_PER\_PAGE\ =\ PAGE\_SIZE\ /\ \textcolor{keyword}{sizeof}(virtual\_memory\_chunk\_t)\ -\/}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1;\ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00072}00072\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ VMM\_RESERVED\ =\ 0x138000000;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00083}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion}{00083}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }PACKED\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion}{VirtualMemoryRegion}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00085}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion_acb2a48316bf199fbf739cce981aeea5a}{00085}}\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryChunk}{virtual\_memory\_chunk\_t}}\ chunks[CHUNKS\_PER\_PAGE];\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00086}\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion_ad413d0bc698f58b335e61665a18cff9f}{00086}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion}{VirtualMemoryRegion}}*\ \mbox{\hyperlink{structMaxOS_1_1memory_1_1VirtualMemoryRegion_ad413d0bc698f58b335e61665a18cff9f}{next}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00088}\mbox{\hyperlink{virtual_8h_a0c2f8355820427cecb751d5b4e1c93fb}{00088}}\ \ \ \ \ \ \ \ \ \}\ virtual\_memory\_region\_t;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00096}\mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager}{00096}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager}{VirtualMemoryManager}}\ \{}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t*\ m\_pml4\_root\_address;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t*\ m\_pml4\_root\_physical\_address;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00101}00101\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00102}00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{virtual_8h_a0c2f8355820427cecb751d5b4e1c93fb}{virtual\_memory\_region\_t}}*\ m\_first\_region;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00103}00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{virtual_8h_a0c2f8355820427cecb751d5b4e1c93fb}{virtual\_memory\_region\_t}}*\ m\_current\_region;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ m\_current\_chunk\ =\ 0;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ m\_next\_available\_address;}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00106}00106\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{free\_chunk\_t}}*\ m\_free\_chunks\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ add\_free\_chunk(uintptr\_t\ start\_address,\ \textcolor{keywordtype}{size\_t}\ size);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structMaxOS_1_1memory_1_1FreeChunk}{free\_chunk\_t}}*\ find\_and\_remove\_free\_chunk(\textcolor{keywordtype}{size\_t}\ size);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ new\_region();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ fill\_up\_to\_address(uintptr\_t\ address,\ \textcolor{keywordtype}{size\_t}\ flags,\ \textcolor{keywordtype}{bool}\ mark\_used);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a1b906972aec924522e630490ff0a8de2}{VirtualMemoryManager}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00116}00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a77e2717ead1bd12e12da9c824b0c7921}{\string~VirtualMemoryManager}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00117}00117\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00118}00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a433396979e1b088454eefbce0964b709}{allocate}}(\textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{size\_t}\ flags);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a433396979e1b088454eefbce0964b709}{allocate}}(uint64\_t\ address,\ \textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{size\_t}\ flags);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a96b3efdb246def1b85d311a61e401af6}{free}}(\textcolor{keywordtype}{void}*\ address);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00121}00121\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a2e0c30587858d4cfaad1cf6fc0fe75e7}{load\_physical\_into\_address\_space}}(uintptr\_t\ physical\_address,\ \textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{size\_t}\ flags);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_aeb6cda8549b46a97ef761d10a7e21b32}{load\_shared\_memory}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_aeb6cda8549b46a97ef761d10a7e21b32}{load\_shared\_memory}}(uintptr\_t\ physical\_address,\ \textcolor{keywordtype}{size\_t}\ size);}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a89aed6e936e4089ff4355568f0ee32ee}{pml4\_root\_address}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t*\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a569e9f953df4b59d853219009a2f232f}{pml4\_root\_address\_physical}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00129}00129\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classMaxOS_1_1memory_1_1VirtualMemoryManager_a4ae320422dd476cfbf63d810fc725bd5}{memory\_used}}();}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00131}00131\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00132}00132\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00133}00133\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00134}00134\ \}}
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00135}00135\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00136}00136\ }
\DoxyCodeLine{\Hypertarget{virtual_8h_source_l00137}00137\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ MAXOS\_VIRTUAL\_H}}

\end{DoxyCode}
