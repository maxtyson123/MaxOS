\hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler}{}\doxysection{max\+OS\+::net\+::Transmission\+Control\+Protocol\+Handler Class Reference}
\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler}\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}


{\ttfamily \#include $<$tcp.\+h$>$}

Inheritance diagram for max\+OS\+::net\+::Transmission\+Control\+Protocol\+Handler\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ab888d7bdcc105c2e47cde211edb8a2e6}{Transmission\+Control\+Protocol\+Handler}} (\mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolHandler}{Internet\+Protocol\+Handler}} $\ast$\mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolPayloadHandler_a3adb1aeac42ac73a8c52c2d00ebd9a2f}{internet\+Protocol\+Handler}}, \mbox{\hyperlink{classmaxOS_1_1common_1_1OutputStream}{common\+::\+Output\+Stream}} $\ast$\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a8bedb5143f41c426fb4bda0a503bb125}{error\+Messages}})
\item 
\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ae7db4243489b515c400b514f26a2e469}{$\sim$\+Transmission\+Control\+Protocol\+Handler}} ()
\item 
bool \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_abedc3bf545352a95defe6c8b3ad848cb}{handle\+Internet\+Protocol\+Payload}} (\mbox{\hyperlink{namespacemaxOS_1_1net_a6160a1724f91d5d2caafdde3185f5e32}{Internet\+Protocol\+Address}} \mbox{\hyperlink{ipv4_8h_aed74aa5789cabec794d6961455e80db3}{source\+IP}}, \mbox{\hyperlink{namespacemaxOS_1_1net_a6160a1724f91d5d2caafdde3185f5e32}{Internet\+Protocol\+Address}} \mbox{\hyperlink{ipv4_8h_afcc7048c1d9643cebaf1806fa4de390e}{destination\+IP}}, uint8\+\_\+t $\ast$payload\+Data, uint32\+\_\+t \mbox{\hyperlink{multiboot_8h_a6d813a0f2b5281b18dea3f4cda696c33}{size}})
\begin{DoxyCompactList}\small\item\em Handle the T\+CP message (provider end) \end{DoxyCompactList}\item 
\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$ \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a17ee7c16c6b71cd8087694a5bbbdbfc2}{Connect}} (\mbox{\hyperlink{namespacemaxOS_1_1net_a6160a1724f91d5d2caafdde3185f5e32}{Internet\+Protocol\+Address}} ip, \mbox{\hyperlink{namespacemaxOS_1_1net_ac3a0656aefa32bf06fe9577285dc5957}{Transmission\+Control\+Protocol\+Port}} port)
\begin{DoxyCompactList}\small\item\em Connect to a remote host through the T\+CP protocol. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$ \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ab7028b648665398ab3800cf639f9050c}{Connect}} (\mbox{\hyperlink{namespacemaxOS_afb37cc4e82c35155b8c0785e8d9fa937}{string}} internet\+Protocol\+Address\+And\+Port)
\item 
void \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ae456df7930b51668b3568f04bc622b54}{Disconnect}} (\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$socket)
\begin{DoxyCompactList}\small\item\em Begin the disconnect process. \end{DoxyCompactList}\item 
virtual \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$ \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ab809163f57ee08faff648b73201aaee5}{Listen}} (uint16\+\_\+t port)
\begin{DoxyCompactList}\small\item\em Begin listening on a port. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a41fc5f0834a02802e18e2c62a631772e}{Bind}} (\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$socket, \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolPayloadHandler}{Transmission\+Control\+Protocol\+Payload\+Handler}} $\ast$handler)
\begin{DoxyCompactList}\small\item\em Bind a data handler to this socket. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{send\+Transmission\+Control\+Protocol\+Packet}} (\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$socket, uint8\+\_\+t $\ast$\mbox{\hyperlink{icmp_8h_a1e43bf7d608e87228b625cca2c04d641}{data}}, uint16\+\_\+t \mbox{\hyperlink{multiboot_8h_a6d813a0f2b5281b18dea3f4cda696c33}{size}}, uint16\+\_\+t \mbox{\hyperlink{tcp_8h_aa2585d779da0ab21273a8d92de9a0ebe}{flags}}=0)
\begin{DoxyCompactList}\small\item\em Send a packet (Throught the provider) \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classmaxOS_1_1common_1_1OutputStream}{common\+::\+Output\+Stream}} $\ast$ \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a8bedb5143f41c426fb4bda0a503bb125}{error\+Messages}}
\item 
\mbox{\hyperlink{classmaxOS_1_1common_1_1Vector}{common\+::\+Vector}}$<$ \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$ $>$ \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a808523124196c3f969dfb80ba63572c8}{sockets}}
\end{DoxyCompactItemize}
\doxysubsection*{Static Protected Attributes}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{namespacemaxOS_1_1net_ac3a0656aefa32bf06fe9577285dc5957}{Transmission\+Control\+Protocol\+Port}} \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_aff5fa7f511f8c6c29944e3b3c801ff24}{free\+Ports}} = 0x8000
\begin{DoxyCompactList}\small\item\em {\bfseries{Handler}}/// \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Friends}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a6cb78908521ca4ec70a18ed72b6b96bf}{Transmission\+Control\+Protocol\+Socket}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 158 of file tcp.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ab888d7bdcc105c2e47cde211edb8a2e6}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ab888d7bdcc105c2e47cde211edb8a2e6}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!TransmissionControlProtocolHandler@{TransmissionControlProtocolHandler}}
\index{TransmissionControlProtocolHandler@{TransmissionControlProtocolHandler}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{TransmissionControlProtocolHandler()}{TransmissionControlProtocolHandler()}}
{\footnotesize\ttfamily Transmission\+Control\+Protocol\+Handler\+::\+Transmission\+Control\+Protocol\+Handler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolHandler}{Internet\+Protocol\+Handler}} $\ast$}]{internet\+Protocol\+Handler,  }\item[{\mbox{\hyperlink{classmaxOS_1_1common_1_1OutputStream}{common\+::\+Output\+Stream}} $\ast$}]{error\+Messages }\end{DoxyParamCaption})}



Definition at line 126 of file tcp.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{128 : \mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolPayloadHandler_aa84ea5b14f12e69aaa6ad2b2d95871dc}{InternetProtocolPayloadHandler}}(\mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolPayloadHandler_a3adb1aeac42ac73a8c52c2d00ebd9a2f}{internetProtocolHandler}}, 0x06)}
\DoxyCodeLine{129 \{}
\DoxyCodeLine{130     \textcolor{keyword}{this} -\/> \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a8bedb5143f41c426fb4bda0a503bb125}{errorMessages}} = \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a8bedb5143f41c426fb4bda0a503bb125}{errorMessages}};}
\DoxyCodeLine{131     }
\DoxyCodeLine{132 \}}

\end{DoxyCode}


References error\+Messages.

\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ae7db4243489b515c400b514f26a2e469}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ae7db4243489b515c400b514f26a2e469}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!````~TransmissionControlProtocolHandler@{$\sim$TransmissionControlProtocolHandler}}
\index{````~TransmissionControlProtocolHandler@{$\sim$TransmissionControlProtocolHandler}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{$\sim$TransmissionControlProtocolHandler()}{~TransmissionControlProtocolHandler()}}
{\footnotesize\ttfamily Transmission\+Control\+Protocol\+Handler\+::$\sim$\+Transmission\+Control\+Protocol\+Handler (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 134 of file tcp.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{135 \{}
\DoxyCodeLine{136 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a41fc5f0834a02802e18e2c62a631772e}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a41fc5f0834a02802e18e2c62a631772e}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!Bind@{Bind}}
\index{Bind@{Bind}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{Bind()}{Bind()}}
{\footnotesize\ttfamily void Transmission\+Control\+Protocol\+Handler\+::\+Bind (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$}]{socket,  }\item[{\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolPayloadHandler}{Transmission\+Control\+Protocol\+Payload\+Handler}} $\ast$}]{handler }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Bind a data handler to this socket. 


\begin{DoxyParams}{Parameters}
{\em socket} & The socket to bind the handler to \\
\hline
{\em transmission\+Control\+Protocol\+Handler} & The handler to bind \\
\hline
\end{DoxyParams}


Definition at line 568 of file tcp.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{569 \{}
\DoxyCodeLine{570   socket-\/>\mbox{\hyperlink{classmaxOS_1_1common_1_1EventManager_ad92d3d8264a5fe4a0cddb58e249c7670}{connect\_event\_handler}}(handler);}
\DoxyCodeLine{571 \}}

\end{DoxyCode}


References max\+O\+S\+::common\+::\+Event\+Manager$<$ Event\+Type $>$\+::connect\+\_\+event\+\_\+handler().

\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a17ee7c16c6b71cd8087694a5bbbdbfc2}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a17ee7c16c6b71cd8087694a5bbbdbfc2}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!Connect@{Connect}}
\index{Connect@{Connect}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{Connect()}{Connect()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$ Transmission\+Control\+Protocol\+Handler\+::\+Connect (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacemaxOS_1_1net_a6160a1724f91d5d2caafdde3185f5e32}{Internet\+Protocol\+Address}}}]{ip,  }\item[{\mbox{\hyperlink{namespacemaxOS_1_1net_ac3a0656aefa32bf06fe9577285dc5957}{Transmission\+Control\+Protocol\+Port}}}]{port }\end{DoxyParamCaption})}



Connect to a remote host through the T\+CP protocol. 


\begin{DoxyParams}{Parameters}
{\em ip} & The IP of the remote host \\
\hline
{\em port} & The port of the remote host \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The socket that is connected to the remote host, 0 if it failed 
\end{DoxyReturn}


Definition at line 449 of file tcp.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{450 \{}
\DoxyCodeLine{451     \textcolor{comment}{//Create a new socket}}
\DoxyCodeLine{452     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{TransmissionControlProtocolSocket}}* socket = (\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{TransmissionControlProtocolSocket}}*)MemoryManager::s\_active\_memory\_manager-\/> malloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{TransmissionControlProtocolSocket}}));}
\DoxyCodeLine{453 }
\DoxyCodeLine{454     \textcolor{comment}{//If there is space for the socket}}
\DoxyCodeLine{455     \textcolor{keywordflow}{if}(socket != 0)}
\DoxyCodeLine{456     \{}
\DoxyCodeLine{457         \textcolor{comment}{//Set the socket}}
\DoxyCodeLine{458         \textcolor{keyword}{new} (socket) \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a6cb78908521ca4ec70a18ed72b6b96bf}{TransmissionControlProtocolSocket}}(\textcolor{keyword}{this});}
\DoxyCodeLine{459 }
\DoxyCodeLine{460         \textcolor{comment}{//Set local and remote addresses}}
\DoxyCodeLine{461         socket -\/> remotePort = port;}
\DoxyCodeLine{462         socket -\/> remoteIP = ip;}
\DoxyCodeLine{463         socket -\/> localPort = \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_aff5fa7f511f8c6c29944e3b3c801ff24}{freePorts}}++;}
\DoxyCodeLine{464         socket -\/> localIP = \mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolPayloadHandler_a3adb1aeac42ac73a8c52c2d00ebd9a2f}{internetProtocolHandler}} -\/> GetInternetProtocolAddress();}
\DoxyCodeLine{465 }
\DoxyCodeLine{466         \textcolor{comment}{//Convert into big endian}}
\DoxyCodeLine{467         socket -\/> remotePort = ((socket -\/> remotePort \& 0xFF00)>>8) | ((socket -\/> remotePort \& 0x00FF) << 8);}
\DoxyCodeLine{468         socket -\/> localPort = ((socket -\/> localPort \& 0xFF00)>>8) | ((socket -\/> localPort \& 0x00FF) << 8);}
\DoxyCodeLine{469 }
\DoxyCodeLine{470         \textcolor{comment}{//Set the socket into the socket array and then set its state}}
\DoxyCodeLine{471         \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a808523124196c3f969dfb80ba63572c8}{sockets}}.push\_back(socket);}
\DoxyCodeLine{472         socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a85b031dafe6562bc4f160b2e1205aa09}{SYN\_SENT}};}
\DoxyCodeLine{473 }
\DoxyCodeLine{474         \textcolor{comment}{//Dummy sequence number}}
\DoxyCodeLine{475         socket -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}} = 0xbeefcafe;}
\DoxyCodeLine{476 }
\DoxyCodeLine{477         \textcolor{comment}{//Send a sync packet}}
\DoxyCodeLine{478         \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}});}
\DoxyCodeLine{479     \}}
\DoxyCodeLine{480 }
\DoxyCodeLine{481     \textcolor{keywordflow}{return} socket;}
\DoxyCodeLine{482 \}}

\end{DoxyCode}


References free\+Ports, max\+O\+S\+::net\+::\+Internet\+Protocol\+Payload\+Handler\+::internet\+Protocol\+Handler, send\+Transmission\+Control\+Protocol\+Packet(), sequence\+Number, sockets, max\+O\+S\+::net\+::\+S\+YN, max\+O\+S\+::net\+::\+S\+Y\+N\+\_\+\+S\+E\+NT, and Transmission\+Control\+Protocol\+Socket.



Referenced by Connect().

\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ab7028b648665398ab3800cf639f9050c}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ab7028b648665398ab3800cf639f9050c}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!Connect@{Connect}}
\index{Connect@{Connect}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{Connect()}{Connect()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$ Transmission\+Control\+Protocol\+Handler\+::\+Connect (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacemaxOS_afb37cc4e82c35155b8c0785e8d9fa937}{string}}}]{internet\+Protocol\+Address\+And\+Port }\end{DoxyParamCaption})}



Definition at line 485 of file tcp.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{485                                                                                                                     \{}
\DoxyCodeLine{486     \textcolor{comment}{// Find the colon (:) character in the input string}}
\DoxyCodeLine{487     \textcolor{keywordtype}{string} colonPosition = (\mbox{\hyperlink{namespacemaxOS_afb37cc4e82c35155b8c0785e8d9fa937}{string}})internetProtocolAddressAndPort;}
\DoxyCodeLine{488     \textcolor{keywordflow}{for} (; *colonPosition != \textcolor{charliteral}{'\(\backslash\)0'}; colonPosition++) \{}
\DoxyCodeLine{489         \textcolor{keywordflow}{if} (*colonPosition == \textcolor{charliteral}{':'}) \{}
\DoxyCodeLine{490             \textcolor{comment}{// Break the loop if a colon is found}}
\DoxyCodeLine{491             \textcolor{keywordflow}{break};}
\DoxyCodeLine{492         \}}
\DoxyCodeLine{493     \}}
\DoxyCodeLine{494 }
\DoxyCodeLine{495     \textcolor{comment}{// If no colon is found, return 0}}
\DoxyCodeLine{496     \textcolor{keywordflow}{if} (*colonPosition != \textcolor{charliteral}{':'}) \{}
\DoxyCodeLine{497         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{498     \}}
\DoxyCodeLine{499 }
\DoxyCodeLine{500     \textcolor{comment}{// Parse the InternetProtocolAddress from the input string}}
\DoxyCodeLine{501     \mbox{\hyperlink{namespacemaxOS_1_1net_a6160a1724f91d5d2caafdde3185f5e32}{InternetProtocolAddress}} remoteAddress = \mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolHandler_afe355c241075103457e041325d9b86c0}{InternetProtocolHandler::Parse}}(internetProtocolAddressAndPort);}
\DoxyCodeLine{502 }
\DoxyCodeLine{503     \textcolor{comment}{// Initialize the TransmissionControlProtocolPort to 0}}
\DoxyCodeLine{504     \mbox{\hyperlink{namespacemaxOS_1_1net_ac3a0656aefa32bf06fe9577285dc5957}{TransmissionControlProtocolPort}} port = 0;}
\DoxyCodeLine{505 }
\DoxyCodeLine{506     \textcolor{comment}{// Iterate through the string after the colon to extract the port number}}
\DoxyCodeLine{507     \textcolor{keywordflow}{for} (colonPosition++; *colonPosition != \textcolor{charliteral}{'\(\backslash\)0'}; colonPosition++) \{}
\DoxyCodeLine{508         \textcolor{keywordflow}{if} (\textcolor{charliteral}{'0'} <= *colonPosition \&\& *colonPosition <= \textcolor{charliteral}{'9'}) \{}
\DoxyCodeLine{509             \textcolor{comment}{// Calculate the port number by converting characters to integers}}
\DoxyCodeLine{510             port = port * 10 + (*colonPosition -\/ \textcolor{charliteral}{'0'});}
\DoxyCodeLine{511         \}}
\DoxyCodeLine{512     \}}
\DoxyCodeLine{513 }
\DoxyCodeLine{514     \textcolor{comment}{// Connect to the remote address and port}}
\DoxyCodeLine{515     \textcolor{keywordflow}{return} \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a17ee7c16c6b71cd8087694a5bbbdbfc2}{Connect}}(remoteAddress, port);}
\DoxyCodeLine{516 \}}

\end{DoxyCode}


References Connect(), max\+O\+S\+::net\+::\+Internet\+Protocol\+Handler\+::\+Parse(), and max\+O\+S\+::string.

\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ae456df7930b51668b3568f04bc622b54}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ae456df7930b51668b3568f04bc622b54}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!Disconnect@{Disconnect}}
\index{Disconnect@{Disconnect}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{Disconnect()}{Disconnect()}}
{\footnotesize\ttfamily void Transmission\+Control\+Protocol\+Handler\+::\+Disconnect (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$}]{socket }\end{DoxyParamCaption})}



Begin the disconnect process. 


\begin{DoxyParams}{Parameters}
{\em socket} & The socket to disconnect \\
\hline
\end{DoxyParams}


Definition at line 523 of file tcp.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{524 \{}
\DoxyCodeLine{525 }
\DoxyCodeLine{526     socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a0b994147e6a7e8aee930bffb4edb6b32}{FIN\_WAIT1}};                            \textcolor{comment}{//Begin fin wait sequence}}
\DoxyCodeLine{527     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cacbe9c8b3fd1be16375db02cf13b8426f}{FIN}} + \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}});            \textcolor{comment}{//Send FIN|ACK packet}}
\DoxyCodeLine{528     socket -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}}++;                             \textcolor{comment}{//Increase the sequence number}}
\DoxyCodeLine{529 \}}

\end{DoxyCode}


References max\+O\+S\+::net\+::\+A\+CK, max\+O\+S\+::net\+::\+F\+IN, max\+O\+S\+::net\+::\+F\+I\+N\+\_\+\+W\+A\+I\+T1, send\+Transmission\+Control\+Protocol\+Packet(), and sequence\+Number.

\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_abedc3bf545352a95defe6c8b3ad848cb}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_abedc3bf545352a95defe6c8b3ad848cb}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!handleInternetProtocolPayload@{handleInternetProtocolPayload}}
\index{handleInternetProtocolPayload@{handleInternetProtocolPayload}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{handleInternetProtocolPayload()}{handleInternetProtocolPayload()}}
{\footnotesize\ttfamily bool Transmission\+Control\+Protocol\+Handler\+::handle\+Internet\+Protocol\+Payload (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacemaxOS_1_1net_a6160a1724f91d5d2caafdde3185f5e32}{Internet\+Protocol\+Address}}}]{source\+IP,  }\item[{\mbox{\hyperlink{namespacemaxOS_1_1net_a6160a1724f91d5d2caafdde3185f5e32}{Internet\+Protocol\+Address}}}]{destination\+IP,  }\item[{uint8\+\_\+t $\ast$}]{payload\+Data,  }\item[{uint32\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Handle the T\+CP message (provider end) 


\begin{DoxyParams}{Parameters}
{\em src\+I\+P\+\_\+\+BE} & The source IP address \\
\hline
{\em dst\+I\+P\+\_\+\+BE} & The destination IP address \\
\hline
{\em internetprotocol\+Payload} & The payload \\
\hline
{\em size} & The size of the payload \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if data is to be sent back or false if not 
\end{DoxyReturn}


Reimplemented from \mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolPayloadHandler_aaef48d6a7ff6c478f9bf561097c82c01}{max\+O\+S\+::net\+::\+Internet\+Protocol\+Payload\+Handler}}.



Definition at line 162 of file tcp.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{163 \{}
\DoxyCodeLine{164 }
\DoxyCodeLine{165     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a8bedb5143f41c426fb4bda0a503bb125}{errorMessages}} -\/> write(\textcolor{stringliteral}{"TCP: Handling TCP message\(\backslash\)n"});}
\DoxyCodeLine{166 }
\DoxyCodeLine{167     \textcolor{comment}{//Check if the size is too small}}
\DoxyCodeLine{168     \textcolor{keywordflow}{if}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} < 13)}
\DoxyCodeLine{169     \{}
\DoxyCodeLine{170         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{171     \}}
\DoxyCodeLine{172 }
\DoxyCodeLine{173     \textcolor{comment}{// If it's smaller than the header, return}}
\DoxyCodeLine{174     \textcolor{keywordflow}{if}(\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} < 4*payloadData[12]/16)             \textcolor{comment}{// The lower 4 bits of the 13th byte is the header length}}
\DoxyCodeLine{175     \{}
\DoxyCodeLine{176         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{177     \}}
\DoxyCodeLine{178 }
\DoxyCodeLine{179     \textcolor{comment}{//Get the header}}
\DoxyCodeLine{180     \mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolHeader}{TransmissionControlProtocolHeader}}* msg = (\mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolHeader}{TransmissionControlProtocolHeader}}*)payloadData;}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     \textcolor{comment}{//Get the connection values (convert to host endian)}}
\DoxyCodeLine{183     uint16\_t localPort = \mbox{\hyperlink{tcp_8cpp_abfe30d4c4185706700ed78df8308a63e}{bigEndian16}}(msg -\/> \mbox{\hyperlink{tcp_8h_ac01766720e5781a418710ebf1ba5379e}{dstPort}});}
\DoxyCodeLine{184     uint16\_t remotePort = \mbox{\hyperlink{tcp_8cpp_abfe30d4c4185706700ed78df8308a63e}{bigEndian16}}(msg -\/> \mbox{\hyperlink{tcp_8h_a26ebbf4f65c3f6fd9959d9cecef5c9d8}{srcPort}});}
\DoxyCodeLine{185 }
\DoxyCodeLine{186     \textcolor{comment}{//Create the socket}}
\DoxyCodeLine{187     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{TransmissionControlProtocolSocket}}* socket = 0;}
\DoxyCodeLine{188 }
\DoxyCodeLine{189     \textcolor{keywordflow}{for}(\mbox{\hyperlink{classmaxOS_1_1common_1_1Rectangle}{Vector<TransmissionControlProtocolSocket*>::iterator}} currentSocket = \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a808523124196c3f969dfb80ba63572c8}{sockets}}.begin(); currentSocket != \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a808523124196c3f969dfb80ba63572c8}{sockets}}.end(); currentSocket++)}
\DoxyCodeLine{190     \{}
\DoxyCodeLine{191         \textcolor{keywordflow}{if}( (*currentSocket) -\/> localPort == localPort                               \textcolor{comment}{//Check if the local port is the same as the destination port}}
\DoxyCodeLine{192         \&\&  (*currentSocket) -\/> localIP == \mbox{\hyperlink{ipv4_8h_afcc7048c1d9643cebaf1806fa4de390e}{destinationIP}}                                  \textcolor{comment}{//Check if the local IP is the same as the destination IP}}
\DoxyCodeLine{193         \&\&  (*currentSocket) -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a56252a0c93c53f83dc0b20badbf38b08}{LISTEN}}                                           \textcolor{comment}{//Check if the socket is in the LISTEN state}}
\DoxyCodeLine{194         \&\& (((msg -\/> \mbox{\hyperlink{amd__am79c973_8h_a773b39d480759f67926cb18ae2219281}{flags}}) \& (\mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}} | \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}})) == \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}}))                                       \textcolor{comment}{//Check if the SYN flag is set (allow for acknoweldgement)}}
\DoxyCodeLine{195         \{}
\DoxyCodeLine{196             socket = *currentSocket;}
\DoxyCodeLine{197         \}}
\DoxyCodeLine{198         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( (*currentSocket) -\/> localPort == localPort                          \textcolor{comment}{//Check if the local port is the same as the destination port}}
\DoxyCodeLine{199              \&\&  (*currentSocket) -\/> localIP == \mbox{\hyperlink{ipv4_8h_afcc7048c1d9643cebaf1806fa4de390e}{destinationIP}}                             \textcolor{comment}{//Check if the local IP is the same as the destination IP}}
\DoxyCodeLine{200              \&\&  (*currentSocket) -\/> remotePort == remotePort                         \textcolor{comment}{//Check if the remote port is the same as the source port}}
\DoxyCodeLine{201              \&\&  (*currentSocket) -\/> remoteIP == \mbox{\hyperlink{ipv4_8h_afcc7048c1d9643cebaf1806fa4de390e}{destinationIP}})                           \textcolor{comment}{//Check if the remote IP is the same as the source IP}}
\DoxyCodeLine{202         \{}
\DoxyCodeLine{203             socket = *currentSocket;}
\DoxyCodeLine{204         \}}
\DoxyCodeLine{205     \}}
\DoxyCodeLine{206 }
\DoxyCodeLine{207 }
\DoxyCodeLine{208     \textcolor{keywordtype}{bool} reset = \textcolor{keyword}{false};}
\DoxyCodeLine{209 }
\DoxyCodeLine{210     \textcolor{comment}{//Check if the socket is found and if the socket wants to reset}}
\DoxyCodeLine{211     \textcolor{keywordflow}{if}(socket != 0 \&\& msg -\/> \mbox{\hyperlink{amd__am79c973_8h_a773b39d480759f67926cb18ae2219281}{flags}} \& \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca31cabdff85581b8e911b181b628e83be}{RST}})}
\DoxyCodeLine{212     \{}
\DoxyCodeLine{213         socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8ac0582d073da4f6dfdd4aa5983f0aca46}{CLOSED}};}
\DoxyCodeLine{214         socket -\/> Disconnected();}
\DoxyCodeLine{215     \}}
\DoxyCodeLine{216 }
\DoxyCodeLine{217     \textcolor{comment}{//Check if the socket is found and if the socket is not closed}}
\DoxyCodeLine{218     \textcolor{keywordflow}{if}(socket != 0 \&\& socket -\/> state != \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8ac0582d073da4f6dfdd4aa5983f0aca46}{CLOSED}})}
\DoxyCodeLine{219     \{}
\DoxyCodeLine{220         \textcolor{keywordflow}{switch}((msg -\/> \mbox{\hyperlink{amd__am79c973_8h_a773b39d480759f67926cb18ae2219281}{flags}}) \& (\mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}} | \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}} | \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cacbe9c8b3fd1be16375db02cf13b8426f}{FIN}}))}
\DoxyCodeLine{221         \{}
\DoxyCodeLine{222             \textcolor{comment}{/*}}
\DoxyCodeLine{223 \textcolor{comment}{             * Example for explanation:}}
\DoxyCodeLine{224 \textcolor{comment}{             * socket -\/> state = SYN\_RECEIVED;                                                  //The state of the socket, e.g. recieved, or established. This is used to know how to handle the socket}}
\DoxyCodeLine{225 \textcolor{comment}{             * socket -\/> remotePort = msg -\/> srcPort;                                           //The remote port, e.g. the port of the server}}
\DoxyCodeLine{226 \textcolor{comment}{             * socket -\/> remoteIP = srcIP\_BE;                                                   //The remote IP, e.g. the IP of the server}}
\DoxyCodeLine{227 \textcolor{comment}{             * socket -\/> acknowledgementNumber = bigEndian32( msg -\/> sequenceNumber ) + 1;      //The acknowledgement number, the number used to keep track of what has been received, this is just incremented by 1 each time}}
\DoxyCodeLine{228 \textcolor{comment}{             * socket -\/> sequenceNumber = 0xbeefcafe;                                           //The sequence number, the number of the next set that is to be sent but in this case sequence isnt enabled so just set it to anything}}
\DoxyCodeLine{229 \textcolor{comment}{             * Send(socket, 0,0, SYN|ACK);                                                      //The response command, genneraly has to have the acknoledgement flag set}}
\DoxyCodeLine{230 \textcolor{comment}{             * socket -\/> sequenceNumber++;                                                      //Increment the sequence number}}
\DoxyCodeLine{231 \textcolor{comment}{             *}}
\DoxyCodeLine{232 \textcolor{comment}{             */}}
\DoxyCodeLine{233 }
\DoxyCodeLine{234             \textcolor{keywordflow}{case} \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}}:}
\DoxyCodeLine{235                 \textcolor{keywordflow}{if}(socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a56252a0c93c53f83dc0b20badbf38b08}{LISTEN}})}
\DoxyCodeLine{236                 \{}
\DoxyCodeLine{237                     socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a35f68f623dff382c7ce78e66567651ef}{SYN\_RECEIVED}};}
\DoxyCodeLine{238                     socket -\/> remotePort = msg -\/> \mbox{\hyperlink{tcp_8h_a26ebbf4f65c3f6fd9959d9cecef5c9d8}{srcPort}};}
\DoxyCodeLine{239                     socket -\/> remoteIP = \mbox{\hyperlink{ipv4_8h_aed74aa5789cabec794d6961455e80db3}{sourceIP}};}
\DoxyCodeLine{240                     socket -\/> \mbox{\hyperlink{tcp_8h_ac41c406579d1214f4a1f0338bca28b6a}{acknowledgementNumber}} = \mbox{\hyperlink{tcp_8cpp_abb0f64c6581be532c99e657e200718a1}{bigEndian32}}( msg -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}} ) + 1;}
\DoxyCodeLine{241                     socket -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}} = 0xbeefcafe;}
\DoxyCodeLine{242                     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}}|\mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}});}
\DoxyCodeLine{243                     socket -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}}++;}
\DoxyCodeLine{244                 \}}
\DoxyCodeLine{245                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{246                     reset = \textcolor{keyword}{true};}
\DoxyCodeLine{247                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{248 }
\DoxyCodeLine{249 }
\DoxyCodeLine{250             \textcolor{keywordflow}{case} \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}} | \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}}:}
\DoxyCodeLine{251                 \textcolor{keywordflow}{if}(socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a85b031dafe6562bc4f160b2e1205aa09}{SYN\_SENT}})}
\DoxyCodeLine{252                 \{}
\DoxyCodeLine{253                     socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a9e2bb0c6cec3526517a90d752da6d83f}{ESTABLISHED}};}
\DoxyCodeLine{254                     socket -\/> \mbox{\hyperlink{tcp_8h_ac41c406579d1214f4a1f0338bca28b6a}{acknowledgementNumber}} = \mbox{\hyperlink{tcp_8cpp_abb0f64c6581be532c99e657e200718a1}{bigEndian32}}( msg -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}} ) + 1;}
\DoxyCodeLine{255                     socket -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}}++;}
\DoxyCodeLine{256                     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}});}
\DoxyCodeLine{257                 \}}
\DoxyCodeLine{258                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{259                     reset = \textcolor{keyword}{true};}
\DoxyCodeLine{260                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{261 }
\DoxyCodeLine{262 }
\DoxyCodeLine{263             \textcolor{keywordflow}{case} \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}} | \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cacbe9c8b3fd1be16375db02cf13b8426f}{FIN}}:}
\DoxyCodeLine{264             \textcolor{keywordflow}{case} \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}} | \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cacbe9c8b3fd1be16375db02cf13b8426f}{FIN}} | \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}}:}
\DoxyCodeLine{265                 reset = \textcolor{keyword}{true};}
\DoxyCodeLine{266                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{267 }
\DoxyCodeLine{268 }
\DoxyCodeLine{269             \textcolor{keywordflow}{case} \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cacbe9c8b3fd1be16375db02cf13b8426f}{FIN}}:}
\DoxyCodeLine{270             \textcolor{keywordflow}{case} \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cacbe9c8b3fd1be16375db02cf13b8426f}{FIN}}|\mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}}:}
\DoxyCodeLine{271                 \textcolor{keywordflow}{if}(socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a9e2bb0c6cec3526517a90d752da6d83f}{ESTABLISHED}})}
\DoxyCodeLine{272                 \{}
\DoxyCodeLine{273                     socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a89eda32fbf52080bd0fc7fffa19c50c4}{CLOSE\_WAIT}};}
\DoxyCodeLine{274                     socket -\/> \mbox{\hyperlink{tcp_8h_ac41c406579d1214f4a1f0338bca28b6a}{acknowledgementNumber}}++;}
\DoxyCodeLine{275                     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}});}
\DoxyCodeLine{276                     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cacbe9c8b3fd1be16375db02cf13b8426f}{FIN}}|\mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}});}
\DoxyCodeLine{277                     socket -\/> Disconnected();}
\DoxyCodeLine{278                 \}}
\DoxyCodeLine{279                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a89eda32fbf52080bd0fc7fffa19c50c4}{CLOSE\_WAIT}})}
\DoxyCodeLine{280                 \{}
\DoxyCodeLine{281                     socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8ac0582d073da4f6dfdd4aa5983f0aca46}{CLOSED}};}
\DoxyCodeLine{282                 \}}
\DoxyCodeLine{283                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a0b994147e6a7e8aee930bffb4edb6b32}{FIN\_WAIT1}} || socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8aa27fd942ed402a2700afbc5a859d30eb}{FIN\_WAIT2}})}
\DoxyCodeLine{284                 \{}
\DoxyCodeLine{285                     socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8ac0582d073da4f6dfdd4aa5983f0aca46}{CLOSED}};}
\DoxyCodeLine{286                     socket -\/> \mbox{\hyperlink{tcp_8h_ac41c406579d1214f4a1f0338bca28b6a}{acknowledgementNumber}}++;}
\DoxyCodeLine{287                     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}});}
\DoxyCodeLine{288                     socket -\/> Disconnected();}
\DoxyCodeLine{289                 \}}
\DoxyCodeLine{290                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{291                     reset = \textcolor{keyword}{true};}
\DoxyCodeLine{292                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{293 }
\DoxyCodeLine{294 }
\DoxyCodeLine{295             \textcolor{keywordflow}{case} \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}}:}
\DoxyCodeLine{296                 \textcolor{keywordflow}{if}(socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a35f68f623dff382c7ce78e66567651ef}{SYN\_RECEIVED}})}
\DoxyCodeLine{297                 \{}
\DoxyCodeLine{298                     socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a9e2bb0c6cec3526517a90d752da6d83f}{ESTABLISHED}};}
\DoxyCodeLine{299                     socket -\/> Connected();}
\DoxyCodeLine{300                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{301                 \}}
\DoxyCodeLine{302                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a0b994147e6a7e8aee930bffb4edb6b32}{FIN\_WAIT1}})}
\DoxyCodeLine{303                 \{}
\DoxyCodeLine{304                     socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8aa27fd942ed402a2700afbc5a859d30eb}{FIN\_WAIT2}};}
\DoxyCodeLine{305                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{306                 \}}
\DoxyCodeLine{307                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a89eda32fbf52080bd0fc7fffa19c50c4}{CLOSE\_WAIT}})}
\DoxyCodeLine{308                 \{}
\DoxyCodeLine{309                     socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8ac0582d073da4f6dfdd4aa5983f0aca46}{CLOSED}};}
\DoxyCodeLine{310                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{311                 \}}
\DoxyCodeLine{312 }
\DoxyCodeLine{313                 \textcolor{keywordflow}{if}(msg -\/> \mbox{\hyperlink{amd__am79c973_8h_a773b39d480759f67926cb18ae2219281}{flags}} == \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}})}
\DoxyCodeLine{314                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{315 }
\DoxyCodeLine{316                 \textcolor{comment}{// no break, because of piggybacking}}
\DoxyCodeLine{317 }
\DoxyCodeLine{318             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{319 }
\DoxyCodeLine{320                 \textcolor{comment}{//By default handle the data}}
\DoxyCodeLine{321 }
\DoxyCodeLine{322                 \textcolor{keywordflow}{if}(\mbox{\hyperlink{tcp_8cpp_abb0f64c6581be532c99e657e200718a1}{bigEndian32}}(msg -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}}) == socket -\/> \mbox{\hyperlink{tcp_8h_ac41c406579d1214f4a1f0338bca28b6a}{acknowledgementNumber}})}
\DoxyCodeLine{323                 \{}
\DoxyCodeLine{324 }
\DoxyCodeLine{325                     reset = !(socket -\/> handleTransmissionControlProtocolPayload(payloadData + msg -\/> \mbox{\hyperlink{tcp_8h_a3909a49a58301aec6d401cdd9ae76f5a}{headerSize32}}*4,\mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} -\/ msg -\/> \mbox{\hyperlink{tcp_8h_a3909a49a58301aec6d401cdd9ae76f5a}{headerSize32}}*4));}
\DoxyCodeLine{326                     \textcolor{keywordflow}{if}(!reset)}
\DoxyCodeLine{327                     \{}
\DoxyCodeLine{328                         \textcolor{keywordtype}{int} \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4adba0b26586463c1871896762f205c0e2}{x}} = 0;                                                                      \textcolor{comment}{//The number of bytes to send back}}
\DoxyCodeLine{329                         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}} = msg -\/> \mbox{\hyperlink{tcp_8h_a3909a49a58301aec6d401cdd9ae76f5a}{headerSize32}}*4; \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}} < \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}; \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}}++)                               \textcolor{comment}{//Loop through the data}}
\DoxyCodeLine{330                             \textcolor{keywordflow}{if}(payloadData[\mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}}] != 0)                                                     \textcolor{comment}{//Check if the data is not 0}}
\DoxyCodeLine{331                                 \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4adba0b26586463c1871896762f205c0e2}{x}} = \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}};                                                                  \textcolor{comment}{//Set the number of bytes to send back to the current index}}
\DoxyCodeLine{332                         socket -\/> \mbox{\hyperlink{tcp_8h_ac41c406579d1214f4a1f0338bca28b6a}{acknowledgementNumber}} += \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4adba0b26586463c1871896762f205c0e2}{x}} -\/ msg -\/> \mbox{\hyperlink{tcp_8h_a3909a49a58301aec6d401cdd9ae76f5a}{headerSize32}}*4 + 1;               \textcolor{comment}{//Increment the acknowledgement number by the number of bytes to send back}}
\DoxyCodeLine{333                         \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288cac39429d5f83fbf4480bbaa8e9989101a}{ACK}});                                          \textcolor{comment}{//Send the acknowledgement}}
\DoxyCodeLine{334                     \}}
\DoxyCodeLine{335                 \}}
\DoxyCodeLine{336                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{337                 \{}
\DoxyCodeLine{338                     \textcolor{comment}{// data in wrong order}}
\DoxyCodeLine{339                     reset = \textcolor{keyword}{true};}
\DoxyCodeLine{340                 \}}
\DoxyCodeLine{341 }
\DoxyCodeLine{342         \}}
\DoxyCodeLine{343     \}}
\DoxyCodeLine{344 }
\DoxyCodeLine{345 }
\DoxyCodeLine{346 }
\DoxyCodeLine{347     \textcolor{keywordflow}{if}(reset)                                                                       \textcolor{comment}{//If the socket is to be reset}}
\DoxyCodeLine{348     \{}
\DoxyCodeLine{349         \textcolor{keywordflow}{if}(socket != 0)                                                             \textcolor{comment}{//If the socket exists then send a reset flag}}
\DoxyCodeLine{350         \{}
\DoxyCodeLine{351             \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca31cabdff85581b8e911b181b628e83be}{RST}});}
\DoxyCodeLine{352         \}}
\DoxyCodeLine{353         \textcolor{keywordflow}{else}                                                                        \textcolor{comment}{//If it doesnt exist then create a new socket and send a reset flag}}
\DoxyCodeLine{354         \{}
\DoxyCodeLine{355             \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{TransmissionControlProtocolSocket}} socket(\textcolor{keyword}{this});                     \textcolor{comment}{//Create a new socket}}
\DoxyCodeLine{356             socket.\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket_a774a603e810b39dbf44a6edf8fe103bb}{remotePort}} = msg -\/> \mbox{\hyperlink{tcp_8h_a26ebbf4f65c3f6fd9959d9cecef5c9d8}{srcPort}};                                         \textcolor{comment}{//Set the remote port}}
\DoxyCodeLine{357             socket.\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket_a831a45e082ae10012cce8639d091b2ee}{remoteIP}} = \mbox{\hyperlink{ipv4_8h_aed74aa5789cabec794d6961455e80db3}{sourceIP}};                                                 \textcolor{comment}{//Set the remote IP}}
\DoxyCodeLine{358             socket.\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket_a2393bd54f9aca116e6ff94086f7d7ab5}{localPort}} = msg -\/> \mbox{\hyperlink{tcp_8h_ac01766720e5781a418710ebf1ba5379e}{dstPort}};                                                  \textcolor{comment}{//Set the local port}}
\DoxyCodeLine{359             socket.\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket_a2852168de0b476f3852d285e5092be92}{localIP}} = \mbox{\hyperlink{ipv4_8h_afcc7048c1d9643cebaf1806fa4de390e}{destinationIP}};                                                     \textcolor{comment}{//Set the local IP}}
\DoxyCodeLine{360             socket.\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket_ae122b236c9f1601a00256e76bc4b685a}{sequenceNumber}} = \mbox{\hyperlink{tcp_8cpp_abb0f64c6581be532c99e657e200718a1}{bigEndian32}}(msg -\/> \mbox{\hyperlink{tcp_8h_ac41c406579d1214f4a1f0338bca28b6a}{acknowledgementNumber}});              \textcolor{comment}{//Set the sequence number}}
\DoxyCodeLine{361             socket.\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket_aa2864940c530277ea7e792b148f2e682}{acknowledgementNumber}} = \mbox{\hyperlink{tcp_8cpp_abb0f64c6581be532c99e657e200718a1}{bigEndian32}}(msg -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}}) + 1;          \textcolor{comment}{//Set the acknowledgement number}}
\DoxyCodeLine{362             \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}{sendTransmissionControlProtocolPacket}}(\&socket, 0,0, \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca31cabdff85581b8e911b181b628e83be}{RST}});          \textcolor{comment}{//Send the reset flag}}
\DoxyCodeLine{363         \}}
\DoxyCodeLine{364     \}}
\DoxyCodeLine{365 }
\DoxyCodeLine{366 }
\DoxyCodeLine{367     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a8bedb5143f41c426fb4bda0a503bb125}{errorMessages}} -\/>\mbox{\hyperlink{classmaxOS_1_1common_1_1OutputStream_acd9ebbe1729dded0d4156f32ae77da95}{write}}(\textcolor{stringliteral}{"TCP: Handled packet\(\backslash\)n"});}
\DoxyCodeLine{368 }
\DoxyCodeLine{369     \textcolor{keywordflow}{if}(socket != 0 \&\& socket -\/> state == \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8ac0582d073da4f6dfdd4aa5983f0aca46}{CLOSED}})                                        \textcolor{comment}{//If the socket is closed then remove it from the list}}
\DoxyCodeLine{370     \{}
\DoxyCodeLine{371         \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a808523124196c3f969dfb80ba63572c8}{sockets}}.erase(socket);}
\DoxyCodeLine{372         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{373     \}}
\DoxyCodeLine{374 }
\DoxyCodeLine{375 }
\DoxyCodeLine{376 }
\DoxyCodeLine{377     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{378 \}}

\end{DoxyCode}


References max\+O\+S\+::net\+::\+A\+CK, acknowledgement\+Number, max\+O\+S\+::net\+::\+Transmission\+Control\+Protocol\+Socket\+::acknowledgement\+Number, big\+Endian16(), big\+Endian32(), max\+O\+S\+::net\+::\+C\+L\+O\+S\+E\+\_\+\+W\+A\+IT, max\+O\+S\+::net\+::\+C\+L\+O\+S\+ED, destination\+IP, dst\+Port, error\+Messages, max\+O\+S\+::net\+::\+E\+S\+T\+A\+B\+L\+I\+S\+H\+ED, max\+O\+S\+::net\+::\+F\+IN, max\+O\+S\+::net\+::\+F\+I\+N\+\_\+\+W\+A\+I\+T1, max\+O\+S\+::net\+::\+F\+I\+N\+\_\+\+W\+A\+I\+T2, flags, header\+Size32, max\+O\+S\+::drivers\+::peripherals\+::i, max\+O\+S\+::net\+::\+L\+I\+S\+T\+EN, max\+O\+S\+::net\+::\+Transmission\+Control\+Protocol\+Socket\+::local\+IP, max\+O\+S\+::net\+::\+Transmission\+Control\+Protocol\+Socket\+::local\+Port, max\+O\+S\+::net\+::\+Transmission\+Control\+Protocol\+Socket\+::remote\+IP, max\+O\+S\+::net\+::\+Transmission\+Control\+Protocol\+Socket\+::remote\+Port, max\+O\+S\+::net\+::\+R\+ST, send\+Transmission\+Control\+Protocol\+Packet(), sequence\+Number, max\+O\+S\+::net\+::\+Transmission\+Control\+Protocol\+Socket\+::sequence\+Number, size, sockets, source\+IP, src\+Port, max\+O\+S\+::net\+::\+S\+YN, max\+O\+S\+::net\+::\+S\+Y\+N\+\_\+\+R\+E\+C\+E\+I\+V\+ED, max\+O\+S\+::net\+::\+S\+Y\+N\+\_\+\+S\+E\+NT, max\+O\+S\+::common\+::\+Output\+Stream\+::write(), and max\+O\+S\+::drivers\+::peripherals\+::x.

\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ab809163f57ee08faff648b73201aaee5}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ab809163f57ee08faff648b73201aaee5}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!Listen@{Listen}}
\index{Listen@{Listen}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{Listen()}{Listen()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$ Transmission\+Control\+Protocol\+Handler\+::\+Listen (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{port }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Begin listening on a port. 


\begin{DoxyParams}{Parameters}
{\em port} & The port to listen on \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The socket that will handle the connection 
\end{DoxyReturn}


Definition at line 537 of file tcp.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{538 \{}
\DoxyCodeLine{539     \textcolor{comment}{//Create a new socket}}
\DoxyCodeLine{540     \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{TransmissionControlProtocolSocket}}* socket = (\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{TransmissionControlProtocolSocket}}*)MemoryManager::s\_active\_memory\_manager-\/> malloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{TransmissionControlProtocolSocket}}));}
\DoxyCodeLine{541 }
\DoxyCodeLine{542     \textcolor{comment}{//If there is space for the socket}}
\DoxyCodeLine{543     \textcolor{keywordflow}{if}(socket != 0)}
\DoxyCodeLine{544     \{}
\DoxyCodeLine{545         \textcolor{comment}{//Set the socket}}
\DoxyCodeLine{546         \textcolor{keyword}{new} (socket) \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a6cb78908521ca4ec70a18ed72b6b96bf}{TransmissionControlProtocolSocket}}(\textcolor{keyword}{this});}
\DoxyCodeLine{547 }
\DoxyCodeLine{548         \textcolor{comment}{//Configure the socket}}
\DoxyCodeLine{549         socket -\/> state = \mbox{\hyperlink{namespacemaxOS_1_1net_af461188b92ce6b75f84da8d98c1cc3f8a56252a0c93c53f83dc0b20badbf38b08}{LISTEN}};}
\DoxyCodeLine{550         socket -\/> localIP = \mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolPayloadHandler_a3adb1aeac42ac73a8c52c2d00ebd9a2f}{internetProtocolHandler}} -\/> GetInternetProtocolAddress();}
\DoxyCodeLine{551         socket -\/> localPort = ((port \& 0xFF00)>>8) | ((port \& 0x00FF) << 8);}
\DoxyCodeLine{552 }
\DoxyCodeLine{553         \textcolor{comment}{//Add the socket to the socket array}}
\DoxyCodeLine{554         \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a808523124196c3f969dfb80ba63572c8}{sockets}}.push\_back(socket);}
\DoxyCodeLine{555     \}}
\DoxyCodeLine{556 }
\DoxyCodeLine{557     \textcolor{comment}{//Return the socket}}
\DoxyCodeLine{558     \textcolor{keywordflow}{return} socket;}
\DoxyCodeLine{559 \}}

\end{DoxyCode}


References max\+O\+S\+::net\+::\+Internet\+Protocol\+Payload\+Handler\+::internet\+Protocol\+Handler, max\+O\+S\+::net\+::\+L\+I\+S\+T\+EN, sockets, and Transmission\+Control\+Protocol\+Socket.

\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_ada592497c45a1f0fe5d79acf9860dcd5}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!sendTransmissionControlProtocolPacket@{sendTransmissionControlProtocolPacket}}
\index{sendTransmissionControlProtocolPacket@{sendTransmissionControlProtocolPacket}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{sendTransmissionControlProtocolPacket()}{sendTransmissionControlProtocolPacket()}}
{\footnotesize\ttfamily void Transmission\+Control\+Protocol\+Handler\+::send\+Transmission\+Control\+Protocol\+Packet (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}} $\ast$}]{socket,  }\item[{uint8\+\_\+t $\ast$}]{data,  }\item[{uint16\+\_\+t}]{size,  }\item[{uint16\+\_\+t}]{flags = {\ttfamily 0} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Send a packet (Throught the provider) 


\begin{DoxyParams}{Parameters}
{\em socket} & The socket to send the packet from \\
\hline
{\em data} & The data to send \\
\hline
{\em size} & The size of the data \\
\hline
{\em flags} & The flags to send \\
\hline
\end{DoxyParams}


Definition at line 388 of file tcp.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{389 \{}
\DoxyCodeLine{390     \textcolor{comment}{//Get the total size of the packet and the packet with the pseudo header}}
\DoxyCodeLine{391     uint16\_t \mbox{\hyperlink{ipv4_8h_a46d6b08cf598408355fa1fc5c1de902a}{totalLength}} = \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}} + \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolHeader}{TransmissionControlProtocolHeader}});}
\DoxyCodeLine{392     uint16\_t lengthInclPHdr = \mbox{\hyperlink{ipv4_8h_a46d6b08cf598408355fa1fc5c1de902a}{totalLength}} + \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolPseudoHeader}{TransmissionControlProtocolPseudoHeader}});}
\DoxyCodeLine{393 }
\DoxyCodeLine{394     \textcolor{comment}{//Create a buffer for the packet}}
\DoxyCodeLine{395     uint8\_t* buffer = (uint8\_t*)MemoryManager::s\_active\_memory\_manager-\/> malloc(lengthInclPHdr);}
\DoxyCodeLine{396     uint8\_t* buffer2 = buffer + \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolHeader}{TransmissionControlProtocolHeader}}) + \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolPseudoHeader}{TransmissionControlProtocolPseudoHeader}});}
\DoxyCodeLine{397 }
\DoxyCodeLine{398     \textcolor{comment}{//Create the headers}}
\DoxyCodeLine{399     \mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolPseudoHeader}{TransmissionControlProtocolPseudoHeader}}* phdr = (\mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolPseudoHeader}{TransmissionControlProtocolPseudoHeader}}*)buffer;}
\DoxyCodeLine{400     \mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolHeader}{TransmissionControlProtocolHeader}}* msg = (\mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolHeader}{TransmissionControlProtocolHeader}}*)(buffer + \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolPseudoHeader}{TransmissionControlProtocolPseudoHeader}}));}
\DoxyCodeLine{401 }
\DoxyCodeLine{402     \textcolor{comment}{//Size is translated into 32bit}}
\DoxyCodeLine{403     msg -\/> \mbox{\hyperlink{tcp_8h_a3909a49a58301aec6d401cdd9ae76f5a}{headerSize32}} = \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structmaxOS_1_1net_1_1TransmissionControlProtocolHeader}{TransmissionControlProtocolHeader}})/4;}
\DoxyCodeLine{404 }
\DoxyCodeLine{405     \textcolor{comment}{//Set the ports}}
\DoxyCodeLine{406     msg -\/> \mbox{\hyperlink{tcp_8h_a26ebbf4f65c3f6fd9959d9cecef5c9d8}{srcPort}} = \mbox{\hyperlink{tcp_8cpp_abfe30d4c4185706700ed78df8308a63e}{bigEndian16}}(socket -\/> localPort);}
\DoxyCodeLine{407     msg -\/> \mbox{\hyperlink{tcp_8h_ac01766720e5781a418710ebf1ba5379e}{dstPort}} = \mbox{\hyperlink{tcp_8cpp_abfe30d4c4185706700ed78df8308a63e}{bigEndian16}}(socket -\/> remotePort);}
\DoxyCodeLine{408 }
\DoxyCodeLine{409     \textcolor{comment}{//Set TCP related data}}
\DoxyCodeLine{410     msg -\/> \mbox{\hyperlink{tcp_8h_ac41c406579d1214f4a1f0338bca28b6a}{acknowledgementNumber}} = \mbox{\hyperlink{tcp_8cpp_abb0f64c6581be532c99e657e200718a1}{bigEndian32}}( socket -\/> \mbox{\hyperlink{tcp_8h_ac41c406579d1214f4a1f0338bca28b6a}{acknowledgementNumber}} );}
\DoxyCodeLine{411     msg -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}} = \mbox{\hyperlink{tcp_8cpp_abb0f64c6581be532c99e657e200718a1}{bigEndian32}}( socket -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}} );}
\DoxyCodeLine{412     msg -\/> \mbox{\hyperlink{fat32_8h_acb7bc06bed6f6408d719334fc41698c7}{reserved}} = 0;}
\DoxyCodeLine{413     msg -\/> \mbox{\hyperlink{amd__am79c973_8h_a773b39d480759f67926cb18ae2219281}{flags}} = \mbox{\hyperlink{amd__am79c973_8h_a773b39d480759f67926cb18ae2219281}{flags}};}
\DoxyCodeLine{414     msg -\/> \mbox{\hyperlink{tcp_8h_a6b2a31b20954529dabfe0f32eda1cf11}{windowSize}} = 0xFFFF;}
\DoxyCodeLine{415     msg -\/> \mbox{\hyperlink{tcp_8h_aca974d34b50135a7d9b524a8fc2f5d00}{urgentPtr}} = 0;}
\DoxyCodeLine{416 }
\DoxyCodeLine{417     \textcolor{comment}{//Through the options allow for the MSS to be set}}
\DoxyCodeLine{418     msg -\/> \mbox{\hyperlink{tcp_8h_a2ba60f781746d31baf29e8c5a35d07e7}{options}} = ((\mbox{\hyperlink{amd__am79c973_8h_a773b39d480759f67926cb18ae2219281}{flags}} \& \mbox{\hyperlink{namespacemaxOS_1_1net_a306db96e97ff11fdb579107e0cf1288ca20ec4c36fc18a99ba2232dec0f88eb3f}{SYN}}) != 0) ? 0xB4050402 : 0;}
\DoxyCodeLine{419 }
\DoxyCodeLine{420     \textcolor{comment}{//Increase the sequence number}}
\DoxyCodeLine{421     socket -\/> \mbox{\hyperlink{tcp_8h_a2d38c5cab4c11a0212dbc06554a6e1e0}{sequenceNumber}} += \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}};}
\DoxyCodeLine{422 }
\DoxyCodeLine{423     \textcolor{comment}{//Copy the data into the buffer}}
\DoxyCodeLine{424     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}} = 0; \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}} < \mbox{\hyperlink{fat32_8h_ab2c6b258f02add8fdf4cfc7c371dd772}{size}}; \mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}}++)}
\DoxyCodeLine{425         buffer2[\mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}}] = \mbox{\hyperlink{icmp_8h_a1e43bf7d608e87228b625cca2c04d641}{data}}[\mbox{\hyperlink{namespacemaxOS_1_1drivers_1_1peripherals_a9854b786a692cef8357e51059ed90ab4a45ce6c8daf3081e4b64797e319378cb0}{i}}];}
\DoxyCodeLine{426 }
\DoxyCodeLine{427     \textcolor{comment}{//Set the pseudo header}}
\DoxyCodeLine{428     phdr -\/> \mbox{\hyperlink{arp_8h_a2c21b87d7d19b79e094d74112253a776}{srcIP}} = socket -\/> localIP;}
\DoxyCodeLine{429     phdr -\/> \mbox{\hyperlink{arp_8h_a2287eab8c0183320980c7a0addb74a5a}{dstIP}} = socket -\/> remoteIP;}
\DoxyCodeLine{430     phdr -\/> \mbox{\hyperlink{arp_8h_ab551400c74271f35d0c79f81d29cffbb}{protocol}} = 0x0600;}
\DoxyCodeLine{431     phdr -\/> \mbox{\hyperlink{ipv4_8h_a46d6b08cf598408355fa1fc5c1de902a}{totalLength}} = ((\mbox{\hyperlink{ipv4_8h_a46d6b08cf598408355fa1fc5c1de902a}{totalLength}} \& 0x00FF) << 8) | ((\mbox{\hyperlink{ipv4_8h_a46d6b08cf598408355fa1fc5c1de902a}{totalLength}} \& 0xFF00) >> 8);}
\DoxyCodeLine{432 }
\DoxyCodeLine{433     \textcolor{comment}{//Calculate the checksum}}
\DoxyCodeLine{434     msg -\/> \mbox{\hyperlink{intel__i217_8h_a6796c847bbd16253ce2538754c250bd6}{checksum}} = 0;}
\DoxyCodeLine{435     msg -\/> \mbox{\hyperlink{intel__i217_8h_a6796c847bbd16253ce2538754c250bd6}{checksum}} = \mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolHandler_af21ed9d77b68f0c51f1d80524d327ded}{InternetProtocolHandler::Checksum}}((uint16\_t*)buffer, lengthInclPHdr);}
\DoxyCodeLine{436 }
\DoxyCodeLine{437 }
\DoxyCodeLine{438     \textcolor{comment}{//Send and then free the data}}
\DoxyCodeLine{439     \mbox{\hyperlink{classmaxOS_1_1net_1_1InternetProtocolPayloadHandler_a547124e71c39318710ca97724adc447b}{Send}}(socket -\/> remoteIP, (uint8\_t*)msg, \mbox{\hyperlink{ipv4_8h_a46d6b08cf598408355fa1fc5c1de902a}{totalLength}});}
\DoxyCodeLine{440     MemoryManager::s\_active\_memory\_manager-\/> free(buffer);}
\DoxyCodeLine{441 \}}

\end{DoxyCode}


References acknowledgement\+Number, big\+Endian16(), big\+Endian32(), checksum, max\+O\+S\+::net\+::\+Internet\+Protocol\+Handler\+::\+Checksum(), data, dst\+IP, dst\+Port, flags, header\+Size32, max\+O\+S\+::drivers\+::peripherals\+::i, options, protocol, reserved, max\+O\+S\+::net\+::\+Internet\+Protocol\+Payload\+Handler\+::\+Send(), sequence\+Number, size, src\+IP, src\+Port, max\+O\+S\+::net\+::\+S\+YN, total\+Length, urgent\+Ptr, and window\+Size.



Referenced by Connect(), Disconnect(), and handle\+Internet\+Protocol\+Payload().



\doxysubsection{Friends And Related Function Documentation}
\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a6cb78908521ca4ec70a18ed72b6b96bf}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a6cb78908521ca4ec70a18ed72b6b96bf}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!TransmissionControlProtocolSocket@{TransmissionControlProtocolSocket}}
\index{TransmissionControlProtocolSocket@{TransmissionControlProtocolSocket}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{TransmissionControlProtocolSocket}{TransmissionControlProtocolSocket}}
{\footnotesize\ttfamily friend class \mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}}\hspace{0.3cm}{\ttfamily [friend]}}



Definition at line 160 of file tcp.\+h.



Referenced by Connect(), and Listen().



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a8bedb5143f41c426fb4bda0a503bb125}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a8bedb5143f41c426fb4bda0a503bb125}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!errorMessages@{errorMessages}}
\index{errorMessages@{errorMessages}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{errorMessages}{errorMessages}}
{\footnotesize\ttfamily \mbox{\hyperlink{classmaxOS_1_1common_1_1OutputStream}{common\+::\+Output\+Stream}}$\ast$ max\+O\+S\+::net\+::\+Transmission\+Control\+Protocol\+Handler\+::error\+Messages\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line 162 of file tcp.\+h.



Referenced by handle\+Internet\+Protocol\+Payload(), and Transmission\+Control\+Protocol\+Handler().

\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_aff5fa7f511f8c6c29944e3b3c801ff24}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_aff5fa7f511f8c6c29944e3b3c801ff24}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!freePorts@{freePorts}}
\index{freePorts@{freePorts}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{freePorts}{freePorts}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacemaxOS_1_1net_ac3a0656aefa32bf06fe9577285dc5957}{Transmission\+Control\+Protocol\+Port}} Transmission\+Control\+Protocol\+Handler\+::free\+Ports = 0x8000\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [protected]}}



{\bfseries{Handler}}/// 



Definition at line 165 of file tcp.\+h.



Referenced by Connect().

\mbox{\Hypertarget{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a808523124196c3f969dfb80ba63572c8}\label{classmaxOS_1_1net_1_1TransmissionControlProtocolHandler_a808523124196c3f969dfb80ba63572c8}} 
\index{maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}!sockets@{sockets}}
\index{sockets@{sockets}!maxOS::net::TransmissionControlProtocolHandler@{maxOS::net::TransmissionControlProtocolHandler}}
\doxysubsubsection{\texorpdfstring{sockets}{sockets}}
{\footnotesize\ttfamily \mbox{\hyperlink{classmaxOS_1_1common_1_1Vector}{common\+::\+Vector}}$<$\mbox{\hyperlink{classmaxOS_1_1net_1_1TransmissionControlProtocolSocket}{Transmission\+Control\+Protocol\+Socket}}$\ast$$>$ max\+O\+S\+::net\+::\+Transmission\+Control\+Protocol\+Handler\+::sockets\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line 163 of file tcp.\+h.



Referenced by Connect(), handle\+Internet\+Protocol\+Payload(), and Listen().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/max-\/os/max-\/os/kernel/include/net/\mbox{\hyperlink{tcp_8h}{tcp.\+h}}\item 
/home/runner/work/max-\/os/max-\/os/kernel/src/net/\mbox{\hyperlink{tcp_8cpp}{tcp.\+cpp}}\end{DoxyCompactItemize}
